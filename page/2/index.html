<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Robert Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Robert Blog">
<meta property="og:url" content="https://robert-pf.github.io/RobertBlog/page/2/index.html">
<meta property="og:site_name" content="Robert Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Robert Pang">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/RobertBlog/atom.xml" title="Robert Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/RobertBlog/css/style.css">

<meta name="generator" content="Hexo 5.4.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/RobertBlog/" id="logo">Robert Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/RobertBlog/">Home</a>
        
          <a class="main-nav-link" href="/RobertBlog/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/RobertBlog/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://robert-pf.github.io/RobertBlog"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Lvm快照备份恢复" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/RobertBlog/2020/03/18/Lvm%E5%BF%AB%E7%85%A7%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D/" class="article-date">
  <time datetime="2020-03-18T15:30:35.000Z" itemprop="datePublished">2020-03-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/RobertBlog/2020/03/18/Lvm%E5%BF%AB%E7%85%A7%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D/">LVM快照备份与恢复</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="基于-Linux-的-lvm-快照卷备份"><a href="#基于-Linux-的-lvm-快照卷备份" class="headerlink" title="基于 Linux 的 lvm 快照卷备份"></a>基于 Linux 的 lvm 快照卷备份</h3><p>LVM中snapshot通过“写时复制”(copy on write) 来实现，即当一个snapshot创建的时候，仅拷贝原始卷里数据的元数据(meta-data)；创建的时候，并不会有数据的物理拷贝，因此snapshot的创建几乎是实时的，当原始卷上有写操作执行时，snapshot跟踪原始卷块的改变，这个时候原始卷上将要改变的数据在改变之前被拷贝到snapshot预留的空间里。</p>
<p>当一个snapshot创建的时候，仅拷贝原始卷里数据的元数据(meta-data)。创建的时候，并不会有数据的物理拷贝，因此snapshot的创建几乎是实时的，当原始卷上有写操作执行时，snapshot跟踪原始卷块的改变，这个时候原始卷上将要改变的数据在改变之前被拷贝到snapshot预留的空间里，因此这个原理的实现叫做写时复制(copy-on-write)。</p>
<p> 注意：采取CoW实现方式时，snapshot的大小并不需要和原始卷一样大，其大小仅仅只需要考虑两个方面：从shapshot创建到释放这段时间内，估计块的改变量有多大;数据更新的频率。一旦 snapshot的空间记录满了原始卷块变换的信息，那么这个snapshot立刻被释放，从而无法使用，从而导致这个snapshot无效。所以，非常重要的一点，一定要在snapshot的生命周期里，做完你需要做得事情。</p>
<h4 id="快照原理解读："><a href="#快照原理解读：" class="headerlink" title="快照原理解读："></a>快照原理解读：</h4><p>创建快照卷</p>
<img src="https://www.linuxidc.com/upload/2016_09/160925102566304.png" alt="基于LVM的快照实现原理分析-听海博客">

<p>读写原始卷时：</p>
<ul>
<li><p>读原始卷：直接读取就行。</p>
</li>
<li><p>写原始卷：</p>
<ol>
<li> 检查Chunk位图中要写入数据所在的Chunk所对应的bitmap是否被置位；</li>
</ol>
</li>
</ul>
<ol start="2">
<li> 如果已被置位，直接写入该Chunk；如果未被置位，将拷贝该Chunk的数据到快照备份卷；</li>
<li> 将Chunk位图中对应的bitmap置位。 </li>
<li> 将数据写入原始卷。</li>
</ol>
<p>读写快照卷：</p>
<ul>
<li>读快照卷：<ol>
<li>读的chunk如果没有进行过拷贝，那么读取的就是原始卷chunk。</li>
<li>如果原始卷中对应的chunk已经被重新写过，那么此时在快照卷中一定存在一个打快照时原始的chunk的副本，用这个副本和原始没有进行过写操作的chunk拼合成一个新的卷 </li>
</ol>
</li>
<li>写快照卷：直接在快照卷空间中写，并且将bitmap置位。</li>
</ul>
<p>以下为和LVM快照相关的概念：</p>
<ul>
<li>PV(physical <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=volume">volume</a>)：物理卷，在逻辑卷管理系统最底层，可为整个物理硬盘或实际物理硬盘上的分区。</li>
<li>VG(volume group)：卷组，建立在物理卷上，卷组建立后可动态的添加卷到卷组中。</li>
<li> LV(logical volume)：逻辑卷，建立在卷组基础上，卷组中未分配空间可用于建立新的逻辑卷。</li>
<li> PE(physical extent)：物理区域，是物理卷中可用于分配的最小存储单元。</li>
</ul>
<h4 id="1、创建-LVM-卷"><a href="#1、创建-LVM-卷" class="headerlink" title="1、创建 LVM 卷"></a>1、创建 LVM 卷</h4><p>之前已经创建好了，这里就不再阐述了。</p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Lvm快照备份恢复\image-20220323180829653.png" alt="image-20220323180829653"></p>
<h4 id="2、创建-LVM-快照"><a href="#2、创建-LVM-快照" class="headerlink" title="2、创建 LVM 快照"></a>2、创建 LVM 快照</h4><ul>
<li><p>前提：lvm快照和对应的lvm是在同一个vg组中</p>
</li>
<li><p>vg 剩余的空间足够，一般建议为 lvm 容量 10%以上。</p>
<p>具体命令如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">lvcreate -L 2GB -s -n dataMongo_snap  /dev/data/dataMongo</span><br><span class="line">-L 300G 表示此次创建快照大小</span><br><span class="line">-s 表示创建快照</span><br><span class="line">-n 新的快照名字</span><br><span class="line">/dev/data/dataMongo 为要创建快照的逻辑卷</span><br></pre></td></tr></table></figure>

<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Lvm快照备份恢复\image-20220323185310609.png" alt="image-20220323185310609"></p>
<p>执行 lvs 命令可以看到创建出的快照卷，其中的Data% 为当前快照卷的利用率。 </p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Lvm快照备份恢复\image-20220323181643716.png" alt="image-20220323181643716"></p>
</li>
</ul>
<h4 id="3、快照的备份还原"><a href="#3、快照的备份还原" class="headerlink" title="3、快照的备份还原"></a>3、快照的备份还原</h4><ul>
<li><p>方案一、dd命令：需要准备一块磁盘磁盘和原始卷的大小一样。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/data/dataMongo_snap of=/dev/sdc</span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Lvm快照备份恢复\image-20220323212250876.png" alt="image-20220323212250876"></p>
<ul>
<li><p>方案二、copy命令只需要准备与实际文件大小即可。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mount /dev/data/dataMongo_snap /mnt</span><br><span class="line"><span class="built_in">cp</span> /mnt/* /data_copy</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://robert-pf.github.io/RobertBlog/2020/03/18/Lvm%E5%BF%AB%E7%85%A7%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D/" data-id="cl26a2mty000130uvfss38ow0" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/RobertBlog/tags/LVM/" rel="tag">LVM</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Mongodb搭建" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/RobertBlog/2020/03/18/Mongodb%E6%90%AD%E5%BB%BA/" class="article-date">
  <time datetime="2020-03-18T15:30:35.000Z" itemprop="datePublished">2020-03-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/RobertBlog/2020/03/18/Mongodb%E6%90%AD%E5%BB%BA/">MongoDB</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="数据模型："><a href="#数据模型：" class="headerlink" title="数据模型："></a>数据模型：</h4><p>​    层次模型：是以“上下级”的层次关系来组织数据的一种方式，层次模型的数据结构看起来就像一颗树：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">            ┌─────┐</span><br><span class="line">            │     │</span><br><span class="line">            └─────┘</span><br><span class="line">               │</span><br><span class="line">       ┌───────┴───────┐</span><br><span class="line">       │               │</span><br><span class="line">    ┌─────┐         ┌─────┐</span><br><span class="line">    │     │         │     │</span><br><span class="line">    └─────┘         └─────┘</span><br><span class="line">       │               │</span><br><span class="line">   ┌───┴───┐       ┌───┴───┐</span><br><span class="line">   │       │       │       │</span><br><span class="line">┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐</span><br><span class="line">│     │ │     │ │     │ │     │</span><br><span class="line">└─────┘ └─────┘ └─────┘ └─────┘</span><br></pre></td></tr></table></figure>

<p>​    网状模型把每个数据节点和其他很多节点都连接起来，它的数据结构看起来就像很多城市之间的路网：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">    ┌─────┐      ┌─────┐</span><br><span class="line">   ┌─│     │──────│     │──┐</span><br><span class="line">   │ └─────┘      └─────┘  │</span><br><span class="line">   │    │            │     │</span><br><span class="line">   │    └──────┬─────┘     │</span><br><span class="line">   │           │           │</span><br><span class="line">┌─────┐     ┌─────┐     ┌─────┐</span><br><span class="line">│     │─────│     │─────│     │</span><br><span class="line">└─────┘     └─────┘     └─────┘</span><br><span class="line">   │           │           │</span><br><span class="line">   │     ┌─────┴─────┐     │</span><br><span class="line">   │     │           │     │</span><br><span class="line">   │  ┌─────┐     ┌─────┐  │</span><br><span class="line">   └──│     │─────│     │──┘</span><br><span class="line">      └─────┘     └─────┘</span><br></pre></td></tr></table></figure>

<p>关系模型把数据看作是一个二维表格，任何数据都可以通过行号+列号来唯一确定，它的数据模型看起来就是一个Excel表：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">┌─────┬─────┬─────┬─────┬─────┐</span><br><span class="line">│     │     │     │     │     │</span><br><span class="line">├─────┼─────┼─────┼─────┼─────┤</span><br><span class="line">│     │     │     │     │     │</span><br><span class="line">├─────┼─────┼─────┼─────┼─────┤</span><br><span class="line">│     │     │     │     │     │</span><br><span class="line">├─────┼─────┼─────┼─────┼─────┤</span><br><span class="line">│     │     │     │     │     │</span><br><span class="line">└─────┴─────┴─────┴─────┴─────┘</span><br></pre></td></tr></table></figure>

<h4 id="关系型数据库："><a href="#关系型数据库：" class="headerlink" title="关系型数据库："></a>关系型数据库：</h4><p>典型的关系型数据库代表：</p>
<p>Oracle、SQL Server、MySQL、PostgreSQL、DB2、SAP</p>
<p>优点：使用简单，便于维护</p>
<p>缺点：</p>
<ul>
<li>1.网站的用户并发性非常高，往往达到每秒上万次读写请求，对于传统关系型数据库来说，硬盘I/O是一个很大的瓶颈</li>
<li>2.网站每天产生的数据量是巨大的，对于关系型数据库来说，在一张包含海量数据的表中查询，效率是非常低的</li>
<li>3.在基于web的结构当中，数据库是最难进行横向扩展的，当一个应用系统的用户量和访问量与日俱增的时候，数据库却没有办法像web server和app server那样简单的通过添加更多的硬件和服务节点来扩展性能和负载能力。当需要对数据库系统进行升级和扩展时，往往需要停机维护和数据迁移。</li>
<li>4.性能欠佳：在关系型数据库中，导致性能欠佳的最主要原因是多表的关联查询，以及复杂的数据分析类型的复杂SQL报表查询。为了保证数据库的ACID特性，必须尽量按照其要求的范式进行设计，关系型数据库中的表都是存储一个格式化的数据结构。</li>
</ul>
<p>数据库事务必须具备ACID特性，</p>
<ul>
<li>Atomic原子性，</li>
<li>Consistency一致性，</li>
<li>Isolation隔离性，</li>
<li>Durability持久性。</li>
</ul>
<h4 id="非关系型数据库："><a href="#非关系型数据库：" class="headerlink" title="非关系型数据库："></a>非关系型数据库：</h4><p>非关系型数据库以键值对存储，且结构不固定，每一个元组可以有不一样的字段，每个元组可以根据需要增加一些自己的键值对，不局限于固定的结构，可以减少一些时间和空间的开销。用户可以根据需要去添加自己需要的字段</p>
<p>优点</p>
<ul>
<li>用户可以根据需要去添加自己需要的字段，为了获取用户的不同信息，不像关系型数据库中，要对多表进行关联查询。仅需要根据id取出相应的value就可以完成查询。</li>
<li>适用于SNS(Social Networking Services)中，例如facebook，微博。系统的升级，功能的增加，往往意味着数据结构巨大变动，这一点关系型数据库难以应付，需要新的结构化数据存储。由于不可能用一种数据结构化存储应付所有的新的需求，因此，非关系型数据库严格上不是一种数据库，应该是一种数据结构化存储方法的集合。</li>
</ul>
<p>不足：</p>
<ul>
<li>只适合存储一些较为简单的数据，对于需要进行较复杂查询的数据，关系型数据库显的更为合适。不适合持久存储海量数据</li>
</ul>
<p>非关系型数据库分类：</p>
<ul>
<li>高性能并发读写的key-value数据库：Redis</li>
<li>面向海量数据访问的面向文档数据库：MongoDB</li>
<li>面向搜索数据内容的搜索引擎：Elasticsearch，Splunk</li>
<li>面向可扩展性的分布式数据库：Cassandra，HBase，</li>
</ul>
<h4 id="MongoDB-简介"><a href="#MongoDB-简介" class="headerlink" title="MongoDB  简介"></a>MongoDB  简介</h4><p>MongoDB 是一个基于分布式文件存储的数据库。由 C++ 语言编写。旨在为 WEB 应用提供可扩展的高性能数据存储解决方案，是一个介于关系数据库和非关系数据库之间的产品，是非关系数据库当中功能最丰富，最像关系数据库的。它支持的数据结构非常松散，是类似json的bson格式，因此可以存储比较复杂的数据类型。Mongo最大的特点是它支持的查询语言非常强大，其语法有点类似于面向对象的查询语言，几乎可以实现类似关系数据库单表查询的绝大部分功能，而且还支持对数据建立索引。</p>
<p><img src="/RobertBlog/.io//Users\Robert\AppData\Roaming\Typora\typora-user-images\image-20220322211821380.png"></p>
<h5 id="1、下载镜像："><a href="#1、下载镜像：" class="headerlink" title="1、下载镜像："></a>1、下载镜像：</h5><p>地址：<a target="_blank" rel="noopener" href="https://www.mongodb.com/download-center/community">https://www.mongodb.com/download-center/community</a></p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Mongdb搭建\image-20220318092129146.png" alt="image-20220318092129146"></p>
<p>根据操作系统的类别和版本来选择。</p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Mongdb搭建\image-20220318151448048.png" alt="image-20220318151448048"></p>
<p>server仅包含mongodb server，</p>
<p>shell仅包含mongo客户端命令mongo，rpm可以用<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=yum&spm=1001.2101.3001.7020">yum</a>或者rpm安装，tgz直接解压并配置path就可以使用</p>
<p>最后的tgz包包含了所有组件（mongos，shell和server），直接解压就可以使用。</p>
<h5 id="2、配置环境变量"><a href="#2、配置环境变量" class="headerlink" title="2、配置环境变量"></a>2、配置环境变量</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/profile</span><br></pre></td></tr></table></figure>

<p>将数据库的安装目录加入环境变量中：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> MONGODB_HOME=/mongodb</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$MONGODB_HOME</span>/bin:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure>

<p>使环境变量配置生效：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure>



<h5 id="3、创建数据库目录"><a href="#3、创建数据库目录" class="headerlink" title="3、创建数据库目录"></a>3、创建数据库目录</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /mongodb/</span><br><span class="line"><span class="built_in">mkdir</span> data		<span class="comment">#必须有这步，这个使存放数据文件的路径，并且启动mongod进程是必须用此参数</span></span><br><span class="line"><span class="built_in">mkdir</span> <span class="built_in">log</span>		<span class="comment">#同上</span></span><br></pre></td></tr></table></figure>

<h5 id="4、启动MongoDB服务"><a href="#4、启动MongoDB服务" class="headerlink" title="4、启动MongoDB服务"></a>4、启动MongoDB服务</h5><ul>
<li>启动方式一：指定命令行启动</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mongod --dbpath /mongodb/data  --logpath /mongodb/log		--fork</span><br><span class="line"><span class="comment">#mongod --dbpath 数据文件存放路径  --logpath 日志文件存放路径	--fork 指定进程后台运行，也可以用Linux的&amp;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>启动方式二：使用配置文件启动，此配置文件需要提前编辑好</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -f [ --config] arg	Configuration file specifying</span></span><br><span class="line">mongod -f /mongodb/mongodb.conf</span><br></pre></td></tr></table></figure>

<p>​    配置文件内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">systemLog:</span><br><span class="line">   destination: file</span><br><span class="line">   path: <span class="string">&quot;/mongodb/log/mongod.log&quot;</span>	<span class="comment">#备份需要日志路径是绝对路径</span></span><br><span class="line">   logAppend: <span class="literal">true</span></span><br><span class="line">storage:</span><br><span class="line">   dbPath: <span class="string">&quot;/mongodb/data&quot;</span>	<span class="comment">#路径是绝对路径</span></span><br><span class="line">   journal:</span><br><span class="line">      enabled: <span class="literal">true</span></span><br><span class="line">processManagement:</span><br><span class="line">   fork: <span class="literal">true</span></span><br><span class="line">net:</span><br><span class="line">   bindIp: 0.0.0.0</span><br><span class="line">   port: 27017</span><br><span class="line">setParameter:</span><br><span class="line">   enableLocalhostAuthBypass: <span class="literal">false</span> </span><br><span class="line">security:</span><br><span class="line">　　authorization: enabled</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>配置详解：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">systemLog:</span><br><span class="line">   verbosity: &lt;int&gt; 	<span class="comment">#级别1-5，数字越大级别越高</span></span><br><span class="line">   quiet: &lt;boolean&gt;	<span class="comment">#限制输出信息：数据库命令输出，副本集活动，连接接受事件，连接关闭事件。</span></span><br><span class="line">   traceAllExceptions: &lt;boolean&gt;	<span class="comment">#为调试打印详细信息，用于支持相关的故障排除。</span></span><br><span class="line">   syslogFacility: &lt;string&gt;	<span class="comment">#将mongodb使用日志记录到系统日志中，如果要使用这个选项，必须开启--sysylog选项</span></span><br><span class="line">   path: &lt;string&gt;			<span class="comment">#指定日志文件的目录</span></span><br><span class="line">   logAppend: &lt;boolean&gt;	<span class="comment">#当mongod或mongos重启时，如果为true，将日志追加到原来日志文件内容末尾；如果为false，将创建一个新的日志文件</span></span><br><span class="line">   logRotate: &lt;string&gt;	<span class="comment">#值：rename、reopen，rename重命名日志文件；reopen关闭和重新打开日志文件，如果使用reopen你必须设置sysLog.logAppend为true</span></span><br><span class="line">   destination: &lt;string&gt;	<span class="comment">#值：file、syslog；指定为file必须指定path</span></span><br><span class="line">   timeStampFormat: &lt;string&gt;	<span class="comment">#为日志添加时间戳。</span></span><br><span class="line">storage:</span><br><span class="line">   dbPath: &lt;string&gt; <span class="comment">#指定数据文件的路径。</span></span><br><span class="line">   journal：</span><br><span class="line">     enabled: &lt;boolean&gt;	<span class="comment">#记录操作日志，防止数据丢失。默认64bit为true，32bit为false。</span></span><br><span class="line">net:</span><br><span class="line">   port: &lt;int&gt;	<span class="comment">#指定运行端口，默认值为27017，MongoDB实例监听客户端连接的端口号。</span></span><br><span class="line">   bindIp: &lt;string&gt;	<span class="comment">#指定mongodb实例绑定的ip，为了绑定多个ip，可以使用逗号分隔。</span></span><br><span class="line">   maxIncomingConnections: &lt;int&gt;	<span class="comment">#接受的最多连接数，如果高于操作系统接受的最大线程数，设置无效。默认值：1000000</span></span><br><span class="line">   wireObjectCheck: &lt;boolean&gt;	<span class="comment">#检查文档的有效性。会稍微影响性能。默认值：true</span></span><br><span class="line">   ipv6: &lt;boolean&gt;		<span class="comment">#默认为false 打开IPV6功能，默认为关闭的。</span></span><br><span class="line">   unixDomainSocket:	</span><br><span class="line">      enabled: &lt;boolean&gt;</span><br><span class="line">      pathPrefix: &lt;string&gt;</span><br><span class="line">      filePermissions: &lt;int&gt;</span><br><span class="line">   http:</span><br><span class="line">      enabled: &lt;boolean&gt;	<span class="comment">#默认为false，打开http端口，会导致更多的不安全因素。</span></span><br><span class="line">      JSONPEnabled: &lt;boolean&gt;	<span class="comment">#默认为false 运行json访问http端口，打开会导致更多的不安全因素。</span></span><br><span class="line">      RESTInterfaceEnabled: &lt;boolean&gt;	<span class="comment">#默认为false 即使http接口选项关闭，打开也会暴露http接口，会导致更多的不安全因素。</span></span><br><span class="line"><span class="comment"># ssl:</span></span><br><span class="line"><span class="comment">#  mode: &quot;requireSSL&quot;</span></span><br><span class="line"><span class="comment">#  PEMKeyFile: &quot;/etc/ssl/mongodb.pem&quot;</span></span><br><span class="line">security:</span><br><span class="line">  keyFile: <span class="string">&quot;/var/lib/mongo/mongodb-keyfile&quot;</span> <span class="comment">#指定分片集或副本集成员之间身份验证的key文件存储位置。</span></span><br><span class="line">  clusterAuthMode: <span class="string">&quot;keyFile&quot;</span> <span class="comment">#值keyFile,sendKeyFile,sendX509,x509</span></span><br><span class="line">  authorization: <span class="string">&quot;disabled&quot;</span> <span class="comment">#值：enabled、disabled；打开访问数据库和进行操作的用户角色认证。</span></span><br><span class="line">replication:</span><br><span class="line">  oplogSizeMB: 50 <span class="comment">#默认为磁盘的5%。指定oplog的最大尺寸。</span></span><br><span class="line">  replSetName: <span class="string">&quot;repl_test&quot;</span>	<span class="comment">#指定副本集的名称。</span></span><br><span class="line">  secondaryIndexPrefetch: <span class="string">&quot;all&quot;</span> <span class="comment">#值：none、all、_id_only。指定副本集成员在接受oplog之前是否加载索引到内存。默认none。</span></span><br><span class="line">sharding</span><br><span class="line">   clusterRole：<span class="comment">#configsvr，shardsvr。shardsvr</span></span><br><span class="line">setParameter:</span><br><span class="line">   enableLocalhostAuthBypass: <span class="literal">false</span> <span class="comment">#此参数只能在配置文件中设置。值：0，false,true；默认是开启的。 </span></span><br><span class="line">processManagement:</span><br><span class="line">   fork: <span class="literal">true</span>	<span class="comment">#作用：后台Daemon方式启动mongodb实例，此参数必须配个--logpath参数使用。</span></span><br></pre></td></tr></table></figure>

<p>手动数据库中设置方法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.adminCommand( &#123; setParameter: <span class="number">1</span>, <span class="operator">&lt;</span><span class="keyword">parameter</span><span class="operator">&gt;</span>: <span class="operator">&lt;</span><span class="keyword">value</span><span class="operator">&gt;</span>  &#125; )</span><br></pre></td></tr></table></figure>

<h5 id="5、向Linux系统中添加Mongodb服务"><a href="#5、向Linux系统中添加Mongodb服务" class="headerlink" title="5、向Linux系统中添加Mongodb服务"></a>5、向Linux系统中添加Mongodb服务</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/init.d/mongodb</span><br></pre></td></tr></table></figure>

<p>添加内容：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#chkconfig: 2345 80 90</span></span><br><span class="line"><span class="comment">#description:auto_run</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ### BEGIN INIT INFO</span></span><br><span class="line"><span class="comment"># Short-Description: mongodb   </span></span><br><span class="line"><span class="comment"># Description: mongo db server   </span></span><br><span class="line"><span class="comment">### END INIT INFO   </span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">PROGRAM=/mongodb/bin/mongod	<span class="comment">#设置mongod的路径</span></span><br><span class="line">MONGOPID=`ps -ef | grep <span class="string">&#x27;mongod&#x27;</span> | grep -v grep | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>`</span><br><span class="line"> </span><br><span class="line"><span class="built_in">test</span> -x <span class="variable">$PROGRAM</span> || <span class="built_in">exit</span> 0</span><br><span class="line"> </span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">  start)</span><br><span class="line">     <span class="built_in">ulimit</span> -n 3000</span><br><span class="line">     <span class="built_in">echo</span> <span class="string">&quot;Starting MongoDB server&quot;</span></span><br><span class="line">     <span class="variable">$PROGRAM</span> --fork --quiet -f /mongodb/mongodb.config <span class="comment">#用命令启动书库服务</span></span><br><span class="line">     <span class="built_in">echo</span> <span class="string">&quot;Started MongoDB server&quot;</span></span><br><span class="line">     ;;</span><br><span class="line">  stop)</span><br><span class="line">     <span class="built_in">echo</span> <span class="string">&quot;Stopping MongoDB server&quot;</span></span><br><span class="line">     <span class="keyword">if</span> [ ! -z <span class="string">&quot;<span class="variable">$MONGOPID</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">kill</span> -15 <span class="variable">$MONGOPID</span></span><br><span class="line">     <span class="keyword">fi</span></span><br><span class="line">     <span class="built_in">echo</span> <span class="string">&quot;Stopped MongoDB server&quot;</span></span><br><span class="line">     ;;</span><br><span class="line">  status)</span><br><span class="line">     ;;</span><br><span class="line">  *)</span><br><span class="line">     <span class="built_in">echo</span> <span class="string">&quot;Usage: mongodb &#123;start|stop|status&#125;&quot;</span></span><br><span class="line">     <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"> </span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure>

<h5 id="6、设置Mongodb服务自启动"><a href="#6、设置Mongodb服务自启动" class="headerlink" title="6、设置Mongodb服务自启动"></a>6、设置Mongodb服务自启动</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x /etc/init.d/mongodb</span><br><span class="line">chkconfig --add mongodb</span><br><span class="line">chkconfig mongodb on</span><br></pre></td></tr></table></figure>

<h5 id="7、关闭数据库"><a href="#7、关闭数据库" class="headerlink" title="7、关闭数据库"></a>7、关闭数据库</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mongo </span><br><span class="line">db.shutdownServer()</span><br></pre></td></tr></table></figure>

<h5 id="8、连接数据库"><a href="#8、连接数据库" class="headerlink" title="8、连接数据库"></a>8、连接数据库</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mongodb://[username:password@]host1[:port1][,host2[:port2],...[,hostN[:portN]]][/[database][?options]]</span></span><br><span class="line">mongodb </span><br></pre></td></tr></table></figure>

<h5 id="9、在mongodb中基本的概念是文档、集合、数据库，"><a href="#9、在mongodb中基本的概念是文档、集合、数据库，" class="headerlink" title="9、在mongodb中基本的概念是文档、集合、数据库，"></a>9、在mongodb中基本的概念是文档、集合、数据库，</h5><table>
<thead>
<tr>
<th align="left">SQL术语/概念</th>
<th align="center">MongoDB术语/概念</th>
<th align="center">解释/说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">database</td>
<td align="center">database</td>
<td align="center">数据库</td>
</tr>
<tr>
<td align="left">table</td>
<td align="center">collection</td>
<td align="center">数据库表/集合</td>
</tr>
<tr>
<td align="left">row</td>
<td align="center">document</td>
<td align="center">数据记录行/文档</td>
</tr>
<tr>
<td align="left">column</td>
<td align="center">field</td>
<td align="center">数据字段/域</td>
</tr>
<tr>
<td align="left">index</td>
<td align="center">index</td>
<td align="center">索引</td>
</tr>
<tr>
<td align="left">table joins</td>
<td align="center"></td>
<td align="center">表连接,MongoDB不支持</td>
</tr>
<tr>
<td align="left">primary key</td>
<td align="center">primary key</td>
<td align="center">主键,MongoDB自动将_id字段设置为主键</td>
</tr>
</tbody></table>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Mongdb搭建\Figure-1-Mapping-Table-to-Collection-1.png" alt="img"></p>
<p>一个mongodb中可以建立多个数据库。</p>
<p>MongoDB的默认数据库为”db”，该数据库存储在data目录中。</p>
<p>MongoDB的单个实例可以容纳多个独立的数据库，每一个都有自己的集合和权限，不同的数据库也放置在不同的文件中。</p>
<h5 id="10、数据库的使用–数据库、集合"><a href="#10、数据库的使用–数据库、集合" class="headerlink" title="10、数据库的使用–数据库、集合"></a>10、数据库的使用–数据库、集合</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db #默认显示是test</span><br><span class="line"><span class="keyword">show</span> dbs #命令可以显示所有数据的列表。</span><br><span class="line">use dbName	#切换数据，如果没有这个数据库，在进行实际的插入数据时会自动创建一个新的数据库。</span><br><span class="line">db.dropDatabase()	#删除当前数据库</span><br><span class="line">db.createCollection(name, options)	#name: 要创建的集合名称、options: 可选参数, 指定有关内存大小及索引的选项</span><br></pre></td></tr></table></figure>

<p> options 可以是如下参数：</p>
<table>
<thead>
<tr>
<th align="left">字段</th>
<th align="left">类型</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">capped</td>
<td align="left">布尔</td>
<td align="left">（可选）如果为 true，则创建固定集合。固定集合是指有着固定大小的集合，当达到最大值时，它会自动覆盖最早的文档。 <strong>当该值为 true 时，必须指定 size 参数。</strong></td>
</tr>
<tr>
<td align="left">size</td>
<td align="left">数值</td>
<td align="left">（可选）为固定集合指定一个最大值，即字节数。 <strong>如果 capped 为 true，也需要指定该字段。</strong></td>
</tr>
<tr>
<td align="left">max</td>
<td align="left">数值</td>
<td align="left">（可选）指定固定集合中包含文档的最大数量。</td>
</tr>
</tbody></table>
<p>在插入文档时，MongoDB 首先检查固定集合的 size 字段，然后检查 max 字段。</p>
<p>在 MongoDB 中，你不需要创建集合。当你插入一些文档时，MongoDB 会自动创建集合。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> collections #<span class="keyword">show</span> tables 也可。</span><br><span class="line">db.collectionName.drop() #删除集合，先切换到对应得数据库中执行</span><br></pre></td></tr></table></figure>

<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Mongdb搭建\image-20220320170311683.png" alt="image-20220320170311683"></p>
<h5 id="11、数据库的使用–文档"><a href="#11、数据库的使用–文档" class="headerlink" title="11、数据库的使用–文档"></a>11、数据库的使用–文档</h5><p>文档的数据结构和 JSON 基本一样。所有存储在集合中的数据都是 BSON 格式。BSON 是一种类似 JSON 的二进制形式的存储格式，是 Binary JSON 的简称。</p>
<p>插入</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.COLLECTION_NAME.insert()</span><br><span class="line">db.collection.insertOne()</span><br><span class="line">db.collection.insertMany()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Mongdb搭建\image-20220320184725547.png" alt="image-20220320184725547"></p>
<p>更新</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">db.collection.update(</span><br><span class="line">   <span class="operator">&lt;</span>query<span class="operator">&gt;</span>,</span><br><span class="line">   <span class="operator">&lt;</span><span class="keyword">update</span><span class="operator">&gt;</span>,</span><br><span class="line">   &#123;</span><br><span class="line">     upsert: <span class="operator">&lt;</span><span class="type">boolean</span><span class="operator">&gt;</span>,</span><br><span class="line">     multi: <span class="operator">&lt;</span><span class="type">boolean</span><span class="operator">&gt;</span>,</span><br><span class="line">     writeConcern: <span class="operator">&lt;</span>document<span class="operator">&gt;</span></span><br><span class="line">   &#125;</span><br><span class="line">)</span><br><span class="line">#query : <span class="keyword">update</span>的查询条件，类似<span class="keyword">sql</span> <span class="keyword">update</span>查询内<span class="keyword">where</span>后面的。</span><br><span class="line">#<span class="keyword">update</span> : <span class="keyword">update</span>的对象和一些更新的操作符（如$,$inc...）等，也可以理解为<span class="keyword">sql</span> <span class="keyword">update</span>查询内<span class="keyword">set</span>后面的</span><br><span class="line">#upsert : 可选，这个参数的意思是，如果不存在<span class="keyword">update</span>的记录，是否插入objNew,<span class="literal">true</span>为插入，默认是<span class="literal">false</span>，不插入。</span><br><span class="line">#multi : 可选，mongodb 默认是<span class="literal">false</span>,只更新找到的第一条记录，如果这个参数为<span class="literal">true</span>,就把按条件查出来多条记录全部更新。</span><br><span class="line">#writeConcern :可选，抛出异常的级别</span><br></pre></td></tr></table></figure>



<p>删除</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">db.collection.remove(</span><br><span class="line">   <span class="operator">&lt;</span>query<span class="operator">&gt;</span>,</span><br><span class="line">   &#123;</span><br><span class="line">     justOne: <span class="operator">&lt;</span><span class="type">boolean</span><span class="operator">&gt;</span>,	</span><br><span class="line">     writeConcern: <span class="operator">&lt;</span>document<span class="operator">&gt;</span></span><br><span class="line">   &#125;</span><br><span class="line">)</span><br><span class="line">#query :（可选）删除的文档的条件。</span><br><span class="line">#justOne : （可选）如果设为 <span class="literal">true</span> 或 <span class="number">1</span>，则只删除一个文档，如果不设置该参数，或使用默认值 <span class="literal">false</span>，则删除所有匹配条件的文档。</span><br><span class="line">#writeConcern :（可选）抛出异常的级别。</span><br></pre></td></tr></table></figure>

<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Mongdb搭建\image-20220320182457888.png" alt="image-20220320182457888"></p>
<h5 id="12、数据库的使用–用户篇"><a href="#12、数据库的使用–用户篇" class="headerlink" title="12、数据库的使用–用户篇"></a>12、数据库的使用–用户篇</h5><ul>
<li>​    设置管理员账户</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use admin</span><br><span class="line">db.createUser(&#123; <span class="keyword">user</span>: &quot;test&quot;, pwd: &quot;password&quot;, roles: [&#123; role: &quot;userAdminAnyDatabase&quot;, db: &quot;admin&quot; &#125;] &#125;)</span><br></pre></td></tr></table></figure>

<p>mongodb中的用户是基于身份role的，该管理员账户的 role是 userAdminAnyDatabase。 ‘userAdmin’代表用户管理身份，’AnyDatabase’ 代表可以管理任何数据库。</p>
<p>开启用户认证需要在配置文件中添加参数：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">security:</span><br><span class="line">　　<span class="keyword">authorization</span>: enabled</span><br></pre></td></tr></table></figure>

<p>登陆验证：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use admin</span><br><span class="line">db.auth(&quot;admin&quot;, &quot;password&quot;)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>创建普通用户</p>
<p>进入mongodb,用第3步的 管理员账户登录，用该账户创建其他数据库管理员账号:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">use admin</span><br><span class="line">db.auth(&quot;admin&quot;, &quot;password&quot;)	#先认证管理员</span><br><span class="line">use databaseName</span><br><span class="line">db.createUser(&#123; <span class="keyword">user</span>: &quot;youruser&quot;, pwd: &quot;yourpassword&quot;, roles: [&#123; role: &quot;dbOwner&quot;, db: &quot;databaseName&quot; &#125;] &#125;)	#设置其他库的账号密码及权限</span><br></pre></td></tr></table></figure>

<ul>
<li><p>rote:dbOwner 代表数据库所有者角色，拥有最高该数据库最高权限。比如新建索引等</p>
</li>
<li><p>Read：允许用户读取指定数据库</p>
</li>
<li><p>readWrite：允许用户读写指定数据库</p>
</li>
<li><p>dbAdmin：允许用户在指定数据库中执行管理函数，如索引创建、删除，查看统计或访问system.profile</p>
</li>
<li><p>userAdmin：允许用户向system.users集合写入，可以找指定数据库里创建、删除和管理用户</p>
</li>
<li><p>clusterAdmin：只在admin数据库中可用，赋予用户所有分片和复制集相关函数的管理权限。</p>
</li>
<li><p>readAnyDatabase：只在admin数据库中可用，赋予用户所有数据库的读权限</p>
</li>
<li><p>readWriteAnyDatabase：只在admin数据库中可用，赋予用户所有数据库的读写权限</p>
</li>
<li><p>userAdminAnyDatabase：只在admin数据库中可用，赋予用户所有数据库的userAdmin权限</p>
</li>
<li><p>dbAdminAnyDatabase：只在admin数据库中可用，赋予用户所有数据库的dbAdmin权限。</p>
</li>
<li><p>root：只在admin数据库中可用。超级账号，超级权限</p>
</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://robert-pf.github.io/RobertBlog/2020/03/18/Mongodb%E6%90%AD%E5%BB%BA/" data-id="cl26a2mub000930uv9f7134xb" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/RobertBlog/tags/MongoDB/" rel="tag">MongoDB</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-设计模式" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/RobertBlog/2020/03/18/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" class="article-date">
  <time datetime="2020-03-18T15:30:35.000Z" itemprop="datePublished">2020-03-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/RobertBlog/2020/03/18/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a>代理模式</h3><p>代理模式分类：</p>
<ol>
<li>静态代理</li>
<li>动态代理</li>
</ol>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Spring\代理1.png" alt="image-20220407225308179"></p>
<h5 id="静态代理"><a href="#静态代理" class="headerlink" title="静态代理"></a>静态代理</h5><p>角色分析：</p>
<ul>
<li>抽象角色：一般会使用接口或者抽象类来解决</li>
<li>真实角色：被代理的角色</li>
<li>代理角色：代理真实角色，代理角色实现后会做一些附属操作</li>
<li>客户：访问代理对象的人</li>
</ul>
<p>代理模式的优点：</p>
<ul>
<li>实现了真是角色专注的办理专注的事情，不用去关注一些公共的业务</li>
<li>公共的操作交给代理角色，实现了业务的分工</li>
<li>公共业务的改变，实现了集中处理</li>
</ul>
<p>缺点：</p>
<ul>
<li>代码量的上升</li>
</ul>
<h5 id="动态代理"><a href="#动态代理" class="headerlink" title="动态代理"></a>动态代理</h5><ul>
<li><p>动态代理和静态代理角色一样</p>
</li>
<li><p>动态代理的代理类是动态生成的</p>
</li>
<li><p>动态代理类分为两大类：基于接口、基于类</p>
<ol>
<li><p>基于接口的动态代理–JDK动态代理</p>
</li>
<li><p>基于类的动态代理–cglib</p>
</li>
<li><p>java字节码实现。</p>
</li>
</ol>
</li>
</ul>
<p>优点：</p>
<ul>
<li>可以真正让业务层专注与自己的业务逻辑，不用关注公共业务</li>
<li>公共的交给代理类，实现了业务的分工</li>
<li>公共业务发生扩展的时候，方便集中管理</li>
<li>一个动态代理类的是一个接口，一般对应一类业务</li>
<li>一个动态代理类可以代理多个类，只要实现了同一个接口</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://robert-pf.github.io/RobertBlog/2020/03/18/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" data-id="cl26a2muz000h30uvcb1p8jtl" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/RobertBlog/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Java垃圾回收" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/RobertBlog/2020/03/18/Java%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/" class="article-date">
  <time datetime="2020-03-18T15:30:35.000Z" itemprop="datePublished">2020-03-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/RobertBlog/2020/03/18/Java%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/">垃圾回收</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="/RobertBlog/.io//image-20220611163432909.png" alt="image-20220611163432909"></p>
<p><img src="/RobertBlog/.io//image-20220611173419153.png" alt="image-20220611173419153"></p>
<p><img src="/RobertBlog/.io//image-20220611175650472.png" alt="image-20220611175650472"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://robert-pf.github.io/RobertBlog/2020/03/18/Java%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/" data-id="cl6w6pzi50001k4igbgiu0bi6" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/RobertBlog/tags/LVM/" rel="tag">LVM</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Spring" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/RobertBlog/2020/02/25/Spring/" class="article-date">
  <time datetime="2020-02-25T15:30:35.000Z" itemprop="datePublished">2020-02-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/RobertBlog/2020/02/25/Spring/">Spring</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h2><p><strong>容器</strong>：为某种特定组件的运行提供必要支持的一个软件环境。</p>
<p>​        Docker：提供了一个Linux进程运行所必要的Linux环境。</p>
<p>​        Tomcat：给Servlet的运行提供运行环境。</p>
<p><strong>核心</strong>：为IoC容器提供了一个容器环境。可以管理所有轻量级的JavaBean组件。</p>
<p>​            <strong>IoC</strong>： Inversion of Control，控制反转。传统的应用，控制权在程序本身；在IoC模式下，控制权发生了反转，从应用程序本身转移到了IoC容器。通俗点就是，没有用IoC时，程序怎么走的决定权在程序本身，但是在IoC环境下，程序怎么走得看环境中有什么。</p>
<p>​        <strong>IoC</strong>：又称为依赖注入（Dependency Injection）,将组件的创建和配置与组件得使用相分离，并且由IoC容器负责管理组件得生命周期。</p>
<h4 id="优点："><a href="#优点：" class="headerlink" title="优点："></a>优点：</h4><ul>
<li><p>Spring是一个开源的免费的框架（容器）！</p>
</li>
<li><p>Spring是一个轻量级、非入侵式的框架！</p>
</li>
<li><p>控制反转（IoC）,面向切面编程（AOP）!</p>
</li>
<li><p>支持事务的处理，对框架整合的支持！</p>
<p>Spring是一个轻量级的控制反转（IoC）,面向切面编程（AOP）的框架。</p>
</li>
</ul>
<p><strong>提供的底层服务</strong>：组件的生命周期管理、配置、组装服务。AOP支持，建立在AOP基础上的的生命事务服务等。</p>
<p><strong>组件</strong>：JavaBean，配置一个JavaBean就是配置一个组件。</p>
<h4 id="别名、Bean的配置："><a href="#别名、Bean的配置：" class="headerlink" title="别名、Bean的配置："></a>别名、Bean的配置：</h4><p>可以用<alias name=" fromNmame" alias="toName">将一个bean对象，赋予不同的name，通过这个name客户获取到同一个实例。其中fromName为实例的id。如果使用不当的话，可能会产生空实例。</alias></p>
<p>但是用name也可以取别名，此种方法可以多个名字对应一个实例，而且不容易产生空实例。一般情况下建议用name来起别名。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><span class="line">         &lt;bean id=<span class="string">&quot;cat&quot;</span> class=<span class="string">&quot;com.spring.autowired.Cat&quot;</span>  name=<span class="string">&quot;TomCat,cat2:cat3;cat4&quot;</span>/&gt;</span><br><span class="line">        &lt;!--</span><br><span class="line">        id:bean 的唯一标识，也就是相当于对象名</span><br><span class="line">        class： bean 对象所属的类</span><br><span class="line">        name：也是别名，而却name 可以同时取多个名字</span><br><span class="line">        --&gt;</span><br><span class="line">        &lt;alias name=<span class="string">&quot;cat&quot;</span> alias=<span class="string">&quot;catNew&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>

<h4 id="import：导入本xml之外的xml配置文件"><a href="#import：导入本xml之外的xml配置文件" class="headerlink" title="import：导入本xml之外的xml配置文件"></a>import：导入本xml之外的xml配置文件</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><span class="line">&lt;!--<span class="keyword">import</span>:</span><br><span class="line">    就是将不同的xml文件合并到一个总的xlm中。类似于java中的<span class="keyword">import</span>包的概念。</span><br><span class="line">    以下示例中就是将bean，bean2的xml中的配置导入本xml中。</span><br><span class="line">    --&gt;</span><br><span class="line">    &lt;<span class="keyword">import</span> resource=<span class="string">&quot;bean.xml&quot;</span>/&gt;</span><br><span class="line">    &lt;<span class="keyword">import</span> resource=<span class="string">&quot;bean2.xml&quot;</span>/&gt;</span><br><span class="line">&lt;/beans&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="DI-依赖注入的方式有两种："><a href="#DI-依赖注入的方式有两种：" class="headerlink" title="DI 依赖注入的方式有两种："></a><strong>DI 依赖注入的方式有两种</strong>：</h4><ol>
<li><p>使用set()方法实现，也称为属性注入方式。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> DataSource dataSource;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDataSource</span><span class="params">(DataSource dataSource)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.dataSource = dataSource;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>通过构造方法实现，也称为构造方法注入。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> DataSource dataSource;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BookService</span><span class="params">(DataSource dataSource)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.dataSource = dataSource;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>注</strong>：Spring的IoC容器同时支持属性注入和构造方法注入，并允许混合使用。然后再配置application.xml</p>
<h4 id="依赖配置："><a href="#依赖配置：" class="headerlink" title="依赖配置："></a>依赖配置：</h4><h5 id="1、xml中用基本的方法注入"><a href="#1、xml中用基本的方法注入" class="headerlink" title="1、xml中用基本的方法注入"></a>1、xml中用基本的方法注入</h5><p>使用xml的property进行配置值基本的属性：String、arrays、 list、set、map、properties 属性：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;address&quot;</span> class=<span class="string">&quot;com.Spring.Study.Address&quot;</span> &gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;add&quot;</span> value=<span class="string">&quot;人才公寓&quot;</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">    &lt;bean id=<span class="string">&quot;Student&quot;</span> class=<span class="string">&quot;com.Spring.Study.Student&quot;</span>&gt;</span><br><span class="line">&lt;!--        注入数值--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;name&quot;</span> value=<span class="string">&quot;Robert&quot;</span>/&gt;</span><br><span class="line">&lt;!--        bean 注入--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;address&quot;</span> ref=<span class="string">&quot;address&quot;</span>/&gt;</span><br><span class="line">&lt;!--        数组注入--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;books&quot;</span>&gt;</span><br><span class="line">            &lt;array&gt;</span><br><span class="line">                &lt;value&gt;红楼梦&lt;/value&gt;</span><br><span class="line">                &lt;value&gt;水浒传&lt;/value&gt;</span><br><span class="line">                &lt;value&gt;西游记&lt;/value&gt;</span><br><span class="line">            &lt;/array&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">&lt;!--        set注入--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;games&quot;</span>&gt;</span><br><span class="line">            &lt;set&gt;</span><br><span class="line">                &lt;value&gt;王者荣耀&lt;/value&gt;</span><br><span class="line">                &lt;value&gt;穿越火线&lt;/value&gt;</span><br><span class="line">            &lt;/set&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">&lt;!--        map注入--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;map&quot;</span>&gt;</span><br><span class="line">            &lt;map&gt;</span><br><span class="line">                &lt;entry key=<span class="string">&quot;card&quot;</span> value=<span class="string">&quot;242345524&quot;</span>/&gt;</span><br><span class="line">            &lt;/map&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">&lt;!--        list注入--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;list&quot;</span> &gt;</span><br><span class="line">            &lt;value&gt;听歌&lt;/value&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">&lt;!--        Properties注入--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;info&quot;</span>&gt;</span><br><span class="line">            &lt;props&gt;</span><br><span class="line">                &lt;prop key=<span class="string">&quot;学号&quot;</span>&gt;<span class="number">0203160321</span>&lt;/prop&gt;</span><br><span class="line">                &lt;prop key=<span class="string">&quot;性别&quot;</span>&gt;男&lt;/prop&gt;</span><br><span class="line">            &lt;/props&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>

<h5 id="2、p命名注入"><a href="#2、p命名注入" class="headerlink" title="2、p命名注入"></a>2、p命名注入</h5><p>在xml的文件中必须添加图中标出的那行xml配置约束，在配置bean的过程中输入p会自动显示出能进行配置的属性。</p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Spring\P命名使用.png" alt="image-20220405204725909"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">       xmlns:p=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;user&quot;</span> class=<span class="string">&quot;com.Spring.Study.User&quot;</span> p:name=<span class="string">&quot;Robert&quot;</span> p:age=<span class="string">&quot;18&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>

<p>图中对应的p：name 对应的就是User的属性name</p>
<h5 id="3、c命名空间注入"><a href="#3、c命名空间注入" class="headerlink" title="3、c命名空间注入"></a>3、c命名空间注入</h5><p>同样需要导入约束：**xmlns:c=”<a target="_blank" rel="noopener" href="http://www.springframework.org/schema/c&quot;**%EF%BC%8C%E4%BD%BF%E7%94%A8%E6%AD%A4%E6%96%B9%E6%B3%95%E7%B1%BB%E5%BF%85%E9%A1%BB%E6%9C%89%E6%9C%89%E5%8F%82%E6%9E%84%E9%80%A0%E5%99%A8%E3%80%82">http://www.springframework.org/schema/c&quot;**，使用此方法类必须有有参构造器。</a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:c</span>=<span class="string">&quot;http://www.springframework.org/schema/c&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.Spring.Study.User&quot;</span> <span class="attr">p:name</span>=<span class="string">&quot;Robert&quot;</span> <span class="attr">p:age</span>=<span class="string">&quot;18&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.Spring.Study.User&quot;</span> <span class="attr">c:name</span>=<span class="string">&quot;Daisy&quot;</span> <span class="attr">c:age</span>=<span class="string">&quot;18&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.Spring.Study.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Robert</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2022-04-05 20:50</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;user.xml&quot;</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;user&quot;</span>, User.class);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">        System.out.println(<span class="string">&quot;************************&quot;</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user2</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;user2&quot;</span>, User.class);</span><br><span class="line">        System.out.println(user2);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Bean的作用域："><a href="#Bean的作用域：" class="headerlink" title="Bean的作用域："></a>Bean的作用域：</h4><table>
<thead>
<tr>
<th><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-scopes-singleton">singleton</a></th>
<th>(Default) Scopes a single bean definition to a single object instance for each Spring IoC container.</th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-scopes-prototype">prototype</a></td>
<td>Scopes a single bean definition to any number of object instances.</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-scopes-request">request</a></td>
<td>Scopes a single bean definition to the lifecycle of a single HTTP request. That is, each HTTP request has its own instance of a bean created off the back of a single bean definition. Only valid in the context of a web-aware Spring <code>ApplicationContext</code>.</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-scopes-session">session</a></td>
<td>Scopes a single bean definition to the lifecycle of an HTTP <code>Session</code>. Only valid in the context of a web-aware Spring <code>ApplicationContext</code>.</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-scopes-application">application</a></td>
<td>Scopes a single bean definition to the lifecycle of a <code>ServletContext</code>. Only valid in the context of a web-aware Spring <code>ApplicationContext</code>.</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#websocket-stomp-websocket-scope">websocket</a></td>
<td>Scopes a single bean definition to the lifecycle of a <code>WebSocket</code>. Only valid in the context of a web-aware Spring <code>ApplicationContext</code>.</td>
</tr>
</tbody></table>
<p>1、单例模式（Spring 默认机制）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="type">bean</span> <span class="variable">id</span> <span class="operator">=</span> <span class="string">&quot;user&quot;</span> class=<span class="string">&quot;com.Robert.learnjava.user&quot;</span> c:age=<span class="number">18</span> scope=<span class="string">&quot;singleton&quot;</span>&gt;&lt;/bean&gt;</span><br></pre></td></tr></table></figure>

<p>2、原型模式：每次从容器中get的时候，都会产生一个新的对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="type">bean</span> <span class="variable">id</span> <span class="operator">=</span> <span class="string">&quot;user&quot;</span> class=<span class="string">&quot;com.Robert.learnjava.user&quot;</span> c:age=<span class="number">18</span> scope=<span class="string">&quot;prototype&quot;</span>&gt;&lt;/bean&gt;</span><br></pre></td></tr></table></figure>

<p>3、其余的request、session、application 这些个只能在Web开发中使用到。</p>
<h4 id="装配Bean"><a href="#装配Bean" class="headerlink" title="装配Bean"></a>装配Bean</h4><p>​    自动装配式Spring满足bean依赖一种方式，Spring会根据上下文自动寻找对应的bean并装配。</p>
<p>装配bean的方法共三种：</p>
<ol>
<li>在xml中显示的配置</li>
<li>在java中显示配置</li>
<li>隐式的自动装配Bean</li>
</ol>
<h5 id="方法一：使用xml配置文件配置"><a href="#方法一：使用xml配置文件配置" class="headerlink" title="方法一：使用xml配置文件配置"></a>方法一：使用xml配置文件配置</h5><p>在每一个bean中用propert注入参数。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;UserService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.Robert.learnjava.service.UserService&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;mailService&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;MailService&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcInsert&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;JdbcInsert&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;MailService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.Robert.learnjava.service.MailService&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;JdbcInsert&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.Robert.learnjava.service.JdbcInsert&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol>
<li><p>注入方式一，使用property显示注入</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dog&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.autowired.Dog&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cat&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.autowired.Cat&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.autowired.Person&quot;</span> &gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Robert&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dog&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dog&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;cat&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;cat&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>注入方式二，byName</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dog&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.autowired.Dog&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cat&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.autowired.Cat&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">byName :会自动在容器上下文中查找，和自己对象set方法后对应的值匹配对应的bean的id进行自动的装配</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.autowired.Person&quot;</span>  <span class="attr">autowire</span>=<span class="string">&quot;byName&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Robert&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>注入方式三，byType</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dog&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.autowired.Dog&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cat&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.autowired.Cat&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">byType :会自动在容器上下文中查找，可自己对象属性类型相同的bean。缺点，一个类多个bean（比如说多个Dog的bean）在注入过程中就不知道自动注入那个bean。</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.autowired.Person&quot;</span>  <span class="attr">autowire</span>=<span class="string">&quot;byType&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Robert&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<p>总结：byName 方法需要保证id唯一，byType需要保证Class唯一。</p>
<h5 id="方法二：使用注解自动配置"><a href="#方法二：使用注解自动配置" class="headerlink" title="方法二：使用注解自动配置"></a>方法二：使用注解自动配置</h5><p>Jdk 1.5支持注解，Spring 2.5开始支持注解：</p>
<p>使用注解须知：xml文件中必须添加注解的约束和开启注解的配置代码。</p>
<ul>
<li>导入约束：context约束</li>
<li>配置支持注解： *<em><a href="context:annotation-config/">context:annotation-config/</a></em>*</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">           http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">           http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">           https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    此行必须写，是用来开启注解处理器的--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:annotation-config</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>自动装配的注解：</p>
<ul>
<li>@Autowired :自动装配Bean，先Type后Name</li>
<li>@Nullable ：可配置此字段可以为空</li>
<li>@Resource：自动装配，先Name后Type</li>
</ul>
<h4 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h4><h6 id="Autowired"><a href="#Autowired" class="headerlink" title="@Autowired"></a>@Autowired</h6><p>使用@Autowired 时可以不用在bean中配置属性中包含的bean，只要在xml配置文件中创建了这个bean，那么就会自动去寻找。</p>
<p>举例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    Dog dog;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    Cat cat;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Cat</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dog</span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>如果没有配置@Autowired的话，xml配置文件应该如下所示用property设置属性，或者用byName或者byType方法自动装早属性</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dog&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.autowired.Dog&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cat&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.autowired.Cat&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.autowired.Person&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Robert&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;cat&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;cat&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dog&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dog&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在Person中配置了@Autowired之后，可以不用配置property进行bean的引用配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dog&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.autowired.Dog&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cat&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.autowired.Cat&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.autowired.Person&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Robert&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在本例中Person中自动装配了Cat和Dog这两个类的对象，如果在配置文件中并没有创建Cat的bea的话，自动装配的时候会报错：org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type ‘com.spring.autowired.Cat’ available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {@org.springframework.beans.factory.annotation.Autowired(required=true)}大致意思就是找不到对应的实例。此时可以对@Autowired加上required = false参数进行设置此引用对象可以为空。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    Dog dog;</span><br><span class="line">    <span class="meta">@Autowired(required = false)</span></span><br><span class="line">    Cat cat;&#125;</span><br></pre></td></tr></table></figure>

<p>如果自动装配的环境存在多个id不同但是类是同一个类的bean的对象，使用@Autowired时会先优先根据类进行匹配bean对象，如果有多个类的时候，会根据id进行查找，如果id还不存在的时候会报错。</p>
<p>如下例中的配置文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;Robert&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.autowired.Person&quot;</span> <span class="attr">p:name</span>=<span class="string">&quot;Robert&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cat1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.autowired.Cat&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cat2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.autowired.Cat&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dog&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.autowired.Dog&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>存在两个Cat类的bean容器，在自动装配的时候会先找有Cat类的容器，如果只有一个Cat类的容器，那么不管id时怎样的，都会将这个bean注入到person的bean中；如果存在两个相同类的bean容器，若其中有一个bean的id跟注入的变量名字一样的时候，那么会注意此变量（如此例中若Person中Cat类对应的变量是cat1的话，会自动将cat1的bean容器注入Person中）；若Person类中的变量名字跟Cat类对应的id没有一个相同的话，就会无法自动匹配，报错；org.springframework.beans.factory.NoUniqueBeanDefinitionException: No qualifying bean of type ‘com.spring.autowired.Cat’ available: expected single matching bean but found 2: cat1,cat2</p>
<p>这时可以使用@Qualifier(value = “cat2”) 注解指定@Autowired注解装配的bean的id值来指定装配对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    Dog dog;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Qualifier(value = &quot;cat2&quot;)</span></span><br><span class="line">    Cat cat;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="Resource"><a href="#Resource" class="headerlink" title="@Resource"></a>@Resource</h6><p>@Resource(value)也可以实现自动装配。</p>
<p>它的自动装配顺序顺序为，先通过ByName的方式自动寻找bean，找不到的时候再ByType。</p>
<p>@Resource也可以指定值：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource(name=&quot;cat1&quot;)</span> <span class="comment">//装配指定的id为cat1的bean</span></span><br></pre></td></tr></table></figure>

<h6 id="Component"><a href="#Component" class="headerlink" title="@Component"></a>@Component</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//此注解相当于，自动创建bean 等价于 &lt;bean id=&quot;dog&quot; class=&quot;com.spring.autowired.Dog&quot;/&gt;</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dog</span> &#123;</span><br><span class="line"><span class="comment">//    此注解相当于&lt;property name=&quot;name&quot;  value=&quot;XiaoTianQuan&quot;/&gt;</span></span><br><span class="line">    <span class="meta">@Value(&quot;XiaoTianQuan&quot;)</span></span><br><span class="line">    String name;</span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">void</span>  <span class="title function_">bark</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;wang&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>@Component有几个衍生注解：在web开发中按照三层架构分层：</strong></p>
<ul>
<li><p>dao ：@Respository</p>
</li>
<li><p>service：@Service</p>
</li>
<li><p>controller：@Controller</p>
<p>这四个注解的功能都是一样的，代表将某个类注册到Spring中装配Bean。</p>
</li>
</ul>
<h6 id="Value"><a href="#Value" class="headerlink" title="@Value"></a>@Value</h6><p>注入值，可以代替：<property></property></p>
<h6 id="Qualifier"><a href="#Qualifier" class="headerlink" title="@Qualifier"></a>@Qualifier</h6><p>@Qualifier(value = “cat2”) 指定对象的值。</p>
<h6 id="Nullable"><a href="#Nullable" class="headerlink" title="@Nullable"></a>@Nullable</h6><p>@Nullable 说明此字段可以为空：</p>
<h6 id="Scope"><a href="#Scope" class="headerlink" title="@Scope"></a>@Scope</h6><p>@Scope指定Bean的作用域：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Scope(&quot;prototype&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Cat</span> &#123;</span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">void</span>  <span class="title function_">bark</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;miao&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="Configuration"><a href="#Configuration" class="headerlink" title="@Configuration"></a>@Configuration</h6><p>@Configuration：此行注释代表此类是一个配置类，相当于xml配置文件</p>
<h6 id="Bean"><a href="#Bean" class="headerlink" title="@Bean"></a>@Bean</h6><p>@Bean代表注册一个Bean，等价于xml中的<bean> 这个注解主要作用与方法的。</bean></p>
<h4 id="XML和注解的对比"><a href="#XML和注解的对比" class="headerlink" title="XML和注解的对比"></a>XML和注解的对比</h4><ul>
<li><p>xml更加万能，使用任何场景，维护建单</p>
</li>
<li><p>注解不是自己的类使用不了，维护比较复杂</p>
<p>必须让注解生效的话，需要开启注解支持：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:annotation-config</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--指定扫描包的路径 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.acme&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="使用Java的方式配置Spring"><a href="#使用Java的方式配置Spring" class="headerlink" title="使用Java的方式配置Spring"></a>使用Java的方式配置Spring</h4><p>使用方法：创建配置类，在配置类中使用@Config、@Bean注解，此类相当于xml配置文件。实体类中用@Compent注解</p>
<p>1、配置配置类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//此行注释代表此类是一个配置类，相当于xml配置文件。这个也是Spring容器托管，注册到容器中</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">//代表自动扫描的路径</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.spring&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Config</span> &#123;</span><br><span class="line">    <span class="comment">//@Bean代表注册一个Bean，等价于xml中的&lt;bean/&gt;</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUser</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、实体类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span> <span class="comment">//注册一个Bean，使xml或者config类能找到此类并进行实例化</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Value(&quot;Robert&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GetUserTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(Config.class);</span><br><span class="line">        <span class="comment">//这里如果是通过@Bean获取的Bean的话，需要用的是方法的名字</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;getUser&quot;</span>, User.class);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这种方法的优点是，可以完全不需要XML，让Spring自动扫面并组装它们。</p>
<p>使用方法：</p>
<p>1、先用@Compoent注明需要每一个需要组装的类，就像xml中的<bean></bean></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MailService</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、在调用步骤中的类的时候，在代码的上方用@Autowired注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span> <span class="comment">//使用此注解代表下方的mailService就是上方的提供注解的类的实例。一般是类的全名首个字母小写了。</span></span><br><span class="line">    MailService mailService;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用<code>@Autowired</code>就相当于把指定类型的Bean注入到指定的字段中。和XML配置相比，<code>@Autowired</code>大幅简化了注入，因为它不但可以写在<code>set()</code>方法上，还可以直接写在字段上，甚至可以写在构造方法中：</p>
<p>@Autowired 写在set()方法上</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setJdbcInsert</span><span class="params">(JdbcInsert jdbcInsert)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.jdbcInsert = jdbcInsert;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>@Autowired 写在字段上：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> MailService mailService;</span><br></pre></td></tr></table></figure>

<p>@Autowired 写在构造方法中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">UserService</span><span class="params">(<span class="meta">@Autowired</span> MailService mailService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.mailService = mailService;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="定制的Bean："><a href="#定制的Bean：" class="headerlink" title="定制的Bean："></a>定制的Bean：</h4><h5 id="scope"><a href="#scope" class="headerlink" title="scope"></a>scope</h5><p>对于Spring容器来说，当我们把一个Bean标记为<code>@Component</code>后，它就会自动为我们创建一个单例（Singleton），即容器初始化时创建Bean，容器关闭前销毁Bean。在容器运行期间，我们调用<code>getBean(Class)</code>获取到的Bean总是同一个实例。</p>
<p>还有一种Bean，我们每次调用<code>getBean(Class)</code>，容器都返回一个新的实例，这种Bean称为Prototype（原型），它的生命周期显然和Singleton不同。声明一个Prototype的Bean时，需要添加一个额外的<code>@Scope</code>注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)</span> <span class="comment">// @Scope(&quot;prototype&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MailSession</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="注入List："><a href="#注入List：" class="headerlink" title="注入List："></a>注入List：</h5><p>validator为一个接口，有三个实现类，分别是：EmailValidator、PasswordValidator、NameValidator</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Validator</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">validate</span><span class="params">(String email, String password, String name)</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmailValidator</span> <span class="keyword">implements</span> <span class="title class_">Validator</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">validate</span><span class="params">(String email, String password, String name)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!email.matches(<span class="string">&quot;^[a-z0-9]+\\@[a-z0-9]+\\.[a-z]&#123;2,10&#125;$&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;invalid email: &quot;</span> + email);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PasswordValidator</span> <span class="keyword">implements</span> <span class="title class_">Validator</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">validate</span><span class="params">(String email, String password, String name)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!password.matches(<span class="string">&quot;^.&#123;6,20&#125;$&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;invalid password&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NameValidator</span> <span class="keyword">implements</span> <span class="title class_">Validator</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">validate</span><span class="params">(String email, String password, String name)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (name == <span class="literal">null</span> || name.isBlank() || name.length() &gt; <span class="number">20</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;invalid name: &quot;</span> + name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>下边创建了一个List<Validator> 的List，这个list被添加被@Autowired时，Spring会自动的将所有类型为Validator的Bean装配到这个list中，就实现了list的自动注入。</Validator></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Validators</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    List&lt;Validator&gt; validators;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">validate</span><span class="params">(String email, String password, String name)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> validator : <span class="built_in">this</span>.validators) &#123;</span><br><span class="line">            validator.validate(email, password, name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>List</code>是有序的，要指定<code>List</code>中Bean的顺序，可以加上<code>@Order</code>注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Order(1)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmailValidator</span> <span class="keyword">implements</span> <span class="title class_">Validator</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Order(2)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PasswordValidator</span> <span class="keyword">implements</span> <span class="title class_">Validator</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Order(3)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NameValidator</span> <span class="keyword">implements</span> <span class="title class_">Validator</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="可选注入"><a href="#可选注入" class="headerlink" title="可选注入"></a>可选注入</h5><p>给<code>@Autowired</code>增加一个<code>required = false</code>的参数：如果找到一个类型为<code>ZoneId</code>的Bean，就注入，如果找不到，就忽略。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MailService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired(required = false)</span></span><br><span class="line">    <span class="type">ZoneId</span> <span class="variable">zoneId</span> <span class="operator">=</span> ZoneId.systemDefault();</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h3><p>AOP是Aspect Oriented Programming，即面向切面编程。在不改变现在业务逻辑的情况下，增强</p>
<p>OOP：Object Oriented Programming，OOP作为面向对象编程的模式，主要作用是数据的封装、继承、多态</p>
<p>AOP就是将核心业务中公用的部分抽离出来，作为一个切面，让业务层面专注与写业务代码。减小了代码的重复编写，优点像动态代理。在Java平台中，对于AOP的织入共有三种方式：</p>
<ol>
<li>编译期：在编译时，由编译器把切面调用编译进字节码，这种方式需要定义新的关键字并扩展编译器，AspectJ就扩展了Java编译器，使用关键字aspect来实现织入；</li>
<li>类加载器：在目标类被装载到JVM时，通过一个特殊的类加载器，对目标类的字节码重新“增强”；</li>
<li>运行期：目标对象和切面都是普通Java类，通过JVM的动态代理功能或者第三方库实现运行期动态织入。</li>
</ol>
<p>Spring的AOP实现：Spring对接口类型使用JDK动态代理，对普通类使用CGLIB创建子类。如果一个Bean的class是final，Spring将无法为其创建子类。。由于JVM的动态代理要求必须实现接口，如果一个普通类没有业务接口，就需要通过<a target="_blank" rel="noopener" href="https://github.com/cglib/cglib">CGLIB</a>或者<a target="_blank" rel="noopener" href="https://www.javassist.org/">Javassist</a>这些第三方库实现。</p>
<p>在AOP编程中，我们经常会遇到下面的概念：</p>
<ul>
<li>Aspect：切面，即一个横跨多个核心逻辑的功能，或者称之为系统关注点；</li>
<li>Joinpoint：连接点，即定义在应用程序流程的何处插入切面的执行；</li>
<li>Pointcut：切入点，即一组连接点的集合；</li>
<li>Advice：增强，指特定连接点上执行的动作；</li>
<li>Introduction：引介，指为一个已有的Java对象动态地增加新的接口；</li>
<li>Weaving：织入，指将切面整合到程序的执行流程中；</li>
<li>Interceptor：拦截器，是一种实现增强的方式；</li>
<li>Target Object：目标对象，即真正执行业务的核心逻辑对象；</li>
<li>AOP Proxy：AOP代理，是客户端持有的增强后的对象引用。</li>
</ul>
<p>使用AOP :实质是动态代理的实现类。</p>
<p>使用之前需要引入依赖：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">     &lt;groupId&gt;org.aspectj&lt;/groupId&gt;</span><br><span class="line">     &lt;artifactId&gt;org.aspectjweaver&lt;/artifactId&gt;</span><br><span class="line">     &lt;version&gt;<span class="number">1.9</span><span class="number">.9</span><span class="number">.1</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createBook</span><span class="params">(String name)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteBook</span><span class="params">(String name)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateBook</span><span class="params">(String name, String toName)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookServiceImpl</span>  <span class="keyword">implements</span> <span class="title class_">BookService</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> Set&lt;Book&gt; bookSet = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;BookServiceImpl&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;bookSet=&quot;</span> + bookSet +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createBook</span><span class="params">(String name)</span>&#123;</span><br><span class="line">        bookSet.add(<span class="keyword">new</span> <span class="title class_">Book</span>(<span class="string">&quot;悲惨的世界&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteBook</span><span class="params">(String name)</span>&#123;</span><br><span class="line">        <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Book</span>(name);</span><br><span class="line">        bookSet.remove(book);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateBook</span><span class="params">(String name, String toName)</span>&#123;</span><br><span class="line">        <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Book</span>(name);</span><br><span class="line">        Iterator&lt;Book&gt; iterator=bookSet.iterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext())&#123;</span><br><span class="line">            <span class="type">Book</span> <span class="variable">bookUpdate</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">            <span class="keyword">if</span> (bookUpdate.equals(book))&#123;</span><br><span class="line">                bookUpdate.setBookName(toName);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>xml配置：需要添加aop的约束：xmlns:aop=”<a target="_blank" rel="noopener" href="http://www.springframework.org/schema/aop%E3%80%81http://www.springframework.org/schema/aop">http://www.springframework.org/schema/aop、http://www.springframework.org/schema/aop</a> <a target="_blank" rel="noopener" href="http://www.springframework.org/schema/aop/spring-aop.xsd">http://www.springframework.org/schema/aop/spring-aop.xsd</a></p>
<h4 id="实现方式一：使用SpringAPI接口实现"><a href="#实现方式一：使用SpringAPI接口实现" class="headerlink" title="实现方式一：使用SpringAPI接口实现"></a>实现方式一：使用SpringAPI接口实现</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                            http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--   注册bean--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookServiceImpl&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.aop.BookServiceImpl&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;log&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.aop.ServiceLog&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--实现方式一--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    配置AOP--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        切入点:expression:表达式，execution（要执行的位置！ * * * * *）--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;logCutPoint&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* com.spring.aop.BookServiceImpl.*(..))&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        执行环绕增加--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;log&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;logCutPoint&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;bookService.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//动态代理代理的是接口</span></span><br><span class="line">        <span class="type">BookService</span> <span class="variable">bookService</span> <span class="operator">=</span> (BookService) context.getBean(<span class="string">&quot;bookServiceImpl&quot;</span>);</span><br><span class="line">        bookService.createBook(<span class="string">&quot;悲惨世界&quot;</span>);</span><br><span class="line">        bookService.updateBook(<span class="string">&quot;悲惨的世界&quot;</span>,<span class="string">&quot;肖申克的救赎&quot;</span>);</span><br><span class="line">        bookService.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="实现方式二：自定义类来实现AOP"><a href="#实现方式二：自定义类来实现AOP" class="headerlink" title="实现方式二：自定义类来实现AOP"></a>实现方式二：自定义类来实现AOP</h4><p>实现类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DiyPointCut</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;**********方法执行前**************&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">After</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;**********方法执行后**************&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>xml配置文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookServiceImpl&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.aop.BookServiceImpl&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;DiyPointCut&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.aop.diy.DiyPointCut&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        自定义切面，ref要引用的类--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;DiyPointCut&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            切入点--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot; point&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* com.spring.aop.BookServiceImpl.*(..))&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            通知在切点平面前后执行相应的方法--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;before&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot; point&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">&quot;After&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot; point&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="实现方式三：注解实现"><a href="#实现方式三：注解实现" class="headerlink" title="实现方式三：注解实现"></a>实现方式三：注解实现</h4><p>实现类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span> <span class="comment">//标注这个类为一个切面</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AnnotationPoint</span> &#123;</span><br><span class="line">    <span class="meta">@Before(&quot;execution(* com.spring.aop.BookServiceImpl.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;===方法执行前===&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@After(&quot;execution(* com.spring.aop.BookServiceImpl.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;===方法执行后===&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>xml配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;Annotation&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.aop.diy.AnnotationPoint&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookServiceImpl&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.aop.BookServiceImpl&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>测试类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AnnotationTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;AnnotationPoint.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//动态代理代理的是接口</span></span><br><span class="line">        <span class="type">BookService</span> <span class="variable">bookService</span> <span class="operator">=</span> (BookService) context.getBean(<span class="string">&quot;bookServiceImpl&quot;</span>);</span><br><span class="line">        bookService.createBook(<span class="string">&quot;悲惨世界&quot;</span>);</span><br><span class="line">        bookService.updateBook(<span class="string">&quot;悲惨的世界&quot;</span>,<span class="string">&quot;肖申克的救赎&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>也可以不用xml，完全用java配置：</p>
<p>需要用到注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ComponentScan</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookServiceImpl</span>  <span class="keyword">implements</span> <span class="title class_">BookService</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> Set&lt;Book&gt; bookSet = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;BookServiceImpl&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;bookSet=&quot;</span> + bookSet +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createBook</span><span class="params">(String name)</span>&#123;</span><br><span class="line">        bookSet.add(<span class="keyword">new</span> <span class="title class_">Book</span>(<span class="string">&quot;悲惨的世界&quot;</span>));</span><br><span class="line">        System.out.println(bookSet.toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteBook</span><span class="params">(String name)</span>&#123;</span><br><span class="line">        <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Book</span>(name);</span><br><span class="line">        bookSet.remove(book);</span><br><span class="line">        System.out.println(bookSet.toString());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateBook</span><span class="params">(String name, String toName)</span>&#123;</span><br><span class="line">        <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Book</span>(name);</span><br><span class="line">        Iterator&lt;Book&gt; iterator=bookSet.iterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext())&#123;</span><br><span class="line">            <span class="type">Book</span> <span class="variable">bookUpdate</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">            <span class="keyword">if</span> (bookUpdate.equals(book))&#123;</span><br><span class="line">                bookUpdate.setBookName(toName);</span><br><span class="line">                System.out.println(bookSet.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://robert-pf.github.io/RobertBlog/2020/02/25/Spring/" data-id="cl26a2muj000d30uv33b7fyb8" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/RobertBlog/tags/Java-Spring/" rel="tag">Java Spring</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Servlet" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/RobertBlog/2020/02/15/Servlet/" class="article-date">
  <time datetime="2020-02-15T14:03:35.000Z" itemprop="datePublished">2020-02-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/RobertBlog/2020/02/15/Servlet/">Servlet详解</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Servlet详解"><a href="#Servlet详解" class="headerlink" title="Servlet详解"></a>Servlet详解</h3><p>一个Servlet就是一个网页，举个例子：你访问网站Http://localhost:8080/hello 就是访问网页服务器的hello路径的实现类。在下边的代码中，就是将此类的路径设置未/hello ，访问此网页需要用上述连接。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@WebServlet(urlPatterns = &quot;/hello&quot;)</span><br><span class="line">public class HelloServlet extends HttpServlet &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因为浏览器发送请求的时候，还会有请求方法（HTTP Method）：即GET、POST、PUT等不同类型的请求。因此，要处理GET请求，我们要覆写<code>doGet()</code>方法。要处理Post请求的时候需要用doPost()方法。</p>
<p>浏览器发出的HTTP请求总是由Web Server先接收，然后，根据Servlet配置的映射，不同的路径转发到不同的Servlet：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">               ┌ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ┐</span><br><span class="line"></span><br><span class="line">               │            /hello    ┌───────────────┐│</span><br><span class="line">                          ┌──────────&gt;│ HelloServlet  │</span><br><span class="line">               │          │           └───────────────┘│</span><br><span class="line">┌───────┐    ┌──────────┐ │ /signin   ┌───────────────┐</span><br><span class="line">│Browser│───&gt;│Dispatcher│─┼──────────&gt;│ SignInServlet ││</span><br><span class="line">└───────┘    └──────────┘ │           └───────────────┘</span><br><span class="line">               │          │ /         ┌───────────────┐│</span><br><span class="line">                          └──────────&gt;│ IndexServlet  │</span><br><span class="line">               │                      └───────────────┘│</span><br><span class="line">                              Web Server</span><br><span class="line">               └ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ┘</span><br></pre></td></tr></table></figure>

<p>上图就是通过以上逻辑结构进行hou’tai’d</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://robert-pf.github.io/RobertBlog/2020/02/15/Servlet/" data-id="cl0pbxj3m00009guv2kk2ep5t" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/RobertBlog/tags/Servlet/" rel="tag">Servlet</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Web开发" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/RobertBlog/2020/02/10/Web%E5%BC%80%E5%8F%91/" class="article-date">
  <time datetime="2020-02-10T14:03:35.000Z" itemprop="datePublished">2020-02-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/RobertBlog/2020/02/10/Web%E5%BC%80%E5%8F%91/">Web开发</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Web开发"><a href="#Web开发" class="headerlink" title="Web开发"></a>Web开发</h2><p>概念：Web开发就是编写服务器程序来处理客户端请求。</p>
<h3 id="背景知识："><a href="#背景知识：" class="headerlink" title="背景知识："></a>背景知识：</h3><p>Web是基于Browser/Server模式，简称BS架构，特点是，客户端只需要浏览器，服务端响应客户端的请求，浏览器将服务器发送过来的数据展现给用户。</p>
<p>Web页面用的HTML编写的。</p>
<p>web 浏览器和服务端的协议时HTTP协议，HTTP协议是基于TCP协议之上的请求-响应协议，。</p>
<p>对于浏览器来说，请求响应流程如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">st=&gt;start: 客户端与服务器建立TCP连接</span><br><span class="line">op=&gt;operation: 发送HTTP请求</span><br><span class="line">e=&gt;end: 收取HTTP响应，然后把网页在浏览器中显示出来</span><br><span class="line">st-&gt;op-&gt;e</span><br></pre></td></tr></table></figure>

<p>HTTP请求和响应都由HTTP Header和HTTP Body构成，其中HTTP Header每行都以<code>\r\n</code>结束。如果遇到两个连续的<code>\r\n</code>，那么后面就是HTTP Body。浏览器读取HTTP Body，并根据Header信息中指示的<code>Content-Type</code>、<code>Content-Encoding</code>等解压后显示网页、图像或其他内容。通常浏览器获取的第一个资源是HTML网页，在网页中，如果嵌入了JavaScript、CSS、图片、视频等其他资源，浏览器会根据资源的URL再次向服务器请求对应的资源。</p>
<p>1、来写一个HTTP的Server端程序吧。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.Robert.Web;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 建个的Web服务</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Robert</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2022-03-11 17:46</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Web1Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>  &#123;</span><br><span class="line">        <span class="type">ServerSocket</span> <span class="variable">ss</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ss =  <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(<span class="number">8080</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;server is running&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (;;)&#123;</span><br><span class="line">                <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                socket = ss.accept();<span class="comment">//获取浏览器产生的sock</span></span><br><span class="line">                System.out.println(<span class="string">&quot;connected from &quot;</span>+socket.getRemoteSocketAddress());</span><br><span class="line">                <span class="comment">//将sock作为参数，传入Handler的构造函数中。</span></span><br><span class="line">                <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span>  <span class="keyword">new</span> <span class="title class_">Handler</span>(socket);</span><br><span class="line">                t.start();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                ss.close(); <span class="comment">//创建了资源一定要关闭。</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Handler</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line">    Socket socket;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Handler</span><span class="params">(Socket s)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.socket = s;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//创建输入输出流，</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">OutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            inputStream = <span class="built_in">this</span>.socket.getInputStream();</span><br><span class="line">            outputStream = <span class="built_in">this</span>.socket.getOutputStream();</span><br><span class="line">            handle(inputStream,outputStream); <span class="comment">//调用handle方法</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                inputStream.close();</span><br><span class="line">                outputStream.close();</span><br><span class="line">                <span class="built_in">this</span>.socket.close();</span><br><span class="line">                System.out.println(<span class="string">&quot;client disconnect……&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//此处是代码的核心重点，以下代码是用来处理从socket中接受到请求参数，并输出信息。</span></span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(InputStream input,OutputStream output)</span> &#123;</span><br><span class="line">        <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(input));</span><br><span class="line">        <span class="type">BufferedWriter</span> <span class="variable">writer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedWriter</span>(<span class="keyword">new</span> <span class="title class_">OutputStreamWriter</span>(output));</span><br><span class="line">        <span class="comment">//读取HTTP请求。</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">requestOk</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">first</span> <span class="operator">=</span> reader.readLine();</span><br><span class="line">            System.out.println(first);</span><br><span class="line">            <span class="keyword">if</span> (first.startsWith(<span class="string">&quot;GET / HTTP/1.&quot;</span>)) &#123;</span><br><span class="line">                requestOk = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">header</span> <span class="operator">=</span> reader.readLine();</span><br><span class="line">                <span class="keyword">if</span> (header.isEmpty()) &#123; <span class="comment">// 读取到空行时, HTTP Header读取完毕</span></span><br><span class="line">                    System.out.println(header);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(requestOk ? <span class="string">&quot;Response OK&quot;</span> : <span class="string">&quot;Response Error&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!requestOk) &#123;</span><br><span class="line">                <span class="comment">// 发送错误响应:</span></span><br><span class="line">                writer.write(<span class="string">&quot;HTTP/1.0 404 Not Found\r\n&quot;</span>);</span><br><span class="line">                writer.write(<span class="string">&quot;Content-Length: 0\r\n&quot;</span>);</span><br><span class="line">                writer.write(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">                writer.flush();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 发送成功响应:</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> <span class="string">&quot;&lt;html&gt;&lt;body&gt;&lt;h1&gt;Hello, world!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span>;</span><br><span class="line">                <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> data.getBytes(StandardCharsets.UTF_8).length;</span><br><span class="line">                writer.write(<span class="string">&quot;HTTP/1.0 200 OK\r\n&quot;</span>);</span><br><span class="line">                writer.write(<span class="string">&quot;Connection: close\r\n&quot;</span>);</span><br><span class="line">                writer.write(<span class="string">&quot;Content-Type: text/html\r\n&quot;</span>);</span><br><span class="line">                writer.write(<span class="string">&quot;Content-Length: &quot;</span> + length + <span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">                writer.write(<span class="string">&quot;\r\n&quot;</span>); <span class="comment">// 空行标识Header和Body的分隔</span></span><br><span class="line">                writer.write(data);</span><br><span class="line">                writer.flush();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>好了，Web程序终于调试完了，看着 handle 很复杂吧，要考虑HTTP响应，非常麻烦，如果真的去开发一个Web这么一行代码一行代码写，太耗费时间了，这种情况下我们就可以用 Serverlet 来帮我们创建 Web 服务了。</p>
<h3 id="Servlet"><a href="#Servlet" class="headerlink" title="Servlet"></a>Servlet</h3><ol>
<li>Servlet就是JAVA 类。</li>
<li>Servlet是一个继承 HttpServlet 类的类</li>
<li>这个在服务器端运行，用以处理客户端的请求。</li>
</ol>
<h4 id="使用方法："><a href="#使用方法：" class="headerlink" title="使用方法："></a>使用方法：</h4><ol>
<li><h5 id="新建一个maven项目，项目的pom-xml中添加依赖："><a href="#新建一个maven项目，项目的pom-xml中添加依赖：" class="headerlink" title="新建一个maven项目，项目的pom.xml中添加依赖："></a>新建一个maven项目，项目的pom.xml中添加依赖：</h5></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;javax.servlet&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">4.0</span><span class="number">.1</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>注意：寻找依赖的方法是：    在 <a target="_blank" rel="noopener" href="https://search.maven.org/">https://search.maven.org/</a> 中搜索：javax.servlet-api ，最后显示如图中所示：</p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Web开发\image-20220312231945566.png" alt="image-20220312231945566"></p>
<p>点击版本号：4.0.1 会如图显示：</p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Web开发\image-20220312232117657.png" alt="image-20220312232117657"></p>
<p>右上角的 Apache 中显示的的即是依赖地址，复制下来既可以使用。</p>
<p>2、编写类继承HttpServlet</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// WebServlet注解表示这是一个Servlet，并映射到地址/: </span></span><br><span class="line"><span class="comment">//必须加这条，不然配置的Tomcat可能找不到路径发，返会404</span></span><br><span class="line"><span class="meta">@WebServlet(urlPatterns = &quot;/&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span><br><span class="line">            <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// 设置响应类型:</span></span><br><span class="line">        resp.setContentType(<span class="string">&quot;text/html&quot;</span>);</span><br><span class="line">        <span class="comment">// 获取输出流:</span></span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">pw</span> <span class="operator">=</span> resp.getWriter();</span><br><span class="line">        <span class="comment">// 写入响应:</span></span><br><span class="line">        pw.write(<span class="string">&quot;&lt;h1&gt;Hello, world!&lt;/h1&gt;&quot;</span>);</span><br><span class="line">        <span class="comment">// 最后不要忘记flush强制输出:</span></span><br><span class="line">        pw.flush();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3、启动Tomcat服务器：</p>
<p>在项目的依赖中添加：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">         &lt;groupId&gt;org.apache.tomcat.embed&lt;/groupId&gt;</span><br><span class="line">         &lt;artifactId&gt;tomcat-embed-core&lt;/artifactId&gt;</span><br><span class="line">         &lt;version&gt;<span class="number">9.0</span><span class="number">.26</span>&lt;/version&gt;</span><br><span class="line">         &lt;scope&gt;provided&lt;/scope&gt;</span><br><span class="line">     &lt;/dependency&gt;</span><br><span class="line">     &lt;dependency&gt;</span><br><span class="line">         &lt;groupId&gt;org.apache.tomcat.embed&lt;/groupId&gt;</span><br><span class="line">         &lt;artifactId&gt;tomcat-embed-jasper&lt;/artifactId&gt;</span><br><span class="line">         &lt;version&gt;<span class="number">9.0</span><span class="number">.26</span>&lt;/version&gt;</span><br><span class="line">         &lt;scope&gt;provided&lt;/scope&gt;</span><br><span class="line">     &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>编写方法，启动tomcat服务器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">// 启动Tomcat:</span></span><br><span class="line">    <span class="type">Tomcat</span> <span class="variable">tomcat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Tomcat</span>();</span><br><span class="line">    tomcat.setPort(Integer.getInteger(<span class="string">&quot;port&quot;</span>, <span class="number">8080</span>));</span><br><span class="line">    tomcat.getConnector();</span><br><span class="line">    <span class="comment">// 创建webapp:</span></span><br><span class="line">    <span class="type">Context</span> <span class="variable">ctx</span> <span class="operator">=</span> tomcat.addWebapp(<span class="string">&quot;&quot;</span>, <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;src/main/webapp&quot;</span>).getAbsolutePath());</span><br><span class="line">    <span class="type">WebResourceRoot</span> <span class="variable">resources</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandardRoot</span>(ctx);</span><br><span class="line">    resources.addPreResources(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">DirResourceSet</span>(resources, <span class="string">&quot;/WEB-INF/classes&quot;</span>, <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;target/classes&quot;</span>).getAbsolutePath(), <span class="string">&quot;/&quot;</span>));</span><br><span class="line">    ctx.setResources(resources);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        tomcat.start();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (LifecycleException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    tomcat.getServer().await();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后运行上述test方法，既可启动Tomcat服务器，然后通过预设的tomcat.addWebapp 路径会将当前项目的为根webapp。在本地服务器上访问：<code>[http://localhost:8080/](http://localhost:8080/)</code>：即可访问工程。</p>
<h4 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h4><p>自己编写的Servlet并不能直接运行，需要又Web服务器加载后创建实例运行，因为类似Tomcat这样的Web服务器也称之未Servlet容器。</p>
<p>Servlet具有如下特点：</p>
<ul>
<li><p>无法在代码中直接通过new创建Servlet实例，需要由容器创建Servle实例。</p>
</li>
<li><p>Servlet容器只会给每个Servlet类创建唯一实例；</p>
</li>
<li><p>Servlet容器会使用多线程执行doGet()或者doPost()方法，因此Servlet实现类必须重写其中一种方法。</p>
</li>
</ul>
<p>使用需要注意如下问题：</p>
<ul>
<li>在Servlet中定义的实例变量会被多个线程同时访问，要注意线程安全；</li>
<li><code>HttpServletRequest</code>和<code>HttpServletResponse</code>实例是由Servlet容器传入的局部变量，它们只能被当前线程访问，不存在多个线程访问的问题；</li>
<li>在<code>doGet()</code>或<code>doPost()</code>方法中，如果使用了<code>ThreadLocal</code>，但没有清理，那么它的状态很可能会影响到下次的某个请求，因为Servlet容器很可能用线程池实现线程复用</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://robert-pf.github.io/RobertBlog/2020/02/10/Web%E5%BC%80%E5%8F%91/" data-id="cl0o32txa00004cuv1uu0bsmu" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/RobertBlog/tags/Java-Web/" rel="tag">Java Web</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-HTML5" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/RobertBlog/2020/02/10/HTML5/" class="article-date">
  <time datetime="2020-02-10T14:03:35.000Z" itemprop="datePublished">2020-02-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/RobertBlog/2020/02/10/HTML5/">HTML</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="表单-lt-form-gt"><a href="#表单-lt-form-gt" class="headerlink" title="表单  &lt;form&gt;"></a>表单  &lt;form&gt;</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>form.example<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--使用表单录入数据，用get方法会在浏览器地址中直接暴露密码</span></span><br><span class="line"><span class="comment">    用post方法，可以在网址中看不到提交的信息，但是通过F12还是能看到的--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span> 名字：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;UserName&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span> 密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;Password&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--添加标签 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;reset&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--添加标签 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>get方法直接暴露密码</p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Web开发\image-20220510233342525.png" alt="image-20220510233342525"></p>
<p>post不直接暴露密码，但是密码仍然是暴露出来的。</p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Web开发\image-20220510233620846.png" alt="image-20220510233620846"></p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Web开发\image-20220510234140302.png" alt="image-20220510234140302"></p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Web开发\image-20220511000054453.png" alt="image-20220511000054453"></p>
<h2 id="标签-lt-input-gt"><a href="#标签-lt-input-gt" class="headerlink" title="标签 &lt;input&gt;"></a>标签 &lt;input&gt;</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=&quot;demo_form.asp&quot;&gt;</span><br><span class="line">  First name: &lt;input type=&quot;text&quot; name=&quot;fname&quot;&gt;&lt;br&gt;</span><br><span class="line">  Last name: &lt;input type=&quot;text&quot; name=&quot;lname&quot;&gt;&lt;br&gt;</span><br><span class="line">  &lt;input type=&quot;submit&quot; value=&quot;提交&quot;&gt;</span><br><span class="line">&lt;/form&gt; </span><br></pre></td></tr></table></figure>

<p><input> 标签规定了用户可以在其中输入数据的输入字段。</p>
<p><input> 元素在 <a target="_blank" rel="noopener" href="https://www.w3cschool.cn/html5/html5-form.html"> 元素</a>中使用，用来声明允许用户输入数据的 input 控件。</p>
<p>输入字段可通过多种方式改变，取决于 type 属性。</p>
<table>
<thead>
<tr>
<th align="left">属性</th>
<th align="left">值</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/htmltags/att-input-accept.html">accept</a></td>
<td align="left">audio/*video/*image/*<em>MIME_type</em></td>
<td align="left">规定通过文件上传来提交的文件的类型。(只针对type=”file”)</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/htmltags/att-input-align.html">align</a></td>
<td align="left">leftrighttopmiddlebottom</td>
<td align="left">HTML5已废弃，不赞成使用。规定图像输入的对齐方式。 (只针对type=”image”)</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/htmltags/att-input-alt.html">alt</a></td>
<td align="left"><em>text</em></td>
<td align="left">定义图像输入的替代文本。 (只针对type=”image”)</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/htmltags/att-input-autocomplete.html">autocomplete</a>New</td>
<td align="left">onoff</td>
<td align="left">autocomplete 属性规定 <input> 元素输入字段是否应该启用自动完成功能。</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/htmltags/att-input-autofocus.html">autofocus</a>New</td>
<td align="left">autofocus</td>
<td align="left">属性规定当页面加载时 <input> 元素应该自动获得焦点。</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/htmltags/att-input-checked.html">checked</a></td>
<td align="left">checked</td>
<td align="left">checked 属性规定在页面加载时应该被预先选定的 <input> 元素。 (只针对 type=”checkbox” 或者 type=”radio”)</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/htmltags/att-input-disabled.html">disabled</a></td>
<td align="left">disabled</td>
<td align="left">disabled 属性规定应该禁用的 <input> 元素。</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/htmltags/att-input-form.html">form</a>New</td>
<td align="left"><em>form_id</em></td>
<td align="left">form 属性规定 <input> 元素所属的一个或多个表单。</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/htmltags/att-input-formaction.html">formaction</a>New</td>
<td align="left"><em>URL</em></td>
<td align="left">属性规定当表单提交时处理输入控件的文件的 URL。(只针对 type=”submit” 和 type=”image”)</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/htmltags/att-input-formenctype.html">formenctype</a>New</td>
<td align="left">application/x-www-form-urlencodedmultipart/form-datatext/plain</td>
<td align="left">属性规定当表单数据提交到服务器时如何编码(只适合 type=”submit” 和 type=”image”)。</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/htmltags/att-input-formmethod.html">formmethod</a>New</td>
<td align="left">getpost</td>
<td align="left">定义发送表单数据到 action URL 的 HTTP 方法。 (只适合 type=”submit” 和 type=”image”)</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/htmltags/att-input-formnovalidate.html">formnovalidate</a>New</td>
<td align="left">formnovalidate</td>
<td align="left">formnovalidate 属性覆盖 <form> 元素的 novalidate 属性。</form></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/htmltags/att-input-formtarget.html">formtarget</a>New</td>
<td align="left">_blank_self_parent_top<em>framename</em></td>
<td align="left">规定表示提交表单后在哪里显示接收到响应的名称或关键词。(只适合 type=”submit” 和 type=”image”)</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/htmltags/att-input-height.html">height</a>New</td>
<td align="left"><em>pixels</em></td>
<td align="left">规定 <input>元素的高度。(只针对type=”image”)</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/htmltags/att-input-list.html">list</a>New</td>
<td align="left"><em>datalist_id</em></td>
<td align="left">属性引用 <datalist> 元素，其中包含 </datalist><input> 元素的预定义选项。</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/htmltags/att-input-max.html">max</a>New</td>
<td align="left"><em>numberdate</em></td>
<td align="left">属性规定 <input> 元素的最大值。</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/htmltags/att-input-maxlength.html">maxlength</a></td>
<td align="left"><em>number</em></td>
<td align="left">属性规定 <input> 元素中允许的最大字符数。</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/htmltags/att-input-min.html">min</a>New</td>
<td align="left"><em>numberdate</em></td>
<td align="left">属性规定 <input>元素的最小值。</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/htmltags/att-input-multiple.html">multiple</a>New</td>
<td align="left">multiple</td>
<td align="left">属性规定允许用户输入到 <input> 元素的多个值。</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/htmltags/att-input-name.html">name</a></td>
<td align="left"><em>text</em></td>
<td align="left">name 属性规定 <input> 元素的名称。</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/htmltags/att-input-pattern.html">pattern</a>New</td>
<td align="left"><em>regexp</em></td>
<td align="left">pattern 属性规定用于验证 <input> 元素的值的正则表达式。</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/htmltags/att-input-placeholder.html">placeholder</a>New</td>
<td align="left"><em>text</em></td>
<td align="left">placeholder 属性规定可描述输入 <input> 字段预期值的简短的提示信息。</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/htmltags/att-input-readonly.html">readonly</a></td>
<td align="left">readonly</td>
<td align="left">readonly 属性规定输入字段是只读的。</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/htmltags/att-input-required.html">required</a>New</td>
<td align="left">required</td>
<td align="left">属性规定必需在提交表单之前填写输入字段。</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/htmltags/att-input-size.html">size</a></td>
<td align="left"><em>number</em></td>
<td align="left">size 属性规定以字符数计的 <input> 元素的可见宽度。</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/htmltags/att-input-src.html">src</a></td>
<td align="left"><em>URL</em></td>
<td align="left">src 属性规定显示为提交按钮的图像的 URL。 (只针对type=”image”)</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/htmltags/att-input-step.html">step</a>New</td>
<td align="left"><em>number</em></td>
<td align="left">step 属性规定 <input> 元素的合法数字间隔。</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/htmltags/att-input-type.html">type</a></td>
<td align="left">button checkbox color date datetime datetime-local email file hidden image month number password radio range reset search submit tel text time url week</td>
<td align="left">type 属性规定要显示的 <input> 元素的类型。</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/htmltags/att-input-value.html">value</a></td>
<td align="left"><em>text</em></td>
<td align="left">指定 <input> 元素 value 的值。</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/htmltags/att-input-width.html">width</a>New</td>
<td align="left"><em>pixels</em></td>
<td align="left">width 属性规定 <input> 元素的宽度。 (只针对type=”image”)</td>
</tr>
</tbody></table>
<h3 id="lt-input-gt-type-属性"><a href="#lt-input-gt-type-属性" class="headerlink" title="&lt;input&gt; type 属性"></a>&lt;input&gt; type 属性</h3><p>带有两种不同输入类型的 HTML 表单，text 和 submit：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;demo-form.php&quot;</span>&gt;</span></span><br><span class="line">Username: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;usrname&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>



<form action="demo-form.php">
Username: <input type="text" name="usrname"><br>
<input type="submit" value="提交">
</form>

<table>
<thead>
<tr>
<th align="left">值</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">button</td>
<td align="left">定义可点击的按钮（通常与 JavaScript 一起使用来启动脚本）。</td>
</tr>
<tr>
<td align="left">checkbox</td>
<td align="left">定义复选框。</td>
</tr>
<tr>
<td align="left">colorNew</td>
<td align="left">定义拾色器。</td>
</tr>
<tr>
<td align="left">dateNew</td>
<td align="left">定义 date 控件（包括年、月、日，不包括时间）。</td>
</tr>
<tr>
<td align="left">datetimeNew</td>
<td align="left">定义 date 和 time 控件（包括年、月、日、时、分、秒、几分之一秒，基于 UTC 时区）。</td>
</tr>
<tr>
<td align="left">datetime-localNew</td>
<td align="left">定义 date 和 time 控件（包括年、月、日、时、分、秒、几分之一秒，不带时区）。</td>
</tr>
<tr>
<td align="left">emailNew</td>
<td align="left">定义用于 e-mail 地址的字段。</td>
</tr>
<tr>
<td align="left">file</td>
<td align="left">定义文件选择字段和 “浏览…” 按钮，供文件上传。</td>
</tr>
<tr>
<td align="left">hidden</td>
<td align="left">定义隐藏输入字段。</td>
</tr>
<tr>
<td align="left">image</td>
<td align="left">定义图像作为提交按钮。</td>
</tr>
<tr>
<td align="left">monthNew</td>
<td align="left">定义 month 和 year 控件（不带时区）。</td>
</tr>
<tr>
<td align="left">numberNew</td>
<td align="left">定义用于输入数字的字段。</td>
</tr>
<tr>
<td align="left">password</td>
<td align="left">定义密码字段（字段中的字符会被遮蔽）。</td>
</tr>
<tr>
<td align="left">radio</td>
<td align="left">定义单选按钮。</td>
</tr>
<tr>
<td align="left">rangeNew</td>
<td align="left">定义用于精确值不重要的输入数字的控件（比如 slider 控件）。</td>
</tr>
<tr>
<td align="left">reset</td>
<td align="left">定义重置按钮（重置所有的表单值为默认值）。</td>
</tr>
<tr>
<td align="left">searchNew</td>
<td align="left">定义用于输入搜索字符串的文本字段。</td>
</tr>
<tr>
<td align="left">submit</td>
<td align="left">定义提交按钮。</td>
</tr>
<tr>
<td align="left">telNew</td>
<td align="left">定义用于输入电话号码的字段。</td>
</tr>
<tr>
<td align="left">text</td>
<td align="left">默认。定义一个单行的文本字段（默认宽度为 20 个字符）。</td>
</tr>
<tr>
<td align="left">timeNew</td>
<td align="left">定义用于输入时间的控件（不带时区）。</td>
</tr>
<tr>
<td align="left">urlNew</td>
<td align="left">定义用于输入 URL 的字段。</td>
</tr>
<tr>
<td align="left">weekNew</td>
<td align="left">定义 week 和 year 控件（不带时区）。</td>
</tr>
</tbody></table>
<h2 id="lt-textarea-gt"><a href="#lt-textarea-gt" class="headerlink" title="&lt;textarea&gt;"></a>&lt;textarea&gt;</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;textarea rows=<span class="string">&quot;10&quot;</span> cols=<span class="string">&quot;30&quot;</span>&gt;</span><br><span class="line">我是一个文本框。 </span><br><span class="line">&lt;/textarea&gt;</span><br></pre></td></tr></table></figure>



<textarea rows="10" cols="30"> 我是一个文本框。  </textarea>

<textarea> 标签定义一个多行的文本输入控件。

文本区域中可容纳无限数量的文本，其中的文本的默认字体是等宽字体（通常是 Courier）。

可以通过 cols 和 rows 属性来规定 textarea 的尺寸大小，不过更好的办法是使用 CSS 的 [height](https://www.w3cschool.cn/cssref/pr-dim-height.html) 和 [width](https://www.w3cschool.cn/cssref/pr-dim-width.html) 属性。

| 属性                                                         | 值        | 描述                                           |
| ------------------------------------------------------------ | --------- | ---------------------------------------------- |
| [autofocus](https://www.w3cschool.cn/htmltags/att-textarea-autofocus.html)New | autofocus | 规定当页面加载时，文本区域自动获得焦点。       |
| [cols](https://www.w3cschool.cn/htmltags/att-textarea-cols.html) | *number*  | 规定文本区域内可见的列数。                     |
| [disabled](https://www.w3cschool.cn/htmltags/att-textarea-disabled.html) | disabled  | 规定禁用文本区域。                             |
| [form](https://www.w3cschool.cn/htmltags/att-textarea-form.html)New | *form_id* | 定义文本区域所属的一个或多个表单。             |
| [maxlength](https://www.w3cschool.cn/htmltags/att-textarea-maxlength.html)New | *number*  | 规定文本区域允许的最大字符数。                 |
| [name](https://www.w3cschool.cn/htmltags/att-textarea-name.html) | *text*    | 规定文本区域的名称。                           |
| [placeholder](https://www.w3cschool.cn/htmltags/att-textarea-placeholder.html)New | *text*    | 规定一个简短的提示，描述文本区域期望的输入值。 |
| [readonly](https://www.w3cschool.cn/htmltags/att-textarea-readonly.html) | readonly  | 规定文本区域为只读。                           |
| [required](https://www.w3cschool.cn/htmltags/att-textarea-required.html)New | required  | 规定文本区域是必需的/必填的。                  |
| [rows](https://www.w3cschool.cn/htmltags/att-textarea-rows.html) | *number*  | 规定文本区域内可见的行数。                     |
| [wrap](https://www.w3cschool.cn/htmltags/att-textarea-wrap.html)New | hard soft | 规定当                                         |

## </textarea>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://robert-pf.github.io/RobertBlog/2020/02/10/HTML5/" data-id="cl338czw80000rcig58cngo19" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/RobertBlog/tags/Web%E7%BD%91%E9%A1%B5/" rel="tag">Web网页</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/RobertBlog/">&amp;laquo; Prev</a><a class="page-number" href="/RobertBlog/">1</a><span class="page-number current">2</span>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/RobertBlog/tags/Java-Spring/" rel="tag">Java Spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/RobertBlog/tags/Java-Web/" rel="tag">Java Web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/RobertBlog/tags/LVM/" rel="tag">LVM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/RobertBlog/tags/MongoDB/" rel="tag">MongoDB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/RobertBlog/tags/MongoDB%E9%9B%86%E7%BE%A4/" rel="tag">MongoDB集群</a></li><li class="tag-list-item"><a class="tag-list-link" href="/RobertBlog/tags/MyBatis/" rel="tag">MyBatis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/RobertBlog/tags/Redis/" rel="tag">Redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/RobertBlog/tags/Servlet/" rel="tag">Servlet</a></li><li class="tag-list-item"><a class="tag-list-link" href="/RobertBlog/tags/Web%E7%BD%91%E9%A1%B5/" rel="tag">Web网页</a></li><li class="tag-list-item"><a class="tag-list-link" href="/RobertBlog/tags/idea-java/" rel="tag">idea java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/RobertBlog/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/RobertBlog/tags/Java-Spring/" style="font-size: 20px;">Java Spring</a> <a href="/RobertBlog/tags/Java-Web/" style="font-size: 10px;">Java Web</a> <a href="/RobertBlog/tags/LVM/" style="font-size: 20px;">LVM</a> <a href="/RobertBlog/tags/MongoDB/" style="font-size: 20px;">MongoDB</a> <a href="/RobertBlog/tags/MongoDB%E9%9B%86%E7%BE%A4/" style="font-size: 10px;">MongoDB集群</a> <a href="/RobertBlog/tags/MyBatis/" style="font-size: 20px;">MyBatis</a> <a href="/RobertBlog/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/RobertBlog/tags/Servlet/" style="font-size: 10px;">Servlet</a> <a href="/RobertBlog/tags/Web%E7%BD%91%E9%A1%B5/" style="font-size: 10px;">Web网页</a> <a href="/RobertBlog/tags/idea-java/" style="font-size: 10px;">idea java</a> <a href="/RobertBlog/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 10px;">设计模式</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/RobertBlog/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/RobertBlog/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/RobertBlog/archives/2022/05/">May 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/RobertBlog/archives/2022/03/">March 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/RobertBlog/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/RobertBlog/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/RobertBlog/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/RobertBlog/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/RobertBlog/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/RobertBlog/archives/2020/02/">February 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/RobertBlog/2022/08/21/%E4%BA%BA%E5%A4%A7%E9%87%91%E4%BB%93%E6%95%B0%E6%8D%AE%E5%BA%93%E6%90%AD%E5%BB%BA%E4%BD%BF%E7%94%A8/">人大金仓数据库搭建</a>
          </li>
        
          <li>
            <a href="/RobertBlog/2022/07/17/IO%E6%A8%A1%E5%9E%8B/">(no title)</a>
          </li>
        
          <li>
            <a href="/RobertBlog/2022/05/12/idea%E4%BD%BF%E7%94%A8%E4%B9%8B%E8%B0%9C/">idea</a>
          </li>
        
          <li>
            <a href="/RobertBlog/2022/03/31/Linux%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/">(no title)</a>
          </li>
        
          <li>
            <a href="/RobertBlog/2021/10/10/Mybatis%E5%92%8C%E4%BA%8B%E5%8A%A1/">MyBatis和事务</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 Robert Pang<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/RobertBlog/" class="mobile-nav-link">Home</a>
  
    <a href="/RobertBlog/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/RobertBlog/fancybox/jquery.fancybox.css">

  
<script src="/RobertBlog/fancybox/jquery.fancybox.pack.js"></script>




<script src="/RobertBlog/js/script.js"></script>




  </div>
</body>
</html>