<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Robert Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Robert Blog">
<meta property="og:url" content="https://robert-pf.github.io/RobertBlog/index.html">
<meta property="og:site_name" content="Robert Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Robert Pang">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/RobertBlog/atom.xml" title="Robert Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/RobertBlog/css/style.css">

<meta name="generator" content="Hexo 5.4.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/RobertBlog/" id="logo">Robert Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/RobertBlog/">Home</a>
        
          <a class="main-nav-link" href="/RobertBlog/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/RobertBlog/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://robert-pf.github.io/RobertBlog"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-自我介绍" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/RobertBlog/2022/07/29/%E8%87%AA%E6%88%91%E4%BB%8B%E7%BB%8D/" class="article-date">
  <time datetime="2022-07-29T00:35:56.603Z" itemprop="datePublished">2022-07-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="版1"><a href="#版1" class="headerlink" title="版1"></a>版1</h2><p>面试官 您好<br>我叫庞腾飞，今年24岁，毕业于中南大学，毕业后一直就职与上海爱数信息技术有限公司，从事Java后端开发工作。<br>长期的工作，让我对Java的了解更加深入，拥有扎实的Java基础。<br>同时熟悉各大数据库，比如Mysql、Oracle、Mongo、Redis等数据库的对接和使用，问题排查。<br>对主流的框架也非常的熟悉，比如SpringBoot、SpringData、SpringSercurity。<br>接下来我就以大学和工作单位为主要时间线简单介绍下自己。<br>1、在大学期间自己积极各种团队和组织，因此收获也是比较多的。<br>大一积极投身自己的兴趣爱好，参加中国大学生创新创业，担任技术部职员、人力资源部、新闻发言人，在这里我收获和很多志同道合的朋友，同时在语言和组织能力上得到了提升。<br>后来在班级中也担任过班长、宣传委员，让我在组合和管理方便有了很多的经验，随后也参加过一定的竞赛，拿过一定的奖项。<br>2、在上海爱数任职期间、主要担任的是Java后端开发工程师，日常主要的的工作是：前期主要是负责软甲的Bug的排查和处理工作，两年内共处理Bug数63个。<br>后期主要工作是对接客户和项目需求，根据客户需求来完善产品，提升用户的使用体验。在任职期间，自己也不断地学习，并将自己的学习转化为输入，分享给我周边的同事。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://robert-pf.github.io/RobertBlog/2022/07/29/%E8%87%AA%E6%88%91%E4%BB%8B%E7%BB%8D/" data-id="cl6w6pzic0003k4iga6i60gaq" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-IO模型" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/RobertBlog/2022/07/17/IO%E6%A8%A1%E5%9E%8B/" class="article-date">
  <time datetime="2022-07-17T11:41:50.254Z" itemprop="datePublished">2022-07-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>总共有一下几种IO模型。</p>
<p>同步：发出功能调用时，在没有得到结果之前，该调用就不会反悔，必须一件事情一件事情干。</p>
<p>异步：当异步过程调用发出后，调用者不能立刻得到结果。实际处理这个调用的不见在完成后，通过状态，通知和回调来通知调用者。</p>
<p>阻塞：阻塞调用是指调用结果返回之前，当前线程会被挂起，函数之后在得到结果之后才会返回。</p>
<p>非阻塞：在调用改函数时，如果不能立刻得到结果，该函数不会阻塞线程，会先返回一个信号。</p>
<h3 id="1、阻塞式IO"><a href="#1、阻塞式IO" class="headerlink" title="1、阻塞式IO"></a>1、阻塞式IO</h3><p>应用程序调用一个IO函数，因为数据还没准备号，导致应用程序阻塞，等待数据准备好才能返回成功。</p>
<h3 id="2、非阻塞式IO"><a href="#2、非阻塞式IO" class="headerlink" title="2、非阻塞式IO"></a>2、非阻塞式IO</h3><p>通过进程反复调用IO函数，多次系统调用，并马上返回；在数据拷贝过程中，进程是阻塞的。在数据没有拷贝成功时，调用函数会返回错误值，调用进程会不断得调用IO函数，此时进程不会进进入睡眠。</p>
<p>虽然表面上看非阻塞的方式可以明显的提高CPU的利用率，但是也带了另外一种后果就是系统的线程切换增加。增加的CPU执行时间能不能补偿系统的切换成本需要好好评估。</p>
<h3 id="3、IO多路复用"><a href="#3、IO多路复用" class="headerlink" title="3、IO多路复用"></a>3、IO多路复用</h3><p>主要是select和epoll；对一个IO端口，两次调用，两次返回，比阻塞IO并没有什么优越性；关键是能实现同时对多个IO端口进行监听； I/O复用模型会用到select、poll、epoll函数，这几个函数也会使进程阻塞，但是和阻塞I/O所不同的的，这两个函数可以同时阻塞多个I/O操作。而且可以同时对多个读操作，多个写操作的I/O函数进行检测，直到有数据可读或可写时，才真正调用I/O操作函数。</p>
<h3 id="4、信号驱动IO"><a href="#4、信号驱动IO" class="headerlink" title="4、信号驱动IO"></a>4、信号驱动IO</h3><p>首先我们允许套接口进行信号驱动I/O,并安装一个信号处理函数，进程继续运行并不阻塞。当数据准备好时，进程会收到一个SIGIO信号，可以在信号处理函数中调用I/O操作函数处理数据。</p>
<h3 id="5、异步IO"><a href="#5、异步IO" class="headerlink" title="5、异步IO"></a>5、异步IO</h3><p>当一个异步过程调用发出后，调用者不能立刻得到结果。实际处理这个调用的部件在完成后，通过状态、通知和回调来通知调用者的输入输出操作</p>
<p>在 Linux 中，通知的方式是 “信号”，分为三种情况：<br>　　①、如果这个进程正在用户态处理其他逻辑，那就强行打断，调用事先注册的信号处理函数，这个函数可以决定何时以及如何处理这个异步任务。由于信号处理函数是突然闯进来的，因此跟中断处理程序一样，有很多事情是不能做的，因此保险起见，一般是把事件 “登记” 一下放进队列，然后返回该进程原来在做的事。<br>　　②、如果这个进程正在内核态处理，例如以同步阻塞方式读写磁盘，那就把这个通知挂起来了，等到内核态的事情忙完了，快要回到用户态的时候，再触发信号通知。<br>　　③、如果这个进程现在被挂起了，例如陷入睡眠，那就把这个进程唤醒，等待CPU调度，触发信号通知。</p>
<h4 id="select、poll、epoll"><a href="#select、poll、epoll" class="headerlink" title="select、poll、epoll"></a>select、poll、epoll</h4><p>目前支持I/O多路复用的系统调用有  select，pselect，poll，epoll，I/O多路复用就是 通过一种机制，一个进程可以监视多个描述符，一旦某个描述符就绪（一般是读就绪或者写就绪），能够通知程序进行相应的读写操作。 但select，pselect，poll，epoll本质上都是同步I/O，因为他们都需要在读写事件就绪后自己负责进行读写，也就是说这个读写过程是阻塞的，而异步I/O则无需自己负责进行读写，异步I/O的实现会负责把数据从内核拷贝到用户空间。<br>与多进程和多线程技术相比， I/O多路复用技术的最大优势是系统开销小，系统不必创建进程/线程，也不必维护这些进程/线程，从而大大减小了系统的开销。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://robert-pf.github.io/RobertBlog/2022/07/17/IO%E6%A8%A1%E5%9E%8B/" data-id="cl6w6pzhz0000k4ig4dne3j75" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-idea使用之谜" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/RobertBlog/2022/05/12/idea%E4%BD%BF%E7%94%A8%E4%B9%8B%E8%B0%9C/" class="article-date">
  <time datetime="2022-05-12T15:30:35.000Z" itemprop="datePublished">2022-05-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/RobertBlog/2022/05/12/idea%E4%BD%BF%E7%94%A8%E4%B9%8B%E8%B0%9C/">idea</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1、背景"><a href="#1、背景" class="headerlink" title="1、背景"></a>1、背景</h2><p>前两日，电脑的C盘的系统出现了问题，重启后，就启动不起来了。中间是想了各种办法想让它起来，研究了大半天，最后还是妥协了，重装了 W11 系统，重装完系统之后就是各种日常使用的软件重装的过程，之前觉得动不动就重装个系统是一件挺愉悦的事情，但是此次就让我感受到了难受，再也不想随便装系统了。其他的软件的重装和调试过程就不讲了，就讲讲这个<code>idea</code>的重装和使用过程吧。</p>
<p>之前一直用的是<code>idea 2021 03</code>版本的，一直用到前不久，系统起不来之后，给C盘重做了下系统。好一点的是D盘上的软件数据都还在，可怜了我的用户配置文件都没了。</p>
<p>重装完，重启<code>idea</code>还能用，但是多少有点不是那么爽。就是想重新装一下idea，让软件注册到系统中，方便使用。</p>
<p>好了，要装就装个最新版的玩玩吧。这一装不要紧，让我研究了大半天的<code>maven</code>项目功能。</p>
<h2 id="2、重点来了"><a href="#2、重点来了" class="headerlink" title="2、重点来了"></a>2、重点来了</h2><p>2022新版本的<code>idea</code>中在新建项目和模块的时候，已经没有了下图中的Maven模块，不能像之前那样创建Maven项目了</p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\001.pang" alt="img"></p>
<p>现在新建Module的时候是这样的，只有一个Maven Archtyoe的选项可选</p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\idea\002.png" alt="image-20220512234654227"></p>
<p>当时开始看到这样子，让我百思不得其解，上网各种查阅资料，最后都没解决。</p>
<p>最后去官网看看吧，仔细研究研究：发现这是的一个新的特性：<a target="_blank" rel="noopener" href="https://www.jetbrains.com/idea/whatsnew/#key-updates">https://www.jetbrains.com/idea/whatsnew/#key-updates</a></p>
<p>主要是用来创建Mavne Archtype的项目，跟普通的Maven项目还是不一样的。</p>
<p>所以接下来的最终的目的来了，我要创建一个普通的Maven项目，怎么办？！！！！！！</p>
<p>研究了官网半天，发现新版本创建Maven项目，只需要在创建项目的时候，选择一下行，跟创建普通项目集成到一个页面中了。</p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\idea\003.png" alt="image-20220512235307602"></p>
<p>就需要选择3步:</p>
<ol>
<li>选择new Module </li>
<li>选择标号2指出来的Maven</li>
<li>选择JDK版本，同时可以填写包的坐标信息。</li>
</ol>
<p>打完收工，特此记录研究了大半天的新版本改变。</p>
<p>继续肝命去了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://robert-pf.github.io/RobertBlog/2022/05/12/idea%E4%BD%BF%E7%94%A8%E4%B9%8B%E8%B0%9C/" data-id="cl338czwi0003rcig06hn3hp5" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/RobertBlog/tags/idea-java/" rel="tag">idea java</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-笔记" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/RobertBlog/2022/04/12/%E7%AC%94%E8%AE%B0/" class="article-date">
  <time datetime="2022-04-11T16:00:00.000Z" itemprop="datePublished">2022-04-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/RobertBlog/2022/04/12/%E7%AC%94%E8%AE%B0/">Java 面试题整理笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="1、说一说虚拟地址空间有哪些部分："><a href="#1、说一说虚拟地址空间有哪些部分：" class="headerlink" title="1、说一说虚拟地址空间有哪些部分："></a>1、说一说虚拟地址空间有哪些部分：</h3><p>用户空间、内核空间、栈空间、堆空间、代码段、BSS段、DATA段</p>
<p>32位系统中，虚拟地址空间为 0 ~ 4G，将最高的 1G 字节（从虚拟地址 0xC0000000 到 0xFFFFFFFF），供内核使用，称为内核空间，将较低的 3G 字节（从虚拟地址 0x00000000 到 0xBFFFFFFF），供各个进程使用，称为用户空间，虚拟地址空间分布如下图：<br><img src="/RobertBlog/.io//02B0D093C76FDC4C79EF2939FA3217C0.png" alt="图片说明"><br><img src="https://www.nowcoder.com/interview/ai/img/001-1.11.png" alt="img"></p>
<ol>
<li><p>内核空间</p>
<p>存放内核的代码和数据，所有进程的内核代码段都映射到同样的物理内存，并在内存中持续存在，是操作系统的一部分。内核空间为内核保留，不允许应用程序读写该区域的内容或直接调用内核代码定义的函数。</p>
</li>
<li><p>用户空间</p>
<p>用户空间给各个进程使用，也称为使用者空间。用户空间中的代码运行在较低的特权级别上，只能看到允许它们使用的部分系统资源，并且不能使用某些特定的系统功能，也不能直接访问内核空间和硬件设备，以及其他一些具体的使用限制。用户空间又大致细分为下列一些空间：</p>
<ul>
<li>栈空间</li>
<li>共享区</li>
<li>堆空间</li>
<li>BSS 段（未初始化数据段）</li>
<li>DATA 段（已初始化数据段）</li>
<li>TEXT 段（代码段）</li>
<li>保留区</li>
</ul>
</li>
</ol>
<h4 id="延伸阅读"><a href="#延伸阅读" class="headerlink" title="延伸阅读"></a>延伸阅读</h4><p>用户空间：</p>
<ol>
<li><p>栈空间</p>
<p>栈又称堆栈，由编译器自动分配释放，行为类似数据结构中的栈（先进后出）。存储局部变量、函数参数值。栈从高地址向低地址增长，是一块连续的空间。</p>
</li>
<li><p>共享区</p>
<p>内存映射以及共享库（动态库）所在的内存。</p>
</li>
<li><p>堆空间</p>
<p>堆用于存放进程运行时动态分配的内存段，可动态扩张或缩减。堆从低地址向高地址增长。通过 new() 或者 malloc() 函数可以在堆区开辟空间。</p>
</li>
<li><p>BSS 段（未初始化数据段）</p>
<p>BSS（Block Started by Symbol）段中通常存放程序中以下符号：</p>
<ul>
<li>未初始化的全局变量和静态局部变量</li>
<li>初始值为 0 的全局变量和静态局部变量(依赖于编译器实现)</li>
</ul>
</li>
<li><p>DATA 段（已初始化数据段）</p>
<p>数据段通常用于存放程序中已初始化且初值不为 0 的全局变量和静态局部变量。</p>
</li>
<li><p>TEXT 段（代码段）</p>
<p>代码段也称正文段或文本段，通常用于存放程序执行代码（即CPU执行的机器指令）。</p>
</li>
<li><p>保留区</p>
<p>位于虚拟地址空间的最低部分，未赋予物理地址。任何对它的引用都是非法的，用于捕捉使用空指针和小整型值指针引用内存的异常情况。</p>
</li>
</ol>
<h3 id="2、MySQL的事务隔离级别："><a href="#2、MySQL的事务隔离级别：" class="headerlink" title="2、MySQL的事务隔离级别："></a>2、MySQL的事务隔离级别：</h3><p>脏读：一个事务读取另一个还未提交的事务修改的数据。</p>
<p>丢失修改：两个事务都对数据做了修改，但是还未提交，导致两次修改都是基于还未修改的做的操作，其中有一个事务的修改会丢失。</p>
<p>不可重复读：两次读取到的数不一样。</p>
<ul>
<li>读未提交：允许读取未提交的事务，mysql的最低隔离级别，可能</li>
<li>读已提交：允许读取</li>
<li>可重复读</li>
<li>串行</li>
</ul>
<h3 id="3、面向对象和面向过程"><a href="#3、面向对象和面向过程" class="headerlink" title="3、面向对象和面向过程"></a>3、面向对象和面向过程</h3><p>面向对象和面向过程注重点不一定样，面向过程围绕的是整个流程需要怎么设计，面向对象主要是将行为抽取未对象的特征或者功能，后期再再让对象执行流程。</p>
<p>面向对象最大的三个特性是，封装、继承、多态。封装是为了</p>
<h3 id="4、https1-0和2-0的区别"><a href="#4、https1-0和2-0的区别" class="headerlink" title="4、https1.0和2.0的区别"></a>4、https1.0和2.0的区别</h3><h3 id="5、重载和重写的区别"><a href="#5、重载和重写的区别" class="headerlink" title="5、重载和重写的区别"></a>5、重载和重写的区别</h3><p>重载是发生在同一个类中，方法名相同，参数类型、顺序、个数不一致；方法返回值、和权限修饰符可以不一样。</p>
<p>重写是子类重写父类的方法，方法名、参数类型必须一致；返回值和类型、抛出异常范围必须小于父类。访问修饰符必须大于等于父类。</p>
<h3 id="6、List-Set区别"><a href="#6、List-Set区别" class="headerlink" title="6、List Set区别"></a>6、List Set区别</h3><p>List 是有序可重复，存储顺序是按照添加元素的顺序存储得，可以有多个null值。可以使用迭代器和get（index i）的方法获得对象。</p>
<p>Set 存储的是无序和不可重复的、存储位置根据数据的hash值进行映射存储。只能用迭代器进行遍历查找。</p>
<h3 id="7、ConcurrentHashMap扩容机制："><a href="#7、ConcurrentHashMap扩容机制：" class="headerlink" title="7、ConcurrentHashMap扩容机制："></a>7、ConcurrentHashMap扩容机制：</h3><p>1.7版本：</p>
<ul>
<li>采用的是分段数组+链表实现。基于Segment分段实现的。</li>
<li>每个Segment相当于一个小型的HashMap。</li>
<li>每个Segment内部会进行扩容，和Hashmap的扩容逻辑类似。</li>
<li>先生成新的数据，然后转移元素到新的数组中。</li>
<li>扩容的判断也是每个Segment内部单独判断，判断是否超过阈值。</li>
</ul>
<p>1.8版本：</p>
<ul>
<li>采用的是数组+链表/红黑树实现的</li>
<li>当某个线程进行put操作时，如果发现ConcurrentHashMap正在进行扩容，那么该线程一起进行扩容。</li>
<li>ConcurrentHashMap是支持多线程进行扩容。</li>
<li>如果缪个线程put是，发现没有进行扩容，则将key-value添加到ConcurrentHashMap中，然后判断是否超过阈值，超过了则进行扩容。</li>
<li>扩容之前也是先生成一个新的数组。</li>
<li>在愿意元素是，先将原数组分组，将每组分给不同的线程来进行元素的转移，每个线程负责一组或者多组元素的转移。</li>
</ul>
<h3 id="8、1-7-1-8-HashMap的变化"><a href="#8、1-7-1-8-HashMap的变化" class="headerlink" title="8、1.7-1.8 HashMap的变化"></a>8、1.7-1.8 HashMap的变化</h3><p>1.7 数组+链表 1.8 数组+链表+红黑树，加红黑树的目的是提高HashMap插入和查询的整体效率。</p>
<p>1.7链表使用的是头插法，1.8链表使用的尾插法。因为1.8插入key和value时需要判断链表元素的个数，所以需要遍历链表元素的个数，所以正好使用尾插法。</p>
<p>1.7 哈希算法存在左移和右移与异或运算，1.8中进行了简化，因为复杂的哈希算法的目的就是提高散列性，来提供HashMap的整体效率，而1.8中新增了红荷数，可以适当的简化hash算法，节省CPU资源。</p>
<h3 id="9、-HashMap的put方法"><a href="#9、-HashMap的put方法" class="headerlink" title="9、 HashMap的put方法"></a>9、 HashMap的put方法</h3><p>1、根据key通过hash算法和与运算得出数组下标。</p>
<p>2、数组下标为空，将key和value封装为Entry对象（1.8 时Node对象）并放入该位置。</p>
<p>3、如果数组下标位置元素不为空，则要分情况讨论：</p>
<ol>
<li>1.7先判断是否扩容，需要扩容就先扩容，如果不需要扩容就先生成Entry对象，使用头插法添加到当前位置的链表中。</li>
<li>1.8 先判断当前位置上的Node的类型，<ol>
<li>红黑树，将对象添加到红黑树中或者更新红黑树的value</li>
<li>链表节点，先尾插或者更新key-value，再判断是否满足转换成红黑树的条件。</li>
<li>将key-value封装为Node或者红黑树后，再判断是否需要进行扩容，如果需要扩容，就进行扩容，如果不需要的话就结束put方法。</li>
</ol>
</li>
</ol>
<h3 id="10、深拷贝和浅拷贝"><a href="#10、深拷贝和浅拷贝" class="headerlink" title="10、深拷贝和浅拷贝"></a>10、深拷贝和浅拷贝</h3><p>浅拷贝的只拷贝基本数据类型和引用</p>
<p>深拷贝时将涉及到的对象的数据进行全部尽心拷贝。</p>
<h3 id="11、HashMap的扩容机制。"><a href="#11、HashMap的扩容机制。" class="headerlink" title="11、HashMap的扩容机制。"></a>11、HashMap的扩容机制。</h3><p>1.7 版本</p>
<ol>
<li>​    先生成新数组</li>
<li>遍历老数组中的元素</li>
<li>取出key ，基于新数组长度，计算每个元素在新数组中的下标。</li>
<li>将元素添加到新数组中</li>
<li>所有元素转移完了之后，将新数组赋值给HashMap对象的table属性。</li>
</ol>
<p>1.8版本</p>
<ol>
<li>先生成新数组</li>
<li>遍历老数组</li>
<li>如果是链表，则将链表中的每个元素重新计算下标，添加到新数组中</li>
<li>如果是红黑树，先遍历红黑树，计算出红黑树中每个元素对应在新数组中的下标位置。<ol>
<li>统计每个下标的元素个数，如果该下标位置元素个数超过8生成红黑树，负责已链表形式插入数组中。</li>
</ol>
</li>
<li>所有元素转移完之后，将新数组复制给HashMap对象的table属性。</li>
</ol>
<h3 id="12、CopyOnWriteArrayList的原理："><a href="#12、CopyOnWriteArrayList的原理：" class="headerlink" title="12、CopyOnWriteArrayList的原理："></a>12、CopyOnWriteArrayList的原理：</h3><p>可以实现多并发，读多写少，对实时性要求不高的情况。</p>
<p>原理：在一个线程读数据的时候，另一个线程有写的情况，会先将数组复制一份出来，并且加锁防止并发写入，在新的数组上进行写操作，读操作还是在原数组上进行。当写操作完成时，会释放锁，并且将原数组指向新的数组。</p>
<h3 id="13、什么是字节码，字节码的好处"><a href="#13、什么是字节码，字节码的好处" class="headerlink" title="13、什么是字节码，字节码的好处"></a>13、什么是字节码，字节码的好处</h3><p>字节码是java源文件编译后的文件，编译后的文件的话可以跨平台运行。编译后的文件，也会提高代码的执行性能。</p>
<h3 id="14、java中的异常体系是什么"><a href="#14、java中的异常体系是什么" class="headerlink" title="14、java中的异常体系是什么"></a>14、java中的异常体系是什么</h3><p>java中的所有异常的父类是Throwable.</p>
<p>Throwable 分为两类 erro 和exception：erro是java虚拟机比价严重的错误比如堆栈溢出，通常这些报错是靠程序自身是无法解决的，Error不能在程序运行过程中被动态处理，一旦出现Error，系统能做的只有记录错误的原因和安全终止。</p>
<p>exception 在运行中的程序发生了程序员不期望发生的事情，可以被Java异常处理机制处理。分为RuntimeException和非RuntimeException</p>
<ol>
<li>RuntimeException是运行时异常，需要在运行的时候后可以产生的异常：</li>
<li>非RuntimeException就是Exception类中除运行类异常之外的异常，如果不处理这类异常，程序都无法编译通过，例如io异常和sql异常。</li>
</ol>
<h3 id="15、什么样的类能被回收"><a href="#15、什么样的类能被回收" class="headerlink" title="15、什么样的类能被回收"></a>15、什么样的类能被回收</h3><ol>
<li>改类所有的对象实例都已被回收，java堆中不存在该类的任何实例。</li>
<li>加载该类的ClassLoader已经被回收。</li>
<li>该类对应的Java.lang.Class 对象没有在二年和地方被引用，无法在任何地方通过反射访问该类的方法。</li>
</ol>
<h3 id="16、JVM-垃圾收集算法"><a href="#16、JVM-垃圾收集算法" class="headerlink" title="16、JVM 垃圾收集算法"></a>16、JVM 垃圾收集算法</h3><ol>
<li>复制算法：只能利用一半的空间。</li>
<li>标记清除算法：内存碎片化严重，标记比较多的时候，效率比较低。</li>
<li>标记整理算法：</li>
</ol>
<h3 id="17、解释JVM内部各种垃圾收集算法："><a href="#17、解释JVM内部各种垃圾收集算法：" class="headerlink" title="17、解释JVM内部各种垃圾收集算法："></a>17、解释JVM内部各种垃圾收集算法：</h3><ol>
<li>分带收集理论：Java 堆分为新生代和老年代。新生代朝生夕死，可以采用复制算法完成垃圾收集。老年代对象的存活率较高，采用标记清除和标记整理算法比较合适，但是标记清理和标记清除算法比复制算法慢10倍以上。</li>
<li></li>
</ol>
<h3 id="18、解释下CMS收集器垃圾收集过程"><a href="#18、解释下CMS收集器垃圾收集过程" class="headerlink" title="18、解释下CMS收集器垃圾收集过程"></a>18、解释下CMS收集器垃圾收集过程</h3><p>三色标记</p>
<p>三色标记产生的漏标问题怎么解决：</p>
<p>增量更新和原始快照方法解决的：增量更新是如果有新的</p>
<h3 id="19、G1垃圾回收器过程"><a href="#19、G1垃圾回收器过程" class="headerlink" title="19、G1垃圾回收器过程"></a>19、G1垃圾回收器过程</h3><h3 id="20、G1垃圾收集器最大的停顿时间是如何实现的"><a href="#20、G1垃圾收集器最大的停顿时间是如何实现的" class="headerlink" title="20、G1垃圾收集器最大的停顿时间是如何实现的"></a>20、G1垃圾收集器最大的停顿时间是如何实现的</h3><p>G1收集器在后台维护了一个优先列表，每次根据允许的收集时间，优先选择回收价值最大的region，每一个region会估算回收需要的时间。在回收时间有限的情况下，会选用回收效率最高效的区域进行回收。</p>
<h3 id="21、内存泄漏到底是怎么回事，怎么快速排查"><a href="#21、内存泄漏到底是怎么回事，怎么快速排查" class="headerlink" title="21、内存泄漏到底是怎么回事，怎么快速排查"></a>21、内存泄漏到底是怎么回事，怎么快速排查</h3><p>一般的电商架构可能会使用多级缓存架构，就是Redis加上JVM级缓存，当JVM级缓存直接用了hashMap，于是不断往里边放数据的过程中，缓存mao越来越大，时间长了就会导致full gc非常频繁，这就是一种内存泄漏。时间长了可能还会导致OOM。</p>
<p>这种情况完全可以考虑采用一些成熟的JVM级缓存框架来解决，比如ehcache邓自带的一些LRU数据淘汰算法的框架来作为JVM级的缓存。</p>
<h3 id="22、GC是什么时候都能做得吗？知道GC安全点与安全区域是怎么回事？"><a href="#22、GC是什么时候都能做得吗？知道GC安全点与安全区域是怎么回事？" class="headerlink" title="22、GC是什么时候都能做得吗？知道GC安全点与安全区域是怎么回事？"></a>22、GC是什么时候都能做得吗？知道GC安全点与安全区域是怎么回事？</h3><p>GC不是任何时候都能做得，需要代码运行到安全点或安全区域才能做。</p>
<p>安全点：代码中的一些特定的位置，当线程运行到这些位置时，他的状况时确定的，这样JVM就可以安全的进行一些操作，比如GC，所以GC是需要等待所有的线程运行到安全点之后才能触发。</p>
<p>这些特定的安全位置主要有以下几种：</p>
<ol>
<li>方法返回之前</li>
<li>调用某个方法之后</li>
<li>抛出异常的位置</li>
<li>循环的末尾</li>
</ol>
<p>大体实现思想时，当垃圾收集器需要中断线程的时候，不直接对线程做操作，仅简单的设置一个标志位，各个线程执行过中会检查自己是否运行到这个标志位，如果到了的话，自己主动挂起。</p>
<p>安全区域：安全点时对于正在执行的线程设定的，如果一个线程处于sleep状态或者中断状态，他就不能相应jvm的终端请求，再运行到安全点。因此JVM引入了安全区域，是指一段代码片中，引用关系不会发生变化，在这个区域内的任意地方，开始GC是安全的。</p>
<h3 id="22、解析下字符串常量池："><a href="#22、解析下字符串常量池：" class="headerlink" title="22、解析下字符串常量池："></a>22、解析下字符串常量池：</h3><h1 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h1><h3 id="15、Spring创建对象bean的流程"><a href="#15、Spring创建对象bean的流程" class="headerlink" title="15、Spring创建对象bean的流程"></a>15、Spring创建对象bean的流程</h3><p>UserService类–&gt;推断构造方法（推断构造方法，可以用无参或者有参的）–&gt;对象—&gt;依赖注入</p>
<p>–&gt;初始化前（@PostConstruct 找到类中有此注解的方法执行）</p>
<p>–&gt;初始化（InitializingBean）–&gt;初始化后（AOP）–&gt;代理对象–&gt;放入Map单例池中—&gt;bean对象</p>
<h4 id="16、推断构造方法是什么？"><a href="#16、推断构造方法是什么？" class="headerlink" title="16、推断构造方法是什么？"></a>16、推断构造方法是什么？</h4><ul>
<li><p>UserService类–无参构造方法</p>
<ul>
<li><p>一个类中如果有多个构造方法的情况下，默认会用无参构造方法进行实例化实例。</p>
</li>
<li><p>如果有多个构造方法并且没有无参构造方法的情况下，会去寻找构造方法中是否有@Autowired这个注解，如果有的话，会使用此构造方法。</p>
</li>
</ul>
</li>
</ul>
<p>在使用构造方法创建实例的过程中，会使用先byType，再byName的方式传入Bean。例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">UserService</span><span class="params">(OrderService orderService1)</span>&#123;</span><br><span class="line">    system.out.println(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上述构造方法中有一个orderservice的bean需要传入，spring会现根据OrderService寻找Map中寻找是否有类为OrderService类的Bean，如果有且只有一个的时候，就用此Bean；如果有多个情况下，会根绝orderService1这个名字寻找到对应的Bean并传入。</p>
<ul>
<li>总结 先ByType 后ByName。</li>
</ul>
<h4 id="17、依赖注入过程"><a href="#17、依赖注入过程" class="headerlink" title="17、依赖注入过程"></a>17、依赖注入过程</h4><ul>
<li>也是先ByType，后ByName。</li>
</ul>
<h4 id="18、动态代理"><a href="#18、动态代理" class="headerlink" title="18、动态代理"></a>18、动态代理</h4><p><img src="/RobertBlog/.io//image-20220730203215842-16591843483961.png" alt="image-20220730203215842"></p>
<h3 id="19、注解失效"><a href="#19、注解失效" class="headerlink" title="19、注解失效"></a>19、注解失效</h3><p>直接在一个事务中执行开了注解的另外一个方法，方法a的注解会失效。</p>
<p><img src="/RobertBlog/.io//image-20220731000415283-16591970797482.png" alt="image-20220731000415283"></p>
<h2 id="20、-Configuration的作用"><a href="#20、-Configuration的作用" class="headerlink" title="20、@Configuration的作用"></a>20、@Configuration的作用</h2><ol>
<li>告诉spring这是一个配置类，相当于spring的xml配置文件</li>
<li>被@Configuration 注解的类，会被cglib代理进行增强</li>
<li>@Conﬁguration类允许通过调用同一类中的其他@Bean方法来定义bean之间的依赖关系，保证@Bean的对象作用域受到控制，避免多例</li>
</ol>
<h2 id="21、为什么要用三级缓存，解决循环依赖问题？"><a href="#21、为什么要用三级缓存，解决循环依赖问题？" class="headerlink" title="21、为什么要用三级缓存，解决循环依赖问题？"></a>21、为什么要用三级缓存，解决循环依赖问题？</h2><ul>
<li>类名前两个字母是大写的情况下 ABService下，spring中对应的Bean的Name是AService，如果是Abservice ，spring中bean容器中的name是abservice。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Compan</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AService</span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="22、-Async-会-导致循坏依赖失败"><a href="#22、-Async-会-导致循坏依赖失败" class="headerlink" title="22、@Async 会 导致循坏依赖失败"></a>22、@Async 会 导致循坏依赖失败</h2><h2 id="23、构造方法何何多实例导致循环依赖失败"><a href="#23、构造方法何何多实例导致循环依赖失败" class="headerlink" title="23、构造方法何何多实例导致循环依赖失败"></a>23、构造方法何何多实例导致循环依赖失败</h2><ul>
<li>​    构造方法传入了相互依赖的参数</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Class ASeervice&#123;</span><br><span class="line">    <span class="keyword">private</span> Bservice bService;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AService</span><span class="params">(BServive bService)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.bService=bService</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> Class BSeervice&#123;</span><br><span class="line">    <span class="keyword">private</span> Aservice aService;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BService</span><span class="params">(AServive aService)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.bService=bService</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>多实例导致失败</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Scope(&quot;prototype&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Class ASeervice&#123;</span><br><span class="line">    <span class="keyword">private</span> Bservice bService;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AService</span><span class="params">(BServive bService)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.bService=bService</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Scope(&quot;prototype&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Class BSeervice&#123;</span><br><span class="line">    <span class="keyword">private</span> Aservice aService;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BService</span><span class="params">(AServive aService)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.bService=bService</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Web容器</p>
<p>Tomcat、Jetty、Undertow</p>
<p>自动选择使用什么容器的原理</p>
<p><img src="/RobertBlog/.io//image-20220809224555503-16600563587151.png" alt="image-20220809224555503"></p>
<p><img src="/RobertBlog/.io//image-20220809224625746-16600563876112.png" alt="image-20220809224625746"></p>
<h2 id="ConditionalOnClass注解"><a href="#ConditionalOnClass注解" class="headerlink" title="@ConditionalOnClass注解"></a>@ConditionalOnClass注解</h2><p><img src="/RobertBlog/.io//image-20220809225239901-16600567619823.png" alt="image-20220809225239901"></p>
<p>ASM util获取class文件的注解信息。</p>
<p>BeanPostProcess</p>
<h1 id="Mysql："><a href="#Mysql：" class="headerlink" title="Mysql："></a>Mysql：</h1><p>B树和B+树的区别：</p>
<p>B树，一个节点可能会有多个</p>
<p>数据库中字符类型转换：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a,var e, index <span class="keyword">on</span> a,e;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t1 <span class="keyword">where</span> a<span class="operator">=</span><span class="number">1</span>; #能走索引查询</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t1 <span class="keyword">where</span> a<span class="operator">=</span><span class="string">&#x27;1&#x27;</span>;#能走索引查询</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t1 <span class="keyword">where</span> e<span class="operator">=</span><span class="number">1</span>;#不能走索引查询，因为此条件中 e是<span class="type">varchar</span>类型，在与<span class="number">1</span>最比较的时候，会先将e转换成<span class="type">int</span> <span class="number">0</span>,所以查询不出结果。</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t1 <span class="keyword">where</span> e<span class="operator">=</span><span class="string">&#x27;1&#x27;</span>;#能走索引查询</span><br><span class="line">#不是数字的字符，在查询时，如果用判断e的的值的时候会将e转换成<span class="number">0</span>；</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>索引：</p>
<table>
<thead>
<tr>
<th>Memory存储引擎</th>
<th>Hash索引</th>
<th>不支持排序<br>不支持部分列索引查找<br>只支持等值查询，无法提供范围查询功能</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td>B 树</td>
<td>优秀检索速度<br>尽可能少的磁盘 IO，加快了检索速度；<br>可以支持范围查找。</td>
</tr>
<tr>
<td>Innodb 作为存储引擎<br>myisam 作为存储引擎</td>
<td>B+Tree</td>
<td>非叶子节点不存储data,只存储索引(冗余),可以放更多的索引 <br>叶子节点包含所有索引字段<br>叶子节点用双向指针相连，提高区间访问性</td>
</tr>
</tbody></table>
<h2 id="innodb和myisam的区别"><a href="#innodb和myisam的区别" class="headerlink" title="innodb和myisam的区别"></a>innodb和myisam的区别</h2><ul>
<li>innodb支持事务，而myisam不支持事务。Myisam不支持事务原因索引与数据分开存储，两个文件无法做到一致性。</li>
<li>innodb支持外键，而myisam不支持外键。</li>
<li>innodb默认表锁，使用索引检索条件时是行锁，而myisam是表锁（每次更新增加删除都会锁住表）。</li>
<li>innodb和myisam的索引都是基于b+树，但他们具体实现不一样，innodb的b+树的<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%8F%B6%E5%AD%90%E8%8A%82%E7%82%B9&spm=1001.2101.3001.7020">叶子节点</a>是存放数据的，myisam的b+树的叶子节点是存放指针的。</li>
<li>innodb是<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E8%81%9A%E7%B0%87%E7%B4%A2%E5%BC%95&spm=1001.2101.3001.7020">聚簇索引</a>，必须要有主键，一定会基于主键查询，但是辅助索引就会查询两次，myisam是非聚簇索引，索引和数据是分离的，索引里保存的是数据地址的指针，主键索引和辅助索引是分开的。</li>
<li>innodb不存储表的行数，所以select count( * )的时候会全表查询，而myisam会存放表的行数，select count(*）的时候会查的很快。</li>
</ul>
<h4 id="应用场景："><a href="#应用场景：" class="headerlink" title="应用场景："></a>应用场景：</h4><ul>
<li>MyISAM：以读写插入为主的应用程序，比如博客系统、新闻门户网站，存储操作日志。</li>
<li>Innodb：更新（删除）操作频率也高，或者要保证数据的完整性；并发量高，支持事务和外键。比如 OA自动化办公系统。</li>
</ul>
<h4 id="数据存储形式"><a href="#数据存储形式" class="headerlink" title="数据存储形式"></a>数据存储形式</h4><ul>
<li>聚集索引（聚簇索引）形式：索引和数据是否存在放一起，即B+tree中的叶子节点存储的是实际数据；</li>
<li>非聚集索引（非聚簇索引）：索引存放的是数据的一个指针，可以是主键，也可以是数据的地址值。</li>
</ul>
<ol>
<li>Mysql的innodb引擎：是利用B++树以聚簇索引的形式实现存放数据，表中的非聚簇索引（二级索引）存放的是数据的的主键值。一个Innodb只能有一个聚簇索引，可以有多个二级索引。<ul>
<li><strong>聚簇索引建立的列规则</strong>，按照优先级为：主键-&gt;第一个非空唯一列-&gt;InnoDB创建一个隐式row-id作为聚簇索引</li>
</ul>
</li>
<li>MyISAM存储引擎：是利用B+树以非聚簇索引的形式实现存放数据。索引和数据是分开存放的，索引的叶子节点存储的是数据行的地址。<code>MyISAM</code> 引擎按照数据插入顺序，将数据文件存储在磁盘上.</li>
</ol>
<h4 id="回表查询"><a href="#回表查询" class="headerlink" title="回表查询:"></a>回表查询:</h4><ul>
<li>就是根据非聚簇索引，查找到主键值，再根据主键值去表中取数据的过程就叫做回表。</li>
<li>innodb中回表一般是出现利用非聚簇索引查询时，需要返回的数据不在索引中会出需要回表进行取值操作。</li>
<li>Myisam检索数据过程中有 “回表操作”，因为myisam的索引是非聚簇索引，利用索引只能查询到数据中对应的行的地址。</li>
</ul>
<h4 id="索引覆盖："><a href="#索引覆盖：" class="headerlink" title="索引覆盖："></a>索引覆盖：</h4><p>只需要在一棵索引树上就能获取SQL所需的所有列数据，无需回表，速度更快，这就叫做索引覆盖。 实现索引覆盖最常见的方法就是：将被查询的字段，建立到组合索引。</p>
<p>Inodb查询等于的查询 引擎会自动使用哈希索引进行查询,存储引擎会监控对表上索引的查找，如果观察到建立哈希索引可以带来速度的提升，则建立哈希索引，所以称之为自适应哈希索引。自适应哈希索引通过缓冲池的B+树构造而来，因此建立的速度很快。而且不需要将整个表都建哈希索引，InnoDB存储引擎会自动根据访问的频率和模式来为某些页建立哈希索引。</p>
<h3 id="最左前缀原则"><a href="#最左前缀原则" class="headerlink" title="最左前缀原则"></a>最左前缀原则</h3><p>复合索引使用时遵循最左前缀原则，最左前缀顾名思义，就是最左优先，即查询中使用到最左边的列，那么查询就会使用到索引，如果从索引的第二列开始查找，索引将失效。</p>
<p><img src="/RobertBlog/.io//image-20220811002228002-16601485500451.png" alt="image-20220811002228002"></p>
<p>对字段进行操作会导致联合索引失效；</p>
<h2 id="MySQL在使用like模糊查询时，索引能不能起作用？"><a href="#MySQL在使用like模糊查询时，索引能不能起作用？" class="headerlink" title="MySQL在使用like模糊查询时，索引能不能起作用？"></a>MySQL在使用like模糊查询时，索引能不能起作用？</h2><p>回答：MySQL在使用Like模糊查询时，索引是可以被使用的，只有把%字符写在后面才会使用到索引。 select * from user where name like ‘%o%’; //不起作用 select * from user where name like ‘o%’; //起作用 select * from user where name like ‘%o’; //不起作用</p>
<h2 id="MySQL查询支持filesort和index两种方式的排序"><a href="#MySQL查询支持filesort和index两种方式的排序" class="headerlink" title="MySQL查询支持filesort和index两种方式的排序"></a>MySQL查询支持filesort和index两种方式的排序</h2><p>filesort是先把结果查出，然后在缓存或磁盘进行排序操作，效率较低。使用index是指利用索引自动实现排序，不需另做排序操作，效率会比较高。 <strong>filesort有两种排序算法：双路排序和单路排序。</strong> <strong>双路排序</strong>：需要两次磁盘扫描读取，最终得到用户数据。第一次将排序字段读取出来，然后排序；第二次去读取其他字段数据。 <strong>单路排序</strong>：从磁盘查询所需的所有列数据，然后在内存排序将结果返回。如果查询数据超出缓存 sort_buffer，会导致多次磁盘读取操作，并创建临时表，最后产生了多次IO，反而会增加负担。 解决方案：少使用select *；增加sort_buffer_size容量和max_length_for_sort_data容量。</p>
<p>如果我们Explain分析SQL，结果中Extra属性显示Using filesort，表示使用了filesort排序方式，需要优 化。如果Extra属性显示Using index时，表示覆盖索引，也表示所有操作在索引上完成，也可以使用 index排序方式，建议尽可能采用覆盖索引。</p>
<h2 id="Mysql索引失效的情况"><a href="#Mysql索引失效的情况" class="headerlink" title="Mysql索引失效的情况"></a>Mysql索引失效的情况</h2><ul>
<li>围查询右边的列，不能使用索引</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t <span class="keyword">where</span> name <span class="operator">=</span><span class="string">&#x27;test&#x27;</span> <span class="keyword">and</span> status <span class="operator">&gt;</span><span class="string">&#x27;1&#x27;</span> <span class="keyword">and</span> address<span class="operator">=</span><span class="string">&#x27;北京市&#x27;</span></span><br></pre></td></tr></table></figure>

<p>前面的两个字段name，status查询是走索引的，都是最后一个条件address没有用到索引</p>
<ul>
<li>不要在索引列上进行运算操作，索引将失效</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="built_in">substring</span>(name,<span class="number">3</span>,<span class="number">2</span>)<span class="operator">=</span><span class="string">&#x27;科技&#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>字符串不加单引号，造成索引失效</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t <span class="keyword">where</span> name <span class="operator">=</span><span class="string">&#x27;test&#x27;</span> <span class="keyword">and</span> status <span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure>

<ul>
<li>用or分隔的条件，如果or前的条件中的列有索引，而后面的列中没有索引，那么涉及到的索引都不会被用到。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t <span class="keyword">where</span> name <span class="operator">=</span><span class="string">&#x27;test&#x27;</span> <span class="keyword">or</span> createtime<span class="operator">=</span><span class="string">&#x27;2020-04-05 12:00:00&#x27;</span></span><br></pre></td></tr></table></figure>

<p>name是索引列，createtime不是索引列，之间or进行连接，那么会导致name列也不走索引</p>
<ul>
<li>以%开头的like模糊查询，索引失效</li>
</ul>
<p>如果仅仅是尾部的模糊匹配，索引不会失效，如果是头部模糊匹配，索引失效，但是如果使用覆盖索引，那么索引仍然会生效</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> name <span class="keyword">from</span> t <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;%test&#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>如果MySql评估使用索引比全表扫描更慢，则不使用索引</p>
</li>
<li><p>is null，is not null 有时索引失效</p>
</li>
<li><p>in 走索引，not in 索引失效</p>
</li>
<li><p>使用不等于(!=或者&lt;&gt;)的时候，索引失效，会导致全表扫描</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> name <span class="keyword">from</span> t <span class="keyword">where</span> name <span class="operator">!=</span> <span class="string">&#x27;test&#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>MYSQL针对函数或存储过程中传递进的参数,如果是varchar类型时则默认会进行转换字符集校对规则与数据库保持一致，这个时候如果数据库编码和表编码不一致时（比如utf8和utf8mb4），就会出现索引失效的情况</li>
</ul>
<h2 id="最佳索引使用策略"><a href="#最佳索引使用策略" class="headerlink" title="最佳索引使用策略"></a>最佳索引使用策略</h2><ul>
<li>对查询频次较高,且数据量比较大的表建立索引</li>
<li>索引字段的选择,最佳候选列应当从 where子句的条件中提取,如果where子句中的组合比较多,那么应当挑选最常用、过滤效果最好的列的组合</li>
<li>索引可以有效的提升查询数据的效率,但索引数昰不是多多益善,索引越多,维护索引的代价自然也就水涨船高。对于插入、更新、删除等DML操作比较频繁的表来说,索引过多,会引入相当高的维护代价,降低DM操作的效率,增加相应操作的时间消耗。另外索引过多的话, MySQL也会犯选择困难病,虽然最终仍然会找到一个可用的索引,但无疑提高了选择的代价</li>
<li>独立的列</li>
</ul>
<p>独立的列不是指单列索引，而是指索引列不能是表达式的一部分或者是函数的一部分。</p>
<p>select * FROM test where col1 + 1 =100; // 不能是表达式一部分</p>
<p>select * FROM test where ABS(col1) =100; // 不能是函数一部分</p>
<ul>
<li>最左匹配原则</li>
</ul>
<p>假如有个联合索引 key (col1,col2)。那么以下查询是索引无效的</p>
<p>select * from test where col2 = 3;</p>
<p>select * from test where col1 like ‘%3’;</p>
<p>对于最左匹配原则，大家想一下B+树的叶子节点的关联就差不多知道为啥需要最左匹配原则了，因为B+的叶子结点，从左到右以链表的形式关联的，索引我们查询的时候要么范围查询，<strong>要么有明确的左边一个开始的索引值</strong>，不能跳过或者不明确如 like ‘%XYZ’这种查询。</p>
<p>这里需要注意的是，查询的时候如果两个条件都用上了，但是顺序不同，如 <code>col2= xx and col1 ＝xx</code>，那么现在的查询引擎会自动优化为匹配联合索引的顺序，这样是能够命中索引的</p>
<ul>
<li>使用聚簇索引和覆盖索引大大提升读取性能</li>
</ul>
<p>因为聚簇索引和覆盖索引的索引树上就有了需要的字段，所以不需要回表文件查询，所以提升了查询速度</p>
<ul>
<li>使用短索引</li>
</ul>
<p>如果很长的字符串进行查询，只需匹配一个前缀长度，这样能够节省大量索引空间</p>
<ul>
<li>尽量使用覆盖索引，避免使用select *</li>
</ul>
<h2 id="说说Redis"><a href="#说说Redis" class="headerlink" title="说说Redis"></a>说说Redis</h2><p>Redis主要提供了5种数据结构：字符串(string)、哈希(hash)、列表(list)、集合(set)、有序集合(zset)。Redis还提供了Bitmap、HyperLogLog、Geo类型,但这些类型都是基于上述核心数据类型实现的。5.0版本中,Redis新增加了Streams数据类型,它是一个功能强大的、支持多播的、可持久化的消息队列。 string可以存储字符串、数字和二进制数据,除了值可以是String以外,所有的键也可以是string,string最大可以存储大小为2M的数据。 list保证数据线性有序且元素可重复,它支持lpush、blpush、rpop、brpop等操作,可以当作简单的消息队列使用,一个list最多可以存储2^32-1个元素 hash的值本身也是一个键值对结构,最多能存储2^32-1个元素 set是无序不可重复的,它支持多个set求交集、并集、差集,适合实现共同关注之类的需求,一个set最多可以存储2^32-1个元素 zset是有序不可重复的,它通过给每个元素设置一个分数来作为排序的依据,一个zset最多可以存储2^32-1个元素。 加分回答 每种类型支持多个编码,每一种编码采取一个特殊的结构来实现 各类数据结构内部的编码及结构： string：编码分为int、raw、embstr；int底层实现为long,当数据为整数型并且可以用long类型表示时可以用long存储；embstr底层实现为占一块内存的SDS结构,当数据为长度不超过32字节的字符串时,选择以此结构连续存储元数据和值；raw底层实现为占两块内存的SDS,用于存储长度超过32字节的字符串数据,此时会在两块内存中分别存储元数据和值。 list：编码分为ziplist、linkedlist和quicklist（3.2以前版本没有quicklist）。ziplist底层实现为压缩列表,当元素数量小于2且所有元素长度都小于64字节时,使用这种结构来存储；linkedlist底层实现为双端链表,当数据不符合ziplist条件时,使用这种结构存储；3.2版本之后list一般采用quicklist的快速列表结构来代替前两种。 hash：编码分为ziplist、hashtable两种,其中ziplist底层实现为压缩列表,当键值对数量小于2,并且所有的键值长度都小于64字节时使用这种结构进行存储；hashtable底层实现为字典,当不符合压缩列表存储条件时,使用字典进行存储。 set：编码分为inset和hashtable,intset底层实现为整数集合,当所有元素都是整数值且数量不超过2个时使用该结构存储,否则使用字典结构存储。 zset：编码分为ziplist和skiplist,当元素数量小于128,并且每个元素长度都小于64字节时,使用ziplist压缩列表结构存储,否则使用skiplist的字典+跳表的结构存储。</p>
<h2 id="说说多线程："><a href="#说说多线程：" class="headerlink" title="说说多线程："></a>说说多线程：</h2><p>线程是操作系统调度的最小单元，它可以让一个进程并发地处理多个任务,也叫轻量级进程。所以,在一个进程里可以创建多个线程,这些线程都拥有各自的计数器、堆栈、局部变量,并且能够共享进程内的资源。由于共享资源,处理器便可以在这些线程之间快速切换,从而让使用者感觉这些线程在同时执行。 总的来说,操作系统可以同时执行多个任务,每个任务就是一个进程。进程可以同时执行多个任务,每个任务就是一个线程。一个程序运行之后至少有一个进程,而一个进程可以包含多个线程,但至少要包含一个线程。 使用多线程会给开发人员带来显著的好处,而使用多线程的原因主要有以下几点：</p>
<p> \1. 更多的CPU核心 现代计算机处理器性能的提升方式,已经从追求更高的主频向追求更多的核心发展,所以处理器的核心数量会越来越多,充分地利用处理器的核心则会显著地提高程序的性能。而程序使用多线程技术,就可以将计算逻辑分配到多个处理器核心上,显著减少程序的处理时间,从而随着更多处理器核心的加入而变得更有效率。</p>
<p> \2. 更快的响应时间 我们经常要针对复杂的业务编写出复杂的代码,如果使用多线程技术,就可以将数据一致性不强的操作派发给其他线程处理（也可以是消息队列）,如上传图片、发送邮件、生成订单等。这样响应用户请求的线程就能够尽快地完成处理,大大地缩短了响应时间,从而提升了用户体验。</p>
<ol start="3">
<li>更好的编程模型 Java为多线程编程提供了良好且一致的编程模型,使开发人员能够更加专注于问题的解决,开发者只需为此问题建立合适的业务模型,而无需绞尽脑汁地考虑如何实现多线程。一旦开发人员建立好了业务模型,稍作修改就可以将其方便地映射到Java提供的多线程编程模型上。</li>
</ol>
<h2 id="22、线程和协程的区别？"><a href="#22、线程和协程的区别？" class="headerlink" title="22、线程和协程的区别？"></a>22、线程和协程的区别？</h2><p>协程又称为进程。</p>
<ol>
<li>进程拥有独立的地址空间，线程有自己的堆栈和局部变量，但是线程之间没有单独的地址空间。</li>
<li>进程和线程切换时，需要切换进程和线程的上下文，进程的上下文切换时间开销远远大于线程的上下文切换时间，耗费资源大，效率差。</li>
<li>进程的并发性比较低，线程的并发性比较高。</li>
<li>每个独立的进程都有一个程序运行的入口、顺序执行序列和程序的出口，但是线程不能够独立执行，必须依存在应用程序中，由应用程序提供多个线程执行控制。</li>
<li>系统在运行的时候，会为每个进程分配不同的内存空间；但是线程而言，除了CPU之外，系统不会为线程分配内存，只能依赖于所属的进程的的资源，线程组之间只能共享资源。</li>
<li>一个进程崩溃后，在保护模式下不会对其他的进程产生影响，但是一个线程崩溃整个进程都会死掉，所以多进程要比多线程更加健壮。</li>
</ol>
<h2 id="内存管理"><a href="#内存管理" class="headerlink" title="内存管理"></a>内存管理</h2><p>Linux 操作系统是采用段页式内存管理方式： 页式存储管理能有效地提高内存利用率（解决内存碎片）,而分段存储管理能反映程序的逻辑结构并有利于段的共享。将这两种存储管理方法结合起来,就形成了段页式存储管理方式。 段页式存储管理方式即先将用户程序分成若干个段,再把每个段分成若干个页,并为每一个段赋予一个段名。在段页式系统中,为了实现从逻辑地址到物理地址的转换,系统中需要同时配置段表和页表,利用段表和页表进行从用户地址空间到物理内存空间的映射。 系统为每一个进程建立一张段表,每个分段有一张页表。段表表项中至少包括段号、页表长度和页表始址,页表表项中至少包括页号和块号。在进行地址转换时,首先通过段表查到页表始址,然后通过页表找到页帧号,最终形成物理地址</p>
<h2 id="说说你对IoC的理解"><a href="#说说你对IoC的理解" class="headerlink" title="说说你对IoC的理解"></a>说说你对IoC的理解</h2><p> IoC是控制反转的意思,是一种面向对象编程的设计思想。在不采用这种思想的情况下,我们需要自己维护对象与对象之间的依赖关系,很容易造成对象之间的耦合度过高,在一个大型的项目中这十分的不利于代码的维护。IoC则可以解决这种问题,它可以帮我们维护对象与对象之间的依赖关系,并且降低对象之间的耦合度。 说到IoC就不得不说DI,DI是依赖注入的意思,它是IoC实现的实现方式。由于IoC这个词汇比较抽象而DI比较直观,所以很多时候我们就用DI来代替它,在很多时候我们简单地将IoC和DI划等号,这是一种习惯。实现依赖注入的关键是IoC容器,它的本质就是一个工厂。</p>
<p> IoC是Java EE企业应用开发中的就偶组件之间复杂关系的利器。 在以Spring为代表的轻量级Java EE开发风行之前,实际开发中是使用更多的是EJB为代表的开发模式。在EJB开发模式中,开发人员需要编写EJB组件,这种组件需要满足EJB规范才能在EJB容器中运行,从而完成获取事务,生命周期管理等基本服务,Spring提供的服务和EJB并没有什么区别,只是在具体怎样获取服务的方式上两者的设计有很大不同：Spring IoC提供了一个基本的JavaBean容器,通过IoC模式管理依赖关系,并通过依赖注入和AOP切面增强了为JavaBean这样的POJO对象服务于事务管理、生命周期管理等基本功能；而对于EJB,一个简单的EJB组件需要编写远程／本地接口、Home接口和Bean的实体类,而且EJB运行不能脱离EJB容器,查找其他EJB组件也需要通过诸如JNDI的方式,这就造成了对EJB容器和技术规范的依赖。也就是说Spring把EJB组件还原成了POJO对象或者JavaBean对象,以此降低了用用开发对于传统J2EE技术规范的依赖。 在应用开发中开发人员设计组件时往往需要引用和调用其他组件的服务,这种依赖关系如果固化在组件设计中,会造成依赖关系的僵化和维护难度的增加,这个时候使用IoC把资源获取的方向反转,让IoC容器主动管理这些依赖关系,将这些依赖关系注入到组件中,这就会让这些依赖关系的适配和管理更加灵活。</p>
<h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><h3 id="1、Redis到底是单线程还是多线程？"><a href="#1、Redis到底是单线程还是多线程？" class="headerlink" title="1、Redis到底是单线程还是多线程？"></a>1、Redis到底是单线程还是多线程？</h3><ul>
<li>Redis6.0之前的单线程指的是网络I/O和键值对的读写都是由一个线程完成的。</li>
<li>Redis6.0版本引入了多线程指的是网络请求过程采用了多线程，但是键值对读写命令仍然是采用的单线程，所以Redis依然是并发安全的。</li>
</ul>
<h3 id="2、Redis-单线程为什么还能那么快？"><a href="#2、Redis-单线程为什么还能那么快？" class="headerlink" title="2、Redis 单线程为什么还能那么快？"></a>2、Redis 单线程为什么还能那么快？</h3><ol>
<li> 命令执行基于内存操作</li>
<li>命令执行是单线程，没有线程切换开销</li>
<li>基于IO多路复用机制提升Redis的I\O利用率</li>
<li>高效的数据存储结构，全局Hash表以及多种高效数据结构，比如跳表、压缩列表、链表等。</li>
</ol>
<h3 id="3、Redis-怎么实现跳表的："><a href="#3、Redis-怎么实现跳表的：" class="headerlink" title="3、Redis 怎么实现跳表的："></a>3、Redis 怎么实现跳表的：</h3><p>跳表：将有序链表改成位支持近似二分法查找算法，可以进入快速的插入、删除、查找操作。    </p>
<p><img src="/RobertBlog/.io//image-20220813192626832-16603899882524.png" alt="image-20220813192626832"></p>
<h3 id="4、Redis-Key过期了为什么内存没释放？"><a href="#4、Redis-Key过期了为什么内存没释放？" class="headerlink" title="4、Redis Key过期了为什么内存没释放？"></a>4、Redis Key过期了为什么内存没释放？</h3><ol>
<li>手动修改过key的值，但是没有加上过期参数的话，那么这个key是永不过期。</li>
<li>Redis对于过期的Key的处理一般是惰性删除和定时删除策略：<ol>
<li>惰性删除：当读写一个已经过期的Key时，会触发惰性删除策略，判断Key是否过期，如果过期才会删除。</li>
<li>定时删除：由于惰性删除无法保证冷数据被及时删掉，所以Redis会定时主动淘汰一批过期的Key，但是并不是将所有的过期的Key都删除，所以可能还会出现过期的Key占据着内存。</li>
</ol>
</li>
</ol>
<h3 id="5、Redis-Key没有设置过期时间，为什么被Redis主动删除了？"><a href="#5、Redis-Key没有设置过期时间，为什么被Redis主动删除了？" class="headerlink" title="5、Redis Key没有设置过期时间，为什么被Redis主动删除了？"></a>5、Redis Key没有设置过期时间，为什么被Redis主动删除了？</h3><p>主动清理策略在Redis 4.0之前一共实现了6种内存淘汰策略，在4.0之后，又增加了2种策略，总共8种:</p>
<p>a) 针对设置了过期时间的key做处理:</p>
<p>volatile-ttl:在筛选时，会针对设置了过期时间的键值对，根据过期时间的先后进行删除，越早过期的越先被删除。<br>volatile-random:就像它的名称一样，在设置了过期时间的键值对中，进行随机删除。<br>volatile-Iru:会使用LRU算法筛选设置了过期时间的键值对删除。<br>volatile-lfu:会使用LFU算法筛选设置了过期时间的键值对删除。<br>b) 针对所有的key做处理(听上去有点不可思议):</p>
<p>allkeys-random:从所有键值对中随机选择并删除数据。<br>allkeys-Iru:使用LRU算法在所有数据中进行筛选删除。<br>allkeys-lfu:使用LFU算法在所有数据中进行筛选删除。<br>c) 不处理:</p>
<p>no-eviction:不会剔除任何数据，拒绝所有写入操作并返回客户端错误信息”(error) OOM command not allowed when used memory”，此时Redis只响应读操作。<br>因此redis中key没有设置过期时间但被redis主动删除，有可能是因为redis的allkeys内存淘汰策略</p>
<p>另外对LRU算法和LFU算法做个补充说明：</p>
<p>LRU算法(Least Recently Used，最近最少使用):淘汰很久没被访问过的数据，以最近一次访问时间作为参考<br>LFU算法(Least Frequently Used，最不经常使用):淘汰最近一段时间被访问次数最少的数据，以次数作为参考<br>绝大多数情况我们都可以用LRU策略，当存在大量的热点缓存数据时，LFU可能更好点。</p>
<h3 id="6、Del-Key会阻塞Redis吗？"><a href="#6、Del-Key会阻塞Redis吗？" class="headerlink" title="6、Del Key会阻塞Redis吗？"></a>6、Del Key会阻塞Redis吗？</h3><p>会 删除不通类型的数据需要的时间不同。</p>
<h3 id="7、Redis-主从、哨兵，集群架构优缺点比较。"><a href="#7、Redis-主从、哨兵，集群架构优缺点比较。" class="headerlink" title="7、Redis 主从、哨兵，集群架构优缺点比较。"></a>7、Redis 主从、哨兵，集群架构优缺点比较。</h3><p>主从，需要人工拉起从节点。</p>
<p>哨兵架构：切换主从的过程中耗时；Redis 大小10G，数据大了影响恢复过程。</p>
<p><img src="/RobertBlog/.io//image-20220813202843304-16603937252815.png" alt="image-20220813202843304"></p>
<p>高可用集群模式：顺断问题比哨兵模式影响小。</p>
<p><img src="/RobertBlog/.io//image-20220813203136164-16603938985386.png" alt="image-20220813203136164"></p>
<h3 id="8、Redis集群数据Hash分片算法是怎么回事？"><a href="#8、Redis集群数据Hash分片算法是怎么回事？" class="headerlink" title="8、Redis集群数据Hash分片算法是怎么回事？"></a>8、Redis集群数据Hash分片算法是怎么回事？</h3><p>Redis Cluster 将所有数据划分为16384个槽位，每个系节点负责其中一部分槽位。槽位的信息存储与每个节点中</p>
<p>当Redis Cluster的客户端来连接集群时，它也会得到一份集群的槽位信心并将其缓存在客户端本地，这样找对用的Key时，可以根据槽位定位算法定位到目标节点。</p>
<p>槽位定位算法：Cluster 默认会对Key值使用crc16算法进行hash得到一个证书，然后用这个证书值对16384进行取模来得到具体槽位： Hash_slot = crc16(key) mod 16384。再根据槽位值和Redis节点对应的关系就可以定位到Key具体时落在那个Redis节点上。</p>
<h3 id="9、Redis执行命令有死循环bug"><a href="#9、Redis执行命令有死循环bug" class="headerlink" title="9、Redis执行命令有死循环bug"></a>9、Redis执行命令有死循环bug</h3><p>RandomKey 从当前数据库中随机返回一个 key，此命令在主节点上寻找key，并判断是否过期。过期的话就删除，继续寻找下一个Key，在主节点上执行还好，经过一段时间总能寻找到不过过期的Key。</p>
<p>但是在slave节点上执行的时候，slave节点上的del命令是只有主节点发送了del命令才能删除对应的Key，因此在主节点上执行RandomKey时候，无法删除过期的Key，由于从节点上大量的Key都过期，那么Slave就容易寻找不到符合条件的Key，陷入死循环。</p>
<p>这个是Redis的一个bug，在Redis 5.0才被修复，修复的方法在Slave节点上执行RandomKey限制执行次数，执行到一定次数后跳出循环。</p>
<h3 id="10、Redis主从切换导致缓存雪崩。"><a href="#10、Redis主从切换导致缓存雪崩。" class="headerlink" title="10、Redis主从切换导致缓存雪崩。"></a>10、Redis主从切换导致缓存雪崩。</h3><p>主动节点时间不一致，主节点比从节点慢。从节点切换成为主节点后，大量的Key过期，导致大量的请求直接访问数据库了，进而导致缓存雪崩。</p>
<h3 id="11、Redis-RDB、AOF"><a href="#11、Redis-RDB、AOF" class="headerlink" title="11、Redis RDB、AOF"></a>11、Redis RDB、AOF</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">save 300 50 <span class="comment">#300秒内执行了超过50key被改动，那么会dump文件。</span></span><br><span class="line">bgsave      <span class="comment">#异步，相比较于save，不会阻塞其他的Redis请求，采用的的是写实复制。</span></span><br></pre></td></tr></table></figure>

<p>RDB的缺点：会存在数据丢失。</p>
<p>AOF 模式：执行的命令追加到AOF的文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">appendfsync always <span class="comment">#每个写命令都同步</span></span><br><span class="line">appendfsync everysec <span class="comment">#每秒同步一次</span></span><br><span class="line">appendfsync no <span class="comment">#让操作系统来决定何时同步</span></span><br></pre></td></tr></table></figure>

<p>缺点：恢复速度慢，体积大</p>
<p><img src="/RobertBlog/.io//image-20220813214806502-16603984884347.png" alt="image-20220813214806502"></p>
<h3 id="12、Redis主节点宕机导致数据全部丢失"><a href="#12、Redis主节点宕机导致数据全部丢失" class="headerlink" title="12、Redis主节点宕机导致数据全部丢失"></a>12、Redis主节点宕机导致数据全部丢失</h3><p><img src="/RobertBlog/.io//image-20220814120938172-16604501798318.png" alt="image-20220814120938172"></p>
<h3 id="13、Redis主从复制风暴："><a href="#13、Redis主从复制风暴：" class="headerlink" title="13、Redis主从复制风暴："></a>13、Redis主从复制风暴：</h3><p>Redis主节点有太多得从节点，导致主节点一直在向各个从节点同步数据，导致主节点压力比较大/</p>
<p>可以采用多级主从复制来规避此问题。</p>
<h3 id="14、Redis集群网络抖动导致频繁主从切换怎么处理？"><a href="#14、Redis集群网络抖动导致频繁主从切换怎么处理？" class="headerlink" title="14、Redis集群网络抖动导致频繁主从切换怎么处理？"></a>14、Redis集群网络抖动导致频繁主从切换怎么处理？</h3><p>可以配置cluster-node-timeout，较小集群对网络抖动得敏感度。</p>
<h3 id="15、Redis集群为什么是三个节点？"><a href="#15、Redis集群为什么是三个节点？" class="headerlink" title="15、Redis集群为什么是三个节点？"></a>15、Redis集群为什么是三个节点？</h3><p>因为Master得选举需要大于半数得集群master同意选举才能成功。</p>
<h3 id="16、Redis集群为什么是奇数节点？"><a href="#16、Redis集群为什么是奇数节点？" class="headerlink" title="16、Redis集群为什么是奇数节点？"></a>16、Redis集群为什么是奇数节点？</h3><p>奇数节点在master选举过程中比偶数节点能节省一个节点。</p>
<h3 id="17、Redis集群支持批量操作命令吗？"><a href="#17、Redis集群支持批量操作命令吗？" class="headerlink" title="17、Redis集群支持批量操作命令吗？"></a>17、Redis集群支持批量操作命令吗？</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">如果直接操作mset，mget这样的原生批量操作命令，redis集群只支持所有的key在同一slot（插槽）上的情况，如果一定要批量操作可以在key前面加&#123;xxx&#125;，这样数据会根据参数分片算法计算括号内的值，这样才可以确保可以可以落到不同的slot当中</span><br><span class="line"></span><br><span class="line">mset &#123;user&#125;:1：name jack &#123;user&#125;:1:age 18</span><br></pre></td></tr></table></figure>

<h3 id="18、lua脚本可以在集群当中运行吗"><a href="#18、lua脚本可以在集群当中运行吗" class="headerlink" title="18、lua脚本可以在集群当中运行吗"></a>18、lua脚本可以在集群当中运行吗</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lua脚本在集群当中运行，脚本里面操作redis的所有key必须在同一节点上，这种的话我们可以给lua脚本里面的key值前面都加上hash tag 也就是&#123;xxx&#125;，这样就可以保证脚本内的key都在同一个节点上</span><br></pre></td></tr></table></figure>

<h1 id="ZooKeeper"><a href="#ZooKeeper" class="headerlink" title="ZooKeeper"></a>ZooKeeper</h1><p>1、怎么保证数据的一致性的：</p>
<ul>
<li>强一致性</li>
<li>弱一致性</li>
</ul>
<h1 id="分布式"><a href="#分布式" class="headerlink" title="分布式"></a>分布式</h1><h2 id="CAP理论："><a href="#CAP理论：" class="headerlink" title="CAP理论："></a>CAP理论：</h2><ul>
<li>Consistency（一致性）<ul>
<li>数据更新后并返回客户端，所有节点在同一时间的数据完全一致。对于客户端来说，一致性指的是并发访问时更新过的数据如何获取的问题。从服务端来看，及如何复制分布到整个系统，以保证数据最终一致。</li>
</ul>
</li>
<li>Availability（可用性）<ul>
<li>服务高可用、正常响应时间。系统能够很好的为用户服务，不出现用户操作失败或者访问超时等用户体验不好的情况。</li>
</ul>
</li>
<li>Partition Tolerance（分区容错性）<ul>
<li>在分布式系统中遇到某个节点或者网络分区故障的时候，仍然能够对外满足一致性和可用性服务。</li>
</ul>
</li>
</ul>
<p>CP和AP：分区容错是必须保证的，当发生网络分区的时候，如果要继续服务，那么强一致性和可用性只能2选1.</p>
<h2 id="BASE理论："><a href="#BASE理论：" class="headerlink" title="BASE理论："></a>BASE理论：</h2><p>BASE理论是基于CAP理论逐步演化而来的，是CP（强一致性）和AP（强可用性）权衡的结果。<br>BASE理论的核心思想是：即使无法做到强一致性，但每个应用都可以根据自身业务特点采用适当的方式来使系统达到最终一致性。</p>
<h3 id="Basically-Available（基本可用）"><a href="#Basically-Available（基本可用）" class="headerlink" title="Basically Available（基本可用）"></a>Basically Available（基本可用）</h3><p>响应时间上的损失：正常情况下，处理用户请求需要0.5s返回结果，但是由于系统出现故障，处理用户请求的时间变3s。<br>系统功能上的损失：正常情况下，用户可以使用系统的全部功能，但是由于系统访问量突然剧增，系统的非核心功能无法使用。</p>
<h3 id="Soft-state（软状态）"><a href="#Soft-state（软状态）" class="headerlink" title="Soft state（软状态）"></a>Soft state（软状态）</h3><p>数据同步允许一定的延迟。</p>
<h3 id="Eventually-consistent（最终一致性）"><a href="#Eventually-consistent（最终一致性）" class="headerlink" title="Eventually consistent（最终一致性）"></a>Eventually consistent（最终一致性）</h3><p>系统中所有的数据副本，在经过一段时间的同步后，最终能够达到一个一致的状态，不要求实时。</p>
<h2 id="分布式Id的生成方案："><a href="#分布式Id的生成方案：" class="headerlink" title="分布式Id的生成方案："></a>分布式Id的生成方案：</h2><h3 id="UUID："><a href="#UUID：" class="headerlink" title="UUID："></a>UUID：</h3><ol>
<li>时间 时间戳</li>
<li>时钟序列 计数器</li>
<li>全局唯一的机器识别号，如果有网卡，从网卡的MAC地址获取，没有的话从其他的方式获取。</li>
</ol>
<ul>
<li>优点：代码简单，性能好，保证唯一</li>
<li>缺点：UUID是无序的，不是全数字，无法保证趋势递增；UUID生成的字符串，字符串存储性能差，查询效率慢，写的时候不能产生顺序的append操作，需要进行insert操作，导致频繁的也分裂，这种操作在记录占用空间比较大的情况下，性能下降比较大，还会增加读取磁盘次数；UUID长度过长，不适用于存储，耗费数据库性能；ID无一定业务含义，可读性差；有信息安全问题，可能邪路MAC地址。</li>
</ul>
<h3 id="数据库自增序列："><a href="#数据库自增序列：" class="headerlink" title="数据库自增序列："></a>数据库自增序列：</h3><p>单机模式：</p>
<ul>
<li>优点：实现简单，依靠数据库即可，成本小；ID数字化，单调自增，满足数据存储和查询性能。具有一定的业务可读性。</li>
<li>缺点：强依赖DB，存在单点问题，如果数据库宕机，则业务不可用；DB生成ID性能有限，单点数据库压力大，无法使用高并发场景。信息安全问题，暴露订单量，url查询改一下id查询到别人的订单。</li>
</ul>
<p>数据库高可用：多主模式做负载，基于序列的起始值和步长设置，不同的初始值，相同的步长，步长大于节点数。</p>
<ul>
<li>优点：解决了ID生成单点问题，同时平衡了负载。</li>
<li>缺点：系统扩容困难：系统定义好步长之后，增加机器之后调整步长困难；数据库压力大：每次扩区一个ID都必须读写一次数据库。主从同步的时候，数据一致性问题。</li>
</ul>
<h3 id="Leaf-segment："><a href="#Leaf-segment：" class="headerlink" title="Leaf-segment："></a>Leaf-segment：</h3><p>采用每次获取一个ID区间段的方式解决问题，可以一定程度上减轻数据库压力。</p>
<ul>
<li>优点：扩张灵活，性能强能够支撑起大部分业务场景，ID是趋势递增的，满足数据存储和查询性能要求。可用性高，即使ID生成服务器不可用，也能够保证业务短时间内可用。</li>
<li>缺点：可能存在多个节点同事请求ID区间的情况，依赖DB</li>
</ul>
<p>双Buffer模式：将获取一个号段的方式优化成获取两个号段，在一个号段用完后不用立马去更新号段。在当前号段使用10%的情况下，去查询下一个号段是否准备好，如果没有就提前去准备。</p>
<ul>
<li>优点：基于JVM存储双buffer的号段，减少了数据库查询，减少了网络依赖，效率更高。</li>
<li>缺点：segment 号段长度固定的，业务量大师可能会频繁更新号段。因为原本分配的号段会以下用完。其他的节点重新获取相之前的号段，跨度可能会大。</li>
</ul>
<p>基于Redis、MongoDB、zk等中间件完成。</p>
<h3 id="雪花算法："><a href="#雪花算法：" class="headerlink" title="雪花算法："></a>雪花算法：</h3><p>生成一个64bit的整形数字。第一位符号固定为0，41位为时间戳，10位workId，12位序列号。</p>
<ul>
<li>优点：每个毫秒值包含的ID值很多。不够可以编订位数来增加。时间戳在高位，中尉使固定的机器码，自增的在学列号地位，整个ID使趋势递增。能够根据业务场景数据库节点不知灵活挑战bit位划分，灵活度高。</li>
<li>缺点：强依赖与机器时钟，如果时钟回拨，会导致重复的ID生成，所以一般基于此的算法发现时钟回拨，都会跑异常处理，阻止ID胜场，可能或导致业务不可用。</li>
</ul>
<h2 id="分布式缓存寻址算法："><a href="#分布式缓存寻址算法：" class="headerlink" title="分布式缓存寻址算法："></a>分布式缓存寻址算法：</h2><ol>
<li><p>HASE算法：根据key进行hash运算，结果对分片数取模，确定分片适合固定分片数的场景。扩展分片或者减少分片时，所有数据都需要重新计算分片，存储。</p>
</li>
<li><p>一致性Hash：将整个Hash值得区间组成一个闭合圆环，计算每台服务器的Hash值，映射到圆环中。使用相同得Hash算法计算数据的Hash值，映射到圆环，顺时针寻找，找到第一个服务器的数据存储的服务器。</p>
<p>新增及减少节点时只会影响节点到其他逆时针最近的一个服务器之间的值。存在hash环倾斜问题，服务器分布不均匀，可以通过虚拟节点解决。</p>
</li>
<li><p>hash slot：将数据和服务器隔开。数据与slot映射，slot与服务器映射，数据进行hash决定存放slot，新增节点或者删除节点，只需要将slot进行迁移即可。</p>
</li>
</ol>
<h2 id="分布式架构下，Session共享有什么方案？"><a href="#分布式架构下，Session共享有什么方案？" class="headerlink" title="分布式架构下，Session共享有什么方案？"></a>分布式架构下，Session共享有什么方案？</h2><ol>
<li><p>启用Session，采用无状态服务。</p>
</li>
<li><p>客户端存储cookie，有安全风险。</p>
</li>
<li><p>服务器之间同步session，但是存在同步延迟的问题。</p>
</li>
<li><p>IP绑定策略，同一个ip只能访问固定的服务端。</p>
</li>
<li><p>使用Redis存储。</p>
<p>把Session放到Redis中存储，虽然架构商变得服务，并且需要多访问一次Redis，但是这种方案带来的好处时很大的：</p>
<p>实现Session共享，可以水平扩展，服务器重启Session不丢失，不仅可以跨服务器Session共享，甚至可以跨平台。</p>
</li>
</ol>
<h2 id="分布式事务："><a href="#分布式事务：" class="headerlink" title="分布式事务："></a>分布式事务：</h2><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/183753774">https://zhuanlan.zhihu.com/p/183753774</a></p>
<h2 id="分布式锁的解决方案："><a href="#分布式锁的解决方案：" class="headerlink" title="分布式锁的解决方案："></a>分布式锁的解决方案：</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42440011/article/details/116998915">https://blog.csdn.net/weixin_42440011/article/details/116998915</a></p>
<h2 id="分布式负载均衡的策略有哪些："><a href="#分布式负载均衡的策略有哪些：" class="headerlink" title="分布式负载均衡的策略有哪些："></a>分布式负载均衡的策略有哪些：</h2><ol>
<li>轮询法</li>
<li>加权轮询法，给抗压能力强的节点更高的权重。</li>
<li>随机法</li>
<li>加权随机法</li>
<li>源地址哈希法，根据客户端IP地址，hash运算出固定访问某一台服务端。</li>
<li>最小连接法。根据后端服务器连接情况，分配给连接数最小的服务端。</li>
</ol>
<p>集群、分布式、SOA、微服务的概念区别。</p>
<p>分布式：不同模块部署在不同服务器上<br>作用：分布式解决网站高并发带来问题</p>
<p>集群：多台服务器部署相同应用构成一个集群<br>作用：通过负载均衡设备共同对外提供服务</p>
<p>SOA：业务系统分解为多个组件，让每个组件都独立提供离散，自治，可复用的服务能力，通过服务的组合和编排来实现上层的业务流程<br>作用：简化维护,降低整体风险,伸缩灵活</p>
<p>微服务：架构设计概念,各服务间隔离（分布式也是隔离）,自治（分布式依赖整体组合）其它特性(单一职责,边界,异步通信,独立部署)是分布式概念的跟严格执行SOA到微服务架构的演进过程<br>作用：各服务可独立应用，组合服务也可系统应用<br><img src="/RobertBlog/.io//image-20220815004202921-166049532581710.png" alt="image-20220815004202921"></p>
<h1 id="Java并发："><a href="#Java并发：" class="headerlink" title="Java并发："></a>Java并发：</h1><h2 id="1、CountDownLatch和Semaphore的区别和底层原理："><a href="#1、CountDownLatch和Semaphore的区别和底层原理：" class="headerlink" title="1、CountDownLatch和Semaphore的区别和底层原理："></a>1、CountDownLatch和Semaphore的区别和底层原理：</h2><p>CountDownLatch表示计数器，可以给CountDownLatch设置一个数字，一个线程调用<code>CountDownLatch</code>的<code>await()</code>将会阻塞，其他的线程可以调用<code>CountDownLatch</code>的<code>countDown()</code>方法来对CountDown中的数字减一，当数字减小到0后，所有<code>await()</code>的线程都将会被唤醒。</p>
<ul>
<li>底层原理：调用await()方法的线程会利用AQS排队，一旦数字被减小为0，则会将AOS中排队的线程依次唤醒。</li>
</ul>
<p>Semaphore 表示的是信号量，可以设置许可的个数，表示同时最多允许多少个线程使用该信号量，通过acquire()来获取许可，如果没有许可的话线程将会阻塞，并通过AQS来排队，可以通过release()方法来释放许可，当某个线程释放许可后，就会从AQS队列中找到ige线程开始唤醒，直至没有许可。</p>
<h2 id="2、Java如何开始线程，怎么保证线程安全："><a href="#2、Java如何开始线程，怎么保证线程安全：" class="headerlink" title="2、Java如何开始线程，怎么保证线程安全："></a>2、Java如何开始线程，怎么保证线程安全：</h2><p>线程和进程关系：进程是操作系统分配资源的最小单元，线程是操作系统分配任务的最小单元，线程隶属进程。</p>
<ol>
<li>实现Thread类，重写run方法，调用start方法，启动多线程。</li>
<li>实现Runnable接口，实现run方法，创建接口实现类的对象，将对象作为参数传入Thread构造函数中，创建Thread对象，调用run方法。</li>
<li>实现Callable接口，实现call方法，创建接口实现类对象，创建FutureTask类对象，并将接口实现类的对象传入；将FutureTask实现类对象作为参数传入Thread类的构造器中，创建Thread类的对象，调用Start方法。</li>
<li>通过线程池来开启线程。</li>
</ol>
<p>怎么保证线程安全的问题：</p>
<p>加锁：1、JVM提供的锁synchronized关键字，1.5之前版本是重量锁，之后是清凉所。2、JDK提供的锁。</p>
<h3 id="延申：锁分类"><a href="#延申：锁分类" class="headerlink" title="延申：锁分类"></a>延申：锁分类</h3><h4 id="悲观锁、乐观锁"><a href="#悲观锁、乐观锁" class="headerlink" title="悲观锁、乐观锁"></a>悲观锁、乐观锁</h4><ul>
<li>悲观锁：认为别人肯定会跟自己抢资源，并且抢到的机率比较大，因此在操作之前，必须进行加锁的操作。</li>
<li>乐观锁：认为遭遇并发的机率比较低，读数据时不会有人修改数据，不加锁直接读，写数据的时候泽在进行更新之前判断数据是否已经被修改，如果没有被修改过则更新，修改过则放弃更新。</li>
</ul>
<h4 id="独占锁和共享锁"><a href="#独占锁和共享锁" class="headerlink" title="独占锁和共享锁"></a>独占锁和共享锁</h4><ul>
<li>独占锁：一个锁只能由一个线程持有，独占锁是一种悲观策略，较坏的情况如果某个只读线程获取到锁，那么其他只读线程也只能等待，限制了并发性，因为读操作并不会影响数据一致性。典型的是ReentrantLock。</li>
<li>共享锁：共享锁放宽了加锁限制，允许多个只读线程同时获取锁，并发访问资源。共享锁不适合写线程。</li>
</ul>
<h4 id="ReadWriteLock读写锁"><a href="#ReadWriteLock读写锁" class="headerlink" title="ReadWriteLock读写锁"></a>ReadWriteLock读写锁</h4><ul>
<li>java提供了读写锁，在读的地方使用读锁(共享锁)，在写的地方使用写锁(独占锁)。读之间不互斥，读写与写写之间互斥。在没有写的情形下，读是无阻塞的，一定程度上提高了同时存在读写场景的并发性。<br>java提供了读写锁的接口java.util.concurrent.locks.ReadWriteLock，可以实现这个接口完成自己的读写锁。也可以使用已有的实现ReentrantReadWriteLock.</li>
</ul>
<h4 id="公平锁与非公平锁："><a href="#公平锁与非公平锁：" class="headerlink" title="公平锁与非公平锁："></a>公平锁与非公平锁：</h4><ul>
<li>公平锁：公平锁在加锁之前会检查是否已有在等待的线程，如果有则优先已等待的线程。换一种方式表述就是线程排排队，先到先得，每一个尝试获得锁的线程都会被放到等待队列中，当锁资源释放后，最先等待的线程先拿到锁。</li>
<li>非公平锁：非公平锁不考虑先来后到的问题，线程直接去尝试获取锁，而不会管之前是否已经有线程处于等待状态了。获取失败则进入等待队列等待。</li>
</ul>
<p>公平锁要维护队列，但是其实非公平锁也是会维护队列或集合的，只是非公平锁无需严格遵守队列顺序，因此高效的本质还是在于非公平锁的闯入机制，也就是一个新的线程获取锁时会直接尝试获取锁，失败才进入队列，而不是直接进入队列等待。这样就可以充分利用锁释放后，队列首部的线程重新尝试获取锁这一段时间。<br>公平锁模式下锁释放后需要唤醒队列首部的线程，而从阻塞到运行需要完成内核态到用户态的切换，这是一个很耗时的过程，那么在切换状态的期间就会处于无线程实际运行的情况，大大的浪费了资源。而在这个过程中允许闯入线程获取锁就能很好的利用这一段空白时间。</p>
<h4 id="可重入锁"><a href="#可重入锁" class="headerlink" title="可重入锁"></a>可重入锁</h4><p>可重入锁，又可以称为递归锁，指的是一个线程在持有锁的情况下，可以再次获取锁而不受影响。ReentrantLock和synchronized都是可重入锁。</p>
<h4 id="分段锁"><a href="#分段锁" class="headerlink" title="分段锁"></a>分段锁</h4><p>分段锁是一种概念，即将资源拆分成数断，将对整个资源的锁定改为对一段资源的锁定，提高并发性能。JDK1.8之前的<a target="_blank" rel="noopener" href="https://blog.csdn.net/yue_hu/article/details/113754357">ConcurrentHashMap</a>是典型的分段锁实现。JDK1.8开始<a target="_blank" rel="noopener" href="https://blog.csdn.net/yue_hu/article/details/113754357">ConcurrentHashMap</a>舍弃了分段锁，改用用自旋+CAS+<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=sync&spm=1001.2101.3001.7020">sync</a>关键字来实现同步。</p>
<h4 id="自旋锁："><a href="#自旋锁：" class="headerlink" title="自旋锁："></a>自旋锁：</h4><p>在介绍自旋这个概念之前首先说一下内核态和用户态的概念。简单的说运行操作系统的程序(如操作硬件)需要在内核态（Kernel Mode）进行，用户态（User Mode）则用来运行用户程序。而阻塞等待动作即需要在内核态完成。<br>一个线程，线程阻塞从运行状态进入阻塞状态需要从用户态进入内核态，线程唤醒从阻塞状态进入运行状态则需要从内核态恢复到用户态。而线程状态之前的切换需要的成本非常高，需要的时间也很长。<br>在多个线程竞争同一个锁的场景下，一个线程获取锁之后，其它线程得不到锁就需要进入阻塞状态进行一个用户态到内核态的转变，而当锁资源释放时又需要唤醒线程进行一个内核态到用户态的转变。但是如果持有锁的线程能很快的释放锁，就可能会出现线程等待锁释放的代价要比线程经历两次状态切换的代价更低。<br>自旋的操作就被提出了：如果持有锁的线程能在很短的时间内释放锁资源，那么那些等待竞争锁的线程就不需要做内核态和用户态之间的切换进入阻塞挂起状态，他们只需要等一等(自旋)，等待有锁的线程释放锁之后即可立即获取锁，这样就避免了线程状态切换的消耗</p>
<h4 id="无锁-amp-偏向锁-amp-轻量级锁-amp-重量级锁："><a href="#无锁-amp-偏向锁-amp-轻量级锁-amp-重量级锁：" class="headerlink" title="无锁&amp;偏向锁&amp;轻量级锁&amp;重量级锁："></a>无锁&amp;偏向锁&amp;轻量级锁&amp;重量级锁：</h4><p>可以通过设置JVM参数UseHeavyMonitors禁用偏向锁和轻量锁，直接使用重量锁。<br>在了解锁膨胀之前先了解一下锁膨胀实现的关键：位于Java对象头中的Mark Word.</p>
<p>上图即为堆中一个对象组成的简单结构，Mark Word所处的位置已用蓝色标出，灰色部分与锁无关。JAVA对象头一般由两个机器码组成，Mark Word和类型指针各占据一个，如果是数组对象则会多出一个机器码用来维护数组长度以便JVM确认数组大小。<br>Mark Word用来存储对象运行时数据，如identityHashCode，GC分代年龄，锁状态标志，线程持有的锁，偏向ID等。以32位JVM为例，一个机器码4个字节，即32bit。32bit自然无法存储Mark Word要存的所有内容，因此会复用存储空间，对象处于不同的状态，Mark Word内存的内容也会不同，不同状态下存储的内容如图：</p>
<p><img src="/RobertBlog/.io//watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAeXVlX2h1,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center.png" alt="Java锁"></p>
<p>其中需要重点关注的地方用蓝色底色标出，结合这个图片能更好的理解锁膨胀过程中的各个阶段。<br><img src="/RobertBlog/.io//image-20220816004015828-16605816171142.png" alt="image-20220816004015828"></p>
<h2 id="3、ReebtrantLock的lock-和tryLock"><a href="#3、ReebtrantLock的lock-和tryLock" class="headerlink" title="3、ReebtrantLock的lock()和tryLock()"></a>3、ReebtrantLock的lock()和tryLock()</h2><p>是一个可重用锁、非公平锁。</p>
<ul>
<li>lock()，是一个阻塞加锁的过程，方法会阻塞当前线程直到拿到锁。</li>
<li>tryLock()是一个非阻塞，是否加到锁会返回一个boolen值。</li>
</ul>
<h2 id="4、并发、并行、串行、指令重排"><a href="#4、并发、并行、串行、指令重排" class="headerlink" title="4、并发、并行、串行、指令重排"></a>4、并发、并行、串行、指令重排</h2><ul>
<li>串行：任务一个一个完成。</li>
<li>并行：多个任务同时在进行，在CPU执行上是一个任务依次执行的。</li>
<li>并发：多个任务同时发起，但是在CPU上是通过不断切换线程，来达到多个任务都在进行。</li>
</ul>
<p>并发三大特性：</p>
<ul>
<li>原子性：</li>
<li>可见性：多线程情况下，多线程之间共享的值的改变可以同时可见。</li>
<li>有序性：</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://robert-pf.github.io/RobertBlog/2022/04/12/%E7%AC%94%E8%AE%B0/" data-id="cl6w6pzid0004k4igaqb82208" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Linux命令使用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/RobertBlog/2022/03/31/Linux%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/" class="article-date">
  <time datetime="2022-03-31T01:21:10.030Z" itemprop="datePublished">2022-03-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Linux命令使用\image-20220331092144060.png" alt="image-20220331092144060"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://robert-pf.github.io/RobertBlog/2022/03/31/Linux%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/" data-id="cl26a2mts000030uvai1va4d7" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Mybatis和事务" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/RobertBlog/2021/10/10/Mybatis%E5%92%8C%E4%BA%8B%E5%8A%A1/" class="article-date">
  <time datetime="2021-10-10T14:03:35.000Z" itemprop="datePublished">2021-10-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/RobertBlog/2021/10/10/Mybatis%E5%92%8C%E4%BA%8B%E5%8A%A1/">MyBatis和事务</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1、声明式事务"><a href="#1、声明式事务" class="headerlink" title="1、声明式事务"></a>1、声明式事务</h1><h2 id="1、事务概念"><a href="#1、事务概念" class="headerlink" title="1、事务概念"></a>1、事务概念</h2><ul>
<li>把一组业务当成一个业务来做；要么成功要么失败！</li>
<li>事务在项目的开发中，涉及到数据的一致性问题</li>
<li>事务能确</li>
</ul>
<p>​    事务的ACID原则：</p>
<ul>
<li><p>原子性</p>
</li>
<li><p>一致性</p>
<p>多个业务可能操作同一个资源，放置数据损坏</p>
</li>
<li><p>隔离性</p>
<p>事务一旦提交，无论系统发生什么问题，结果都不会再被影响，被持久化到储存器中</p>
</li>
</ul>
<h2 id="2、事务"><a href="#2、事务" class="headerlink" title="2、事务"></a>2、事务</h2><p>声明式事务</p>
<p>编程式事务</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://robert-pf.github.io/RobertBlog/2021/10/10/Mybatis%E5%92%8C%E4%BA%8B%E5%8A%A1/" data-id="cl26a2mud000a30uv7iwpeetk" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/RobertBlog/tags/MyBatis/" rel="tag">MyBatis</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Mybatis" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/RobertBlog/2021/08/10/Mybatis/" class="article-date">
  <time datetime="2021-08-10T14:03:35.000Z" itemprop="datePublished">2021-08-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/RobertBlog/2021/08/10/Mybatis/">MyBatis</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1、简介："><a href="#1、简介：" class="headerlink" title="1、简介："></a>1、简介：</h1><h4 id="1-1、什么是Mybatis"><a href="#1-1、什么是Mybatis" class="headerlink" title="1.1、什么是Mybatis"></a>1.1、什么是Mybatis</h4><p>MyBatis 是一款优秀的<strong>持久层框架</strong>。<br>它支持自定义 SQL、存储过程以及高级映射。<br>MyBatis 免除了几乎所有的 JDBC 代码以及设置参数和获取结果集的工作。</p>
<p><strong>下载地址：</strong><br>maven仓库<br>githup可以下载源码</p>
<h4 id="1-2、数据持久化"><a href="#1-2、数据持久化" class="headerlink" title="1.2、数据持久化"></a>1.2、数据持久化</h4><ul>
<li>持久化就是将程序的数据在持久状态和瞬时状态转换的过程</li>
<li>实现方式：数据库、IO文件持久化。</li>
</ul>
<h4 id="1-3、持久层"><a href="#1-3、持久层" class="headerlink" title="1.3、持久层"></a>1.3、持久层</h4><p>Dao层、Service层、Controller层</p>
<ul>
<li>完成持久化工作的代码块</li>
<li>层界面十分明显</li>
</ul>
<h4 id="1-4、为什么需要Mybatis"><a href="#1-4、为什么需要Mybatis" class="headerlink" title="1.4、为什么需要Mybatis"></a>1.4、为什么需要Mybatis</h4><ul>
<li>帮助程序将数据存入数据库中</li>
<li>传统的JDBC代码太复杂了。简单、框架、自动化</li>
<li>不用Mybatis也可以，更容易上手。</li>
<li>优点：<ul>
<li>简单易学：本身就很小且简单。没有任何第三方依赖，最简单安装只要两个jar文件+配置几个sql映射文件。易于学习，易于使用。通过文档和源代码，可以比较完全的掌握它的设计思路和实现。</li>
<li>灵活：mybatis不会对应用程序或者数据库的现有设计强加任何影响。 sql写在xml里，便于统一管理和优化。通过sql语句可以满足操作数据库的所有需求。</li>
<li>解除sql与程序代码的耦合：通过提供DAO层，将业务逻辑和数据访问逻辑分离，使系统的设计更清晰，更易维护，更易单元测试。sql和代码的分离，提高了可维护性。</li>
<li>提供映射标签，支持对象与数据库的orm字段关系映射。</li>
<li>提供对象关系映射标签，支持对象关系组建维护。</li>
<li>提供xml标签，支持编写动态sql。</li>
</ul>
</li>
</ul>
<h1 id="2、使用mybatis"><a href="#2、使用mybatis" class="headerlink" title="2、使用mybatis"></a>2、使用mybatis</h1><p>新建maven项目:</p>
<h4 id="2-1、配置项目的依赖文件pom-xml"><a href="#2-1、配置项目的依赖文件pom-xml" class="headerlink" title="2.1、配置项目的依赖文件pom.xml"></a>2.1、配置项目的依赖文件pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>Mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.47<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.13.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-2、从-XML-中构建-SqlSessionFactory"><a href="#2-2、从-XML-中构建-SqlSessionFactory" class="headerlink" title="2.2、从 XML 中构建 SqlSessionFactory"></a>2.2、从 XML 中构建 SqlSessionFactory</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--configuration 核心配置文件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/learnjdbc?useSSL=false<span class="symbol">&amp;amp;</span>useUnicode=true<span class="symbol">&amp;amp;</span>characterEncoding=UTF-8&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;159357&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>还可以不适用xml配置SqlSessionFactory：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> BlogDataSourceFactory.getBlogDataSource();</span><br><span class="line"><span class="type">TransactionFactory</span> <span class="variable">transactionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JdbcTransactionFactory</span>();</span><br><span class="line"><span class="type">Environment</span> <span class="variable">environment</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Environment</span>(<span class="string">&quot;development&quot;</span>, transactionFactory, dataSource);</span><br><span class="line"><span class="type">Configuration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>(environment);</span><br><span class="line">configuration.addMapper(BlogMapper.class);</span><br><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(configuration);</span><br></pre></td></tr></table></figure>

<h4 id="2-3、从-SqlSessionFactory-中获取-SqlSession："><a href="#2-3、从-SqlSessionFactory-中获取-SqlSession：" class="headerlink" title="2.3、从 SqlSessionFactory 中获取 SqlSession："></a>2.3、从 SqlSessionFactory 中获取 SqlSession：</h4><p>编写mybatis工具类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Robert</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2022-04-16 15:51</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisUtils</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SqlSessionFactory sqlSessionFactory;</span><br><span class="line">    <span class="comment">//获取sqlsessionFactory的对象</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;org/mybatis/example/mybatis-config.xml&quot;</span>;</span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);</span><br><span class="line">            sqlSessionFactory = <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//从sqlsessionfacory中创建sqlsession实例</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SqlSession <span class="title function_">getSqlSession</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-4-编写代码：select"><a href="#2-4-编写代码：select" class="headerlink" title="2.4,编写代码：select"></a>2.4,编写代码：select</h4><h5 id="2-4-1、创建对象："><a href="#2-4-1、创建对象：" class="headerlink" title="2.4.1、创建对象："></a>2.4.1、创建对象：</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mybatis.pojo;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Robert</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2022-04-16 16:02</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span>  <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(<span class="type">int</span> id, String name, String password, String email)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">        <span class="built_in">this</span>.email = email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPassword</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPassword</span><span class="params">(String password)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getEmail</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setEmail</span><span class="params">(String email)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.email = email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, password=&#x27;&quot;</span> + password + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, email=&#x27;&quot;</span> + email + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="2-4-2、DAO接口"><a href="#2-4-2、DAO接口" class="headerlink" title="2.4.2、DAO接口"></a>2.4.2、DAO接口</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mybatis.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mybatis.pojo.User;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Robert</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2022-04-16 16:04</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    List&lt;User&gt; <span class="title function_">getUserList</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="2-4-3-、编写接口实现类"><a href="#2-4-3-、编写接口实现类" class="headerlink" title="2.4.3 、编写接口实现类"></a>2.4.3 、编写接口实现类</h5><p>用xml配置文件或者实际的java类都可以，但是为了使用xml配置文件可以应对更复杂的sql语句，一般情况下用的都是xml文件。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- namespace=绑定一个对应的Dao/Mapper接口--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.mybatis.dao.UserDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--id是接口中的方法，resultType是返回的数据的类型--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserList&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.mybatis.pojo.User&quot;</span> &gt;</span></span><br><span class="line">        SELECT  * from learnjdbc.user;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="2-4-4、测试"><a href="#2-4-4、测试" class="headerlink" title="2.4.4、测试"></a>2.4.4、测试</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mybatis.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mybatis.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.mybatis.utils.MybatisUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Robert</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2022-04-16 16:16</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//第一步：获取SqlSession对象</span></span><br><span class="line">        SqlSession sqlSession= MybatisUtils.getSqlSession();</span><br><span class="line">        <span class="comment">//方式一：getMapper</span></span><br><span class="line">        <span class="type">UserDao</span> <span class="variable">userDao</span> <span class="operator">=</span> sqlSession.getMapper(UserDao.class);</span><br><span class="line">        List&lt;User&gt; userList = userDao.getUserList();</span><br><span class="line">        System.out.println(userList.toString());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//关闭Sqlsession</span></span><br><span class="line">        sqlSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>遇到的报错一：java.io.IOException: Could not find resource src/main/resources/mybatis-config.xml<br>真实路径是存在的：</p>
<ul>
<li><p>原因：</p>
<p>​    maven由于约定是大于配置，xml的配置文件并没有被导出到运行包中</p>
</li>
<li><p>解决办法：</p>
<p>​    在build中配置resources，来防止我们资源导出失败的问题。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">  </span><br></pre></td></tr></table></figure></li>
</ul>
<p>报错二：org.apache.ibatis.binding.BindingException: Type interface com.mybatis.dao.UserDao is not known to the MapperRegistry.</p>
<ul>
<li><p>原因一：mybatis的核心配置文件xml没有注册mapper</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/mybatis/dao/UserMapper.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>解决办法加上mappers</p>
</li>
<li><p>原因二：UserMapper.xml 中没有引用正确的接口，namespace后要跟接口正确的路径</p>
<ul>
<li>其中id是接口中的方法，resultType是返回的数据的类型。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.mybatis.dao.UserDaor&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserList&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.mybatis.pojo.User&quot;</span> &gt;</span></span><br><span class="line">        <span class="comment">&lt;!--表名写错--&gt;</span></span><br><span class="line">        SELECT  * from lernjdbc.user;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p>报错三：org.apache.ibatis.exceptions.PersistenceException: Error querying database.  Cause: com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException: Table ‘lernjdbc.user’ doesn’t exist</p>
<ul>
<li><p>原因：UserMapper中的查询语句出现出现错误：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.mybatis.dao.UserDaor&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserList&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.mybatis.pojo.User&quot;</span> &gt;</span></span><br><span class="line">        <span class="comment">&lt;!--表名写错--&gt;</span></span><br><span class="line">        SELECT  * from lernjdbc.user;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>解决办法：更正sql语句</p>
</li>
</ul>
<h4 id="3、CRUD"><a href="#3、CRUD" class="headerlink" title="3、CRUD"></a>3、CRUD</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- namespace=绑定一个对应的Dao/Mapper接口--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.mybatis.dao.UserDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserList&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.mybatis.pojo.User&quot;</span> &gt;</span></span><br><span class="line">        SELECT  * from learnjdbc.user;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>namespce 对应的接口名字</li>
<li>id 是接口中对应的方法名字</li>
<li>parameterType：参数类型</li>
</ul>
<h5 id="select语句："><a href="#select语句：" class="headerlink" title="select语句："></a>select语句：</h5><ol>
<li>编写接口</li>
<li>编写对应的mapper中的sql语句</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--select插入语句--&gt;</span>   </span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserList&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.mybatis.pojo.User&quot;</span> &gt;</span></span><br><span class="line">        SELECT  * from learnjdbc.user;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.mybatis.pojo.User&quot;</span>&gt;</span></span><br><span class="line">        select * from learnjdbc.user where  id = #&#123;id&#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--insert插入语句--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.mybatis.pojo.User&quot;</span>&gt;</span></span><br><span class="line">        insert  into learnjdbc.user (id,name,password,email) values (#&#123;id&#125;,#&#123;name&#125;,#&#123;password&#125;,#&#123;email&#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Update语句--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.mybatis.pojo.User&quot;</span>&gt;</span></span><br><span class="line">        update learnjdbc.user set name=#&#123;name&#125;,password=#&#123;password&#125; where id = #&#123;id&#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>注意点：增删查改语句测试时需要有提交事务操作</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">test3</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> MybatisUtils.getSqlSession();</span><br><span class="line">    <span class="type">UserDao</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(UserDao.class);</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> mapper.updateUser(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">8</span>, <span class="string">&quot;JackSon&quot;</span>, <span class="string">&quot;123455&quot;</span>, <span class="string">&quot;Jack@163.com&quot;</span>));</span><br><span class="line">    <span class="keyword">if</span> (i&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;修改成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//提交事务</span></span><br><span class="line">    sqlSession.commit();</span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4、万能Map"><a href="#4、万能Map" class="headerlink" title="4、万能Map"></a>4、万能Map</h4><p>假设一个类有很多属性，利用对象传递参数时，在写sql语句的时候，再用 update learnjdbc.user set name=#{name},password=#{password} where id = #{id} 这种语句的时候，需要把对象的属性都输入进去，比较麻烦。</p>
<ul>
<li>对象传递参数，直接在sql中取出对象的属性即可。</li>
<li>Map传递参数，直接在sql中取出key即可。<strong>parameterType=”Map”</strong></li>
</ul>
<p>Map修改方法：</p>
<p>接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">updatePassword</span><span class="params">(Map&lt;String,Object&gt; map)</span>;</span><br></pre></td></tr></table></figure>

<p>实现的xml代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updatePassword&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Map&quot;</span>  &gt;</span></span><br><span class="line">    //map方法可以使不要求数据库中的字段名必须与传入参数匹配，但是用对象属性的话，必须一致。</span><br><span class="line">    update  learnjdbc.user set password=#&#123;pwd&#125; where name=#&#123;name&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">test4</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="keyword">try</span> (<span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> MybatisUtils.getSqlSession();)&#123;</span><br><span class="line">           <span class="type">UserDao</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(UserDao.class);</span><br><span class="line">           HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">           map.put(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;JackSon&quot;</span>);</span><br><span class="line">           map.put(<span class="string">&quot;pwd&quot;</span>,<span class="string">&quot;eisoo.com123&quot;</span>);</span><br><span class="line">           <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> mapper.updatePassword(map);</span><br><span class="line">           <span class="keyword">if</span> (i&gt;<span class="number">0</span>)&#123;</span><br><span class="line">               System.out.println(<span class="string">&quot;修改成功&quot;</span>);</span><br><span class="line">           &#125;</span><br><span class="line">           sqlSession.commit();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h1 id="3、配置解析"><a href="#3、配置解析" class="headerlink" title="3、配置解析"></a>3、配置解析</h1><h4 id="3-1、核心配置文件："><a href="#3-1、核心配置文件：" class="headerlink" title="3.1、核心配置文件："></a>3.1、核心配置文件：</h4><p>MyBatis 的配置文件包含了会深深影响 MyBatis 行为的设置和属性信息。 </p>
<p>配置文档的顶层结构如下：</p>
<ul>
<li>configuration（配置）<ul>
<li><a target="_blank" rel="noopener" href="https://mybatis.net.cn/configuration.html#properties">properties（属性）</a></li>
<li><a target="_blank" rel="noopener" href="https://mybatis.net.cn/configuration.html#settings">settings（设置）</a></li>
<li><a target="_blank" rel="noopener" href="https://mybatis.net.cn/configuration.html#typeAliases">typeAliases（类型别名）</a></li>
<li><a target="_blank" rel="noopener" href="https://mybatis.net.cn/configuration.html#typeHandlers">typeHandlers（类型处理器）</a></li>
<li><a target="_blank" rel="noopener" href="https://mybatis.net.cn/configuration.html#objectFactory">objectFactory（对象工厂）</a></li>
<li><a target="_blank" rel="noopener" href="https://mybatis.net.cn/configuration.html#plugins">plugins（插件）</a></li>
<li>environments（环境配置）<ul>
<li>environment（环境变量）<ul>
<li>transactionManager（事务管理器）</li>
<li>dataSource（数据源）</li>
</ul>
</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://mybatis.net.cn/configuration.html#databaseIdProvider">databaseIdProvider（数据库厂商标识）</a></li>
<li><a target="_blank" rel="noopener" href="https://mybatis.net.cn/configuration.html#mappers">mappers（映射器）</a></li>
</ul>
</li>
</ul>
<p><strong>注：核心配置文件中各个块的书写位置：</strong></p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Mybatis\image-20220417111647635.png" alt="image-20220417111647635"></p>
<h4 id="3-2、环境配置（environments）"><a href="#3-2、环境配置（environments）" class="headerlink" title="3.2、环境配置（environments）"></a>3.2、环境配置（environments）</h4><h4 id="3-3、属性（properties）"><a href="#3-3、属性（properties）" class="headerlink" title="3.3、属性（properties）"></a>3.3、属性（properties）</h4><p>这些属性可以在外部进行配置，并可以进行动态替换。你既可以在典型的 Java 属性文件中配置这些属性，也可以在 properties 元素的子元素中设置。</p>
<p>例，在properties中配置：<br>    新建一个properties文件：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">driver=com.mysql.jdbc.Driver</span><br><span class="line">url=jdbc:mysql:<span class="comment">//localhost:3306/learnjdbc?useSSL=false&amp;useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class="line">username=root</span><br><span class="line">password=<span class="number">159357</span></span><br></pre></td></tr></table></figure>

<p>在核心配置文件中导入外部配置文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    导入外部配置文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;db.properties&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--以下元素属性最低，容易被覆盖--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;231233&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果一个属性在不只一个地方进行了配置，那么，MyBatis 将按照下面的顺序来加载：</p>
<ul>
<li>首先读取在 properties 元素体内指定的属性。</li>
<li>然后根据 properties 元素中的 resource 属性读取类路径下属性文件，或根据 url 属性指定的路径读取属性文件，并覆盖之前读取过的同名属性。</li>
<li>最后读取作为方法参数传递的属性，并覆盖之前读取过的同名属性。</li>
</ul>
<p>从 MyBatis 3.4.2 开始，你可以为占位符指定一个默认值。例如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- ... --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;username:ut_user&#125;&quot;</span>/&gt;</span> <span class="comment">&lt;!-- 如果属性 &#x27;username&#x27; 没有被配置，&#x27;username&#x27; 属性的值将为 &#x27;ut_user&#x27; --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这个特性默认是关闭的。要启用这个特性，需要添加一个特定的属性来开启这个特性。例如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;org/mybatis/example/config.properties&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- ... --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;org.apache.ibatis.parsing.PropertyParser.enable-default-value&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span> <span class="comment">&lt;!-- 启用默认值特性 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>提示</strong> 如果你在属性名中使用了 <code>&quot;:&quot;</code> 字符（如：<code>db:username</code>），或者在 SQL 映射中使用了 OGNL 表达式的三元运算符（如： <code>$&#123;tableName != null ? tableName : &#39;global_constants&#39;&#125;</code>），就需要设置特定的属性来修改分隔属性名和默认值的字符。例如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;org/mybatis/example/config.properties&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- ... --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;org.apache.ibatis.parsing.PropertyParser.default-value-separator&quot;</span> <span class="attr">value</span>=<span class="string">&quot;?:&quot;</span>/&gt;</span> <span class="comment">&lt;!-- 修改默认值的分隔符 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- ... --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;db:username?:ut_user&#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-4、类型别名（typeAliases）"><a href="#3-4、类型别名（typeAliases）" class="headerlink" title="3.4、类型别名（typeAliases）"></a>3.4、类型别名（typeAliases）</h4><p>可以为Java的类型设置一个别名，方便在xml配置中引用，降低书写长度：</p>
<ol>
<li><p>对某一类做一个别名：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--设置别名--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--此行代表的意思使将User类取了一个简单的名字user代替--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">type</span>=<span class="string">&quot;com.mybatis.pojo.User&quot;</span> <span class="attr">alias</span>=<span class="string">&quot;user&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<p>​    后边编辑接口实现的xml文件的时候，可以直接使用use代表实现类。</p>
<p>2、对包做别名</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--对整个包做别名--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.mybatis.pojo&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>每一个在包 <code>com.mybatis.pojo</code> 中的 Java Bean，在没有注解的情况下，会使用 Bean 的首字母小写的非限定类名来作为它的别名。 比如 <code>com.mybatis.pojo.User</code> 的别名为 <code>user</code>；若有注解，则别名为其注解值。</p>
<p>3、使用注解写别名：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Alias(&quot;Tom&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;....&#125;</span><br></pre></td></tr></table></figure>

<p>使用注意事项：</p>
<ul>
<li>在实体类比较少的时候，使用第一种方法</li>
<li>在实体类十分多的情况下，建议使用第二种</li>
<li>第一种和使用注解可以自定义别名，但是第二种则不行。</li>
</ul>
<p> Java 类型内建的类型别名。它们都是不区分大小写的，注意，为了应对原始类型的命名重复，采取了特殊的命名风格。</p>
<table>
<thead>
<tr>
<th align="left">别名</th>
<th align="left">映射的类型</th>
</tr>
</thead>
<tbody><tr>
<td align="left">_byte</td>
<td align="left">byte</td>
</tr>
<tr>
<td align="left">_long</td>
<td align="left">long</td>
</tr>
<tr>
<td align="left">_short</td>
<td align="left">short</td>
</tr>
<tr>
<td align="left">_int</td>
<td align="left">int</td>
</tr>
<tr>
<td align="left">_integer</td>
<td align="left">int</td>
</tr>
<tr>
<td align="left">_double</td>
<td align="left">double</td>
</tr>
<tr>
<td align="left">_float</td>
<td align="left">float</td>
</tr>
<tr>
<td align="left">_boolean</td>
<td align="left">boolean</td>
</tr>
<tr>
<td align="left">string</td>
<td align="left">String</td>
</tr>
<tr>
<td align="left">byte</td>
<td align="left">Byte</td>
</tr>
<tr>
<td align="left">long</td>
<td align="left">Long</td>
</tr>
<tr>
<td align="left">short</td>
<td align="left">Short</td>
</tr>
<tr>
<td align="left">int</td>
<td align="left">Integer</td>
</tr>
<tr>
<td align="left">integer</td>
<td align="left">Integer</td>
</tr>
<tr>
<td align="left">double</td>
<td align="left">Double</td>
</tr>
<tr>
<td align="left">float</td>
<td align="left">Float</td>
</tr>
<tr>
<td align="left">boolean</td>
<td align="left">Boolean</td>
</tr>
<tr>
<td align="left">date</td>
<td align="left">Date</td>
</tr>
<tr>
<td align="left">decimal</td>
<td align="left">BigDecimal</td>
</tr>
<tr>
<td align="left">bigdecimal</td>
<td align="left">BigDecimal</td>
</tr>
<tr>
<td align="left">object</td>
<td align="left">Object</td>
</tr>
<tr>
<td align="left">map</td>
<td align="left">Map</td>
</tr>
<tr>
<td align="left">hashmap</td>
<td align="left">HashMap</td>
</tr>
<tr>
<td align="left">list</td>
<td align="left">List</td>
</tr>
<tr>
<td align="left">arraylist</td>
<td align="left">ArrayList</td>
</tr>
<tr>
<td align="left">collection</td>
<td align="left">Collection</td>
</tr>
<tr>
<td align="left">iterator</td>
<td align="left">Iterator</td>
</tr>
</tbody></table>
<h4 id="3-5、设置"><a href="#3-5、设置" class="headerlink" title="3.5、设置"></a>3.5、设置</h4><p>设置（settings）</p>
<p>这是 MyBatis 中极为重要的调整设置，它们会改变 MyBatis 的运行时行为。 下表描述了设置中各项设置的含义、默认值等。</p>
<table>
<thead>
<tr>
<th align="left">设置名</th>
<th align="left">描述</th>
<th align="left">有效值</th>
<th align="left">默认值</th>
</tr>
</thead>
<tbody><tr>
<td align="left">cacheEnabled</td>
<td align="left">全局性地开启或关闭所有映射器配置文件中已配置的任何缓存。</td>
<td align="left">true | false</td>
<td align="left">true</td>
</tr>
<tr>
<td align="left">lazyLoadingEnabled</td>
<td align="left">延迟加载的全局开关。当开启时，所有关联对象都会延迟加载。 特定关联关系中可通过设置 <code>fetchType</code> 属性来覆盖该项的开关状态。</td>
<td align="left">true | false</td>
<td align="left">false</td>
</tr>
</tbody></table>
<h4 id="3-6、映射器"><a href="#3-6、映射器" class="headerlink" title="3.6、映射器"></a>3.6、映射器</h4><p>既然 MyBatis 的行为已经由上述元素配置完了，我们现在就要来定义 SQL 映射语句了。 但首先，我们需要告诉 MyBatis 到哪里去找到这些语句。 在自动查找资源方面，Java 并没有提供一个很好的解决方案，所以最好的办法是直接告诉 MyBatis 到哪里去找映射文件。 你可以使用相对于类路径的资源引用，或完全限定资源定位符（包括 <code>file:///</code> 形式的 URL），或类名和包名等。例如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用相对于类路径的资源引用 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;org/mybatis/builder/AuthorMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;org/mybatis/builder/BlogMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;org/mybatis/builder/PostMapper.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 使用完全限定资源定位符（URL） --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">&quot;file:///var/mappers/AuthorMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">&quot;file:///var/mappers/BlogMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">&quot;file:///var/mappers/PostMapper.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 使用映射器接口实现类的完全限定类名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.builder.AuthorMapper&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.builder.BlogMapper&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.builder.PostMapper&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 将包内的映射器接口实现全部注册为映射器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;org.mybatis.builder&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>使用映射器接口实现类的完全限定类名和包内的映射器接口实现全部注册为映射器的注意事项：</p>
<ol>
<li>接口和他的Mapper配置文件名字必须相同。</li>
<li>接口和他的Mapper配置文件必须在同一个包名下。</li>
</ol>
<h1 id="4、生命周期和作用域"><a href="#4、生命周期和作用域" class="headerlink" title="4、生命周期和作用域"></a>4、生命周期和作用域</h1><p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Mybatis\image-20220417152245109.png" alt="image-20220417152245109"></p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Mybatis\image-20220417152311082.png" alt="image-20220417152311082"></p>
<p>理解我们之前讨论过的不同作用域和生命周期类别是至关重要的，因为错误的使用会导致非常严重的并发问题。</p>
<hr>
<p><strong>提示</strong> <strong>对象生命周期和依赖注入框架</strong></p>
<p>依赖注入框架可以创建线程安全的、基于事务的 SqlSession 和映射器，并将它们直接注入到你的 bean 中，因此可以直接忽略它们的生命周期。 如果对如何通过依赖注入框架使用 MyBatis 感兴趣，可以研究一下 MyBatis-Spring 或 MyBatis-Guice 两个子项目。</p>
<hr>
<h4 id="SqlSessionFactoryBuilder"><a href="#SqlSessionFactoryBuilder" class="headerlink" title="SqlSessionFactoryBuilder"></a>SqlSessionFactoryBuilder</h4><p>这个类可以被实例化、使用和丢弃，一旦创建了 SqlSessionFactory，就不再需要它了。 因此 SqlSessionFactoryBuilder 实例的最佳作用域是方法作用域（也就是局部方法变量）。 你可以重用 SqlSessionFactoryBuilder 来创建多个 SqlSessionFactory 实例，但最好还是不要一直保留着它，以保证所有的 XML 解析资源可以被释放给更重要的事情。</p>
<h4 id="SqlSessionFactory"><a href="#SqlSessionFactory" class="headerlink" title="SqlSessionFactory"></a>SqlSessionFactory</h4><p>SqlSessionFactory 一旦被创建就应该在应用的运行期间一直存在，没有任何理由丢弃它或重新创建另一个实例。 使用 SqlSessionFactory 的最佳实践是在应用运行期间不要重复创建多次，多次重建 SqlSessionFactory 被视为一种代码“坏习惯”。因此 SqlSessionFactory 的最佳作用域是应用作用域。 有很多方法可以做到，最简单的就是使用单例模式或者静态单例模式。</p>
<h4 id="SqlSession"><a href="#SqlSession" class="headerlink" title="SqlSession"></a>SqlSession</h4><p>每个线程都应该有它自己的 SqlSession 实例。SqlSession 的实例不是线程安全的，因此是不能被共享的，所以它的最佳的作用域是请求或方法作用域。 绝对不能将 SqlSession 实例的引用放在一个类的静态域，甚至一个类的实例变量也不行。 也绝不能将 SqlSession 实例的引用放在任何类型的托管作用域中，比如 Servlet 框架中的 HttpSession。 如果你现在正在使用一种 Web 框架，考虑将 SqlSession 放在一个和 HTTP 请求相似的作用域中。 换句话说，每次收到 HTTP 请求，就可以打开一个 SqlSession，返回一个响应后，就关闭它。 这个关闭操作很重要，为了确保每次都能执行关闭操作，你应该把这个关闭操作放到 finally 块中。 下面的示例就是一个确保 SqlSession 关闭的标准模式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">try (SqlSession session = sqlSessionFactory.openSession()) &#123;</span><br><span class="line">  // 你的应用逻辑代码</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在所有代码中都遵循这种使用模式，可以保证所有数据库资源都能被正确地关闭。</p>
<h1 id="5、解决字段名字和属性名字不一致的问题"><a href="#5、解决字段名字和属性名字不一致的问题" class="headerlink" title="5、解决字段名字和属性名字不一致的问题"></a>5、解决字段名字和属性名字不一致的问题</h1><p>数据库中的字段名字：</p>
<table>
<thead>
<tr>
<th align="left">数据库</th>
<th>Bean属性</th>
</tr>
</thead>
<tbody><tr>
<td align="left">name</td>
<td>name</td>
</tr>
<tr>
<td align="left">id</td>
<td>id</td>
</tr>
<tr>
<td align="left">password</td>
<td>pwd</td>
</tr>
<tr>
<td align="left">email</td>
<td>email</td>
</tr>
</tbody></table>
<p>实际类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span>  <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String pwd;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时如果不进行特殊的配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.mybatis.dao.UserMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserList&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Tom&quot;</span> &gt;</span></span><br><span class="line">        SELECT  * from learnjdbc.user;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Tom&quot;</span>&gt;</span></span><br><span class="line">        select * from learnjdbc.user where  id = #&#123;id&#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>还如上图所示的话，从数据库中能够查询出password字段，但是不能正确的配置给Bean的属性。：</p>
<p>User{id=2, name=’Alice’, pwd=’null’, email=‘<a href="mailto:&#x61;&#108;&#x69;&#x63;&#101;&#x40;&#101;&#120;&#97;&#109;&#x70;&#x6c;&#x65;&#46;&#99;&#111;&#109;">&#x61;&#108;&#x69;&#x63;&#101;&#x40;&#101;&#120;&#97;&#109;&#x70;&#x6c;&#x65;&#46;&#99;&#111;&#109;</a>‘}</p>
<p>要解决上述问题可以有两个办法：</p>
<p>方法一：修改sql语句中的字段值：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    select id,name,email,password as pwd  from learnjdbc.user where  id = #&#123;id&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>方法二：使用resultMap（结果集映射）解决。</p>
<h4 id="5-1、resultMap"><a href="#5-1、resultMap" class="headerlink" title="5.1、resultMap"></a>5.1、<code>resultMap</code></h4><p><code>resultMap</code> 元素是 MyBatis 中最重要最强大的元素。它可以让你从 90% 的 JDBC <code>ResultSets</code> 数据提取代码中解放出来，并在一些情形下允许你进行一些 JDBC 不支持的操作。实际上，在为一些比如连接的复杂语句编写映射代码的时候，一份</p>
<p><strong>resultMap 的设计思想是，对简单的语句做到零配置，对于复杂一点的语句，只需要描述语句之间的关系就行了。</strong></p>
<p>为了解决数据库中字段和Bean中的属性不通的问题，可以通过设置一个单独的映射方法来解决：<br>在实现类中使用<code>resultMap</code>标签，标签中阐述映射关系，然后在<code>select</code>标签中<code>resultMap</code>使用你自定义的<code>resultMap</code>的<code>id</code>即可，<code>property</code>代表实例的属性字段，<code>column</code>代表数据库中的字段。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.mybatis.dao.UserMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;password=pwd&quot;</span> <span class="attr">type</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;pwd&quot;</span> <span class="attr">column</span>=<span class="string">&quot;password&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserList&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span> &gt;</span></span><br><span class="line">        SELECT  * from learnjdbc.user;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;password=pwd&quot;</span>&gt;</span></span><br><span class="line">        select *  from learnjdbc.user where  id = #&#123;id&#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>resultMap</code>还可以简化一点写，就是只写需要映射的字段名字就行：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;password=pwd&quot;</span> <span class="attr">type</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;pwd&quot;</span> <span class="attr">column</span>=<span class="string">&quot;password&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="6、日志"><a href="#6、日志" class="headerlink" title="6、日志"></a>6、日志</h1><h4 id="6-1、日志工厂"><a href="#6-1、日志工厂" class="headerlink" title="6.1、日志工厂"></a>6.1、日志工厂</h4><p>曾经解决问题的办法：debug<br>现在可以配置日志，利用日志实现：<br>mybatis中实现的日志工厂：</p>
<table>
<thead>
<tr>
<th>设置名</th>
<th>描述</th>
<th>有效值</th>
<th>默认值</th>
</tr>
</thead>
<tbody><tr>
<td>logImpl</td>
<td>指定 MyBatis 所用日志的具体实现，未指定时将自动查找。</td>
<td>SLF4J | LOG4J | LOG4J2 | JDK_LOGGING | COMMONS_LOGGING | STDOUT_LOGGING | NO_LOGGING</td>
<td>未设置</td>
</tr>
</tbody></table>
<p>这个设置需要手动在核心配置文件中设置加入<code>setting</code>标签中设置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--设置日志--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;logImpl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;STDOUT_LOGGING&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="6-1-1、使用标准日志输出的"><a href="#6-1-1、使用标准日志输出的" class="headerlink" title="6.1.1、使用标准日志输出的"></a>6.1.1、使用标准日志输出的</h5><p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Mybatis\image-20220417170313684.png" alt="image-20220417170313684"></p>
<h5 id="6-1-2、log4j"><a href="#6-1-2、log4j" class="headerlink" title="6.1.2、log4j"></a>6.1.2、log4j</h5><p>Log4j是<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/Apache/8512995">Apache</a>的一个开源项目，通过使用Log4j，我们可以控制日志信息输送的目的地是<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%8E%A7%E5%88%B6%E5%8F%B0/2438626">控制台</a>、文件、<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/GUI">GUI</a>组件，甚至是套接口服务器、<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/NT/3443842">NT</a>的事件记录器、<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/UNIX">UNIX</a> <a target="_blank" rel="noopener" href="https://baike.baidu.com/item/Syslog">Syslog</a><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B/966835">守护进程</a>等；我们也可以控制每一条日志的输出格式；通过定义每一条日志信息的级别，我们能够更加细致地控制日志的生成过程。最令人感兴趣的就是，这些可以通过一个<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/286550">配置文件</a>来灵活地进行配置，而不需要修改应用的代码。</p>
<p>Log4j是一个组件化设计的日志系统，它的架构大致如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">log.info(&quot;User signed in.&quot;);</span><br><span class="line"> │</span><br><span class="line"> │   ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐</span><br><span class="line"> ├──&gt;│ Appender │───&gt;│  Filter  │───&gt;│  Layout  │───&gt;│ Console  │</span><br><span class="line"> │   └──────────┘    └──────────┘    └──────────┘    └──────────┘</span><br><span class="line"> │</span><br><span class="line"> │   ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐</span><br><span class="line"> ├──&gt;│ Appender │───&gt;│  Filter  │───&gt;│  Layout  │───&gt;│   File   │</span><br><span class="line"> │   └──────────┘    └──────────┘    └──────────┘    └──────────┘</span><br><span class="line"> │</span><br><span class="line"> │   ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐</span><br><span class="line"> └──&gt;│ Appender │───&gt;│  Filter  │───&gt;│  Layout  │───&gt;│  Socket  │</span><br><span class="line">     └──────────┘    └──────────┘    └──────────┘    └──────────┘</span><br></pre></td></tr></table></figure>

<p>当我们使用Log4j输出一条日志时，Log4j自动通过不同的Appender把同一条日志输出到不同的目的地。例如：</p>
<ul>
<li>console：输出到屏幕；</li>
<li>file：输出到文件；</li>
<li>socket：通过网络输出到远程计算机；</li>
<li>jdbc：输出到数据库</li>
</ul>
<p>在输出日志的过程中，通过Filter来过滤哪些log需要被输出，哪些log不需要被输出。例如，仅输出<code>ERROR</code>级别的日志。</p>
<p>最后，通过Layout来格式化日志信息，例如，自动添加日期、时间、方法名称等信息。</p>
<p>上述结构虽然复杂，但我们在实际使用的时候，并不需要关心Log4j的API，而是通过配置文件来配置它。</p>
<h6 id="使用方法："><a href="#使用方法：" class="headerlink" title="使用方法："></a>使用方法：</h6><p>1、导入依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.17.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2、在classpath中添加配置</p>
<h1 id="7、分页"><a href="#7、分页" class="headerlink" title="7、分页"></a>7、分页</h1><p>主要目的使为了减少数据的处理量，就是数据库中的limit；</p>
<p>1、使用Limit处理</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">语法：<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> learnjdbc.user limit startIndex.pageSize;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">from</span> learnjdbc.user limit <span class="number">0.4</span>;</span><br></pre></td></tr></table></figure>

<p>startIndex和pageSize可以用一个map将参数传入，然后实现编辑sql语句的动态改变</p>
<p>2、使用RowBounds实现：</p>
<ol>
<li><p>​    接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;User&gt; <span class="title function_">getUserListByRowBounds</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure></li>
<li><p>实现方法：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserListByRowBounds&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;password=pwd&quot;</span>&gt;</span></span><br><span class="line">     SELECT  * from learnjdbc.user;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>测试类</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">   <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> MybatisUtils.getSqlSession())&#123;</span><br><span class="line">            <span class="type">UserMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line">            <span class="comment">//创建RowBounds对象</span></span><br><span class="line">            <span class="type">RowBounds</span> <span class="variable">rowBounds</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RowBounds</span>(<span class="number">0</span>, <span class="number">3</span>);</span><br><span class="line">            <span class="comment">//通过sqlsession，传入rowBound参数，实现分页查询。</span></span><br><span class="line">            List&lt;User&gt; list = sqlSession.selectList(<span class="string">&quot;com.mybatis.dao.UserMapper.getUserListByRowBounds&quot;</span>, <span class="literal">null</span>, rowBounds);</span><br><span class="line">            <span class="keyword">for</span> (User user : list) &#123;</span><br><span class="line">                System.out.println(user);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="number">7.3</span>、分页插件：</span><br><span class="line"></span><br><span class="line">MyBatis 分页插件 PageHepler</span><br><span class="line"></span><br><span class="line"># <span class="number">8</span>、使用注解开发</span><br><span class="line"></span><br><span class="line">#### 面向接口编程</span><br><span class="line"></span><br><span class="line">**含义**</span><br><span class="line">在一个[面向对象](https:<span class="comment">//baike.baidu.com/item/面向对象)的系统中，系统的各种功能是由许许多多的不同对象协作完成的。在这种情况下，各个对象内部是如何实现自己的,对[系统设计](https://baike.baidu.com/item/系统设计)人员来讲就不那么重要了；而各个对象之间的协作关系则成为系统设计的关键。小到不同类之间的通信，大到各模块之间的交互，在系统设计之初都是要着重考虑的，这也是系统设计的主要工作内容。面向接口编程就是指按照这种思想来编程。</span></span><br><span class="line"><span class="number">1.</span>关于接口的理解。</span><br><span class="line">接口从更深层次的理解，应是定义（规范，约束）与实现（名实分离的原则）的分离。</span><br><span class="line">接口的本身反映了系统设计人员对系统的抽象理解。</span><br><span class="line">接口应有两类：第一类是对一个个体的抽象，它可对应为一个抽象体(<span class="keyword">abstract</span> class)；</span><br><span class="line">第二类是对一个个体某一方面的抽象，即形成一个抽象面（interface）；</span><br><span class="line">一个体有可能有多个抽象面。</span><br><span class="line">抽象体与抽象面是有区别的。</span><br><span class="line"><span class="number">2.</span>设计接口的另一个不可忽视的因素是接口所处的环境(context,environment)，系统论的观点：环境是系统要素所处的空间与外部影响因素的总和。任何接口都是在一定的环境中产生的。因此环境的定义及环境的变化对接口的影响是不容忽视的，脱离原先的环境，所有的接口将失去原有的意义。</span><br><span class="line"><span class="number">3.</span>按照组件的开发模型（3C），它们三者相辅相成，各司一面，浑然一体，缺一不可。</span><br><span class="line">面向对象是指，我们考虑问题时，以对象为单位，考虑它的属性及方法</span><br><span class="line">面向过程是指，我们考虑问题时，以一个具体的流程（事务过程）为单位，考虑它的实现</span><br><span class="line">接口设计与非接口设计是针对复用技术而言的，与面向对象（过程）不是一个问题</span><br><span class="line"></span><br><span class="line">#### 实现办法：</span><br><span class="line"></span><br><span class="line">接口：</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="meta">@Select(&quot;select * from learnjdbc.user;&quot;)</span></span><br><span class="line">    List&lt;User&gt; <span class="title function_">getUserList</span><span class="params">()</span>;</span><br><span class="line">    User <span class="title function_">getUserById</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line">    List&lt;User&gt; <span class="title function_">getUserListByRowBounds</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>mybatis的核心配置文件需要修改mappers，要用mapper class测试：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--绑定接口--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.mybatis.dao.UserMapper&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">try</span> (<span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> MybatisUtils.getSqlSession())&#123;</span><br><span class="line">        <span class="type">UserMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line">        List&lt;User&gt; userList = mapper.getUserList();</span><br><span class="line">        <span class="keyword">for</span> (User user : userList) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="9、mybatis-流程分析"><a href="#9、mybatis-流程分析" class="headerlink" title="9、mybatis 流程分析"></a>9、mybatis 流程分析</h1><h1 id="流程分析"><a href="#流程分析" class="headerlink" title="流程分析"></a>流程分析</h1><p>看上面的示例一个简单的mybatis需要这么几步操作：</p>
<blockquote>
<ol>
<li>读取mybatis的配置文件。</li>
<li>获取SqlSession工厂。</li>
<li>获取SqlSession。</li>
<li>设置操作的Mapper文件。</li>
<li>开始需要的Mapper操作。</li>
</ol>
</blockquote>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Mybatis\流程分析.pang" alt="img"></p>
<h1 id="10、复杂环境训练"><a href="#10、复杂环境训练" class="headerlink" title="10、复杂环境训练"></a>10、复杂环境训练</h1><h4 id="10-1、结果映射（resultMap）"><a href="#10-1、结果映射（resultMap）" class="headerlink" title="10.1、结果映射（resultMap）"></a>10.1、结果映射（resultMap）</h4><ul>
<li><p>constructor</p>
<p>- 用于在实例化类时，注入结果到构造方法中</p>
<ul>
<li><code>idArg</code> - ID 参数；标记出作为 ID 的结果可以帮助提高整体性能</li>
<li><code>arg</code> - 将被注入到构造方法的一个普通结果</li>
</ul>
</li>
<li><p><code>id</code> – 一个 ID 结果；标记出作为 ID 的结果可以帮助提高整体性能</p>
</li>
<li><p><code>result</code> – 注入到字段或 JavaBean 属性的普通结果</p>
</li>
<li><p>association</p>
<p>– 一个复杂类型的关联；许多结果将包装成这种类型</p>
<ul>
<li>嵌套结果映射 – 关联可以是 <code>resultMap</code> 元素，或是对其它结果映射的引用</li>
</ul>
</li>
<li><p>collection</p>
<p>– 一个复杂类型的集合</p>
<ul>
<li>嵌套结果映射 – 集合可以是 <code>resultMap</code> 元素，或是对其它结果映射的引用</li>
</ul>
</li>
<li><p>discriminator</p>
<p>– 使用结果值来决定使用哪个</p>
<p>resultMap</p>
<ul>
<li><p>case</p>
<p>– 基于某些值的结果映射</p>
<ul>
<li>嵌套结果映射 – <code>case</code> 也是一个结果映射，因此具有相同的结构和元素；或者引用其它的结果映射</li>
</ul>
</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th align="left">属性</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>id</code></td>
<td align="left">当前命名空间中的一个唯一标识，用于标识一个结果映射。</td>
</tr>
<tr>
<td align="left"><code>type</code></td>
<td align="left">类的完全限定名, 或者一个类型别名（关于内置的类型别名，可以参考上面的表格）。</td>
</tr>
<tr>
<td align="left"><code>autoMapping</code></td>
<td align="left">如果设置这个属性，MyBatis 将会为本结果映射开启或者关闭自动映射。 这个属性会覆盖全局的属性 autoMappingBehavior。默认值：未设置（unset）。</td>
</tr>
</tbody></table>
<h5 id="10-1-1、关联（association）"><a href="#10-1-1、关联（association）" class="headerlink" title="10.1.1、关联（association）"></a>10.1.1、关联（association）</h5><p>关联（association）元素处理“有一个”类型的关系。 比如，在我们的示例中，一个博客有一个用户。关联结果映射和其它类型的映射工作方式差不多。 你需要指定目标属性名以及属性的<code>javaType</code>（很多时候 MyBatis 可以自己推断出来），在必要的情况下你还可以设置 JDBC 类型，如果你想覆盖获取结果值的过程，还可以设置类型处理器。</p>
<p>关联的不同之处是，你需要告诉 MyBatis 如何加载关联。MyBatis 有两种不同的方式加载关联：</p>
<ul>
<li>嵌套 Select 查询：通过执行另外一个 SQL 映射语句来加载期望的复杂类型。</li>
<li>嵌套结果映射：使用嵌套的结果映射来处理连接结果的重复子集。</li>
</ul>
<p>首先，先让我们来看看这个元素的属性。你将会发现，和普通的结果映射相比，它只在 select 和 resultMap 属性上有所不同。</p>
<table>
<thead>
<tr>
<th align="left">属性</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>property</code></td>
<td align="left">映射到列结果的字段或属性。如果用来匹配的 JavaBean 存在给定名字的属性，那么它将会被使用。否则 MyBatis 将会寻找给定名称的字段。 无论是哪一种情形，你都可以使用通常的点式分隔形式进行复杂属性导航。 比如，你可以这样映射一些简单的东西：“username”，或者映射到一些复杂的东西上：“address.street.number”。</td>
</tr>
<tr>
<td align="left"><code>javaType</code></td>
<td align="left">一个 Java 类的完全限定名，或一个类型别名（关于内置的类型别名，可以参考上面的表格）。 如果你映射到一个 JavaBean，MyBatis 通常可以推断类型。然而，如果你映射到的是 HashMap，那么你应该明确地指定 javaType 来保证行为与期望的相一致。</td>
</tr>
<tr>
<td align="left"><code>jdbcType</code></td>
<td align="left">JDBC 类型，所支持的 JDBC 类型参见这个表格之前的“支持的 JDBC 类型”。 只需要在可能执行插入、更新和删除的且允许空值的列上指定 JDBC 类型。这是 JDBC 的要求而非 MyBatis 的要求。如果你直接面向 JDBC 编程，你需要对可能存在空值的列指定这个类型。</td>
</tr>
<tr>
<td align="left"><code>typeHandler</code></td>
<td align="left">我们在前面讨论过默认的类型处理器。使用这个属性，你可以覆盖默认的类型处理器。 这个属性值是一个类型处理器实现类的完全限定名，或者是类型别名。</td>
</tr>
</tbody></table>
<h5 id="10-1-2、关联的嵌套-Select-查询"><a href="#10-1-2、关联的嵌套-Select-查询" class="headerlink" title="10.1.2、关联的嵌套 Select 查询"></a>10.1.2、关联的嵌套 Select 查询</h5><table>
<thead>
<tr>
<th align="left">属性</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>column</code></td>
<td align="left">数据库中的列名，或者是列的别名。一般情况下，这和传递给 <code>resultSet.getString(columnName)</code> 方法的参数一样。 注意：在使用复合主键的时候，你可以使用 <code>column=&quot;&#123;prop1=col1,prop2=col2&#125;&quot;</code> 这样的语法来指定多个传递给嵌套 Select 查询语句的列名。这会使得 <code>prop1</code> 和 <code>prop2</code> 作为参数对象，被设置为对应嵌套 Select 语句的参数。</td>
</tr>
<tr>
<td align="left"><code>select</code></td>
<td align="left">用于加载复杂类型属性的映射语句的 ID，它会从 column 属性指定的列中检索数据，作为参数传递给目标 select 语句。 具体请参考下面的例子。注意：在使用复合主键的时候，你可以使用 <code>column=&quot;&#123;prop1=col1,prop2=col2&#125;&quot;</code> 这样的语法来指定多个传递给嵌套 Select 查询语句的列名。这会使得 <code>prop1</code> 和 <code>prop2</code> 作为参数对象，被设置为对应嵌套 Select 语句的参数。</td>
</tr>
<tr>
<td align="left"><code>fetchType</code></td>
<td align="left">可选的。有效值为 <code>lazy</code> 和 <code>eager</code>。 指定属性后，将在映射中忽略全局配置参数 <code>lazyLoadingEnabled</code>，使用属性的值。</td>
</tr>
</tbody></table>
<h5 id="10-1-3、集合"><a href="#10-1-3、集合" class="headerlink" title="10.1.3、集合"></a>10.1.3、集合</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;collection property=&quot;posts&quot; ofType=&quot;domain.blog.Post&quot;&gt;</span><br><span class="line">  &lt;id property=&quot;id&quot; column=&quot;post_id&quot;/&gt;</span><br><span class="line">  &lt;result property=&quot;subject&quot; column=&quot;post_subject&quot;/&gt;</span><br><span class="line">  &lt;result property=&quot;body&quot; column=&quot;post_body&quot;/&gt;</span><br><span class="line">&lt;/collection&gt;</span><br></pre></td></tr></table></figure>

<p>集合元素和关联元素几乎是一样的，它们相似的程度之高，以致于没有必要再介绍集合元素的相似部分。 所以让我们来关注它们的不同之处吧。</p>
<p>我们来继续上面的示例，一个博客（Blog）只有一个作者（Author)。但一个博客有很多文章（Post)。 在博客类中，这可以用下面的写法来表示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">private List&lt;Post&gt; posts;</span><br></pre></td></tr></table></figure>

<p>要像上面这样，映射嵌套结果集合到一个 List 中，可以使用集合元素。 和关联元素一样，我们可以使用嵌套 Select 查询，或基于连接的嵌套结果映射集合。</p>
<h5 id="10-1-4、集合的嵌套-Select-查询"><a href="#10-1-4、集合的嵌套-Select-查询" class="headerlink" title="10.1.4、集合的嵌套 Select 查询"></a>10.1.4、集合的嵌套 Select 查询</h5><p>首先，让我们看看如何使用嵌套 Select 查询来为博客加载文章。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;resultMap id=&quot;blogResult&quot; type=&quot;Blog&quot;&gt;</span><br><span class="line">  &lt;collection property=&quot;posts&quot; javaType=&quot;ArrayList&quot; column=&quot;id&quot; ofType=&quot;Post&quot; select=&quot;selectPostsForBlog&quot;/&gt;</span><br><span class="line">&lt;/resultMap&gt;</span><br><span class="line"></span><br><span class="line">&lt;select id=&quot;selectBlog&quot; resultMap=&quot;blogResult&quot;&gt;</span><br><span class="line">  SELECT * FROM BLOG WHERE ID = #&#123;id&#125;</span><br><span class="line">&lt;/select&gt;</span><br><span class="line"></span><br><span class="line">&lt;select id=&quot;selectPostsForBlog&quot; resultType=&quot;Post&quot;&gt;</span><br><span class="line">  SELECT * FROM POST WHERE BLOG_ID = #&#123;id&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<p>你可能会立刻注意到几个不同，但大部分都和我们上面学习过的关联元素非常相似。 首先，你会注意到我们使用的是集合元素。 接下来你会注意到有一个新的 “ofType” 属性。这个属性非常重要，它用来将 JavaBean（或字段）属性的类型和集合存储的类型区分开来。 所以你可以按照下面这样来阅读映射：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;collection property=&quot;posts&quot; javaType=&quot;ArrayList&quot; column=&quot;id&quot; ofType=&quot;Post&quot; select=&quot;selectPostsForBlog&quot;/&gt;</span><br></pre></td></tr></table></figure>

<p>读作： “posts 是一个存储 Post 的 ArrayList 集合”</p>
<p>在一般情况下，MyBatis 可以推断 javaType 属性，因此并不需要填写。所以很多时候你可以简略成：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;collection property=&quot;posts&quot; column=&quot;id&quot; ofType=&quot;Post&quot; select=&quot;selectPostsForBlog&quot;/&gt;</span><br></pre></td></tr></table></figure>



<h4 id="10-2、多对一环境搭建"><a href="#10-2、多对一环境搭建" class="headerlink" title="10.2、多对一环境搭建"></a>10.2、多对一环境搭建</h4><p>数据库创建teacher、student表并插入字段：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> `teacher`(</span><br><span class="line">    `id` <span class="type">int</span>(<span class="number">10</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    `name` <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">default</span> <span class="keyword">null</span>,</span><br><span class="line">    <span class="keyword">primary</span> key (`id`)</span><br><span class="line">    ) engine<span class="operator">=</span>innodb <span class="keyword">default</span> charset<span class="operator">=</span>utf8;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> teacher(`id`,`name`) <span class="keyword">values</span> (<span class="number">1</span>,<span class="string">&#x27;王老师&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> `student`(</span><br><span class="line">    `id` <span class="type">int</span>(<span class="number">10</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    `name` <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">default</span> <span class="keyword">null</span>,</span><br><span class="line">    `tid` <span class="type">int</span>(<span class="number">10</span>) <span class="keyword">default</span> <span class="keyword">null</span>,</span><br><span class="line">    <span class="keyword">primary</span> key (`id`),</span><br><span class="line">    key `fktid` (`tid`),</span><br><span class="line">    <span class="keyword">constraint</span> `fktid` <span class="keyword">foreign</span> key (`tid`) <span class="keyword">references</span> `teacher` (`id`)</span><br><span class="line">    )  engine<span class="operator">=</span>innodb <span class="keyword">default</span> charset<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> `student` (`id`,`name`,`tid`) <span class="keyword">values</span> (<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;小红&#x27;</span>,<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> `student` (`id`,`name`,`tid`) <span class="keyword">values</span> (<span class="string">&#x27;2&#x27;</span>,<span class="string">&#x27;小蓝&#x27;</span>,<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> `student` (`id`,`name`,`tid`) <span class="keyword">values</span> (<span class="string">&#x27;3&#x27;</span>,<span class="string">&#x27;小白&#x27;</span>,<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> `student` (`id`,`name`,`tid`) <span class="keyword">values</span> (<span class="string">&#x27;4&#x27;</span>,<span class="string">&#x27;小青&#x27;</span>,<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> `student` (`id`,`name`,`tid`) <span class="keyword">values</span> (<span class="string">&#x27;5&#x27;</span>,<span class="string">&#x27;小绿&#x27;</span>,<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> `student` (`id`,`name`,`tid`) <span class="keyword">values</span> (<span class="string">&#x27;6&#x27;</span>,<span class="string">&#x27;小黄&#x27;</span>,<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> `student` (`id`,`name`,`tid`) <span class="keyword">values</span> (<span class="string">&#x27;7&#x27;</span>,<span class="string">&#x27;小紫&#x27;</span>,<span class="string">&#x27;1&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><code>lombok</code>能够利用注解快速的撞见<code>Get、Set、构造方法</code>等。<br>导入lombok依赖：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;<span class="number">1.18</span><span class="number">.22</span>&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>

<p>创建实体<code>Teacher</code>、<code>Student</code>类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Teacher</span> &#123;</span><br><span class="line">    <span class="keyword">private</span>  <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span>  String name;</span><br><span class="line"><span class="comment">//    private  Set&lt;Student&gt; students;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">private</span>  <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span>  String name;</span><br><span class="line">    <span class="keyword">private</span>  Teacher teacher;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>创建mapper接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">TeacherMapper</span> &#123;</span><br><span class="line">    <span class="meta">@Select(&quot;select * from teacher where id=#&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Student <span class="title function_">selectTeacherByID</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> <span class="type">int</span> id)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">StudentMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select * from student where id=#&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Student <span class="title function_">selectStudentByID</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> <span class="type">int</span> id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将<code>mapper</code>接口绑定注册到<code>mybatis</code>的配置文件中:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.mybatis.dao.UserMapper&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.mybatis.dao.StudentMapper&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.mybatis.dao.TeacherMapper&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>编写测试类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> MybatisUtils.getSqlSession();)&#123;</span><br><span class="line">            <span class="type">StudentMapper</span> <span class="variable">studentMapper</span> <span class="operator">=</span> sqlSession.getMapper(StudentMapper.class);</span><br><span class="line">            <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> studentMapper.selectStudentByID(<span class="number">2</span>);</span><br><span class="line">            System.out.println(student);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="10-2-1、按照嵌套查询处理："><a href="#10-2-1、按照嵌套查询处理：" class="headerlink" title="10.2.1、按照嵌套查询处理："></a>10.2.1、按照嵌套查询处理：</h5><p><code>javaType=&quot;Teacher&quot;</code>确定association中返回的对象的类型，<code>column</code>确定向嵌套的<code>select</code>中注入的参数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF8&quot;</span> ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">        PUBLIC <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="line">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;com.mybatis.dao.StudentMapper&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;select id=<span class="string">&quot;selectStudent&quot;</span> resultMap=<span class="string">&quot;StudentTeacher&quot;</span>&gt;</span><br><span class="line">        select *  from learnjdbc.student</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;select id=<span class="string">&quot;selectStudentByID&quot;</span> parameterType=<span class="string">&quot;int&quot;</span> resultMap=<span class="string">&quot;StudentTeacher&quot;</span>&gt;</span><br><span class="line">        select *  from learnjdbc.student where id=#&#123;id&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;resultMap id=<span class="string">&quot;StudentTeacher&quot;</span> type=<span class="string">&quot;Student&quot;</span>&gt;</span><br><span class="line">        &lt;association property=<span class="string">&quot;teacher&quot;</span> column=<span class="string">&quot;tid&quot;</span>  javaType=<span class="string">&quot;Teacher&quot;</span> select=<span class="string">&quot;getTeacher&quot;</span>/&gt;</span><br><span class="line">    &lt;/resultMap&gt;</span><br><span class="line">    &lt;select id=<span class="string">&quot;getTeacher&quot;</span> resultType=<span class="string">&quot;Teacher&quot;</span>&gt;</span><br><span class="line">        select * from teacher where id=#&#123;id&#125;;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line"></span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (<span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> MybatisUtils.getSqlSession();)&#123;</span><br><span class="line">            <span class="type">StudentMapper</span> <span class="variable">studentMapper</span> <span class="operator">=</span> sqlSession.getMapper(StudentMapper.class);</span><br><span class="line">            <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> studentMapper.selectStudentByID(<span class="number">2</span>);</span><br><span class="line">            System.out.println(student);</span><br><span class="line">            List&lt;Student&gt; studentList = studentMapper.selectStudent();</span><br><span class="line">            <span class="keyword">for</span> (Student student1 : studentList) &#123;</span><br><span class="line">                System.out.println(student1);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>



<h5 id="10-2-2、按照结果嵌套处理："><a href="#10-2-2、按照结果嵌套处理：" class="headerlink" title="10.2.2、按照结果嵌套处理："></a>10.2.2、按照结果嵌套处理：</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectStudent2&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;StudentTeacher2&quot;</span> &gt;</span></span><br><span class="line">        select s.id sid, s.name sname,s.tid tid,t.name tname from student s,teacher t where s.tid=t.id;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;StudentTeacher2&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Student&quot;</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sid&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sname&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;teacher&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;Teacher&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;tid&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;tname&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (<span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> MybatisUtils.getSqlSession();)&#123;</span><br><span class="line">           <span class="type">StudentMapper</span> <span class="variable">studentMapper</span> <span class="operator">=</span> sqlSession.getMapper(StudentMapper.class);</span><br><span class="line">           List&lt;Student&gt; students = studentMapper.selectStudent2();</span><br><span class="line">           <span class="keyword">for</span> (Student student : students) &#123;</span><br><span class="line">               System.out.println(student);</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>

<h4 id="10-2、一对多环境搭建"><a href="#10-2、一对多环境搭建" class="headerlink" title="10.2、一对多环境搭建"></a>10.2、一对多环境搭建</h4><p>实体类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">private</span>  <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span>  String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> tid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Teacher 中有Student的集合。</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Teacher</span> &#123;</span><br><span class="line">    <span class="keyword">private</span>  <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span>  String name;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Student&gt; students;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接口:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">TeacherMapper</span> &#123;</span><br><span class="line"><span class="comment">//    @Select(&quot;select * from teacher where id=#&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Teacher <span class="title function_">selectTeacherByID</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="10-2-1、集合的嵌套-Select-查询"><a href="#10-2-1、集合的嵌套-Select-查询" class="headerlink" title="10.2.1、集合的嵌套 Select 查询"></a>10.2.1、集合的嵌套 Select 查询</h5><p>javaType指定返回的集合类型，ofType指定集合中的元素的类型，select指定嵌套查询的语句</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.mybatis.dao.TeacherMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectTeacherByID&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;TeacherStudent&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">        select * from teacher where id=#&#123;id&#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;TeacherStudent&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Teacher&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;students&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;ArrayList&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;Student&quot;</span>  <span class="attr">select</span>=<span class="string">&quot;getStudents&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getStudents&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Student&quot;</span> &gt;</span></span><br><span class="line">        select * from student where tid=#&#123;tid&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>测试代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="keyword">try</span> (SqlSession sqlSession=MybatisUtils.getSqlSession())&#123;</span><br><span class="line">           <span class="type">TeacherMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(TeacherMapper.class);</span><br><span class="line">           <span class="type">Teacher</span> <span class="variable">teacher</span> <span class="operator">=</span> mapper.selectTeacherByID(<span class="number">1</span>);</span><br><span class="line">           System.out.println(teacher);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h5 id="10-2-2、集合的嵌套结果映射"><a href="#10-2-2、集合的嵌套结果映射" class="headerlink" title="10.2.2、集合的嵌套结果映射"></a>10.2.2、集合的嵌套结果映射</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectTeacher&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;TeacherStudent2&quot;</span> &gt;</span></span><br><span class="line">       select t.name as tname,t.id as id,s.id as sid ,s.name as sname ,s.tid as tid from teacher t,student s where t.id=s.tid ;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;TeacherStudent2&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Teacher&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;tname&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;students&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;Student&quot;</span> &gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sid&quot;</span>/&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sname&quot;</span>/&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;tid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;tid&quot;</span>/&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>查询结果中用collection来接受属性是集合集的字段。</p>
<p>总结：</p>
<ol>
<li>关联-association（多对一）</li>
<li>集合-collection（一对多）<ol>
<li>JavaType 用来指定实体类中属性的类型</li>
<li>ofType用来指定映射到List或者集合中的实体类类型，泛型中的约束类型。</li>
</ol>
</li>
</ol>
<h1 id="11、动态SQL查询"><a href="#11、动态SQL查询" class="headerlink" title="11、动态SQL查询"></a>11、动态SQL查询</h1><p>动态的生成sql语句。</p>
<h4 id="11-1、搭建环境"><a href="#11-1、搭建环境" class="headerlink" title="11.1、搭建环境"></a>11.1、搭建环境</h4><p>数据库中创建表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `blog` (</span><br><span class="line">	`id` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;博客id&#x27;</span>,</span><br><span class="line"> 	`title` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;博客标题&#x27;</span>,</span><br><span class="line">    `author` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;博客作者&#x27;</span>,</span><br><span class="line">    `create_time` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">    `views` <span class="type">int</span>(<span class="number">30</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;浏览量&#x27;</span></span><br><span class="line">)ENGINE<span class="operator">=</span>INNODB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure>

<p>创建实体类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Blog</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> String author;</span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> views;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建DAO接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BlogMapper</span> &#123;</span><br><span class="line">   <span class="type">int</span> <span class="title function_">addBlog</span><span class="params">(Blog blog)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建Mapper.xml实现sql查询语句：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.mybatis.dao.BlogMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addBlog&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Blog&quot;</span>&gt;</span></span><br><span class="line">        insert into blog(id,title,author,create_time,views) values (#&#123;id&#125;,#&#123;title&#125;,#&#123;author&#125;,#&#123;createTime&#125;,#&#123;views&#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>创建工具类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisUtils</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SqlSessionFactory sqlSessionFactory;</span><br><span class="line">    <span class="comment">//获取sqlsessionFactory的对象</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;mybatis-config.xml&quot;</span>;</span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);</span><br><span class="line">            sqlSessionFactory = <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//从sqlsessionfacory中创建sqlsession实例</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SqlSession <span class="title function_">getSqlSession</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;all&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IDutils</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getID</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//生成唯一的UUID，返回值为String类型</span></span><br><span class="line">        <span class="keyword">return</span> UUID.randomUUID().toString().replaceAll(<span class="string">&quot;-&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将mapper接口注册到mybatis的配置文件中</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--configuration核心配置文件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--    导入外部配置文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;db.properties&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&amp;lt;!&amp;ndash;设置日志&amp;ndash;&amp;gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    &lt;settings&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;setting name=&quot;logImpl&quot; value=&quot;STDOUT_LOGGING&quot;/&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    &lt;/settings&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--是否开启驼峰命名自动映射，即从经典数据库列名 A_COLUMN 映射到经典 Java 属性名 aColumn--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--设置别名--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.mybatis.pojo&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;username&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;password&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--注册接口--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.mybatis.dao.BlogMapper&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>添加测试数据：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> (SqlSession sqlSession= MybatisUtils.getSqlSession();)&#123;</span><br><span class="line">            <span class="type">BlogMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(BlogMapper.class);</span><br><span class="line">            mapper.addBlog(<span class="keyword">new</span> <span class="title class_">Blog</span>(IDutils.getID(),<span class="string">&quot;Robert.pang学Java&quot;</span>,<span class="string">&quot;Robert&quot;</span>,<span class="keyword">new</span> <span class="title class_">Date</span>(),<span class="number">999</span>));</span><br><span class="line">            mapper.addBlog(<span class="keyword">new</span> <span class="title class_">Blog</span>(IDutils.getID(),<span class="string">&quot;Robert.pang学Spring&quot;</span>,<span class="string">&quot;Robert&quot;</span>,<span class="keyword">new</span> <span class="title class_">Date</span>(),<span class="number">999</span>));</span><br><span class="line">            mapper.addBlog(<span class="keyword">new</span> <span class="title class_">Blog</span>(IDutils.getID(),<span class="string">&quot;Robert.pang学Mybatis&quot;</span>,<span class="string">&quot;Robert&quot;</span>,<span class="keyword">new</span> <span class="title class_">Date</span>(),<span class="number">999</span>));</span><br><span class="line">            mapper.addBlog(<span class="keyword">new</span> <span class="title class_">Blog</span>(IDutils.getID(),<span class="string">&quot;Robert.pang学SpringBoot&quot;</span>,<span class="string">&quot;Robert&quot;</span>,<span class="keyword">new</span> <span class="title class_">Date</span>(),<span class="number">1000</span>));</span><br><span class="line">            sqlSession.commit();</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>



<h4 id="11-2、IF"><a href="#11-2、IF" class="headerlink" title="11.2、IF"></a>11.2、IF</h4><p>if标签可以动态的增加sql语句的判断条件，但是不能自动的为语句增加或者删除条件之间的判断关键字，比如and or</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectBlogIF&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;map&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Blog&quot;</span>&gt;</span></span><br><span class="line">    select * from blog where 1=1</span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;title!=null&quot;</span>&gt;</span></span><br><span class="line">        and title=#&#123;title&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;author!=null&quot;</span>&gt;</span></span><br><span class="line">        and author=#&#123;author&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="11-3、choose、when、otherwise"><a href="#11-3、choose、when、otherwise" class="headerlink" title="11.3、choose、when、otherwise"></a>11.3、choose、when、otherwise</h4><p>choose标签可以实现，多个条件中只执行其中一个标签的作用，类似于switch循环：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectBlogIF&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;map&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Blog&quot;</span>&gt;</span></span><br><span class="line">        select * from blog where 1=1</span><br><span class="line">    <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;title!=null&quot;</span>&gt;</span></span><br><span class="line">            and title=#&#123;title&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;author!=null&quot;</span>&gt;</span></span><br><span class="line">            and author=#&#123;author&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">            and veiws=#&#123;veiws&#125;</span><br><span class="line">         <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (<span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> MybatisUtils.getSqlSession())&#123;</span><br><span class="line">            <span class="type">BlogMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(BlogMapper.class);</span><br><span class="line">            <span class="type">HashMap</span> <span class="variable">hashMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">            <span class="comment">//hashMap.put(&quot;title&quot;,&quot;Robert.pang学Java&quot;);</span></span><br><span class="line">            hashMap.put(<span class="string">&quot;author&quot;</span>,<span class="string">&quot;Robert&quot;</span>);</span><br><span class="line">            hashMap.put(<span class="string">&quot;views&quot;</span>,<span class="number">999</span>);</span><br><span class="line">            List&lt;Blog&gt; blogs = mapper.selectBlogIF(hashMap);</span><br><span class="line">            <span class="keyword">for</span> (Blog blog : blogs) &#123;</span><br><span class="line">                System.out.println(blog);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//控制台产生的对应的sql语句，因为有title不为空，产生的sql语句中就没有and title，而author为非空，后边的views条件就没有增加。</span></span><br><span class="line">==&gt;  Preparing: select * from blog where <span class="number">1</span>=<span class="number">1</span> and author=? </span><br><span class="line">==&gt; Parameters: Robert(String)</span><br><span class="line">&lt;==    Columns: id, title, author, create_time, views</span><br><span class="line">&lt;==        Row: 1ec2882f2250436db93aec41efc75142, Robert.pang学Java, Robert, <span class="number">2022</span>-<span class="number">04</span>-<span class="number">20</span> <span class="number">23</span>:<span class="number">50</span>:<span class="number">06.0</span>, <span class="number">999</span></span><br><span class="line">&lt;==        Row: 56b57f9436bb4e38af69de570906030c, Robert.pang学Spring, Robert, <span class="number">2022</span>-<span class="number">04</span>-<span class="number">20</span> <span class="number">23</span>:<span class="number">50</span>:<span class="number">06.0</span>, <span class="number">999</span></span><br><span class="line">&lt;==        Row: 575693301aa74ff8a58d96b297e7fb35, Robert.pang学Mybatis, Robert, <span class="number">2022</span>-<span class="number">04</span>-<span class="number">20</span> <span class="number">23</span>:<span class="number">50</span>:<span class="number">06.0</span>, <span class="number">999</span></span><br><span class="line">&lt;==        Row: 43ecccec21294dca9df4f7169c84638b, Robert.pang学SpringBoot, Robert, <span class="number">2022</span>-<span class="number">04</span>-<span class="number">20</span> <span class="number">23</span>:<span class="number">50</span>:<span class="number">06.0</span>, <span class="number">1000</span></span><br><span class="line">&lt;==      Total: <span class="number">4</span></span><br></pre></td></tr></table></figure>

<h4 id="11-4、trim、where、set"><a href="#11-4、trim、where、set" class="headerlink" title="11.4、trim、where、set"></a>11.4、trim、where、set</h4><p><em>where</em> 元素只会在子元素返回任何内容的情况下才插入 “WHERE” 子句。而且，若子句的开头为 “AND” 或 “OR”，<em>where</em> 元素也会将它们去除。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectBlogIF&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;map&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Blog&quot;</span>&gt;</span></span><br><span class="line">        select * from blog</span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;title!=null&quot;</span>&gt;</span></span><br><span class="line">                    and title=#&#123;title&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;author!=null&quot;</span>&gt;</span></span><br><span class="line">                    and author=#&#123;author&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">                    and veiws=#&#123;veiws&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (<span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> MybatisUtils.getSqlSession())&#123;</span><br><span class="line">            <span class="type">BlogMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(BlogMapper.class);</span><br><span class="line">            <span class="type">HashMap</span> <span class="variable">hashMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">            <span class="comment">//hashMap.put(&quot;title&quot;,&quot;Robert.pang学Java&quot;);</span></span><br><span class="line">            hashMap.put(<span class="string">&quot;author&quot;</span>,<span class="string">&quot;Robert&quot;</span>);</span><br><span class="line">            hashMap.put(<span class="string">&quot;views&quot;</span>,<span class="number">999</span>);</span><br><span class="line">            List&lt;Blog&gt; blogs = mapper.selectBlogIF(hashMap);</span><br><span class="line">            <span class="keyword">for</span> (Blog blog : blogs) &#123;</span><br><span class="line">                System.out.println(blog);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>产生的sql语句：select * from blog WHERE author=? ，xml文件中的and符号已经被去除掉了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">==&gt;  Preparing: select * from blog WHERE author=? </span><br><span class="line">==&gt; Parameters: Robert(String)</span><br><span class="line">&lt;==    Columns: id, title, author, create_time, views</span><br><span class="line">&lt;==        Row: 1ec2882f2250436db93aec41efc75142, Robert.pang学Java, Robert, <span class="number">2022</span>-<span class="number">04</span>-<span class="number">20</span> <span class="number">23</span>:<span class="number">50</span>:<span class="number">06.0</span>, <span class="number">999</span></span><br><span class="line">&lt;==        Row: 56b57f9436bb4e38af69de570906030c, Robert.pang学Spring, Robert, <span class="number">2022</span>-<span class="number">04</span>-<span class="number">20</span> <span class="number">23</span>:<span class="number">50</span>:<span class="number">06.0</span>, <span class="number">999</span></span><br><span class="line">&lt;==        Row: 575693301aa74ff8a58d96b297e7fb35, Robert.pang学Mybatis, Robert, <span class="number">2022</span>-<span class="number">04</span>-<span class="number">20</span> <span class="number">23</span>:<span class="number">50</span>:<span class="number">06.0</span>, <span class="number">999</span></span><br><span class="line">&lt;==        Row: 43ecccec21294dca9df4f7169c84638b, Robert.pang学SpringBoot, Robert, <span class="number">2022</span>-<span class="number">04</span>-<span class="number">20</span> <span class="number">23</span>:<span class="number">50</span>:<span class="number">06.0</span>, <span class="number">1000</span></span><br><span class="line">&lt;==      Total: <span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>同样 set 标签也是达到类似功能，set标签就是将为语句自动删除<code>，</code>从而来保证语句正常</p>
<p>这个例子中，<em>set</em> 元素会动态地在行首插入 SET 关键字，并会删掉额外的逗号（这些逗号是在使用条件语句给列赋值时引入的）。</p>
<p>trim 可以定制化添加和删除关键字。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;WHERE&quot;</span> <span class="attr">prefixOverrides</span>=<span class="string">&quot;AND |OR &quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;SET&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>属性</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>prefix</td>
<td>给sql语句拼接的前缀</td>
</tr>
<tr>
<td>suffix</td>
<td>给sql语句拼接的后缀</td>
</tr>
<tr>
<td>prefixOverrides</td>
<td>去除sql语句前面的关键字或者字符，该关键字或者字符由prefixOverrides属性指定，假设该属性指定为”AND”，当sql语句的开头为”AND”，trim标签将会去除该”AND”</td>
</tr>
<tr>
<td>suffixOverrides</td>
<td>去除sql语句后面的关键字或者字符，该关键字或者字符由suffixOverrides属性指定</td>
</tr>
</tbody></table>
<h4 id="11-5、foreach"><a href="#11-5、foreach" class="headerlink" title="11.5、foreach"></a>11.5、foreach</h4><p>动态 SQL 的另一个常见使用场景是对集合进行遍历（尤其是在构建 IN 条件语句的时候）。比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;selectPostIn&quot; resultType=&quot;domain.blog.Post&quot;&gt;</span><br><span class="line">  SELECT *</span><br><span class="line">  FROM POST P</span><br><span class="line">  WHERE ID in</span><br><span class="line">  &lt;foreach item=&quot;item&quot; index=&quot;index&quot; collection=&quot;list&quot;</span><br><span class="line">      open=&quot;(&quot; separator=&quot;,&quot; close=&quot;)&quot;&gt;</span><br><span class="line">        #&#123;item&#125;</span><br><span class="line">  &lt;/foreach&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<p><em>foreach</em> 元素的功能非常强大，它允许你指定一个集合，声明可以在元素体内使用的集合项（item）和索引（index）变量。它也允许你指定开头与结尾的字符串以及集合项迭代之间的分隔符。这个元素也不会错误地添加多余的分隔符，看它多智能！</p>
<p><strong>提示</strong> 你可以将任何可迭代对象（如 List、Set 等）、Map 对象或者数组对象作为集合参数传递给 <em>foreach</em>。当使用可迭代对象或者数组时，index 是当前迭代的序号，item 的值是本次迭代获取到的元素。当使用 Map 对象（或者 Map.Entry 对象的集合）时，index 是键，item 是值。</p>
<h1 id="12、Mysql缓存"><a href="#12、Mysql缓存" class="headerlink" title="12、Mysql缓存"></a>12、Mysql缓存</h1><h4 id="12-1、简介"><a href="#12-1、简介" class="headerlink" title="12.1、简介"></a>12.1、简介</h4><p>缓存就是将经常进行交互的数据存放在内存中，从缓存中直接查询，速度会有很大的提升，解决了高并发的系统的性能问题。</p>
<p>缓存的作用：减少和数据库的交互次数，减小系统开销，提高系统效率。</p>
<p>什么样的数据能够使用缓存：经常查询并不经常改变的数据。</p>
<h4 id="12-2-Mybatis缓存"><a href="#12-2-Mybatis缓存" class="headerlink" title="12.2 Mybatis缓存"></a>12.2 <code>Mybatis</code>缓存</h4><p>Mybatis 使用到了两种缓存：本地缓存（local cache）和二级缓存（second level cache）。</p>
<ul>
<li>默认情况下，只有一级缓存开启（SqlSession级别的缓存，也称之为本地缓存）。</li>
<li>二级缓存需要手动开启和配置，二级缓存是基于namespace级别的缓存。</li>
<li>为了提高拓展性，Mybatis定义了缓存接口Cache，我们可以通过实现Cache接口来自定义二级缓存。</li>
</ul>
<h4 id="12-3-一级缓存"><a href="#12-3-一级缓存" class="headerlink" title="12.3 一级缓存"></a>12.3 一级缓存</h4><p>每当一个新 session 被创建，MyBatis 就会创建一个与之相关联的本地缓存。任何在 session 执行过的查询结果都会被保存在本地缓存中，所以，当再次执行参数相同的相同查询时，就不需要实际查询数据库了。本地缓存将会在做出修改、事务提交或回滚，以及关闭 session 时清空。</p>
<p>默认情况下，本地缓存数据的生命周期等同于整个 session 的周期。由于缓存会被用来解决循环引用问题和加快重复嵌套查询的速度，所以无法将其完全禁用。但是你可以通过设置 localCacheScope=STATEMENT 来只在语句执行时使用缓存。</p>
<p>注意，如果 localCacheScope 被设置为 SESSION，对于某个对象，MyBatis 将返回在本地缓存中唯一对象的引用。对返回的对象（例如 list）做出的任何修改将会影响本地缓存的内容，进而将会影响到在本次 session 中从缓存返回的值。因此，不要对 MyBatis 所返回的对象作出更改，以防后患。</p>
<p>总结：本地缓存是SqlSession级别的，与数据库同一次会话期间查询到的数据会放在本地缓存中，以后如果需要获取相同的数据，直接从缓存中拿，没必要去查询数据库。</p>
<h4 id="12-4、二级缓存"><a href="#12-4、二级缓存" class="headerlink" title="12.4、二级缓存"></a>12.4、二级缓存</h4><p>默认情况下，只启用了本地的会话缓存，它仅仅对一个会话中的数据进行缓存。 要启用全局的二级缓存，只需要在你的 SQL 映射文件中添加一行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;cache/&gt;</span><br></pre></td></tr></table></figure>

<p>基本上就是这样。这个简单语句的效果如下:</p>
<ul>
<li>映射语句文件中的所有 select 语句的结果将会被缓存。</li>
<li>映射语句文件中的所有 insert、update 和 delete 语句会刷新缓存。</li>
<li>缓存会使用最近最少使用算法（LRU, Least Recently Used）算法来清除不需要的缓存。</li>
<li>缓存不会定时进行刷新（也就是说，没有刷新间隔）。</li>
<li>缓存会保存列表或对象（无论查询方法返回哪种）的 1024 个引用。</li>
<li>缓存会被视为读/写缓存，这意味着获取到的对象并不是共享的，可以安全地被调用者修改，而不干扰其他调用者或线程所做的潜在修改。</li>
</ul>
<p><strong>提示</strong> 缓存只作用于 cache 标签所在的映射文件中的语句。如果你混合使用 Java API 和 XML 映射文件，在共用接口中的语句将不会被默认缓存。你需要使用 @CacheNamespaceRef 注解指定缓存作用域。</p>
<p>这些属性可以通过 cache 元素的属性来修改。比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;cache</span><br><span class="line">  eviction=&quot;FIFO&quot;</span><br><span class="line">  flushInterval=&quot;60000&quot;</span><br><span class="line">  size=&quot;512&quot;</span><br><span class="line">  readOnly=&quot;true&quot;/&gt;</span><br></pre></td></tr></table></figure>

<p>这个更高级的配置创建了一个 FIFO 缓存，每隔 60 秒刷新，最多可以存储结果对象或列表的 512 个引用，而且返回的对象被认为是只读的，因此对它们进行修改可能会在不同线程中的调用者产生冲突。</p>
<p>可用的清除策略有：</p>
<ul>
<li><code>LRU</code> – 最近最少使用：移除最长时间不被使用的对象。</li>
<li><code>FIFO</code> – 先进先出：按对象进入缓存的顺序来移除它们。</li>
<li><code>SOFT</code> – 软引用：基于垃圾回收器状态和软引用规则移除对象。</li>
<li><code>WEAK</code> – 弱引用：更积极地基于垃圾收集器状态和弱引用规则移除对象。</li>
</ul>
<p>默认的清除策略是 LRU。</p>
<p>flushInterval（刷新间隔）属性可以被设置为任意的正整数，设置的值应该是一个以毫秒为单位的合理时间量。 默认情况是不设置，也就是没有刷新间隔，缓存仅仅会在调用语句时刷新。</p>
<p>size（引用数目）属性可以被设置为任意正整数，要注意欲缓存对象的大小和运行环境中可用的内存资源。默认值是 1024。</p>
<p>readOnly（只读）属性可以被设置为 true 或 false。只读的缓存会给所有调用者返回缓存对象的相同实例。 因此这些对象不能被修改。这就提供了可观的性能提升。而可读写的缓存会（通过序列化）返回缓存对象的拷贝。 速度上会慢一些，但是更安全，因此默认值是 false。</p>
<p><strong>提示</strong> 二级缓存是事务性的。这意味着，当 SqlSession 完成并提交时，或是完成并回滚，但没有执行 flushCache=true 的 insert/delete/update 语句时，缓存会获得更新。</p>
<p>总结：</p>
<ol>
<li>只要开启了二级缓存，在同一个Mapper下就有效。</li>
<li>所有的数据都会先放在一级缓存中</li>
<li>只有当前会话提交，或者关闭的时候，才会提交到二级缓存中。</li>
</ol>
<p>开启二级缓存操作</p>
<ol>
<li><p>mybatis核心配置文件中配置：</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--        开启全局缓存--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;cacheEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p> SQL 映射文件中添加一行：</p>
</li>
</ol>
   <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>查询 </p>
<h4 id="12-5、自定义缓存"><a href="#12-5、自定义缓存" class="headerlink" title="12.5、自定义缓存"></a>12.5、自定义缓存</h4><p>除了上述自定义缓存的方式，你也可以通过实现你自己的缓存，或为其他第三方缓存方案创建适配器，来完全覆盖缓存行为。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache</span> <span class="attr">type</span>=<span class="string">&quot;com.domain.something.MyCustomCache&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://robert-pf.github.io/RobertBlog/2021/08/10/Mybatis/" data-id="cl309djvf0002fkig9fwm3gy2" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/RobertBlog/tags/MyBatis/" rel="tag">MyBatis</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-SpringBoot" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/RobertBlog/2021/05/25/SpringBoot/" class="article-date">
  <time datetime="2021-05-25T15:30:35.000Z" itemprop="datePublished">2021-05-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/RobertBlog/2021/05/25/SpringBoot/">Spring</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="/RobertBlog/.io//Users\11153\AppData\Roaming\Typora\typora-user-images\image-20220511204133215.png" alt="image-20220511204133215"></p>
<p>微服务是一种架构</p>
<p>​    MVC三层架构</p>
<p>​    MVVM微服务架构。</p>
<p>是一种云原生架构方法，其中单个应用程序由许多松散耦合且可独立部署的较小组件或服务组成。这些服务通常</p>
<ul>
<li>有自己的堆栈，包括数据库和数据模型；</li>
<li>通过REST API，事件流和消息代理的组合相互通信；</li>
<li>它们是按业务能力组织的，分隔服务的线通常称为有界上下文。</li>
</ul>
<p>总结一下就是，将服务独立出来，可以部署到不同的位置，从而来更加合理的分配至资源。</p>
<h2 id="1、创建第一个SpringBoot程序："><a href="#1、创建第一个SpringBoot程序：" class="headerlink" title="1、创建第一个SpringBoot程序："></a>1、创建第一个SpringBoot程序：</h2><h5 id="1、New-Module-or-New-Project"><a href="#1、New-Module-or-New-Project" class="headerlink" title="1、New Module  or New Project"></a>1、<code>New Module</code>  or <code>New Project</code></h5><p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Spring\image-20220512235826780.png" alt="image-20220512235826780"></p>
<p><strong>注意：</strong>这一步的 Server URL 地址如果用默认的start.spring.io可能在网速不好条件下，连不上，建议大家都换成：<a target="_blank" rel="noopener" href="https://start.aliyun.com/">https://start.aliyun.com</a></p>
<h5 id="2、下一步，选择好spring-Boot的版本即可，其他的看项目需求选择。"><a href="#2、下一步，选择好spring-Boot的版本即可，其他的看项目需求选择。" class="headerlink" title="2、下一步，选择好spring Boot的版本即可，其他的看项目需求选择。"></a>2、下一步，选择好spring Boot的版本即可，其他的看项目需求选择。</h5><p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Spring\image-20220512235911307.png" alt="image-20220512235911307"></p>
<p><code>Create</code></p>
<h5 id="3、在新的项目的pom-xml中添加依赖："><a href="#3、在新的项目的pom-xml中添加依赖：" class="headerlink" title="3、在新的项目的pom.xml中添加依赖："></a>3、在新的项目的pom.xml中添加依赖：</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后就可以启动项目啦</p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Spring\image-20220513001711407.png" alt="image-20220513001711407"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  .   ____          _            __ _ _</span><br><span class="line"> /\\ / ___<span class="string">&#x27;_ __ _ _(_)_ __  __ _ \ \ \ \</span></span><br><span class="line"><span class="string">( ( )\___ | &#x27;</span>_ | <span class="string">&#x27;_| | &#x27;</span>_ \/ _` | \ \ \ \</span><br><span class="line"> \\/  ___)| |_)| | | | | || (_| |  ) ) ) )</span><br><span class="line">  <span class="string">&#x27;  |____| .__|_| |_|_| |_\__, | / / / /</span></span><br><span class="line"><span class="string"> =========|_|==============|___/=/_/_/_/</span></span><br><span class="line"><span class="string"> :: Spring Boot ::                (v2.6.7)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2022-05-13 00:17:01.440  INFO 1648 --- [           main] com.robert.HelloWorld001Application      : Starting HelloWorld001Application using Java 1.8.0_331 on Robert with PID 1648 (E:\JavaStudyLocal\java\SpringBoot\HelloWorld-001\target\classes started by 11153 in E:\JavaStudyLocal\java)</span></span><br><span class="line"><span class="string">2022-05-13 00:17:01.443  INFO 1648 --- [           main] com.robert.HelloWorld001Application      : No active profile set, falling back to 1 default profile: &quot;default&quot;</span></span><br><span class="line"><span class="string">2022-05-13 00:17:02.307  INFO 1648 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8080 (http)</span></span><br><span class="line"><span class="string">2022-05-13 00:17:02.316  INFO 1648 --- [           main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]</span></span><br><span class="line"><span class="string">2022-05-13 00:17:02.316  INFO 1648 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.62]</span></span><br><span class="line"><span class="string">2022-05-13 00:17:02.460  INFO 1648 --- [           main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext</span></span><br><span class="line"><span class="string">2022-05-13 00:17:02.461  INFO 1648 --- [           main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 968 ms</span></span><br><span class="line"><span class="string">2022-05-13 00:17:02.849  INFO 1648 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path &#x27;</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">2022-05-13 00:17:02.858  INFO 1648 --- [           main] com.robert.HelloWorld001Application      : Started HelloWorld001Application in 1.971 seconds (JVM running for 3.952)</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<h5 id="4、这是可以用浏览器访问http-localhost-8080"><a href="#4、这是可以用浏览器访问http-localhost-8080" class="headerlink" title="4、这是可以用浏览器访问http://localhost:8080"></a>4、这是可以用浏览器访问<code>http://localhost:8080</code></h5><p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Spring\image-20220513001913448.png" alt="image-20220513001913448"></p>
<p>可以看到能正常访问，但是返回一个错误，404的错误。因为我们只是启动了一个简单的网页，没有资源可以访问的。</p>
<p>就是空白报错页面。</p>
<h5 id="5、如果想添加一个页面的话，我们可以添加一些代码来实现："><a href="#5、如果想添加一个页面的话，我们可以添加一些代码来实现：" class="headerlink" title="5、如果想添加一个页面的话，我们可以添加一些代码来实现："></a>5、如果想添加一个页面的话，我们可以添加一些代码来实现：</h5><p>先添加一个Controller的package，然后再编写一个控制层的相应hello页面请求的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.robert.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;helloControler&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;hello&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello World , you get the first SpringBoot program .&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="6、再在浏览器访问：http-localhost-8080-helloControler-hello-您会得到这样一个页面："><a href="#6、再在浏览器访问：http-localhost-8080-helloControler-hello-您会得到这样一个页面：" class="headerlink" title="6、再在浏览器访问：http://localhost:8080/helloControler/hello ,您会得到这样一个页面："></a>6、再在浏览器访问：<code>http://localhost:8080/helloControler/hello</code> ,您会得到这样一个页面：</h5><p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Spring\image-20220513003037697.png" alt="image-20220513003037697"></p>
<p>恭喜你，第一个spring boot程序已经构建完成，下边让我们开始进一步研究他的使用吧。</p>
<p>修改<code>tomcat</code>运行的端口可以直接在配置文件中修改，修改resource目录下的application.properties的内容添加：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server.port=<span class="number">10086</span></span><br></pre></td></tr></table></figure>

<p>上述的处理都是用的propertie文件作为springboot的配置文件</p>
<p>springboot的配置文件也可以用yml文件配置。</p>
<h2 id="2、配置文件解读"><a href="#2、配置文件解读" class="headerlink" title="2、配置文件解读"></a>2、配置文件解读</h2><h4 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h4><ul>
<li>spring-boot-dependecies：核心依赖在父工程中</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>启动器：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>需要用到什么功能的话就需要使用对应功能的依赖。</p>
<h4 id="主程序"><a href="#主程序" class="headerlink" title="主程序"></a>主程序</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorld001Application</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(HelloWorld001Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="yaml文件配置对象："><a href="#yaml文件配置对象：" class="headerlink" title="yaml文件配置对象："></a>yaml文件配置对象：</h4><p>对象类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.robert.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="comment">//指定使用yml中的对象person，并获取对象的属性值</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;person&quot;)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span>  String name;</span><br><span class="line">    <span class="keyword">private</span>  Dog dog;</span><br><span class="line">    <span class="keyword">private</span>  Integer age;</span><br><span class="line">    <span class="keyword">private</span> Date birth;</span><br><span class="line">    <span class="keyword">private</span>  Boolean Happy;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Object&gt; maps;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Object&gt; list;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">//开启debug调试：</span></span><br><span class="line"><span class="attr">debug:</span> <span class="literal">true</span> </span><br><span class="line"><span class="attr">person:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">qinjiang</span></span><br><span class="line">  <span class="attr">age:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">happy:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">birth:</span> <span class="number">2022</span><span class="string">/05/14</span></span><br><span class="line">  <span class="attr">maps:</span> &#123;<span class="attr">k1:</span> <span class="string">v1</span>,<span class="attr">k2:</span> <span class="string">v2</span>&#125;</span><br><span class="line">  <span class="attr">list:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">code</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">music</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">girl</span></span><br><span class="line">  <span class="attr">dog:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">旺财</span></span><br><span class="line">    <span class="attr">age:</span> <span class="number">3</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>松散绑定</p>
<ul>
<li>yaml中可以用fist-name 给对象的firstName属性赋值。属性值的自动识别格式。</li>
</ul>
</li>
<li><p>JSR-303校验信息</p>
<ul>
<li>就是在字段上增加一层过滤器，保证数据的合法性。</li>
</ul>
<p>使用方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="comment">//开启JSR303校验</span></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dog</span> &#123;</span><br><span class="line">	<span class="comment">//校验数值不为空</span></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span>  Integer age;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>复杂类型封装，yml中可以封装对象，使用@Value就不支持。</p>
</li>
</ul>
<h4 id="配置文件的放置位置："><a href="#配置文件的放置位置：" class="headerlink" title="配置文件的放置位置："></a>配置文件的放置位置：</h4><p>自动装配的原理：</p>
<ol>
<li><p>SpringBoot启动会加载大量的自动配置类</p>
</li>
<li><p>判断项目于需求的功能是否在SpringBoot默认类中</p>
</li>
<li><p>判断自动配置的类是否在某一个组件中，如果在，就不需要人工去手动配置</p>
</li>
<li><p>给容器中的自动配置类添加组件的时候，会从properties类中获取某些属性，我们需要在配置文件中执行这些属性的值即可：</p>
<p>xxxxAutoConfiguration:自动配置类；给容器中添加组件</p>
<p>xxxxProperties：封装配置文件中相关属性。</p>
</li>
</ol>
<h3 id="多环境下不同的spring配置："><a href="#多环境下不同的spring配置：" class="headerlink" title="多环境下不同的spring配置："></a>多环境下不同的spring配置：</h3><p>如果在开发的过程中涉及到如开发、测试和生产这3个环境：</p>
<ul>
<li>native</li>
<li>test</li>
<li>production</li>
</ul>
<p>可以在application.yml中配置不通环境的配置变量，如下：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">$&#123;APP_NAME:unnamed&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">pebble:</span></span><br><span class="line">  <span class="attr">suffix:</span></span><br><span class="line">  <span class="attr">cache:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="string">$&#123;APP_PORT:8080&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">test</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8000</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">production</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="attr">pebble:</span></span><br><span class="line">  <span class="attr">cache:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>注意到分隔符<code>---</code>，最前面的配置是默认配置，不需要指定Profile，后面的每段配置都必须以<code>spring.profiles: xxx</code>开头，表示一个Profile。上述配置默认使用8080端口，但是在<code>test</code>环境下，使用<code>8000</code>端口，在<code>production</code>环境下，使用<code>80</code>端口，并且启用Pebble的缓存。</p>
<p>直接启动的时候，使用的是默认配置，tomcat容器运行在8080端口。</p>
<p>要以<code>test</code>环境启动，可输入如下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -Dspring.profiles.active=test -jar springboot-profiles-1.0-SNAPSHOT.jar</span><br></pre></td></tr></table></figure>



<h2 id="3、SpringBoot-Web-开发"><a href="#3、SpringBoot-Web-开发" class="headerlink" title="3、SpringBoot Web 开发"></a>3、SpringBoot Web 开发</h2><p>新建Spring项目，选中SpringWeb，项目出来的目的结构：</p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Spring\image-20220514212131387.png" alt="image-20220514212131387"></p>
<p>新建Controller层：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello,world&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="导入静态资源"><a href="#导入静态资源" class="headerlink" title="导入静态资源"></a>导入静态资源</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//SpringBoot Web Mvc的配置类中的</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.resourceProperties.isAddMappings()) &#123;</span><br><span class="line">        logger.debug(<span class="string">&quot;Default resource handling disabled&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//在web端输入/webjars/ ，相当于输入了/META-INF/resources/webjars/</span></span><br><span class="line">        <span class="built_in">this</span>.addResourceHandler(registry, <span class="string">&quot;/webjars/**&quot;</span>, <span class="string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.addResourceHandler(registry, <span class="built_in">this</span>.mvcProperties.getStaticPathPattern(), (registration) -&gt; &#123;</span><br><span class="line">            registration.addResourceLocations(<span class="built_in">this</span>.resourceProperties.getStaticLocations());</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.servletContext != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="type">ServletContextResource</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletContextResource</span>(<span class="built_in">this</span>.servletContext, <span class="string">&quot;/&quot;</span>);</span><br><span class="line">                registration.addResourceLocations(<span class="keyword">new</span> <span class="title class_">Resource</span>[]&#123;resource&#125;);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>添加依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.webjars.npm<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jquery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.6.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>浏览器访问：<a target="_blank" rel="noopener" href="http://localhost:8080/webjars/jquery/3.6.0/dist/jquery.js">http://localhost:8080/webjars/jquery/3.6.0/dist/jquery.js</a></p>
<p>浏览器中可访问以下四个路径的文件：</p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Spring\image-20220514225301396.png" alt="image-20220514225301396"></p>
<p>测试resources 的目录结构如下：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">resources:</span></span><br><span class="line"> <span class="attr">public:</span></span><br><span class="line">  <span class="string">Hello.html</span></span><br></pre></td></tr></table></figure>

<p>Hello.html文件内如如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">Hello Webjar !</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>运行程序：即可访问：<code>http://localhost:8080/Hello.html</code>即可得到：</p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Spring\image-20220514230204765.png" alt="image-20220514230204765"></p>
<p>四个目录的优先级：</p>
<p>resources &gt; static &gt; public </p>
<p>总结：</p>
<ol>
<li>在SpringBoot中，我们可以使用一下方式处理静态资源：<ul>
<li>webjars localhost:8080/webjars/</li>
<li>public,static,/***,resources localhost:8080/</li>
</ul>
</li>
</ol>
<h3 id="首页"><a href="#首页" class="headerlink" title="首页"></a>首页</h3><p>在静态资源目录中新建index.html文件，在访问8080端口的时候，会展示index.html网页</p>
<h3 id="JSP，模板引擎Thymeleaf"><a href="#JSP，模板引擎Thymeleaf" class="headerlink" title="JSP，模板引擎Thymeleaf"></a>JSP，模板引擎Thymeleaf</h3><p>可以使前端使用变量转换获取。</p>
<h3 id="扩展使用SpringMVC"><a href="#扩展使用SpringMVC" class="headerlink" title="扩展使用SpringMVC"></a>扩展使用SpringMVC</h3><p>If you want to keep those Spring Boot MVC customizations and make more <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.19/reference/html/web.html#mvc">MVC customizations</a> (interceptors, formatters, view controllers, and other features), you can add your own <code>@Configuration</code> class of type <code>WebMvcConfigurer</code> but <strong>without</strong> <code>@EnableWebMvc</code>.</p>
<p>跳转试图：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MySpringMvcConifg</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> &#123;</span><br><span class="line">        registry.addViewController(<span class="string">&quot;/Robert&quot;</span>).setViewName(<span class="string">&quot;Test.html&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="1、首页配置：需要将所有的静态资源修改成th-xxxx-quot-quot"><a href="#1、首页配置：需要将所有的静态资源修改成th-xxxx-quot-quot" class="headerlink" title="1、首页配置：需要将所有的静态资源修改成th:xxxx=&quot;{}&quot;"></a>1、首页配置：需要将所有的静态资源修改成<code>th:xxxx=&quot;&#123;&#125;&quot;</code></h6><h6 id="2、页面国际化，根据发送的请求转换页面"><a href="#2、页面国际化，根据发送的请求转换页面" class="headerlink" title="2、页面国际化，根据发送的请求转换页面"></a>2、页面国际化，根据发送的请求转换页面</h6><h6 id="3、实现登陆后跳转的操作"><a href="#3、实现登陆后跳转的操作" class="headerlink" title="3、实现登陆后跳转的操作"></a>3、实现登陆后跳转的操作</h6><ul>
<li>​    MVC试图设置中添加试图中转的代码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyMvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> &#123;</span><br><span class="line">        registry.addViewController(<span class="string">&quot;/&quot;</span>).setViewName(<span class="string">&quot;auth-login&quot;</span>);</span><br><span class="line"><span class="comment">//        registry.addViewController(&quot;/index.html&quot;).setViewName(&quot;auth-login&quot;);</span></span><br><span class="line">        registry.addViewController(<span class="string">&quot;/auth-recoverpw.html&quot;</span>).setViewName(<span class="string">&quot;auth-recoverpw&quot;</span>);</span><br><span class="line">        registry.addViewController(<span class="string">&quot;/auth-register.html&quot;</span>).setViewName(<span class="string">&quot;auth-register&quot;</span>);</span><br><span class="line">        <span class="comment">//设置后登录后跳转的页面</span></span><br><span class="line">        registry.addViewController(<span class="string">&quot;/user/login.html&quot;</span>).setViewName(<span class="string">&quot;index&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：后边的setViewName是真实的html页面的的名字，前边的<code>/user/login.html</code>是一个伪名字</p>
<ul>
<li>编写Controller控制登录动作：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginControler</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/user/login&quot;)</span></span><br><span class="line">    <span class="keyword">public</span>  String <span class="title function_">login</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(&quot;username&quot;)</span> String username,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(&quot;password&quot;)</span> String password,</span></span><br><span class="line"><span class="params">            Model model</span></span><br><span class="line"><span class="params">            )</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty(username) &amp;&amp; <span class="string">&quot;123456&quot;</span>.equals(password))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;redirect:/user/login.html&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            model.addAttribute(<span class="string">&quot;msg&quot;</span> , <span class="string">&quot;用户名密码错误&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;auth-login&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样在登录成功之后，可以登录用户显示index.html中的内容，但是有一个问题就是，在这种情况下，可以在浏览器中直接输入<code>http://localhost:8080/user/login.html</code>就可以访问登录之后的页面，是一种不完全的操作：</p>
<h6 id="4、此时需要给网页添加拦截器："><a href="#4、此时需要给网页添加拦截器：" class="headerlink" title="4、此时需要给网页添加拦截器："></a>4、此时需要给网页添加拦截器：</h6><p>具体实添加办法</p>
<p>1、添加LoginHandlerInterceptor类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginHandlerInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//登录成功之后，返回用户的session</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">loginUser</span> <span class="operator">=</span> request.getSession().getAttribute(<span class="string">&quot;loginUser&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (loginUser == <span class="literal">null</span>)&#123;</span><br><span class="line">            request.setAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;您还未登录，请先登录&quot;</span>);</span><br><span class="line">            <span class="comment">//getRequestDispatcher(&quot;/&quot;) 返回的登录页面，必去是MVC中配置的addViewController视图。</span></span><br><span class="line">            request.getRequestDispatcher(<span class="string">&quot;/&quot;</span>).forward(request,response);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这时候登录页面就可以根据<code>msg</code>来获取返回信息。</p>
<p>2、Controller中添加session，并获取session的属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginControler</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/user/login&quot;)</span></span><br><span class="line">    <span class="keyword">public</span>  String <span class="title function_">login</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(&quot;username&quot;)</span> String username,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(&quot;password&quot;)</span> String password,</span></span><br><span class="line"><span class="params">            Model model,</span></span><br><span class="line"><span class="params">            //添加获取httpsession，并给session添加属性</span></span><br><span class="line"><span class="params">            HttpSession session</span></span><br><span class="line"><span class="params">            )</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty(username) &amp;&amp; <span class="string">&quot;123456&quot;</span>.equals(password))&#123;</span><br><span class="line">            session.setAttribute(<span class="string">&quot;loginUser&quot;</span>,username);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;redirect:/user/login.html&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            model.addAttribute(<span class="string">&quot;msg&quot;</span> , <span class="string">&quot;用户名密码错误&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;auth-login&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3、给MVCConfig中添加添加拦截过滤设置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">       registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">LoginHandlerInterceptor</span>()).</span><br><span class="line">               addPathPatterns(<span class="string">&quot;/**&quot;</span>).</span><br><span class="line">               excludePathPatterns(<span class="string">&quot;/auth-login.html&quot;</span>,<span class="string">&quot;/&quot;</span>,<span class="string">&quot;/user/login/**&quot;</span>,<span class="string">&quot;/css/**&quot;</span>,</span><br><span class="line">                       <span class="string">&quot;/file/**&quot;</span>,<span class="string">&quot;/font/**&quot;</span>,<span class="string">&quot;/fonts/**&quot;</span>,<span class="string">&quot;/image/**&quot;</span>,<span class="string">&quot;/js/**&quot;</span>,<span class="string">&quot;/picture/**&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>这是直接访问<code>http://localhost:8080/user/login.html</code>会返回提示未登录页面：</p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Spring\image-20220517005313037.png" alt="image-20220517005313037"></p>
<h6 id="5、网页实现增删改查功能："><a href="#5、网页实现增删改查功能：" class="headerlink" title="5、网页实现增删改查功能："></a>5、网页实现增删改查功能：</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">&quot;table table-striped table-sm&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span>id<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span>name<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span>Email<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span>gender<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span>department<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span>birth<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">&quot;employee:$&#123;employees&#125;&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;employee.getId()&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;employee.getName()&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;employee.getEmail()&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;employee.getGender()==0? &#x27;女&#x27;:&#x27;男&#x27;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;employee.getDepartment().getDepartmentName()&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;#dates.format(employee.getBirth(),&#x27;yyyy-MM-dd HH:mm:ss&#x27;)&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-sm btn-danger&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-sm btn-primary&quot;</span>&gt;</span>修改<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1、使用th;each 可以遍历返回的集合：后端返回的代码如下，下述代码中给前端返回的集合名字是<code>employees</code>,所以再前端要写成 <code>$&#123;employees&#125;</code> </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/emps&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">list</span><span class="params">(Model model)</span>&#123;</span><br><span class="line">        Collection&lt;Employee&gt; employees = employeeDao.getAll();</span><br><span class="line">        model.addAttribute(<span class="string">&quot;employees&quot;</span>,employees);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;emp/employeeList&quot;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>2、使用三元公式，根据返回值展现不同的内容：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;employee.getGender()==0? &#x27;女&#x27;:&#x27;男&#x27;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>3、使用dates工具对日期格式的数据进行</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;#dates.format(employee.getBirth(),&#x27;yyyy-MM-dd HH:mm:ss&#x27;)&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>6、添加员工：</p>
<p>略……</p>
<p>注意： 因为静态参数没有get和set方法，所以<code>@Autowired</code>不能自动对静态参数赋值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.robert.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.robert.pojo.Department;</span><br><span class="line"><span class="keyword">import</span> com.robert.pojo.Employee;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//模拟数据库中的数据</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;Integer, Employee&gt; employees = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//注入departmentDao</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span>  DepartmentDao departmentDao;</span><br><span class="line">    <span class="comment">////////一定不要将DepartmentDao设置成静态的参数，不然会在下边添加员工的时候报空指针异常，可能是设置了静态参数后，没有自动注入departmentDao</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建员工</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        employees = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;Integer, Employee&gt;();</span><br><span class="line">        employees.put(<span class="number">1</span>,<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">1</span>,<span class="string">&quot;Robert&quot;</span>,<span class="string">&quot;Robert@163.com&quot;</span>,<span class="number">1</span>,<span class="keyword">new</span> <span class="title class_">Date</span>(),<span class="keyword">new</span> <span class="title class_">Department</span>(<span class="number">101</span>,<span class="string">&quot;教学部&quot;</span>)));</span><br><span class="line">        employees.put(<span class="number">2</span>,<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">2</span>,<span class="string">&quot;Daisy&quot;</span>,<span class="string">&quot;Daisy@163.com&quot;</span>,<span class="number">0</span>,<span class="keyword">new</span> <span class="title class_">Date</span>(),<span class="keyword">new</span> <span class="title class_">Department</span>(<span class="number">102</span>,<span class="string">&quot;市场部&quot;</span>)));</span><br><span class="line">        employees.put(<span class="number">3</span>,<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">3</span>,<span class="string">&quot;loasy&quot;</span>,<span class="string">&quot;loasy@163.com&quot;</span>,<span class="number">0</span>,<span class="keyword">new</span> <span class="title class_">Date</span>(),<span class="keyword">new</span> <span class="title class_">Department</span>(<span class="number">103</span>,<span class="string">&quot;教研部&quot;</span>)));</span><br><span class="line">        employees.put(<span class="number">4</span>,<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">4</span>,<span class="string">&quot;Jack&quot;</span>,<span class="string">&quot;Jack@163.com&quot;</span>,<span class="number">1</span>,<span class="keyword">new</span> <span class="title class_">Date</span>(),<span class="keyword">new</span> <span class="title class_">Department</span>(<span class="number">104</span>,<span class="string">&quot;后勤部&quot;</span>)));</span><br><span class="line">        employees.put(<span class="number">5</span>,<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">5</span>,<span class="string">&quot;Rose&quot;</span>,<span class="string">&quot;Rose@163.com&quot;</span>,<span class="number">0</span>,<span class="keyword">new</span> <span class="title class_">Date</span>(),<span class="keyword">new</span> <span class="title class_">Department</span>(<span class="number">101</span>,<span class="string">&quot;教学部&quot;</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//主键自增</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">static</span>  <span class="type">Integer</span> <span class="variable">eeid</span> <span class="operator">=</span> <span class="number">6</span>;</span><br><span class="line">    <span class="comment">//增加员工</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">addEmployee</span><span class="params">(Employee employee)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (employee.getId() ==  <span class="literal">null</span>)&#123;</span><br><span class="line">            employee.setId(eeid++);</span><br><span class="line">        &#125;</span><br><span class="line">        employee.setDepartment(departmentDao.getDepartmentById(employee.getDepartment().getId()));</span><br><span class="line">        employees.put(employee.getId(),employee);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//查询员工</span></span><br><span class="line">    <span class="keyword">public</span> Collection&lt;Employee&gt; <span class="title function_">getAll</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> employees.values();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//通过id查询员工</span></span><br><span class="line">    <span class="keyword">public</span>  Employee <span class="title function_">getEmployeeBiId</span><span class="params">(Integer id)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> employees.get(id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//删除员工通过id</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">void</span>  <span class="title function_">delEmployee</span><span class="params">(Integer id)</span>&#123;</span><br><span class="line">        employees.remove(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Spring\image-20220524181155209.png" alt="image-20220524181155209"></p>
<h3 id="4、SpringData"><a href="#4、SpringData" class="headerlink" title="4、SpringData"></a>4、SpringData</h3><p>新建spring项目：</p>
<p>添加spring配置文件<code>application.yml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">159357</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/learnjdbc?useUnicode=true&amp;characterEncoding=utf-8</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br></pre></td></tr></table></figure>

<p>注意：如果配置了yml文件中的数据源的话，就不要在properter中配置datasource了，否则会发生冲突。</p>
<p>遇见问题一：数据库url没有配置时区：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.sql.SQLException: The server time zone value <span class="string">&#x27;�й���׼ʱ��&#x27;</span> is unrecognized or represents more than one time zone. You must configure either the server or JDBC <span class="title function_">driver</span> <span class="params">(via the <span class="string">&#x27;serverTimezone&#x27;</span> configuration property)</span> to use a more specific time zone value <span class="keyword">if</span> you want to utilize time zone support.</span><br></pre></td></tr></table></figure>

<p>解决办法：url中添加失去设置<code>serverTimezone=UTC</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/learnjdbc?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf-8</span></span><br></pre></td></tr></table></figure>

<h4 id="应用实例1：启动一个Web程序"><a href="#应用实例1：启动一个Web程序" class="headerlink" title="应用实例1：启动一个Web程序"></a>应用实例1：启动一个Web程序</h4><p>测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBCController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    JdbcTemplate jdbcTemplate;</span><br><span class="line">    <span class="comment">//查询数据的所有信息</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/userList&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Map&lt;String,Object&gt;&gt; <span class="title function_">userList</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from user&quot;</span>;</span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; maps = jdbcTemplate.queryForList(sql);</span><br><span class="line">        <span class="keyword">return</span> maps;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>启动web程序：web访问<code>localhost:8080//userList](http://localhost:8080/userList</code> 可以返回sql语句的输出结果。</p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Spring\image-20220524233645452.png" alt="image-20220524233645452"></p>
<h5 id="控制层实现增删查改的办法"><a href="#控制层实现增删查改的办法" class="headerlink" title="控制层实现增删查改的办法"></a>控制层实现增删查改的办法</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBCController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    JdbcTemplate jdbcTemplate;</span><br><span class="line">    <span class="comment">//查询数据的所有信息</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/userList&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Map&lt;String,Object&gt;&gt; <span class="title function_">userList</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from user&quot;</span>;</span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; maps = jdbcTemplate.queryForList(sql);</span><br><span class="line">        <span class="keyword">return</span> maps;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//插入数据</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/addUser&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">addUser</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into user (id,name,password,email) values(4,&#x27;Jack&#x27;,&#x27;123123&#x27;,&#x27;Jack@Robert.com&#x27;)&quot;</span>;</span><br><span class="line">        jdbcTemplate.update(sql);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;update OK!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//查询单个用户</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/userQuery/&#123;name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span>  List&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">userQuery</span><span class="params">(<span class="meta">@PathVariable(&quot;name&quot;)</span> String name)</span>&#123;</span><br><span class="line">        String sql= <span class="string">&quot;select * from user where name=&quot;</span>+<span class="string">&quot;\&quot;&quot;</span>+name+<span class="string">&quot;\&quot;&quot;</span>;</span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; maps = jdbcTemplate.queryForList(sql);</span><br><span class="line">        <span class="keyword">return</span>  maps;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//更新数据</span></span><br><span class="line">    <span class="comment">//因为整个Controller使用了@RestController注解，相当于加了@</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/updateUserPassword/&#123;name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateUser</span><span class="params">(<span class="meta">@PathVariable(&quot;name&quot;)</span> String name, HttpServletResponse response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;update user set password=? where name=&quot;</span>+<span class="string">&quot;\&quot;&quot;</span>+name+<span class="string">&quot;\&quot;&quot;</span>;</span><br><span class="line">        String password=<span class="string">&quot;123456&quot;</span>;</span><br><span class="line">        jdbcTemplate.update(sql,password);</span><br><span class="line">        response.sendRedirect(<span class="string">&quot;/userQuery/&quot;</span>+name); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="解决问题：类标注了-RestController后，不能用redirect实现网页跳转。"><a href="#解决问题：类标注了-RestController后，不能用redirect实现网页跳转。" class="headerlink" title="解决问题：类标注了@RestController后，不能用redirect实现网页跳转。"></a>解决问题：类标注了@RestController后，不能用redirect实现网页跳转。</h5><p>@RestController相当于类中的所有方法都标注了@ResponseBody，这时通过redirect返回String类型跳转不会返回一个视图，而是返回一个json对象，这样的话只是在页面上打印出字符串，而不跳转。控制器用@Controller注解即可</p>
<p>如果上述代码改成</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">   <span class="meta">@GetMapping(&quot;/updateUserPassword/&#123;name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateUser</span><span class="params">(<span class="meta">@PathVariable(&quot;name&quot;)</span> String name, HttpServletResponse response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;update user set password=? where name=&quot;</span>+<span class="string">&quot;\&quot;&quot;</span>+name+<span class="string">&quot;\&quot;&quot;</span>;</span><br><span class="line">        String password=<span class="string">&quot;123456&quot;</span>;</span><br><span class="line">        jdbcTemplate.update(sql,password);</span><br><span class="line">       <span class="keyword">return</span> <span class="string">&quot;redirect:/userQuery/&quot;</span>+name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>则访问：<code>http://localhost:8080:/updateUserPassword/Jack</code>是只会返回一个字符串：redirect:/userQuery/Jack，并不会跳转到网页：<code>http://localhost:8080:/userQuery/Jack</code>上，要想实现跳转，可以通过将一个<code>HttpServletResponse</code>参数添加到处理程序方法中，然后调用<code>response.sendRedirect(</code>redirectURL）；来解决跳转问题：</p>
<h5 id="数据源对比：https-www-jianshu-com-p-1abb19b6a512"><a href="#数据源对比：https-www-jianshu-com-p-1abb19b6a512" class="headerlink" title="数据源对比：https://www.jianshu.com/p/1abb19b6a512"></a>数据源对比：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/1abb19b6a512">https://www.jianshu.com/p/1abb19b6a512</a></h5><p>性能方面 hikariCP&gt;druid&gt;tomcat-jdbc&gt;dbcp&gt;c3p0 。hikariCP的高性能得益于最大限度的避免锁竞争。druid功能最为全面，sql拦截等功能，统计数据较为全面，具有良好的扩展性。综合性能，扩展性等方面，可考虑使用druid或者hikariCP连接池。可开启prepareStatement缓存，对性能会有大概20%的提升。</p>
<p>使用<code>druid</code>配置后台：</p>
<p>修改使用druid数据源方法</p>
<ol>
<li><p>配置依赖：</p>
</li>
<li><p>```xml</p>
<dependency>
            <groupId>com.alibaba</groupId>
            <artifactId>druid</artifactId>
            <version>1.2.10</version>
        </dependency>
        <dependency>
            <groupId>log4j</groupId>
            <artifactId>log4j</artifactId>
            <version>1.2.12</version>
        </dependency>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">3. springboot的配置文件中添加 `spring.datasource.type=com.alibaba.druid.pool.DruidDataSource` 对应的yaml配置文件如下图：</span><br><span class="line"></span><br><span class="line">```yaml</span><br><span class="line">spring:</span><br><span class="line">  datasource:</span><br><span class="line">    username: root</span><br><span class="line">    password: 159357</span><br><span class="line">    url: jdbc:mysql://localhost:3306/learnjdbc?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf-8</span><br><span class="line">    driver-class-name: com.mysql.jdbc.Driver</span><br><span class="line">    type: com.alibaba.druid.pool.DruidDataSource</span><br></pre></td></tr></table></figure></li>
<li><p>配置完以上步骤就可以正常使用了，但是我们可以配置一个</p>
</li>
</ol>
<h3 id="5、SpringSecurity"><a href="#5、SpringSecurity" class="headerlink" title="5、SpringSecurity"></a>5、SpringSecurity</h3><p>是一个安全框架。认证、授权。</p>
<p>配置依赖文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>编写config</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">登录控制，根据权限显示不通的网页</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">http.remeberMe() <span class="comment">//开始记住密码认证的方法，一般是根据cookie和session来保证</span></span><br></pre></td></tr></table></figure>

<h3 id="6、Shiro"><a href="#6、Shiro" class="headerlink" title="6、Shiro"></a>6、Shiro</h3><p>一个权限管理的框架，实现 用户认证、用户授权。可以完成 :<strong>认证</strong>、<strong>授权</strong>、加密、会话管理、与 Web 集成、缓存等。</p>
<ul>
<li><p>Shiro 用于中小型项目比较常见,简单易上手,可以支持多种环境</p>
<p>Shiro 可以不跟任何的框架或者容器绑定，可独立运行</p>
</li>
<li><p>Spring Security 一般多用于spring环境,中大型项目,更强大</p>
<p> Spring Security 则必须要有Spring环境</p>
</li>
</ul>
<p>1、导入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--        shiro--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-spring-boot-web-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        mysql和mybais--&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>2、配置shiro配置文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShiroConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ShiroFilterFactoryBean</span></span><br><span class="line">    <span class="meta">@Bean(name=&quot;shiroFilterFactoryBean&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ShiroFilterFactoryBean <span class="title function_">getShiroFilterFactoryBean</span><span class="params">(<span class="meta">@Qualifier(&quot;defaultWebSecurityManager&quot;)</span> DefaultWebSecurityManager defaultWebSecurityManager)</span>&#123;</span><br><span class="line">        <span class="type">ShiroFilterFactoryBean</span> <span class="variable">shiroFilterFactoryBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShiroFilterFactoryBean</span>();</span><br><span class="line">        <span class="comment">//设置安全管理器；</span></span><br><span class="line">        shiroFilterFactoryBean.setSecurityManager(defaultWebSecurityManager);</span><br><span class="line">        <span class="comment">//添加shiro的内置过滤器</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        * anon： 无需认证就可以访问</span></span><br><span class="line"><span class="comment">        * authc：必须认证了才能访问</span></span><br><span class="line"><span class="comment">        * user： 必须拥有了记住我 功能才能用</span></span><br><span class="line"><span class="comment">        * perms： 拥有对某个资源的权限才能访问</span></span><br><span class="line"><span class="comment">        * role：拥有某个角色权限才能访问</span></span><br><span class="line"><span class="comment">        * */</span></span><br><span class="line">        HashMap&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//        添加授权拦截 这个必须卸载登录拦截之前。</span></span><br><span class="line">          map.put(<span class="string">&quot;/user/add&quot;</span>,<span class="string">&quot;perms[user:add]&quot;</span>);</span><br><span class="line"></span><br><span class="line">          shiroFilterFactoryBean.setUnauthorizedUrl(<span class="string">&quot;/unauthorized&quot;</span>);</span><br><span class="line">        <span class="comment">//添加登录拦截</span></span><br><span class="line">        map.put(<span class="string">&quot;/user/*&quot;</span>,<span class="string">&quot;authc&quot;</span>);</span><br><span class="line">        shiroFilterFactoryBean.setFilterChainDefinitionMap(map);</span><br><span class="line"></span><br><span class="line">        shiroFilterFactoryBean.setLoginUrl(<span class="string">&quot;/toLogin&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> shiroFilterFactoryBean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//生成DefaultSecurityManager;</span></span><br><span class="line">    <span class="meta">@Bean(name=&quot;defaultWebSecurityManager&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DefaultWebSecurityManager <span class="title function_">getDefaultWebSecurityManager</span><span class="params">(<span class="meta">@Qualifier(&quot;userRealm&quot;)</span> UserRealm userRealm)</span>&#123;</span><br><span class="line">        <span class="type">DefaultWebSecurityManager</span> <span class="variable">defaultWebSecurityManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultWebSecurityManager</span>();</span><br><span class="line">        <span class="comment">//关联UserReamm</span></span><br><span class="line">        defaultWebSecurityManager.setRealm(userRealm);</span><br><span class="line">        <span class="keyword">return</span> defaultWebSecurityManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建Realm对象，需要自定义类</span></span><br><span class="line">    <span class="meta">@Bean(name=&quot;userRealm&quot;)</span></span><br><span class="line">    <span class="keyword">public</span>  UserRealm <span class="title function_">userRealm</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserRealm</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>编写Reaml类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserRealm</span> <span class="keyword">extends</span> <span class="title class_">AuthorizingRealm</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">     UserService userService;</span><br><span class="line">    <span class="comment">//授权</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> AuthorizationInfo <span class="title function_">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principalCollection)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;执行了=》授权doGetAuthorizationInfo&quot;</span>);</span><br><span class="line">        <span class="type">SimpleAuthorizationInfo</span> <span class="variable">info</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleAuthorizationInfo</span>();</span><br><span class="line">        <span class="comment">//获取登录用户</span></span><br><span class="line">        <span class="type">Subject</span> <span class="variable">subject</span> <span class="operator">=</span> SecurityUtils.getSubject();</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User) subject.getPrincipal();<span class="comment">//拿到User对象</span></span><br><span class="line">        <span class="comment">//如果用户是bob添加授权</span></span><br><span class="line">        <span class="keyword">if</span> (user.getName().equals(<span class="string">&quot;bob&quot;</span>))&#123;</span><br><span class="line">            info.addStringPermission(<span class="string">&quot;user:add&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> info;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//认证</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> AuthenticationInfo <span class="title function_">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken authenticationToken)</span> <span class="keyword">throws</span> AuthenticationException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;执行了=》授权doGetAuthenticationInfo&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//没有连接数据库得情况下伪造数据。</span></span><br><span class="line"><span class="comment">//        String  name=&quot;Robert&quot;;</span></span><br><span class="line"><span class="comment">//        String password=&quot;123456&quot;;</span></span><br><span class="line">        UsernamePasswordToken userToken=(UsernamePasswordToken) authenticationToken;</span><br><span class="line">        <span class="comment">//连接真正数据库查询数据库</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getUserByName(userToken.getUsername());</span><br><span class="line">        <span class="keyword">if</span> (user==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//可以加密，MD5 MD5盐值加密</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SimpleAuthenticationInfo</span>(user,user.getPassword(),<span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="comment">//        return null;</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>3、编写测试类</p>
<p>7、Swagger</p>
<p>前后端分离的情况下，存在一些弊端，就是前后端的变化不能实时更新。</p>
<p>前期的解决方案：</p>
<ul>
<li>前端测试后端接口：postman</li>
<li>后端提供接口，需要实时更新最新的解决方案。</li>
</ul>
<p>Swagger</p>
<ul>
<li>RestFull Api文档在线自动生成工具。=》Api文档与API定义同步更新。</li>
<li>直接运行可以在线测试API接口</li>
<li>支持多种语言。</li>
</ul>
<p>在项目中使用Swagger需要sprinbox</p>
<p>swagger2</p>
<p>ui</p>
<h4 id="使用方法："><a href="#使用方法：" class="headerlink" title="使用方法："></a>使用方法：</h4><ol>
<li>添加依赖</li>
<li>编辑swagger配置文件</li>
<li>配置扫描接口<ol>
<li>Docket</li>
</ol>
</li>
<li>分组</li>
<li>实体类配置</li>
</ol>
<h3 id="7、RPC"><a href="#7、RPC" class="headerlink" title="7、RPC"></a>7、RPC</h3><p> RPC 框架-远程过程调用协议RPC（Remote Procedure Call Protocol)—–允许像调用本地服务一样调用远程服务。</p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Spring\v2-bdbecb7c77674f8b15c48f844e8347c1_r.jpg" alt="preview"></p>
<p>远程调用需要以下几个步骤：</p>
<ol>
<li>先解决远程调用的通信问题，可以是客户端和服务端要建立起TCP连接。</li>
<li><strong>要解决寻址的问题</strong>，也就是说，A服务器上的应用怎么告诉底层的RPC框架，如何连接到B服务器（如主机或IP地址）以及特定的端口，方法的名称名称是什么，这样才能完成调用。比如基于Web服务协议栈的RPC，就要提供一个endpoint URI，或者是从UDDI服务上查找。如果是RMI调用的话，还需要一个RMI Registry来注册服务的地址。</li>
<li>当A服务器上的应用发起远程过程调用时，方法的参数需要通过底层的网络协议如TCP传递到B服务器，由于网络协议是基于二进制的，内存中的参数的值要序列化成二进制的形式，也就是<strong>序列化</strong>（Serialize）或编组（marshal），通过寻址和传输将序列化的二进制发送给B服务器。</li>
<li>B服务器收到请求后，需要对参数进行反序列化（序列化的逆操作），恢复为内存中的表达方式，然后找到对应的方法（寻址的一部分）进行本地调用，然后得到返回值。</li>
<li>返回值还要发送回服务器A上的应用，也要经过序列化的方式发送，服务器A接到后，再反序列化，恢复为内存中的表达方式，交给A服务器上的应用</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://robert-pf.github.io/RobertBlog/2021/05/25/SpringBoot/" data-id="cl338czwh0002rcighc3e7h8p" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/RobertBlog/tags/Java-Spring/" rel="tag">Java Spring</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Redis" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/RobertBlog/2020/04/24/Redis/" class="article-date">
  <time datetime="2020-04-24T14:03:35.000Z" itemprop="datePublished">2020-04-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/RobertBlog/2020/04/24/Redis/">Redis</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="NoSql"><a href="#NoSql" class="headerlink" title="NoSql"></a>NoSql</h2><p>NoSQL最常见的解释是“non-relational”， “Not Only SQL”也被很多人接受。NoSQL仅仅是一个概念，泛指非关系型的数据库，区别于关系数据库，它们不保证关系数据的ACID特性。NoSQL是一项全新的数据库革命性运动，其拥护者们提倡运用非关系型的数据存储，相对于铺天盖地的关系型数据库运用，这一概念无疑是一种全新的思维的注入。<br>NoSQL有如下优点：易扩展，NoSQL数据库种类繁多，但是一个共同的特点都是去掉关系数据库的关系型特性。数据之间无关系，这样就非常容易扩展。无形之间也在架构的层面上带来了可扩展的能力。大数据量，高性能，NoSQL数据库都具有非常高的读写性能，尤其在大数据量下，同样表现优秀。这得益于它的无关系性，数据库的结构简单</p>
<h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><p><strong>键值(Key-Value)存储数据库</strong></p>
<p>这一类数据库主要会使用到一个<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%93%88%E5%B8%8C%E8%A1%A8">哈希表</a>，这个表中有一个特定的键和一个指针指向特定的数据。Key/value模型对于IT系统来说的优势在于简单、易部署。但是如果<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E5%91%98/1216449">数据库管理员</a>(<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/DBA/3349">DBA</a>)只对部分值进行查询或更新的时候，Key/value就显得效率低下了。举例如：Tokyo Cabinet/Tyrant， Redis， Voldemort， Oracle BDB。</p>
<ul>
<li>新浪：Redis</li>
<li>美团：Redis + Tair</li>
<li>阿里、百度：Redis + Memecache</li>
</ul>
<p><strong>列存储数据库</strong></p>
<p>这部分数据库通常是用来应对分布式存储的海量数据。键仍然存在，但是它们的特点是指向了多个列。这些列是由列家族来安排的。如：Cassandra， HBase， Riak。分布式文件系统</p>
<p><strong>文档型数据库</strong></p>
<p>文档型数据库的灵感是来自于Lotus Notes办公软件的，而且它同第一种键值存储相类似。该类型的数据模型是版本化的文档，半结构化的文档以特定的格式存储，比如JSON。文档型数据库可以看作是键值数据库的升级版，允许之间嵌套键值，在处理网页等复杂数据时，文档型数据库比传统键值数据库的查询效率更高。如：CouchDB， MongoDb. 国内也有文档型数据库SequoiaDB，已经开源。</p>
<ul>
<li>MongoDB<ul>
<li>是一个基于分布式文件存储的数据库，C++ 编写，主要是用来处理大量的文档</li>
<li>是一个介于关系型和非关系型数据中间的产品；是非关系型数据库中功能最丰富，最像关系型数据库的。</li>
</ul>
</li>
<li>ConthDB</li>
</ul>
<p><strong>图形(Graph)数据库</strong></p>
<p>图形结构的数据库同其他行列以及刚性结构的SQL数据库不同，它是使用灵活的图形模型，并且能够扩展到多个服务器上。NoSQL数据库没有标准的查询语言(SQL)，因此进行数据库查询需要制定数据模型。许多NoSQL数据库都有REST式的数据接口或者查询API。如：Neo4J， InfoGrid， Infinite Graph。<br>特点：主要存储的数据关系的。</p>
<p><strong>不同分类特点对比</strong></p>
<table>
<thead>
<tr>
<th><strong>分类</strong></th>
<th><strong>Examples举例</strong></th>
<th>典型应用场景</th>
<th>数据模型</th>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody><tr>
<td><strong>键值（key-value）</strong></td>
<td>Tokyo Cabinet/Tyrant， Redis， Voldemort， Oracle BDB</td>
<td>内容缓存，主要用于处理大量数据的高访问负载，也用于一些日志系统等等。</td>
<td>Key 指向 Value 的键值对，通常用hash table来实现</td>
<td>查找速度快</td>
<td>数据无结构化，通常只被当作字符串或者二进制数据</td>
</tr>
<tr>
<td><strong>列存储数据库</strong></td>
<td>Cassandra， HBase， Riak</td>
<td>分布式的文件系统</td>
<td>以列簇式存储，将同一列数据存在一起</td>
<td>查找速度快，可扩展性强，更容易进行分布式扩展</td>
<td>功能相对局限</td>
</tr>
<tr>
<td><strong>文档型数据库</strong></td>
<td>CouchDB， MongoDb</td>
<td>Web应用（与Key-Value类似，Value是结构化的，不同的是数据库能够了解Value的内容）</td>
<td>Key-Value对应的键值对，Value为结构化数据</td>
<td>数据结构要求不严格，表结构可变，不需要像关系型数据库一样需要预先定义表结构</td>
<td>查询性能不高，而且缺乏统一的查询语法。</td>
</tr>
<tr>
<td><strong>图形(Graph)数据库</strong></td>
<td>Neo4J， InfoGrid， Infinite Graph</td>
<td>社交网络，推荐系统等。专注于构建关系图谱</td>
<td>图结构</td>
<td>利用图结构相关算法。比如最短路径寻址，N度关系查找等</td>
<td>很多时候需要对整个图做计算才能得出需要的信息，而且这种结构不太好做分布式的集群方案。</td>
</tr>
</tbody></table>
<h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><h4 id="易扩展"><a href="#易扩展" class="headerlink" title="易扩展"></a><strong>易扩展</strong></h4><p>NoSQL数据库种类繁多，但是一个共同的特点都是去掉关系数据库的关系型特性。数据之间无关系，这样就非常容易扩展。无形之间，在架构的层面上带来了可扩展的能力。</p>
<h4 id="大数据量，高性能"><a href="#大数据量，高性能" class="headerlink" title="大数据量，高性能"></a><strong>大数据量，高性能</strong></h4><p>NoSQL数据库都具有非常高的读写性能，尤其在大数据量下，同样表现优秀。这得益于它的无关系性，数据库的结构简单。一般MySQL使用Query Cache。NoSQL的Cache是记录级的，是一种细粒度的Cache，所以NoSQL在这个层面上来说性能就要高很多。</p>
<h4 id="灵活的数据模型"><a href="#灵活的数据模型" class="headerlink" title="灵活的数据模型"></a><strong>灵活的数据模型</strong></h4><p>NoSQL无须事先为要存储的数据建立字段，随时可以存储自定义的数据格式。而在关系数据库里，增删字段是一件非常麻烦的事情。如果是非常大数据量的表，增加字段简直就是——个噩梦。这点在大数据量的Web 2.0时代尤其明显。</p>
<h4 id="高可用"><a href="#高可用" class="headerlink" title="高可用"></a><strong>高可用</strong></h4><p>NoSQL在不太影响性能的情况，就可以方便地实现高可用的架构。比如Cassandra、HBase模型，通过复制模型也能实现高可用。</p>
<h4 id="传统的RDBMS和NoSQL对比："><a href="#传统的RDBMS和NoSQL对比：" class="headerlink" title="传统的RDBMS和NoSQL对比："></a>传统的RDBMS和NoSQL对比：</h4><p>传统的RDBMS：</p>
<ul>
<li>结构化组织</li>
<li>SQL</li>
<li>数据和关系都存在单独的表中</li>
<li>严格的一致性</li>
<li>基础的事务</li>
</ul>
<p>NoSQL</p>
<ul>
<li>不仅仅是数据</li>
<li>没有固定的查询语言</li>
<li>键值对存储，列存储，文档存储，图形数据库</li>
<li>CAP定理和BASE</li>
<li>高性能，高可用，高可扩。</li>
</ul>
<blockquote>
<p>大数据的3V+3高</p>
</blockquote>
<p>大数据库的3V：主要是描述问题的</p>
<ol>
<li>海量Volume</li>
<li>多样Variaty</li>
<li>实时Velocity</li>
</ol>
<p>大数据时代的3高：主要是对程序的要求</p>
<ol>
<li>高并发</li>
<li>高可拓（机器不够可以随时扩展服务器）</li>
<li>高性能</li>
</ol>
<h2 id="Redis-概念"><a href="#Redis-概念" class="headerlink" title="Redis 概念"></a>Redis 概念</h2><blockquote>
<p>是什么</p>
</blockquote>
<p> Redis（Remote Dictionary Server )，即远程字典服务，是一个开源的使用ANSI <a target="_blank" rel="noopener" href="https://baike.baidu.com/item/C%E8%AF%AD%E8%A8%80">C语言</a>编写、支持网络、可基于内存亦可持久化的日志型、Key-Value<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E5%BA%93/103728">数据库</a>，并提供多种语言的API。和memcached一样，为了保证效率，数据都是缓存在内存中。区别的是redis会周期性的把更新的数据写入磁盘或者把修改操作写入追加的记录文件，并且在此基础上实现了master-slave(主从)同步。</p>
<blockquote>
<p>能做什么</p>
</blockquote>
<ol>
<li>内存存储、持久化。持久化机制（rdb，oaf）</li>
<li>效率高，可以用于高速缓存。</li>
<li>发布订阅系统</li>
<li>地图信息分析</li>
<li>计时器，计数器（浏览量）</li>
</ol>
<blockquote>
<p>特性</p>
</blockquote>
<ol>
<li>多样的数据类型</li>
<li>持久化</li>
<li>集群</li>
<li>事务</li>
</ol>
<p>安装办法：</p>
<p>Windos</p>
<p>解压zip文件即可使用。</p>
<blockquote>
<h1 id="redis-server-exe-服务端运行程序"><a href="#redis-server-exe-服务端运行程序" class="headerlink" title="redis-server.exe 服务端运行程序"></a>redis-server.exe 服务端运行程序</h1></blockquote>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Redis\image-20220424230634275.png" alt="image-20220424230634275"></p>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>Redis 的配置文件位于 Redis 安装目录下，文件名为 <strong>redis.conf</strong>(Windows 名为 redis.windows.conf)。</p>
<h4 id="查看配置"><a href="#查看配置" class="headerlink" title="查看配置"></a>查看配置</h4><p>你可以通过 <strong>CONFIG</strong> 命令查看或设置配置项。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#查看loglevel的配置</span></span><br><span class="line">CONFIG GET loglevel</span><br><span class="line"><span class="comment">#使用 * 号获取所有配置项：</span></span><br><span class="line">CONFIG GET *</span><br></pre></td></tr></table></figure>

<h4 id="编辑配置"><a href="#编辑配置" class="headerlink" title="编辑配置"></a>编辑配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#CONFIG SET 命令基本语法：</span></span><br><span class="line">CONFIG SET CONFIG_SETTING_NAME NEW_CONFIG_VALUE</span><br></pre></td></tr></table></figure>

<p>具体配置见连接：<a target="_blank" rel="noopener" href="https://www.runoob.com/redis/redis-conf.html">https://www.runoob.com/redis/redis-conf.html</a></p>
<p>测试性能：</p>
<p><code>redis-bencheckmark</code> 是一个压力测试工具</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@测试： 100个并发连接，</span><br><span class="line">redis-benchmark </span><br></pre></td></tr></table></figure>

<h2 id="基础知识："><a href="#基础知识：" class="headerlink" title="基础知识："></a>基础知识：</h2><p>默认有16个数据库，可以通过<code>select dbid</code>可以切换数据库。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Set the number of databases. The default database is DB 0, you can select</span></span><br><span class="line"><span class="comment"># a different one on a per-connection basis using SELECT &lt;dbid&gt; where</span></span><br><span class="line"><span class="comment"># dbid is a number between 0 and &#x27;databases&#x27;-1</span></span><br><span class="line">databases 16</span><br></pre></td></tr></table></figure>

<p>基本使用方法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#连接数据库：</span></span><br><span class="line">redis-cli -h host -p port -a password</span><br><span class="line"><span class="comment">#查看数据大小</span></span><br><span class="line">127.0.0.1:6379[1]&gt; DBSIZE</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line"><span class="comment">#查看当前数据库的所有key</span></span><br><span class="line">127.0.0.1:6379[1]&gt; keys *</span><br><span class="line">1) <span class="string">&quot;name&quot;</span></span><br><span class="line"><span class="comment">#清空当前数据库</span></span><br><span class="line">127.0.0.1:6379[1]&gt; FLUSHDB</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[1]&gt; keys *</span><br><span class="line">(empty list or <span class="built_in">set</span>)</span><br><span class="line"><span class="comment">#清空全部数据库内容</span></span><br><span class="line">127.0.0.1:6379&gt; flushall</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Redis 是单线程的</p>
</blockquote>
<p>Redis是基于内存操作，CPU不是Redis性能的凭借，Redis的瓶颈是机器的内存和带宽。既然可以使用单线程，就是用了单线程。</p>
<p>Redis是C语言写的，官方提供的数据为 100000+ 的QPS ，完全不必同样是使用key-value的Memecache差。</p>
<p>Redis 是单线程的还快？</p>
<p>误区：高性能的服务器一定是多线程的，多线程一定比单线程效率高。因为CPU的上下文切换需要时间。</p>
<p>核心：redis是将所有的数据放置在内存中，所以说使用单线程操作效率是最高的。多线程（CPU上下文切换是耗时的），对于内存系统来说，如果没有上下文切换效率是最高的。多次读写都在一个CPU中操作，是最高效率的方案。</p>
<h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><p>Redis支持五种数据类型：string（字符串），hash（哈希），list（列表），set（集合）及zset(sorted set：有序集合)。</p>
<p>string 是 redis 最基本的类型，你可以理解成与 Memcached 一模一样的类型，一个 key 对应一个 value。</p>
<p>string 类型是二进制安全的。意思是 redis 的 string 可以包含任何数据。比如jpg图片或者序列化的对象。</p>
<p>string 类型是 Redis 最基本的数据类型，string 类型的值最大能存储 512MB。</p>
<h4 id="Redis-keys-命令"><a href="#Redis-keys-命令" class="headerlink" title="Redis keys 命令"></a>Redis keys 命令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; keys * <span class="comment">#查看所有keys</span></span><br><span class="line">1) <span class="string">&quot;name&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; exists name <span class="comment">#是否存在key</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; expire name 10 <span class="comment">#设置key的过期时间</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; ttl name <span class="comment">#查看key当前的有效时间</span></span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line">127.0.0.1:6379&gt; TYPE name <span class="comment">#查看key的类型</span></span><br><span class="line">string</span><br></pre></td></tr></table></figure>



<table>
<thead>
<tr>
<th>1</th>
<th><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/keys-del.html">DEL key</a> 该命令用于在 key 存在时删除 key。</th>
</tr>
</thead>
<tbody><tr>
<td>2</td>
<td><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/keys-dump.html">DUMP key</a> 序列化给定 key ，并返回被序列化的值。</td>
</tr>
<tr>
<td>3</td>
<td><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/keys-exists.html">EXISTS key</a> 检查给定 key 是否存在。</td>
</tr>
<tr>
<td>4</td>
<td><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/keys-expire.html">EXPIRE key</a> seconds 为给定 key 设置过期时间，以秒计。</td>
</tr>
<tr>
<td>5</td>
<td><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/keys-expireat.html">EXPIREAT key timestamp</a> EXPIREAT 的作用和 EXPIRE 类似，都用于为 key 设置过期时间。 不同在于 EXPIREAT 命令接受的时间参数是 UNIX 时间戳(unix timestamp)。</td>
</tr>
<tr>
<td>6</td>
<td><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/keys-pexpire.html">PEXPIRE key milliseconds</a> 设置 key 的过期时间以毫秒计。</td>
</tr>
<tr>
<td>7</td>
<td><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/keys-pexpireat.html">PEXPIREAT key milliseconds-timestamp</a> 设置 key 过期时间的时间戳(unix timestamp) 以毫秒计</td>
</tr>
<tr>
<td>8</td>
<td><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/keys-keys.html">KEYS pattern</a> 查找所有符合给定模式( pattern)的 key 。</td>
</tr>
<tr>
<td>9</td>
<td><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/keys-move.html">MOVE key db</a> 将当前数据库的 key 移动到给定的数据库 db 当中。</td>
</tr>
<tr>
<td>10</td>
<td><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/keys-persist.html">PERSIST key</a> 移除 key 的过期时间，key 将持久保持。</td>
</tr>
<tr>
<td>11</td>
<td><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/keys-pttl.html">PTTL key</a> 以毫秒为单位返回 key 的剩余的过期时间。</td>
</tr>
<tr>
<td>12</td>
<td><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/keys-ttl.html">TTL key</a> 以秒为单位，返回给定 key 的剩余生存时间(TTL, time to live)。</td>
</tr>
<tr>
<td>13</td>
<td><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/keys-randomkey.html">RANDOMKEY</a> 从当前数据库中随机返回一个 key 。</td>
</tr>
<tr>
<td>14</td>
<td><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/keys-rename.html">RENAME key newkey</a> 修改 key 的名称</td>
</tr>
<tr>
<td>15</td>
<td><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/keys-renamenx.html">RENAMENX key newkey</a> 仅当 newkey 不存在时，将 key 改名为 newkey 。</td>
</tr>
<tr>
<td>16</td>
<td>[SCAN cursor <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/keys-scan.html">MATCH pattern] [COUNT count]</a> 迭代数据库中的数据库键。</td>
</tr>
<tr>
<td>17</td>
<td><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/keys-type.html">TYPE key</a> 返回 key 所储存的值的类型。</td>
</tr>
</tbody></table>
<h4 id="Redis-字符串-String"><a href="#Redis-字符串-String" class="headerlink" title="Redis 字符串(String)"></a>Redis 字符串(String)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; get name</span><br><span class="line">(nil)</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> name Robert  </span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; append name Daisy <span class="comment">#追加字符串，如果不存在此key，会自动创建。</span></span><br><span class="line">(<span class="built_in">integer</span>) 11</span><br><span class="line">127.0.0.1:6379&gt; get name</span><br><span class="line"><span class="string">&quot;RobertDaisy&quot;</span></span><br><span class="line">127.0.0.1:6379&gt;</span><br><span class="line"><span class="comment">#GETRANGE key start end #返回 key 中字符串值的子字符</span></span><br><span class="line"><span class="comment">#GETSET key value #将给定 key 的值设为 value ，并返回 key 的旧值(old value)</span></span><br><span class="line">127.0.0.1:6379&gt; getrange name 2 4</span><br><span class="line"><span class="string">&quot;ber&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; getset name Robert</span><br><span class="line"><span class="string">&quot;RobertDaisy&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; getrange name 2 -1  <span class="comment">#获取从2开始，到末尾的开始的所有字符串</span></span><br><span class="line"><span class="string">&quot;bert&quot;</span></span><br><span class="line"><span class="comment">#SETEX key seconds value #将值 value 关联到 key ，并将 key 的过期时间设为 seconds (以秒为单位)。</span></span><br><span class="line"><span class="comment">#SETNX key value  #只有在 key 不存在时设置 key 的值。</span></span><br><span class="line"><span class="comment">#SETRANGE key offset value #用 value 参数覆写给定 key 所储存的字符串值，从偏移量 offset 开始。</span></span><br><span class="line"><span class="comment">#STRLEN key 返回 key 所储存的字符串值的长度。</span></span><br><span class="line"><span class="comment">##################################################</span></span><br><span class="line"><span class="comment">###自增自减</span></span><br><span class="line"><span class="comment">#INCR key #将 key 中储存的数字值增一</span></span><br><span class="line"><span class="comment">#INCRBY key increment #将 key 所储存的值加上给定的增量值（increment） 。</span></span><br><span class="line"><span class="comment">#INCRBYFLOAT key increment #将 key 所储存的值加上给定的浮点增量值（increment） </span></span><br><span class="line"><span class="comment">#DECR key #将 key 中储存的数字值减一。</span></span><br><span class="line"><span class="comment">#DECRBY key decrement #key 所储存的值减去给定的减量值（decrement） 。</span></span><br><span class="line"><span class="comment">#############################################</span></span><br><span class="line">mset 	<span class="comment">#MSET key value [key value ...]同时设置一个或多个 key-value 对。</span></span><br><span class="line">msetnx 	<span class="comment">#	MSETNX key value [key value ...]同时设置一个或多个 key-value 对，当且仅当所有给定 key 都不存在。mset 是一个原子性的操作，如果有一个设置的key不能成功，那么整体的设置都会失败。</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; mset k1 v1 k2 v2</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; msetnx k3 v3 k1 v4  <span class="comment">#因为原子性，此步的k3并未设置成功。</span></span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) <span class="string">&quot;k2&quot;</span></span><br><span class="line">2) <span class="string">&quot;k1&quot;</span></span><br></pre></td></tr></table></figure>

<p>String的应用场景：value可以是字符串可以是数组、</p>
<ol>
<li>计数器</li>
<li>统计多单位的数量</li>
<li>粉丝数</li>
<li>对象缓存存储</li>
</ol>
<h4 id="List（列表）"><a href="#List（列表）" class="headerlink" title="List（列表）"></a>List（列表）</h4><p>Redis列表是简单的字符串列表，按照插入顺序排序。你可以添加一个元素到列表的头部（左边）或者尾部（右边）</p>
<p>一个列表最多可以包含 232 - 1 个元素 (4294967295, 每个列表超过40亿个元素)。</p>
<p>可以当成栈，队列，阻塞队列使用。</p>
<p>所有的list命令都是list开头的。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line">LPUSH key value1 [value2] <span class="comment">#将一个或多个值插入到列表头部</span></span><br><span class="line">127.0.0.1:6379&gt; lpush name Robert Daisy</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; lrange name 0 -1</span><br><span class="line">1) <span class="string">&quot;Daisy&quot;</span></span><br><span class="line">2) <span class="string">&quot;Robert&quot;</span></span><br><span class="line"><span class="comment"># lindex 通过索引获取列表中的元素，以下例子说明index是从0开始的。</span></span><br><span class="line">127.0.0.1:6379&gt; lindex name 2</span><br><span class="line">(nil)</span><br><span class="line">127.0.0.1:6379&gt; lindex name 1</span><br><span class="line"><span class="string">&quot;Robert&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; lindex name 0</span><br><span class="line"><span class="string">&quot;Daisy&quot;</span></span><br><span class="line"><span class="comment">#LLEN key 获取列表长度</span></span><br><span class="line">127.0.0.1:6379&gt; llen name</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; Lpush name Robert Daisy</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line"><span class="comment">#rpush 将值插入列表的尾部。</span></span><br><span class="line"><span class="comment">#LPUSHX key value 将一个值插入到已存在的列表头部</span></span><br><span class="line"><span class="comment">#RPUSHX key value 为已存在的列表的列表尾部添加值</span></span><br><span class="line">127.0.0.1:6379&gt; rpush name kkk </span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line"><span class="comment">#根据区间回去具体的值</span></span><br><span class="line">127.0.0.1:6379&gt; lrange name 0 -1 </span><br><span class="line">1) <span class="string">&quot;Daisy&quot;</span></span><br><span class="line">2) <span class="string">&quot;Robert&quot;</span></span><br><span class="line">3) <span class="string">&quot;kkk&quot;</span></span><br><span class="line"><span class="comment">##################################################################</span></span><br><span class="line"><span class="comment">#LPOP</span></span><br><span class="line"><span class="comment">#lpop 移除列表中的第一个值</span></span><br><span class="line">127.0.0.1:6379&gt; lpop name</span><br><span class="line"><span class="string">&quot;Daisy&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; lrange name 0 -1</span><br><span class="line">1) <span class="string">&quot;Robert&quot;</span></span><br><span class="line">2) <span class="string">&quot;kkk&quot;</span></span><br><span class="line"><span class="comment">#rpop 移除列表中的最后一个值。</span></span><br><span class="line">127.0.0.1:6379&gt; rpop name</span><br><span class="line"><span class="string">&quot;kkk&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; lrange name 0 -1</span><br><span class="line">1) <span class="string">&quot;Robert&quot;</span></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line"><span class="comment">#BLPOP</span></span><br><span class="line"><span class="comment">#BRPOP</span></span><br><span class="line"><span class="comment">#BRPOPLPUSH</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#BLPOP key1 [key2 ] timeout</span></span><br><span class="line"><span class="comment">#移出并获取列表的第一个元素， 如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止。</span></span><br><span class="line">127.0.0.1:6379&gt; BLPOP name  2 </span><br><span class="line">1) <span class="string">&quot;name&quot;</span>					<span class="comment">#输出的意思是移除了name list中的Daisy值</span></span><br><span class="line">2) <span class="string">&quot;Daisy&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; BLPOP name  2</span><br><span class="line">1) <span class="string">&quot;name&quot;</span></span><br><span class="line">2) <span class="string">&quot;Robert&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; BLPOP name  2</span><br><span class="line">1) <span class="string">&quot;name&quot;</span></span><br><span class="line">2) <span class="string">&quot;Robert&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; BLPOP name  2 <span class="comment">#因为name中没有值了，所以会一直等待两秒以后再结束BLPOP命令</span></span><br><span class="line">(nil)</span><br><span class="line">(2.04s)</span><br><span class="line"><span class="comment">#BRPOP key1 [key2 ] timeout   </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#从soource中弹出列表的最后一个值 放到destination中，等待时间是2秒。</span></span><br><span class="line"><span class="comment">#BRPOPLPUSH source destination timeout</span></span><br><span class="line"><span class="comment">#从soource中弹出列表的最后一个值 放到destination中</span></span><br><span class="line"><span class="comment">#RPOPLPUSH source destination</span></span><br><span class="line">127.0.0.1:6379&gt; Lpush name Robert Daisy</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; brpoplpush Rober name2 2</span><br><span class="line">(nil)</span><br><span class="line">(2.09s)</span><br><span class="line">127.0.0.1:6379&gt; brpoplpush name name2 2</span><br><span class="line"><span class="string">&quot;Robert&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; lrange name 0 -1</span><br><span class="line">1) <span class="string">&quot;Daisy&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#########################################################################</span></span><br><span class="line"><span class="comment">#LREM</span></span><br><span class="line"><span class="comment">#LSET </span></span><br><span class="line"><span class="comment">#LTRIM</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#LREM key count value   移除指定个数的元素值</span></span><br><span class="line">127.0.0.1:6379&gt; lrange name 0 -1</span><br><span class="line">1) <span class="string">&quot;Daisy&quot;</span></span><br><span class="line">2) <span class="string">&quot;Robert&quot;</span></span><br><span class="line">3) <span class="string">&quot;Daisy&quot;</span></span><br><span class="line">4) <span class="string">&quot;Robert&quot;</span></span><br><span class="line">5) <span class="string">&quot;Daisy&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; lrem name 3 Daisy</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">127.0.0.1:6379&gt; lrange name 0 -1</span><br><span class="line">1) <span class="string">&quot;Robert&quot;</span></span><br><span class="line">2) <span class="string">&quot;Robert&quot;</span></span><br><span class="line"><span class="comment">#LSET key index value 设置指定索引元素的值。</span></span><br><span class="line">127.0.0.1:6379&gt; lset name 1 Daisy</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; lrange name 0 -1</span><br><span class="line">1) <span class="string">&quot;Robert&quot;</span></span><br><span class="line">2) <span class="string">&quot;Daisy&quot;</span></span><br><span class="line"><span class="comment">#LTRIM key start stop  通过index截取list中的内容，只保留start和stop区间内的。</span></span><br><span class="line">127.0.0.1:6379&gt; lrange name 0 -1</span><br><span class="line">1) <span class="string">&quot;Daisy&quot;</span></span><br><span class="line">2) <span class="string">&quot;Robert&quot;</span></span><br><span class="line">3) <span class="string">&quot;Robert&quot;</span></span><br><span class="line">4) <span class="string">&quot;Daisy&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; ltrim name 1 2</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; lrange name 0 -1</span><br><span class="line">1) <span class="string">&quot;Robert&quot;</span></span><br><span class="line">2) <span class="string">&quot;Robert&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>总结：</p>
</blockquote>
<ul>
<li>list实际是一个链表，before node after ，left， right 都可以插入值</li>
<li>如果key不存在，创建新的链表</li>
<li>如果key存在，新增内容</li>
<li>如果移除了所有值，空链表，也代表不存在</li>
<li>在两边改动值效率高！中间元素，相对来说效率会低一点。</li>
</ul>
<p>消息排队：</p>
<ol>
<li>消息队列（Lpush Rpop）</li>
<li>栈 （Lpush Lpop）</li>
</ol>
<h4 id="Set（集合）"><a href="#Set（集合）" class="headerlink" title="Set（集合）"></a>Set（集合）</h4><p>Redis 的 Set 是 String 类型的无序集合。集合成员是唯一的，这就意味着集合中不能出现重复的数据。<br>集合对象的编码可以是 intset 或者 hashtable。<br>Redis 中集合是通过哈希表实现的，所以添加，删除，查找的复杂度都是 O(1)。集合中最大的成员数为 232 - 1 (4294967295, 每个集合可存储40多亿个成员)。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line"><span class="comment">#SADD</span></span><br><span class="line"><span class="comment">#smembers</span></span><br><span class="line"><span class="comment">#sismember</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#SADD key member1 [member2]	向集合添加一个或多个成员</span></span><br><span class="line">127.0.0.1:6379&gt; sadd myset Robert Daisy <span class="comment">#添加成员</span></span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line"><span class="comment">#SMEMBERS key  返回集合中的所有成员</span></span><br><span class="line">127.0.0.1:6379&gt; smembers myset</span><br><span class="line">1) <span class="string">&quot;Robert&quot;</span></span><br><span class="line">2) <span class="string">&quot;Daisy&quot;</span></span><br><span class="line"><span class="comment">#判断元素是否在集合中，在返回1，不在返回0</span></span><br><span class="line">127.0.0.1:6379&gt; sismember myset Robert</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; sismember myset Roberts</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line"></span><br><span class="line"><span class="comment">################################################################</span></span><br><span class="line"><span class="comment">#scard</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#scard key 获取set集合中的元素个数</span></span><br><span class="line">127.0.0.1:6379&gt; scard myset</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line"><span class="comment">################################################################</span></span><br><span class="line"><span class="comment">#SPOP key移除并返回集合中的一个随机元素</span></span><br><span class="line"><span class="comment">#SRANDMEMBER key [count] 返回集合中一个或多个随机数</span></span><br><span class="line"><span class="comment">#SREM key member1 [member2] 移除集合中一个或多个成员</span></span><br><span class="line"><span class="comment">#SMOVE source destination member 将 member 元素从 source 集合移动到 destination 集合</span></span><br><span class="line"><span class="comment">################################################################</span></span><br><span class="line"><span class="comment">#微博，B站 共同关注（并集）</span></span><br><span class="line"><span class="comment">#数据的集合</span></span><br><span class="line">- 差集 SDIFF key1 kye2</span><br><span class="line">- 交集 SINTER key1 kye2</span><br><span class="line">- 并集 SUNION key1 kye2</span><br><span class="line"></span><br><span class="line"><span class="comment">#SDIFFSTORE destination key1 [key2] 返回给定所有集合的差集并存储在 destination 中</span></span><br><span class="line"><span class="comment">#SINTERSTORE destination key1 [key2] 返回给定所有集合的交集并存储在 destination 中</span></span><br><span class="line"><span class="comment">#SUNIONSTORE destination key1 [key2] 所有给定集合的并集存储在 destination 集合中</span></span><br><span class="line"><span class="comment">#SMOVE source destination member 将 member 元素从 source 集合移动到 destination 集合</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="Hash-哈希"><a href="#Hash-哈希" class="headerlink" title="Hash(哈希)"></a>Hash(哈希)</h4><p>Redis hash 是一个 string 类型的 field（字段） 和 value（值） 的映射表，hash 特别适合用于存储对象。<br>Redis 中每个 hash 可以存储 232 - 1 键值对（40多亿）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#HMSET key field1 value1 [field2 value2 ] 同时将多个 field-value (域-值)对设置到哈希表 key 中。</span></span><br><span class="line">127.0.0.1:6379&gt; hset Robert name Robert <span class="comment">#给Robert hash添加name属性值未Robert</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; hget Robert name <span class="comment">#获取属性值</span></span><br><span class="line"><span class="string">&quot;Robert&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#HSETNX key field value	只有在字段 field 不存在时，设置哈希表字段的值。</span></span><br><span class="line">127.0.0.1:6379&gt; hsetnx Robert name daisy <span class="comment">#当对应的key不存在的时候，才新建key 并设置key的filed的value为xxx</span></span><br><span class="line">(<span class="built_in">integer</span>) 0		<span class="comment">#如果新建成功，返回1；新建是失败返回0。</span></span><br><span class="line">127.0.0.1:6379&gt; hsetnx Daisy name daisy</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"></span><br><span class="line"><span class="comment">##HVALS key	获取哈希表中所有值。</span></span><br><span class="line">127.0.0.1:6379&gt; hvals Robert</span><br><span class="line">1) <span class="string">&quot;Robert&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; hvals Dasiy</span><br><span class="line">(empty list or <span class="built_in">set</span>)</span><br><span class="line"><span class="comment">##HGETALL key	获取在哈希表中指定 key 的所有字段和值</span></span><br><span class="line">127.0.0.1:6379&gt; hgetall Robert</span><br><span class="line">1) <span class="string">&quot;name&quot;</span></span><br><span class="line">2) <span class="string">&quot;Robert&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#HGET key field	获取存储在哈希表中指定字段的值。</span></span><br><span class="line"><span class="comment">#HMGET key field1 [field2]	获取所有给定字段的值</span></span><br><span class="line">127.0.0.1:6379&gt; hmget Robert name</span><br><span class="line">1) <span class="string">&quot;Robert&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#HLEN key	获取哈希表中字段的数量</span></span><br><span class="line">127.0.0.1:6379&gt; hlen Robert</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"></span><br><span class="line"><span class="comment">#HKEYS key	获取所有哈希表中的字段</span></span><br><span class="line">127.0.0.1:6379&gt; hkeys Robert</span><br><span class="line">1) <span class="string">&quot;name&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#HDEL key field1 [field2] 删除一个或多个哈希表字段</span></span><br><span class="line">127.0.0.1:6379&gt; hdel Robert name</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#HINCRBY key field increment	为哈希表 key 中的指定字段的整数值加上增量 increment 。</span></span><br><span class="line">127.0.0.1:6379&gt; hgetall Robert</span><br><span class="line">1) <span class="string">&quot;age&quot;</span></span><br><span class="line">2) <span class="string">&quot;18&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; hincrby Robert age 1</span><br><span class="line">(<span class="built_in">integer</span>) 19</span><br></pre></td></tr></table></figure>

<h4 id="Redis-有序集合-sorted-set"><a href="#Redis-有序集合-sorted-set" class="headerlink" title="Redis 有序集合(sorted set)"></a>Redis 有序集合(sorted set)</h4><p>Redis 有序集合和集合一样也是 string 类型元素的集合,且不允许重复的成员。<br>不同的是每个元素都会关联一个 double 类型的分数。redis 正是通过分数来为集合中的成员进行从小到大的排序。<br>有序集合的成员是唯一的,但分数(score)却可以重复。<br>集合是通过哈希表实现的，所以添加，删除，查找的复杂度都是 O(1)。 集合中最大的成员数为 232 - 1 (4294967295, 每个集合可存储40多亿个成员)。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#添加</span></span><br><span class="line"><span class="comment">#ZADD key score1 member1 [score2 member2]	向有序集合添加一个或多个成员，或者更新已存在成员的分数</span></span><br><span class="line">127.0.0.1:6379&gt; zadd  score 90 Robert 80 Daisy</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; zadd score 100 xiaoming 99 xiaohong</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line"><span class="comment">#ZCARD key	获取有序集合的成员数</span></span><br><span class="line">127.0.0.1:6379&gt; zcard score</span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line"><span class="comment">#ZRANGE key start stop [WITHSCORES]	通过索引区间返回有序集合指定区间内的成员</span></span><br><span class="line">127.0.0.1:6379&gt; zrange score 0 2</span><br><span class="line">1) <span class="string">&quot;Daisy&quot;</span></span><br><span class="line">2) <span class="string">&quot;Robert&quot;</span></span><br><span class="line">3) <span class="string">&quot;xiaohong&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; zrange score 0 1</span><br><span class="line">1) <span class="string">&quot;Daisy&quot;</span></span><br><span class="line">2) <span class="string">&quot;Robert&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#排序</span></span><br><span class="line"><span class="comment">#ZRANGEBYSCORE key min max [WITHSCORES] [LIMIT]	通过分数返回有序集合指定区间内的成员</span></span><br><span class="line">127.0.0.1:6379&gt; zrangebyscore score -inf  90  withscores</span><br><span class="line">1) <span class="string">&quot;Daisy&quot;</span></span><br><span class="line">2) <span class="string">&quot;80&quot;</span></span><br><span class="line">3) <span class="string">&quot;Robert&quot;</span></span><br><span class="line">4) <span class="string">&quot;90&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#移除</span></span><br><span class="line"><span class="comment">#ZREM key member [member ...]	移除有序集合中的一个或多个成员</span></span><br><span class="line">127.0.0.1:6379&gt; zrange score 0 4</span><br><span class="line">1) <span class="string">&quot;Daisy&quot;</span></span><br><span class="line">2) <span class="string">&quot;Robert&quot;</span></span><br><span class="line">3) <span class="string">&quot;xiaohong&quot;</span></span><br><span class="line">4) <span class="string">&quot;xiaoming&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; zrem score Robert</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; zrange score 0 4</span><br><span class="line">1) <span class="string">&quot;Daisy&quot;</span></span><br><span class="line">2) <span class="string">&quot;xiaohong&quot;</span></span><br><span class="line">3) <span class="string">&quot;xiaoming&quot;</span></span><br><span class="line"><span class="comment">#ZREMRANGEBYLEX key min max	移除有序集合中给定的字典区间的所有成员</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ZREMRANGEBYRANK key start stop	移除有序集合中给定的排名区间的所有成员</span></span><br><span class="line"><span class="comment">#ZREMRANGEBYSCORE key min max	移除有序集合中给定的分数区间的所有成员</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="特殊数据类型"><a href="#特殊数据类型" class="headerlink" title="特殊数据类型"></a>特殊数据类型</h4><h5 id="Redis-GEO"><a href="#Redis-GEO" class="headerlink" title="Redis GEO"></a>Redis GEO</h5><p>Redis GEO 主要用于存储地理位置信息，并对存储的信息进行操作，该功能在 Redis 3.2 版本新增。<br>Redis GEO 操作方法有：</p>
<ul>
<li>geoadd：添加地理位置的坐标。</li>
<li>geopos：获取地理位置的坐标。</li>
<li>geodist：计算两个位置之间的距离。</li>
<li>georadius：根据用户给定的经纬度坐标来获取指定范围内的地理位置集合。</li>
<li>georadiusbymember：根据储存在位置集合里面的某个地点获取指定范围内的地理位置集合。</li>
<li>geohash：返回一个或多个位置对象的 geohash 值。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#geoadd 用于存储指定的地理空间位置，可以将一个或多个经度(longitude)、纬度(latitude)、位置名称(member)添加到指定的 key 中。</span></span><br><span class="line"><span class="comment">#GEOADD key longitude latitude member [longitude latitude member ...]</span></span><br><span class="line">127.0.0.1:6379&gt; geoadd china  116.397128  39.916527  beijing  102.82147  24.88554  kuming</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#获取城市的经纬度geopos用于从给定的 key 里返回所有指定名称(member)的位置（经度和纬度），不存在的返回 nil。</span></span><br><span class="line"><span class="comment">#GEOPOS key member [member ...]</span></span><br><span class="line">127.0.0.1:6379&gt; geopos china beijing</span><br><span class="line">1) 1) <span class="string">&quot;116.39712899923324585&quot;</span></span><br><span class="line">   2) <span class="string">&quot;39.91652647362980844&quot;</span></span><br><span class="line">   </span><br><span class="line"><span class="comment">#geodist	用于返回两个给定位置之间的距离。 默认是m，可以指定单位。</span></span><br><span class="line"><span class="comment">#GEODIST key member1 member2 [m|km|ft|mi]</span></span><br><span class="line">127.0.0.1:6379&gt; geodist china beijing kuming</span><br><span class="line"><span class="string">&quot;2097031.9964&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; geodist china beijing kuming km</span><br><span class="line"><span class="string">&quot;2097.0320&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#georadius、georadiusbymember</span></span><br><span class="line"><span class="comment">#georadius 以给定的经纬度为中心， 返回键包含的位置元素当中， 与中心的距离不超过给定最大距离的所有位置元素。</span></span><br><span class="line"><span class="comment">#georadiusbymember 和 GEORADIUS 命令一样， 都可以找出位于指定范围内的元素， 但是 georadiusbymember 的中心点是由给定的位置元素决定的， 而不是使用经度和纬度来决定中心点。</span></span><br><span class="line"><span class="comment">#georadius 与 georadiusbymember 语法格式如下：</span></span><br><span class="line"><span class="comment">#GEORADIUS key longitude latitude radius m|km|ft|mi [WITHCOORD] [WITHDIST] [WITHHASH] [COUNT count] [ASC|DESC] [STORE key] [STOREDIST key]</span></span><br><span class="line"><span class="comment">#GEORADIUSBYMEMBER key member radius m|km|ft|mi [WITHCOORD] [WITHDIST] [WITHHASH] [COUNT count] [ASC|DESC] [STORE key] [STOREDIST key]</span></span><br><span class="line">127.0.0.1:6379&gt; georadiusbymember china xian 1000  km</span><br><span class="line">1) <span class="string">&quot;xian&quot;</span></span><br><span class="line">2) <span class="string">&quot;beijing&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; georadiusbymember china xian 1500  km</span><br><span class="line">1) <span class="string">&quot;kuming&quot;</span></span><br><span class="line">2) <span class="string">&quot;xian&quot;</span></span><br><span class="line">3) <span class="string">&quot;beijing&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; georadiusbymember china xian 1500  km withcoord  withdist <span class="comment">#返回经纬度和局member的距离。</span></span><br><span class="line">1) 1) <span class="string">&quot;kuming&quot;</span></span><br><span class="line">   2) <span class="string">&quot;1195.2149&quot;</span></span><br><span class="line">   3) 1) <span class="string">&quot;102.82147139310836792&quot;</span></span><br><span class="line">      2) <span class="string">&quot;24.88553874878809324&quot;</span></span><br><span class="line">2) 1) <span class="string">&quot;xian&quot;</span></span><br><span class="line">   2) <span class="string">&quot;0.0000&quot;</span></span><br><span class="line">   3) 1) <span class="string">&quot;108.93425256013870239&quot;</span></span><br><span class="line">      2) <span class="string">&quot;34.23053097599082406&quot;</span></span><br><span class="line">3) 1) <span class="string">&quot;beijing&quot;</span></span><br><span class="line">   2) <span class="string">&quot;915.0863&quot;</span></span><br><span class="line">   3) 1) <span class="string">&quot;116.39712899923324585&quot;</span></span><br><span class="line">      2) <span class="string">&quot;39.91652647362980844&quot;</span></span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line"><span class="comment">#geohash 使用 geohash 来保存地理位置的坐标。如果返回两个字符串越接近的话，距离越近。</span></span><br><span class="line"><span class="comment">#geohash 用于获取一个或多个位置元素的 geohash 值。</span></span><br><span class="line"><span class="comment">#GEOHASH key member [member ...]</span></span><br><span class="line">127.0.0.1:6379&gt; geohash china beijing kuming xian</span><br><span class="line">1) <span class="string">&quot;wx4g0dtf9e0&quot;</span></span><br><span class="line">2) <span class="string">&quot;wk3jef22cb0&quot;</span></span><br><span class="line">3) <span class="string">&quot;wqj6wz7x210&quot;</span></span><br></pre></td></tr></table></figure>

<p>GEO 底层的原理是ZSET</p>
<h5 id="HyperLoglog"><a href="#HyperLoglog" class="headerlink" title="HyperLoglog"></a>HyperLoglog</h5><p>Redis 在 2.8.9 版本添加了 HyperLogLog 结构。</p>
<p>Redis HyperLogLog 是用来做基数统计的算法，HyperLogLog 的优点是，在输入元素的数量或者体积非常非常大时，计算基数所需的空间总是固定 的、并且是很小的。<br>在 Redis 里面，每个 HyperLogLog 键只需要花费 12 KB 内存，就可以计算接近 2^64 个不同元素的基 数。这和计算基数时，元素越多耗费内存就越多的集合形成鲜明对比。但是，因为 HyperLogLog 只会根据输入元素来计算基数，而不会储存输入元素本身，所以 HyperLogLog 不能像集合那样，返回输入的各个元素</p>
<p>[ PFADD key element <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/hyperloglog-pfadd.html">element …]</a> 添加指定元素到 HyperLogLog 中。<br>[PFCOUNT key <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/hyperloglog-pfcount.html">key …]</a> 返回给定 HyperLogLog 的基数估算值。<br>[PFMERGE destkey sourcekey <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/hyperloglog-pfmerge.html">sourcekey …]</a> 将多个 HyperLogLog 合并为一个 HyperLogLog |</p>
<h5 id="Bitmaps"><a href="#Bitmaps" class="headerlink" title="Bitmaps"></a>Bitmaps</h5><blockquote>
<p>位存储，是一种数据结构。</p>
</blockquote>
<p>只有两个状态的，可以直接用 0 1 代表状态的数据， 可以直接操作二进制结构数据。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">setbit key offset value  <span class="comment">#添加key和对应的值。 offset 位偏移量，value 位上的值，只能是0或者1</span></span><br><span class="line">127.0.0.1:6379&gt; setbit sign 0 1</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit sign 1 0</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit sign 2 2</span><br><span class="line">(error) ERR bit is not an <span class="built_in">integer</span> or out of range</span><br><span class="line">127.0.0.1:6379&gt; getbit sign 0 <span class="comment">#查询位图上0位的值。</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; bitcount sign <span class="comment">#查询key中的值为1的有多少个。</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure>

<h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2><p>Redis事务的本质：一组命令的集合。</p>
<p><strong>Redis 单条命令是保证原子性的，但是事务不保证原子性。</strong></p>
<p>一个事务从开始到执行会经历以下三个阶段：</p>
<ul>
<li>开始事务。</li>
<li>命令入队。</li>
<li>执行事务。</li>
</ul>
<p>所有的命令在事务中，并没有被直接执行，只有发起执行命令的时候才会被执行Exec</p>
<blockquote>
<p>正常执行事务。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; multi <span class="comment">#开始标记事务</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k1 v1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k2 v2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">exec</span> <span class="comment">#执行事务</span></span><br><span class="line">1) OK</span><br><span class="line">2) OK</span><br><span class="line">3) <span class="string">&quot;v1&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; flushdb</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k1 v1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k2 v2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; get k2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; discard  <span class="comment">#放弃事务</span></span><br><span class="line">OK</span><br></pre></td></tr></table></figure>

<blockquote>
<p>编译型异常（代码有问题，命令有错），事务中所有的命令都不会执行。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k1 v1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; getset k2 <span class="comment">#因为命令输入参数错误，所以命令无法执行,导致整个事务无法正确执行</span></span><br><span class="line">(error) ERR wrong number of arguments <span class="keyword">for</span> <span class="string">&#x27;getset&#x27;</span> <span class="built_in">command</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k3 v3</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">exec</span></span><br><span class="line">(error) EXECABORT Transaction discarded because of previous errors.</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">(empty list or <span class="built_in">set</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>运行时异常，如果事务队列中语法正确，但是逻辑错误，那么执行命令的时候，其他的命令是可以正常执行的，错误命令抛错。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; flushdb</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k1 <span class="string">&quot;v1&quot;</span></span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; incr k1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k2 v2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">exec</span></span><br><span class="line">1) OK</span><br><span class="line">2) (error) ERR value is not an <span class="built_in">integer</span> or out of range</span><br><span class="line">3) OK</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>

<h4 id="监控"><a href="#监控" class="headerlink" title="监控"></a>监控</h4><p>悲观锁：</p>
<ul>
<li>很悲观，无论什么时候都会出问题，无论做什么都加锁</li>
</ul>
<p>乐观锁</p>
<ul>
<li>很乐观，认为什么时候都不不会出现问题，所以不会上锁！更新数据的时候去判断一下，在此期间是否有人修改过这个数据。</li>
</ul>
<h5 id="redis-监视测试"><a href="#redis-监视测试" class="headerlink" title="redis 监视测试"></a>redis 监视测试</h5><p>正常执行成功：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) <span class="string">&quot;out&quot;</span></span><br><span class="line">2) <span class="string">&quot;money&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; watch money</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; decrby money 20</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; incrby out 20</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">exec</span></span><br><span class="line">1) (<span class="built_in">integer</span>) 80</span><br><span class="line">2) (<span class="built_in">integer</span>) 20</span><br></pre></td></tr></table></figure>

<p>执行失败</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; decrby money 10</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; incrby out 10</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">####在上述事务未提交之前，另外一个线程修改了money的值</span></span><br><span class="line">127.0.0.1:6379&gt; get money</span><br><span class="line"><span class="string">&quot;80&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> money 10000</span><br><span class="line">OK</span><br><span class="line"><span class="comment">####再次提交事务就会失败</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; incrby out 10</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">exec</span> <span class="comment">###执行返回值是nil 执行失败</span></span><br><span class="line">(nil)</span><br><span class="line">127.0.0.1:6379&gt; mget money out</span><br><span class="line">1) <span class="string">&quot;10000&quot;</span></span><br><span class="line">2) <span class="string">&quot;0&quot;</span></span><br></pre></td></tr></table></figure>

<h5 id="取消watch机制"><a href="#取消watch机制" class="headerlink" title="取消watch机制#"></a>取消watch机制#</h5><p>①WATCH 命令可以被调用多次。对键的监视从 WATCH 执行之后开始生效，直到调用 EXEC 为止。不管事务是否成功执行，对所有键的监视都会被取消。<br>②当客户端断开连接时，该客户端对键的监视也会被取消。<br>③UNWATCH 命令可以手动取消对所有键的监视</p>
<h2 id="Jedis"><a href="#Jedis" class="headerlink" title="Jedis"></a>Jedis</h2><blockquote>
<p>Jedis 是Redis官方推荐的java连接开发工具！使用java操作Redis的中间件！如果要使用java操作redis，那么需要对jedis熟悉。</p>
</blockquote>
<p>配置依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>Redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.2.graal<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>事务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.Robert.jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Transaction;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Robert</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2022-05-07 0:05</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JavaTestTX</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">        jedis.flushDB();</span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">        <span class="comment">//开启事务</span></span><br><span class="line">        <span class="type">Transaction</span> <span class="variable">multi</span> <span class="operator">=</span> jedis.multi();</span><br><span class="line">        jsonObject.put(<span class="string">&quot;user1&quot;</span>,<span class="string">&quot;Robert&quot;</span>);</span><br><span class="line">        jsonObject.put(<span class="string">&quot;user2&quot;</span>,<span class="string">&quot;Daisy&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">string</span> <span class="operator">=</span> jsonObject.toJSONString();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            multi.set(<span class="string">&quot;user1&quot;</span>,string);</span><br><span class="line">            multi.set(<span class="string">&quot;user2&quot;</span>,string);</span><br><span class="line">            <span class="type">int</span> i=<span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line">            multi.exec();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            multi.discard();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            System.out.println(jedis.get(<span class="string">&quot;user1&quot;</span>));</span><br><span class="line">            System.out.println(jedis.keys(<span class="string">&quot;*&quot;</span>));</span><br><span class="line"><span class="comment">//            System.out.println(jedis.get(&quot;user2&quot;));</span></span><br><span class="line">            jedis.close();</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<h2 id="Springt-boot-redis"><a href="#Springt-boot-redis" class="headerlink" title="Springt-boot-redis"></a>Springt-boot-redis</h2><p>问题</p>
<h2 id="Redis-conf-详解"><a href="#Redis-conf-详解" class="headerlink" title="Redis.conf 详解"></a>Redis.conf 详解</h2><p>1、配置文件unit单位对大小写不敏感</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Note on units: when memory size is needed, it is possible to specify</span></span><br><span class="line"><span class="comment"># it in the usual form of 1k 5GB 4M and so forth:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 1k =&gt; 1000 bytes</span></span><br><span class="line"><span class="comment"># 1kb =&gt; 1024 bytes</span></span><br><span class="line"><span class="comment"># 1m =&gt; 1000000 bytes</span></span><br><span class="line"><span class="comment"># 1mb =&gt; 1024*1024 bytes</span></span><br><span class="line"><span class="comment"># 1g =&gt; 1000000000 bytes</span></span><br><span class="line"><span class="comment"># 1gb =&gt; 1024*1024*1024 bytes</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># units are case insensitive so 1GB 1Gb 1gB are all the same.</span></span><br></pre></td></tr></table></figure>

<p>2、包含，可以包含多个配置文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">################################## INCLUDES ###################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Include one or more other config files here.  This is useful if you</span></span><br><span class="line"><span class="comment"># have a standard template that goes to all Redis servers but also need</span></span><br><span class="line"><span class="comment"># to customize a few per-server settings.  Include files can include</span></span><br><span class="line"><span class="comment"># other files, so use this wisely.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Notice option &quot;include&quot; won&#x27;t be rewritten by command &quot;CONFIG REWRITE&quot;</span></span><br><span class="line"><span class="comment"># from admin or Redis Sentinel. Since Redis always uses the last processed</span></span><br><span class="line"><span class="comment"># line as value of a configuration directive, you&#x27;d better put includes</span></span><br><span class="line"><span class="comment"># at the beginning of this file to avoid overwriting config change at runtime.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If instead you are interested in using includes to override configuration</span></span><br><span class="line"><span class="comment"># options, it is better to use include as the last line.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># include .\path\to\local.conf</span></span><br><span class="line"><span class="comment"># include c:\path\to\other.conf</span></span><br></pre></td></tr></table></figure>

<p>3、网络</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bind</span> 127.0.0.1 <span class="comment">#绑定ip</span></span><br><span class="line">protected-mode <span class="built_in">yes</span> <span class="comment">#保护模式</span></span><br><span class="line">port 6379	<span class="comment">#端口</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>4、通用配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">daemonize <span class="built_in">yes</span>	<span class="comment">#是否以守护进程启动，windows上不能以守护进程启动</span></span><br><span class="line">pidfile <span class="string">&quot;/var/run/redis.pid&quot;</span> <span class="comment">#指定pid文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#日志</span></span><br><span class="line"><span class="comment"># Specify the server verbosity level.</span></span><br><span class="line"><span class="comment"># This can be one of:</span></span><br><span class="line"><span class="comment"># debug (a lot of information, useful for development/testing)</span></span><br><span class="line"><span class="comment"># verbose (many rarely useful info, but not a mess like the debug level)</span></span><br><span class="line"><span class="comment"># notice (moderately verbose, what you want in production probably) 生产环境</span></span><br><span class="line"><span class="comment"># warning (only very important / critical messages are logged)</span></span><br><span class="line">loglevel notice</span><br><span class="line"></span><br><span class="line"><span class="comment">#日志的文件位置</span></span><br><span class="line"><span class="comment"># Specify the log file name. Also &#x27;stdout&#x27; can be used to force</span></span><br><span class="line"><span class="comment"># Redis to log on the standard output.</span></span><br><span class="line">logfile <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#设置数据库的数量，默认是16个</span></span><br><span class="line"><span class="comment"># Set the number of databases. The default database is DB 0, you can select</span></span><br><span class="line"><span class="comment"># a different one on a per-connection basis using SELECT &lt;dbid&gt; where</span></span><br><span class="line"><span class="comment"># dbid is a number between 0 and &#x27;databases&#x27;-1</span></span><br><span class="line">databases 16</span><br><span class="line"></span><br><span class="line"><span class="comment">#是否显示logo</span></span><br><span class="line"><span class="comment"># By default Redis shows an ASCII art logo only when started to log to the</span></span><br><span class="line"><span class="comment"># standard output and if the standard output is a TTY. Basically this means</span></span><br><span class="line"><span class="comment"># that normally a logo is displayed only in interactive sessions.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># However it is possible to force the pre-4.0 behavior and always show a</span></span><br><span class="line"><span class="comment"># ASCII art logo in startup logs by setting the following option to yes.</span></span><br><span class="line">always-show-logo <span class="built_in">yes</span></span><br></pre></td></tr></table></figure>

<p>4、快照配置</p>
<p>在规定的时间内，执行了多少次操作，则会持久化到文件中。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Save the DB on disk:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   save &lt;seconds&gt; &lt;changes&gt;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   Will save the DB if both the given number of seconds and the given</span></span><br><span class="line"><span class="comment">#   number of write operations against the DB occurred.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   In the example below the behaviour will be to save:</span></span><br><span class="line"><span class="comment">#   after 900 sec (15 min) if at least 1 key changed</span></span><br><span class="line"><span class="comment">#   after 300 sec (5 min) if at least 10 keys changed</span></span><br><span class="line"><span class="comment">#   after 60 sec if at least 10000 keys changed</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   Note: you can disable saving completely by commenting out all &quot;save&quot; lines.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   It is also possible to remove all the previously configured save</span></span><br><span class="line"><span class="comment">#   points by adding a save directive with a single empty string argument</span></span><br><span class="line"><span class="comment">#   like in the following example:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   save &quot;&quot;</span></span><br><span class="line"></span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br><span class="line"></span><br><span class="line"><span class="comment">#持续化如果出错，是否继续工作</span></span><br><span class="line">stop-writes-on-bgsave-error <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#是否压缩，压缩rdb文件的时候，会消耗cpu资源</span></span><br><span class="line">rdbcompression <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#保存rdb文件的时候，是否进行错误的校验检查</span></span><br><span class="line">rdbchecksum <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#备份文件的名字</span></span><br><span class="line"><span class="comment"># The filename where to dump the DB</span></span><br><span class="line">dbfilename dump.rdb</span><br><span class="line"></span><br><span class="line"><span class="comment">#数据文件的放置路径</span></span><br><span class="line"><span class="comment"># The working directory.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The DB will be written inside this directory, with the filename specified</span></span><br><span class="line"><span class="comment"># above using the &#x27;dbfilename&#x27; configuration directive.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The Append Only File will also be created inside this directory.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Note that you must specify a directory here, not a file name.</span></span><br><span class="line"><span class="built_in">dir</span> ./</span><br></pre></td></tr></table></figure>

<p>5、REPLICATION 复制，主从复制</p>
<p>6、SECURITY</p>
<p>7、CLIENTS </p>
<p>maxclients 10000 #设置连接的最大的客户算数量</p>
<p>maxmemory <bytes> #redis配置最大的内存</bytes></p>
<p>maxmemory-policy noeviction #内存到达上线后，的处理策略</p>
<p>当 Redis 内存使用达到 <code>maxmemory </code>时，需要选择设置好的 <code>maxmemory-policy </code>进行对数据进行淘汰机制。</p>
<p>​    1. volatile-lru(least recently used):最近最少使用算法，从设置了过期时间的键key中选择空转时间最长的键值对清除掉；</p>
<p>​    2. volatile-lfu(least frequently used):最近最不经常使用算法，从设置了过期时间的键中选择某段时间之内使用频次最小的键值对清除掉；</p>
<p>​    3. volatile-ttl:从设置了过期时间的键中选择过期时间最早的键值对清除；</p>
<p>​    4. volatile-random:从设置了过期时间的键中，随机选择键进行清除；</p>
<p>​    5. allkeys-lru:最近最少使用算法，从所有的键中选择空转时间最长的键值对清除；</p>
<p>​    6. allkeys-lfu:最近最不经常使用算法，从所有的键中选择某段时间之内使用频次最少的键值对清除；</p>
<p>​    7.allkeys-random:所有的键中，随机选择键进行删除；</p>
<p>​    8. noeviction:不做任何的清理工作，在redis的内存超过限制之后，所有的写入操作都会返回错误；但是读操作都能正常的进行;</p>
<p>8、 APPEND ONLY MODE</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">appendonly no <span class="comment">#默认是不开启aof模式的，默认是使用rdb方式持久化，开启的话参数改成yes</span></span><br><span class="line"><span class="comment"># The name of the append only file (default: &quot;appendonly.aof&quot;)</span></span><br><span class="line">appendfilename <span class="string">&quot;appendonly.aof&quot;</span>	<span class="comment">#持久化文件的名字</span></span><br><span class="line"><span class="comment"># appendfsync always  #每次修改都会sync，消耗性能</span></span><br><span class="line">appendfsync everysec	<span class="comment">#每秒执行一次</span></span><br><span class="line"><span class="comment"># appendfsync no	#不执行sync，需要操作系统自动同步数据，速度最快。</span></span><br></pre></td></tr></table></figure>

<h2 id="Redis-持久化"><a href="#Redis-持久化" class="headerlink" title="Redis 持久化"></a>Redis 持久化</h2><p>Redis支持两种方式的持久化，一种是RDB方式、另一种是AOF（append-only-file）方式，两种持久化方式可以单独使用其中一种，也可以将这两种方式结合使用。</p>
<p>RDB：根据指定的规则“定时”将内存中的数据存储在硬盘上，生成的快照<br>AOF：每次执行命令后将命令本身记录下来，每次执行命令都会将命令写入到aof文件中</p>
<h3 id="RDB模式"><a href="#RDB模式" class="headerlink" title="RDB模式"></a>RDB模式</h3><p>RDB的持久化方式是通过快照（snapshotting）完成的，它是Redis默认的持久化方式，</p>
<p>Redis允许用户自定义快照条件，当符合快照条件时，Redis会自动执行快照操作。快照的条件可以由用户在配置文件中配置。配置格式如下</p>
<h4 id="根据配置文件中设置的策略，自动触发。"><a href="#根据配置文件中设置的策略，自动触发。" class="headerlink" title="根据配置文件中设置的策略，自动触发。"></a>根据配置文件中设置的策略，自动触发。</h4><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">save m n //m 代表秒数，n 代表次数，表示 m 秒内发生 n 次变化时，会触发 bgsave。</span><br><span class="line">//redis.conf 中的三个默认配置项</span><br><span class="line">//设置多个 save m n 命令时，满足任何一个条件都会触发持久化。</span><br><span class="line">save 900 1 //表示的是时间900秒内，如果 Redis 中数据至少发生一次变化，就会执行bgsave</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br></pre></td></tr></table></figure>

<h4 id="手动操作触发持久化："><a href="#手动操作触发持久化：" class="headerlink" title="手动操作触发持久化："></a>手动操作触发持久化：</h4><h5 id="save-命令"><a href="#save-命令" class="headerlink" title="save 命令"></a><strong>save 命令</strong></h5><p>Redis 处理命令的方式是以单线程形式来进行的，客户端的请求都会放入一个队列里。当执行 save 命令时，如果执行时间很长的话，后面的请求就会被阻塞，客户端发送的所有命令都会被拒绝。</p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Redis\v2-3036a75a8358d30a8433786839a497e9_r.jpg" alt="preview"></p>
<h5 id="bgsave-命令"><a href="#bgsave-命令" class="headerlink" title="bgsave 命令"></a><strong>bgsave 命令</strong></h5><p>与 save 不同的是，执行过程中它并不会阻塞客户端的请求。而是将持久化工作交给子进程来执行，主进程仍负责客户端请求的处理工作。</p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Redis\v2-05967df1adcf64a26f0edfe54d879b5f_r.jpg" alt="preview"></p>
<p>Redis会单独创建(fork)一个子进程来进行持久化，会先将数据写入到一个临时文件中，待持久化过程都结束了，再用这个临时文件替换上次持久化好的文件。整个过程中，主进程是不进行任何IO操作的，这就确保了极高的性能。如果需要进行大规模数据的恢复，且对于数据恢复的完整性不是非常敏感，那RDB方式要比AOF方式更加的高效。RDB的缺点是最后一次持久化后的数据可能丢失。</p>
<p>优点：</p>
<ul>
<li>对数据的完整性不高</li>
<li>生成RDB文件的时候，redis主进程会fork()一个子进程来处理所有保存工作，，主进程不需要进行任何磁盘IO操作。</li>
<li>RDB 在恢复大数据集时的速度比AOF的恢复速度要快，适合大规模的数据恢复</li>
</ul>
<p>缺点：</p>
<p>1、需要一定的实践间隔进行操作，如果意外宕机，可能会丢失一定的数据</p>
<p>2、RDB方式数据没办法做到实时持久化/秒级持久化。因为bgsave每次运行都要执行fork操作创建子进程，频繁执行成本过高</p>
<ul>
<li>问题</li>
</ul>
<blockquote>
<p><strong>关于fork</strong></p>
</blockquote>
<p>在Linux程序中，fork()会产生一个和父进程完全相同的子进程，出于效率考虑，Linux中引入了“写时复制技术”，一般情况父进程和子进程会共用同一段物理内存，只有进程空间的各段的内容要发生变化时，才会将父进程的内容复制一份给子进程。</p>
<blockquote>
<p><strong>RDB 做快照的时候数据能修改吗？</strong></p>
</blockquote>
<p>save是同步的会阻塞客户端命令，bgsave的时候是可以修改的。</p>
<blockquote>
<p><strong>Redis怎么解决在bgsave做快照的时候允许数据修改呢？</strong></p>
</blockquote>
<p>这里主要是利用<code>bgsave</code>的子线程实现的，具体操作如下：</p>
<ul>
<li>如果主线程执行读操作，则主线程和 <code>bgsave</code> 子进程互相不影响；</li>
<li>如果主线程执行写操作，则被修改的数据会复制一份副本，然后 <code>bgsave</code>子进程会把该副本数据写入 RDB 文件，在这个过程中，主线程仍然可以直接修改原来的数据。</li>
</ul>
<h3 id="AOF持久化方式"><a href="#AOF持久化方式" class="headerlink" title="AOF持久化方式"></a>AOF持久化方式</h3><p>AOF(Append Only File)：Redis 默认不开启。AOF采用日志的形式来记录每个写操作，并追加到文件中。开启后，执行更改Redis数据的命令时，就会把命令写入到AOF文件中。</p>
<p>Redis 重启时会根据日志文件的内容把写指令从前到后执行一次以完成数据的恢复工作。</p>
<blockquote>
<p>写后日志的方式，Redis先执行命令把数据写入内存，然后再记录日志到文件中。<br>主要是由于Redis在写入日志之前，不对命令进行语法检查，所以只记录执行成功的命令，避免出现记录错误命令的情况，而且在命令执行后再写日志不会阻塞当前的写操作。<br>后写日志主要有两个风险可能会发生：</p>
<ol>
<li>数据可能会丢失：如果 Redis 刚执行完命令，此时发生故障宕机，会导致这条命令存在丢失的风险。</li>
<li>可能阻塞其他操作：AOF 日志其实也是在主线程中执行，所以当 Redis 把日志文件写入磁盘的时候，还是会阻塞后续的操作无法执行。</li>
</ol>
</blockquote>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Redis\v2-08377a93ce41e92d3b694260bfca03af_r.jpg" alt="preview"></p>
<p><strong>AOF 实现方式</strong></p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Redis\v2-1d6ff449f5cdc0441f0a4759157df862_r.jpg" alt="preview"></p>
<p>想要使用 AOF 持久化方式，需要启用配置文件中的 appendonly 参数。默认情况下，Redis 是不开启的。</p>
<p>开启 AOF 持久化后每执行一条修改数据的命令，Redis 就会将该命令写入 aof_buf 缓冲区。后续还需要设置同步选项，从而确保写命令同步到磁盘文件上的时机。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">appendfsync always //每个写命令都同步</span><br><span class="line">appendfsync everysec //每秒同步一次</span><br><span class="line">appendfsync no //让操作系统来决定何时同步</span><br></pre></td></tr></table></figure>

<p><strong>AOF 重写机制</strong></p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Redis\v2-4958e6ede3af9e5bc91c48a3a7064a61_r.jpg" alt="preview"></p>
<p>redis 配置文件中有两个对应的参数是来决定重写机制的触发时机的。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">auto-aof-rewrite-percentage 100 //AOF文件距离上次文件增长超过多少百分比</span><br><span class="line">auto-aof-rewrite-min-size 64mb //AOF文件体积最小多大以上触发</span><br></pre></td></tr></table></figure>

<p>满足所设置的条件时，会自动触发 AOF 重写，此时 Redis 会扫描整个实例的数据，重新生成一个 AOF 文件来达到瘦身的效果。</p>
<p>所以AOF重写机制，其实是重新生成一个AOF日志文件，只将当前有效并存在的数据转义成符合AOF日志格式的记录，然后依次写入该日志文件，最后刷入硬盘。这些操作都是在子进程中进行的，应该不会阻塞主进程，而导致无法处理新的请求。</p>
<p>子进程还带来了一个问题，就是在子进程在生成AOF重写日志的时候，主进程还在处理新的请求，那么这段区间的写命令是没有记录下来的。Linux的进程之间的通信可以<a href="https://link.zhihu.com/?target=https://linux.die.net/man/2/pipe">pipe</a>机制进行，Redis通过该机制，主进程将该段区间执行的命令传递给子进程，然后子进程将这些命令追加到AOF重写日志的末尾，因而解决了这个问题。</p>
<p><strong>AOF 文件恢复</strong></p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Redis\v2-aea493971eb7bd69608d9995e9302070_720w.jpg" alt="img"></p>
<p>和 RBD 不同的是，Redis 中是通过创建一个不带网络连接的伪客户端来进行实现的。为什么要创建伪客户端呢？AOF 文件中的数据格式，都是由命令组成的。通过客户端直接执行每条命令就可以将数据进行恢复。</p>
<p>在这里需要注意的是，如果服务器开启了 AOF 持久化功能，会优先使用 AOF 文件来进行恢复。只有在 AOF 关闭状态下，服务器才会使用 RDB 文件来进行还原。</p>
<p><strong>（1）优点</strong></p>
<ul>
<li>数据更完整：AOF 中是及时写入的方式，数据保存更完整。恢复时降低数据的损失。</li>
<li>易读性强：AOF 中保存的数据格式是客户端的写入命令，可读性性强。</li>
</ul>
<p><strong>（2）缺点</strong></p>
<ul>
<li>文件体积大：AOF 中存储客户端所有的写命令，未经压缩，随着命令的写入，文件会越来越大。</li>
<li>增加磁盘IO：AOF 文件刷盘如果采用每秒刷一次的方式会导致磁盘IO升高，影响性能</li>
</ul>
<h3 id="混合持久化"><a href="#混合持久化" class="headerlink" title="混合持久化"></a><strong>混合持久化</strong></h3><p><strong>混合持久化</strong>其实就是 RDB 与 AOF 的混合模式，这是 Redis4.0 之后新增的。</p>
<p><strong>4.1、持久化方式</strong></p>
<p>混合持久化是通过 aof-use-rdb-preamble 参数来开启的。它的操作方式是这样的，在写入的时候先把数据以 RDB 的形式写入文件的开头，再将后续的写命令以 AOF 的格式追加到文件中。这样既能保证数据恢复时的速度，同时又能减少数据丢失的风险。</p>
<p><strong>文件恢复</strong></p>
<p>在 Redis 重启时，先加载 RDB 的内容，然后再重放增量 AOF 格式命令。这样就避免了 AOF 持久化时的全量加载，从而使加载速率得到大幅提升。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a><strong>总结</strong></h3><p><strong>RDB持久化</strong></p>
<ul>
<li>将某一时刻的数据以二进制形式写入到磁盘里，服务重启时检测到对应文件自动加载进行数据恢复。</li>
<li>有手动触发和自动触发两种机制。</li>
</ul>
<p><strong>AOF持久化</strong></p>
<ul>
<li>以文件追加的方式写入客户端执行的写命令。</li>
<li>数据恢复时，通过创建伪客户端的方式执行命令，直到恢复完成。</li>
</ul>
<p><strong>混合持久化</strong></p>
<ul>
<li>在写入的时候先把数据以 RDB 的形式写入文件的开头，再将后续的写命令以 AOF 的格式追加到文件中。</li>
</ul>
<p>redis持久化分为两种方式，一种是rdb持久化，一种是aof持久化。其中rdb持久化是快照持久化，用二进制的方式存储内存中某一时刻的数据，优点就是文件体积小，缺点就是突然发生宕机，最后一次快照之后的数据会丢失。而aof持久化是文件追加持久化，它会把redis所有的写命令全部记录在日志中，优点就是数据完整性好，缺点就是随着命令的写入，日志文件的体积会越来越大，而且aof恢复的速度也会比rdb持久化慢许多。</p>
<p>rdb会通过fork一个子进程来进行持久化，会先将数据写入到一个临时文件中，待持久化过程都结束了，再用这个临时文件替换上次持久化好的文件。如果期间主线程执行写操作，则被修改的数据会复制一份副本，然后子进程会把该副本数据写入 RDB 文件。</p>
<p>随着命令的不断写入，AOF 文件会变得越来越大，Redis 中提供了瘦身功能，也就是重写机制。Redis 配置文件中有两个对应的参数是来决定重写机制的触发时机的。AOF文件距离上次文件增长超过多少百分比/AOF文件体积最小多大以上触发。满足所设置的条件时，会自动触发 AOF 重写，此时 Redis 会扫描整个实例的数据，重新生成一个 AOF 文件来达到瘦身的效果。这里其实是只将当前有效并存在的数据转义成符合AOF日志格式的记录，然后依次写入该日志文件，最后刷入硬盘。同理，这些操作也是在子进程中进行的，不会阻塞主进程，而导致无法处理新的请求。且还带来了一个问题，就是在子进程在生成AOF重写日志的时候，主进程还在处理新的请求，那么这段区间的写命令是没有记录下来的。Linux的进程之间的通信可以<a href="https://link.zhihu.com/?target=https://linux.die.net/man/2/pipe">pipe</a>机制进行，Redis通过该机制，主进程将该段区间执行的命令传递给子进程，然后子进程将这些命令追加到AOF重写日志的末尾，因而解决了这个问题。</p>
<h2 id="Redis发布订阅"><a href="#Redis发布订阅" class="headerlink" title="Redis发布订阅"></a>Redis发布订阅</h2><p>Redis 发布订阅 (pub/sub) 是一种消息通信模式：发送者 (pub) 发送消息，订阅者 (sub) 接收消息。</p>
<p>Redis 客户端可以订阅任意数量的频道。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#命令及描述 </span></span><br><span class="line">PSUBSCRIBE pattern [pattern ...]	<span class="comment">#订阅一个或多个符合给定模式的频道。 </span></span><br><span class="line">PUBSUB subcommand [argument ...]	<span class="comment">#查看订阅与发布系统状态。 </span></span><br><span class="line">PUBLISH channel message 			<span class="comment">#将信息发送到指定的频道。 </span></span><br><span class="line">PUNSUBSCRIBE [pattern [pattern ...\]]	<span class="comment">#退订所有给定模式的频道。 </span></span><br><span class="line">SUBSCRIBE channel [channel ...\] 	<span class="comment">#订阅给定的一个或多个频道的信息。 </span></span><br><span class="line">UNSUBSCRIBE [channel [channel ...\]] 	<span class="comment">#指退订给定的频道。 </span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>测试</p>
</blockquote>
<p>客户端：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; subscribe Robert  <span class="comment">#订阅Robert频道</span></span><br><span class="line">Reading messages... (press Ctrl-C to quit)</span><br><span class="line">1) <span class="string">&quot;subscribe&quot;</span></span><br><span class="line">2) <span class="string">&quot;Robert&quot;</span></span><br><span class="line">3) (<span class="built_in">integer</span>) 1</span><br><span class="line">1) <span class="string">&quot;message&quot;</span></span><br><span class="line">2) <span class="string">&quot;Robert&quot;</span></span><br><span class="line">3) <span class="string">&quot;hello,Robert&quot;</span></span><br></pre></td></tr></table></figure>

<p>发送端：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; publish Robert <span class="string">&quot;hello,Robert&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure>

<h2 id="Redis-主从复制"><a href="#Redis-主从复制" class="headerlink" title="Redis 主从复制"></a>Redis 主从复制</h2><p>主从复制，读写分离。减缓服务器的压力。<br>主从复制，是指将一台Redis服务器的数据，复制到其他的Redis服务器。前者称为主节点(master)，后者称为从节点(slave),数据的复制是单向的，只能由主节点到从节点。默认情况下，每台Redis服务器都是主节点；且一个主节点可以有多个从节点(或没有从节点)，但一个从节点只能有一个主节点。</p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Redis\285763-20220214202335680-1625341776.png" alt="img"></p>
<h3 id="主从复制的作用"><a href="#主从复制的作用" class="headerlink" title="主从复制的作用"></a><strong>主从复制的作用</strong></h3><ol>
<li>数据冗余：主从复制实现了数据的热备份，是持久化之外的一种数据冗余方式。</li>
<li>故障恢复：当主节点出现问题时，可以由从节点提供服务，实现快速的故障恢复；实际上是一种服务的冗余。</li>
<li>负载均衡：在主从复制的基础上，配合读写分离，可以由主节点提供写服务，由从节点提供读服务（即写Redis数据时应用连接主节点，读Redis数据时应用连接从节点），分担服务器负载；尤其是在写少读多的场景下，通过多个从节点分担读负载，可以大大提高Redis服务器的并发量。</li>
<li>读写分离：可以用于实现读写分离，主库写、从库读，读写分离不仅可以提高服务器的负载能力，同时可根据需求的变化，改变从库的数量；</li>
<li>高可用基石：除了上述作用以外，主从复制还是哨兵和集群能够实施的基础，因此说主从复制是Redis高可用的基础。</li>
</ol>
<h3 id="集群搭建："><a href="#集群搭建：" class="headerlink" title="集群搭建："></a>集群搭建：</h3><p>复制配置文件</p>
<ul>
<li>修改配置文件中端口</li>
<li>dump文件</li>
<li>log文件</li>
</ul>
<p>指定配置文件启动redis服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\redis-server.exe  .\redis.windows-service.conf</span><br></pre></td></tr></table></figure>

<p>将主节点调成从节点并连接两外一个主节点</p>
<h5 id="主从复制的相关操作"><a href="#主从复制的相关操作" class="headerlink" title="主从复制的相关操作"></a>主从复制的相关操作</h5><p>**(1)配置文件:**在从服务器的配置文件中加入 slaveof<masterip><masterport>。例如，新增redis6360.conf, 打开redis6360.conf并加入 slaveof 192.168.152.128 6359, 在6359启动完后再启6360，完成配置；</masterport></masterip></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># replicaof &lt;masterip&gt; &lt;masterport&gt;</span></span><br></pre></td></tr></table></figure>



<p><strong>(2)启动命令：</strong>redis-server启动命令后加入 –slaveof<masterip><masterport>。例如，redis-server –slaveof 192.168.152.128 6359 临时生效，也可以启动后在命令行进行，都是临时的。</masterport></masterip></p>
<p><strong>(3)查看状态：</strong>通过 info replication 命令可以看到复制的一些信息。</p>
<p><strong>(4)断开主从复制：</strong>在slave节点，执行6380:&gt;slaveof no one</p>
<p><strong>(5)断开后再变成主从复制：</strong>6360:&gt; slaveof 192.168.152.128 6359</p>
<p><strong>(6)数据较重要的节点，主从复制时使用密码验证：</strong> requirepass</p>
<p>主节点能进行读写，从节点只能进行读操作。</p>
<p><strong>当主节点宕机时，只能手动的将从节点调成主节点</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slaveof no one</span><br></pre></td></tr></table></figure>



<h4 id="主从复制的方式"><a href="#主从复制的方式" class="headerlink" title="主从复制的方式"></a>主从复制的方式</h4><p><strong>4.1 全量同步</strong><br>Redis全量复制一般发生在Slave初始化阶段，这时Slave需要将Master上的所有数据都复制一份。具体步骤如下：<br>- 从服务器连接主服务器，发送SYNC命令；<br>- 主服务器接收到SYNC命名后，开始执行BGSAVE命令生成RDB文件并使用缓冲区记录此后执行的所有写命令；<br>- 主服务器BGSAVE执行完后，向所有从服务器发送快照文件，并在发送期间继续记录被执行的写命令；<br>- 从服务器收到快照文件后丢弃所有旧数据，载入收到的快照；<br>- 主服务器快照发送完毕后开始向从服务器发送缓冲区中的写命令；<br>- 从服务器完成对快照的载入，开始接收命令请求，并执行来自主服务器缓冲区的写命令；</p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Redis\285763-20220214202426777-229548134.png" alt="img"></p>
<p>完成上面几个步骤后就完成了从服务器数据初始化的所有操作，从服务器此时可以接收来自用户的读请求。</p>
<p><strong>4.2 增量同步</strong><br>Redis增量复制是指Slave初始化后开始正常工作时主服务器发生的写操作同步到从服务器的过程。<br>增量复制的过程主要是主服务器每执行一个写命令就会向从服务器发送相同的写命令，从服务器接收并执行收到的写命令。</p>
<p><strong>Redis主从同步策略</strong><br>主从刚刚连接的时候，进行全量同步；全同步结束后，进行增量同步。当然，如果有需要，slave 在任何时候都可以发起全量同步。redis 策略是，无论如何，首先会尝试进行增量同步，如不成功，要求从机进行全量同步。</p>
<h4 id="哨兵模式"><a href="#哨兵模式" class="headerlink" title="哨兵模式"></a>哨兵模式</h4><p>哨兵模式是一种特殊的模式，首先Redis提供了哨兵的命令，哨兵是一个独立的进程，作为进程，它独立运行。其原理是哨兵通过发送命令，等待Redis服务器响应，从而监控运行的多个Redis实例。</p>
<p>配置哨兵配置文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sentinel   monitor  myredis  127.0.0.1   6379   1</span><br><span class="line">解释 ： sentinel  monitor （被监控的名称）  host  port    1</span><br></pre></td></tr></table></figure>

<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Redis\watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARG91YmxlLVY=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<p>这里哨兵模式有两个作用：<br>通过发送命令，让Redis服务器返回监控其运行状态，包括主服务器和从服务器<br>当哨兵监测到Redis主机宕机，会自动将slave切换成master，然后通过发布订阅模式通知其他服务器，修改配置文件，让他们换主机<br>当一个哨兵进程对Redis服务器进行监控，可能会出现问题，为此可以使用哨兵进行监控， 各个哨兵之间还会进行监控，这就形成了多哨兵模式。</p>
<p>以上过程：假设主服务器宕机，哨兵1先检测到结果，但是系统并不会马上进行failover过程，仅仅是哨兵1主观认为主服务器不可以用，这个现象称为主观下线，当后面的哨兵也检测到主服务器不可用，并且数量达到一定时，那么哨兵之间就会进行一次投票，投票的结果由一个哨兵发起，进行failover故障转移操作。<br>操作转移成功后。就会发布订阅模式，让各个哨兵把自己监控的从服务器实现切换主机，这一过程称为  客观下线<br>此时6379即使修复，也只能变成从机</p>
<p><strong>优点：</strong><br>1.哨兵集群。基于主从复制模式，所有的主从配置优点，它都有<br>2.主从可以切换，故障可以转移，系统可用性就更好<br>3.哨兵模式是主从模式的升级，手动到自动，更完善<br><strong>缺点：</strong><br>1.Redis不好在线扩容，集群容量一旦达到上限，扩容麻烦<br>2.实现配置麻烦<br>哨兵模式的全部配置：</p>
<h2 id="Redis缓存穿透、击穿和雪崩"><a href="#Redis缓存穿透、击穿和雪崩" class="headerlink" title="Redis缓存穿透、击穿和雪崩"></a>Redis缓存穿透、击穿和雪崩</h2><p><strong>缓存穿透</strong>（查不到数据）：用户想要查询一个数据，发现Redis内存数据库里没有，也就是缓存没有命中，于是向 持久层的数据库查询，发现也没有，于是本次查询失败，当用户很多的时候，缓存都没有命中，于是都去请求了持久层数据库，这会给持久层数据库造成很大的压力，出现缓存穿透。</p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Redis\12312.pang" alt="img"></p>
<p>解决方案：布隆过滤器<br>布隆过滤器是一种数据结构，对所有可能查询的参数以hash形式存储，在控制层先进行校验，不符合则丢弃，从而避免了对底层存储系统的压力</p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Redis\watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARG91YmxlLVY=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<p>但是：<br>1、如果空值能被缓存起来，这就意味着缓存需要更多的空间存储更多的键<br>2、即使对空值设置了过期时间，还是会存在缓存层和存储层的数据会有一段时间的窗口不一致</p>
<p><strong>缓存击穿</strong>（访问量过大）：是指某一个key 非常热点，在不停的扛着大的并发，大并发集中对这个点进行访问，当这个key在失效的瞬间，持续的大并发就穿破缓存，直接请求数据库。<br>当某个key过期的瞬间，就会有大量的请求并发访问，这类数据一般是热点数据，由于缓存过期，会同时访问数据库来查询最新数据，并且回写缓存，会导致数据库瞬间压力过大。</p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Redis\rqwr.pang" alt="img">解决：</p>
<p>1、设置热点数据永不过期<br>2、加互斥锁<br>使用分布式锁，保证每一个key同时只有一个线程去查询后端服务，其他线程没有获得分布式锁的权限，只需等待（对分布锁要求高）<br><strong>缓存雪崩</strong>：指在某一个时间段，缓存集中过期失效，Redis宕机</p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Redis\fdasasgas.pang" alt="img">比如 ：双十一零点，抢购，这波商品应该放在缓存区，假设缓存一小时，到了凌晨一点，商品缓存过期，而对于这批商品的访问，都跑到数据库中，对于数据库，产生压力峰。所有请求都会到达存储层，存储层的调用量增加，存储层狗带（缓存服务节点的宕机，对数据库服务器造成的压力不可预知)</p>
<p>解决：<br>1、redis高可用（多增加redis）<br>2、限流降级（通过加锁来控制数据库写缓存的线程数量）<br>3、数据预热（在正式部署之前，把可能的数据先访问一遍）</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://robert-pf.github.io/RobertBlog/2020/04/24/Redis/" data-id="cl309djv50000fkig7bqk2l0l" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/RobertBlog/tags/Redis/" rel="tag">Redis</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Mongodb集群搭建" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/RobertBlog/2020/03/26/Mongodb%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/" class="article-date">
  <time datetime="2020-03-26T15:30:35.000Z" itemprop="datePublished">2020-03-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/RobertBlog/2020/03/26/Mongodb%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/">MongoDB集群</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="副本集群搭建："><a href="#副本集群搭建：" class="headerlink" title="副本集群搭建："></a>副本集群搭建：</h2><p>标准副本集一般会部署三个成员，即一个 Primary 和两个 Secondary，实现数据的冗余和容错。</p>
<p><img src="/RobertBlog/.io//868522-20160105162337293-1637878872.png" alt="img"></p>
<p>注：一个副本集最多有50个成员节点，7个投票节点。</p>
<h5 id="1、准备环境："><a href="#1、准备环境：" class="headerlink" title="1、准备环境："></a>1、准备环境：</h5><p>CentOS Linux release 7.5</p>
<p>mongodb 4.4.13</p>
<h5 id="2、配置文件："><a href="#2、配置文件：" class="headerlink" title="2、配置文件："></a>2、配置文件：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">systemLog:</span><br><span class="line">   destination: file</span><br><span class="line">   <span class="comment">#path: &quot;/mongodb/log/mongod.log&quot;	#备份需要日志路径是绝对路径</span></span><br><span class="line">   logAppend: <span class="literal">true</span></span><br><span class="line">storage:</span><br><span class="line">   <span class="comment">#dbPath: &quot;/mongodb/data&quot;	#路径是绝对路径</span></span><br><span class="line">   journal:</span><br><span class="line">      enabled: <span class="literal">true</span></span><br><span class="line">processManagement:</span><br><span class="line">   fork: <span class="literal">true</span></span><br><span class="line">net:</span><br><span class="line">   bindIp: 0.0.0.0</span><br><span class="line">   port: 27017</span><br><span class="line">setParameter:</span><br><span class="line">   enableLocalhostAuthBypass: <span class="literal">false</span> </span><br><span class="line"><span class="comment">#以下参数在没有创建用户之前，不要添加，可以等待用户创建完成之后再创建。</span></span><br><span class="line">security:</span><br><span class="line">  keyFile: <span class="string">&quot;/var/lib/mongo/mongodb-keyfile&quot;</span> <span class="comment">#指定分片集或副本集成员之间身份验证的key文件存储位置。</span></span><br><span class="line">  clusterAuthMode: <span class="string">&quot;keyFile&quot;</span> <span class="comment">#值keyFile,sendKeyFile,sendX509,x509</span></span><br><span class="line">  authorization: <span class="string">&quot;disabled&quot;</span> <span class="comment">#值：enabled、disabled；打开访问数据库和进行操作的用户角色认证。集群环境下开启了认证参数，就必须配置keyFile。</span></span><br></pre></td></tr></table></figure>

<h5 id="3、生成Key-File，并修改权限。"><a href="#3、生成Key-File，并修改权限。" class="headerlink" title="3、生成Key-File，并修改权限。"></a>3、生成Key-File，并修改权限。</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openssl rand -<span class="built_in">base64</span> 741 &gt; /var/lib/mongo/mongodb-keyfile</span><br><span class="line"><span class="built_in">chmod</span> 600 /var/lib/mongo/mongodb-keyfile</span><br></pre></td></tr></table></figure>

<h5 id="4、启动数据库进程："><a href="#4、启动数据库进程：" class="headerlink" title="4、启动数据库进程："></a>4、启动数据库进程：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/mongodb/bin/mongo -f /mongodb/conf/mongodRepSet1.config --dbpath /mongodb/data/RepSet1/data1 --port 37001 --logpath /mongodb/log/repSet1mongo1.<span class="built_in">log</span> --fork</span><br><span class="line">/mongodb/bin/mongo -f /mongodb/conf/mongodRepSet1.config --dbpath /mongodb/data/RepSet1/data2 --port 37002 --logpath /mongodb/log/repSet1mongo2.<span class="built_in">log</span> --fork</span><br><span class="line">/mongodb/bin/mongo -f /mongodb/conf/mongodRepSet1.config --dbpath /mongodb/data/RepSet1/data3 --port 37003 --logpath /mongodb/log/repSet1mongo3.<span class="built_in">log</span> --fork</span><br></pre></td></tr></table></figure>

<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Mongdb搭建\image-20220329140429690.png" alt="image-20220329140429690"></p>
<h5 id="5、可以将此操作写成一个服务，然后保存到系统中自启动。"><a href="#5、可以将此操作写成一个服务，然后保存到系统中自启动。" class="headerlink" title="5、可以将此操作写成一个服务，然后保存到系统中自启动。"></a>5、可以将此操作写成一个服务，然后保存到系统中自启动。</h5><h5 id="6、新建的集群需要进行初始化操作："><a href="#6、新建的集群需要进行初始化操作：" class="headerlink" title="6、新建的集群需要进行初始化操作："></a>6、新建的集群需要进行初始化操作：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mongos --host ip --port 37001</span><br><span class="line">rs.inintiate() <span class="comment">#初始化集群，并设置当前的secondary节点为主节点</span></span><br><span class="line">rs.status()  <span class="comment">#查询集群的状态。</span></span><br></pre></td></tr></table></figure>

<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Mongdb搭建\image-20220329182724143.png" alt="image-20220329182724143"></p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Mongdb搭建\image-20220329182845054.png" alt="image-20220329182845054"></p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Mongdb搭建\image-20220329183417635.png" alt="image-20220329183417635"></p>
<h5 id="7、创建用户：方便开启集群认证。"><a href="#7、创建用户：方便开启集群认证。" class="headerlink" title="7、创建用户：方便开启集群认证。"></a>7、创建用户：方便开启集群认证。</h5><p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Mongdb搭建\image-20220329183910486.png" alt="image-20220329183910486"></p>
<h5 id="8、将其他的节点加入集群："><a href="#8、将其他的节点加入集群：" class="headerlink" title="8、将其他的节点加入集群："></a>8、将其他的节点加入集群：</h5><p>主节点执行命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">rs.add(<span class="string">&quot;10.5.150.140:37002&quot;</span>)</span><br><span class="line">rs.add(<span class="string">&quot;10.5.150.140:37003&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">或者</span><br><span class="line">cfg=&#123;_id:<span class="string">&#x27;repSet3&#x27;</span>,version:1,members:[&#123;_id:0,host:<span class="string">&#x27;10.5.150.140:47001&#x27;</span>&#125;,&#123;_id:1,host:<span class="string">&#x27;10.5.150.140:47002&#x27;</span>&#125;,&#123;_id:2,host:<span class="string">&#x27;10.5.150.140:47003&#x27;</span>&#125;]&#125;;</span><br><span class="line">rs.initiate(cfg)</span><br></pre></td></tr></table></figure>



<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Mongdb搭建\image-20220329184611038.png" alt="image-20220329184611038"></p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Mongdb搭建\image-20220329184727869.png" alt="image-20220329184727869"></p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Mongdb搭建\image-20220329184847547.png" alt="image-20220329184847547"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">db.updateUser(</span><br><span class="line"> &quot;admin&quot;,</span><br><span class="line">        &#123;</span><br><span class="line">            roles : </span><br><span class="line">            [</span><br><span class="line">                  &#123;&quot;role&quot; : &quot;userAdminAnyDatabase&quot;,&quot;db&quot; : &quot;admin&quot;&#125;,</span><br><span class="line">                  &#123;&quot;role&quot; : &quot;dbOwner&quot;,&quot;db&quot; : &quot;admin&quot;&#125;,</span><br><span class="line">                  &#123;&quot;role&quot; : &quot;clusterAdmin&quot;, &quot;db&quot;: &quot;admin&quot;&#125;</span><br><span class="line">             ]</span><br><span class="line">        &#125;</span><br><span class="line">)  </span><br><span class="line"></span><br><span class="line">use admin</span><br><span class="line">db.createUser(&#123; </span><br><span class="line">user: &quot;admin&quot;, </span><br><span class="line">pwd: &quot;123456&quot;,</span><br><span class="line">roles: [ </span><br><span class="line">&#123; role: &quot;root&quot;, db: &quot;admin&quot; &#125; ,</span><br><span class="line"> &#123;&quot;role&quot; : &quot;dbOwner&quot;,&quot;db&quot; : &quot;admin&quot;&#125;,</span><br><span class="line"> &#123;&quot;role&quot; : &quot;userAdminAnyDatabase&quot;,&quot;db&quot; : &quot;admin&quot;&#125;,</span><br><span class="line"> &#123;&quot;role&quot; : &quot;clusterAdmin&quot;, &quot;db&quot;: &quot;admin&quot;&#125;</span><br><span class="line">] </span><br><span class="line">&#125;</span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure>







<h5 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h5><p>1、启动报错:</p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Mongdb搭建\image-20220328144116292.png" alt="image-20220328144116292"></p>
<p>启动参数中已经写了 –fork 参数。</p>
<p>查看mongod的日志：</p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Mongdb搭建\image-20220328144310682.png" alt="image-20220328144310682"></p>
<p>查看/var/lib/mongo/文件夹下确实没有key-file文件。</p>
<p>手动生成文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl rand -<span class="built_in">base64</span> 741 &gt; /var/lib/mongo/mongodb-keyfile</span><br></pre></td></tr></table></figure>

<p>2、启动报错：permission on key-file are too open</p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Mongdb搭建\image-20220328145555491.png" alt="image-20220328145555491"></p>
<p>修改keyfile的权限：chmod 600 key-file。</p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Mongdb搭建\image-20220328145832842.png" alt="image-20220328145832842"></p>
<p>3、启动mongd报错：Cannot assign requested address</p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Mongdb搭建\image-20220328214143562.png" alt="image-20220328214143562"></p>
<p>要设置bindIP和现有的ip一致。</p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Mongdb搭建\image-20220328151832240.png" alt="image-20220328151832240"></p>
<p>4、配置文件参数：setParameter-enableLocalhostAuthBypass 详解;</p>
<p>在搭建<code>mongodb</code>副本集的时候需要给副本集开启 keyFile 认证，开了此认证的话就代表着<code>authorizatizon</code> 参数是<code>enabled</code> 的，在之后登录数据库的时候需要通过用户认证才能在数据库中执行操作。</p>
<p>背景：在搭建集群的时候，配置文件中开启了认证模式。但是最开始搭建集群的时候，集群初始化时是没有用户的，那么怎么才能进入数据库执行添加用户操作呢？注释<code>security</code>是一种方法，但是太麻烦了。</p>
<p>解决方案：在配置文件中添加<code>setParameter-enableLocalhostAuthBypass：true</code> 此条参数的作用是： localhost exception（本地例外） 允许你在开启安全认证的同时在系统中创建第一个用户。在你开启安全认证之后，你可以使用 localhost exception这个特性去连接到mongo shell，然后在admin数据库下创建第一个账号。该账号必须有创建其他账号的权限，比如有userAdmin或者userAdminAnyDatabase角色的账号</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">setParameter:</span></span><br><span class="line">   <span class="attr">enableLocalhostAuthBypass:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment">#以下参数在没有创建用户之前，不要添加，可以等待用户创建完成之后再创建。</span></span><br><span class="line"><span class="attr">security:</span></span><br><span class="line">  <span class="attr">keyFile:</span> <span class="string">&quot;/var/lib/mongo/mongodb-keyfile&quot;</span> <span class="comment">#指定分片集或副本集成员之间身份验证的key文件存储位置。</span></span><br><span class="line">  <span class="attr">clusterAuthMode:</span> <span class="string">&quot;keyFile&quot;</span> <span class="comment">#值keyFile,sendKeyFile,sendX509,x509</span></span><br><span class="line">  <span class="attr">authorization:</span> <span class="string">&quot;disabled&quot;</span> <span class="comment">#值：enabled、disabled；打开访问数据库和进行操作的用户角色认证。集群环境下开启了认证参数，就必须配置keyFile。</span></span><br></pre></td></tr></table></figure>

<p>注意因为连接数据库需要用<code>localhost</code>连接，所以<code>bindIp</code>应设置为 <code>0.0.0.0</code></p>
<h2 id="分片集搭建"><a href="#分片集搭建" class="headerlink" title="分片集搭建"></a>分片集搭建</h2><p>副本集可以解决主节点发生故障导致数据丢失或不可用的问题，但遇到需要存储海量数据的情况时，副本集机制就束手无策了。副本集中的一台机器可能不足以存储数据，或者说集群不足以提供可接受的读写吞吐量。这就需要用到 MongoDB 的分片（Sharding）技术，这也是 MongoDB 的另外一种集群部署模式。</p>
<p>分片是指将数据拆分并分散存放在不同机器上的过程。有时也用分区来表示这个概念。将数据分散到不同的机器上，不需要功能强大的大型计算机就可以存储更多的数据，处理更大的负载。</p>
<p>MongoDB 支持自动分片，可以使数据库架构对应用程序不可见，简化系统管理。对应用程序而言，就如同始终在使用一个单机的 MongoDB 服务器一样</p>
<h3 id="MongoDB-分片的集群模式"><a href="#MongoDB-分片的集群模式" class="headerlink" title="MongoDB 分片的集群模式"></a>MongoDB 分片的集群模式</h3><p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Mongdb搭建\6-1911191633025H.gif" alt="img"></p>
<p>构建一个 MongoDB 的分片集群，需要三个重要的组件，分别是分片服务器（Shard Server）、配置服务器（Config Server）和路由服务器（Route Server）。</p>
<h5 id="Shard-Server"><a href="#Shard-Server" class="headerlink" title="Shard Server"></a>Shard Server</h5><p>每个 Shard Server 都是一个 mongod 数据库实例，用于存储实际的数据块。整个数据库集合分成多个块存储在不同的 Shard Server 中。<br>在实际生产中，一个 Shard Server 可由几台机器组成一个副本集来承担，防止因主节点单点故障导致整个系统崩溃。</p>
<h5 id="Config-Server"><a href="#Config-Server" class="headerlink" title="Config Server"></a>Config Server</h5><p>这是独立的一个 mongod 进程，保存集群和分片的元数据，在集群启动最开始时建立，保存各个分片包含数据的信息。</p>
<h5 id="Route-Server"><a href="#Route-Server" class="headerlink" title="Route Server"></a>Route Server</h5><p>这是独立的一个 mongos 进程，Route Server 在集群中可作为路由使用，客户端由此接入，让整个集群看起来像是一个单一的数据库，提供客户端应用程序和分片集群之间的接口。<br>Route Server 本身不保存数据，启动时从 Config Server 加载集群信息到缓存中，并将客户端的请求路由给每个 Shard Server，在各 Shard Server 返回结果后进行聚合并返回客户端。</p>
<p>在实际生产环境中，副本集和分片是结合起来使用的，可满足实际应用场景中高可用性和高可扩展性的需求。</p>
<h3 id="搭建过程："><a href="#搭建过程：" class="headerlink" title="搭建过程："></a>搭建过程：</h3><h4 id="1、搭建两套副本集环境，需要配置"><a href="#1、搭建两套副本集环境，需要配置" class="headerlink" title="1、搭建两套副本集环境，需要配置"></a>1、搭建两套副本集环境，需要配置</h4><p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Mongdb搭建\image-20220511170642156.png" alt="image-20220511170642156"></p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Mongdb搭建\image-20220511170704571.png" alt="image-20220511170704571"></p>
<p> 需要将集群以分片集方式启动，具体操作办法为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#方式一：mongod --shardsvr 启动数据库</span></span><br><span class="line">mongod --shardsvr -f /mongodb/conf/RepSet1/mongoRepSet.conf</span><br><span class="line"><span class="comment">#方式二：在配置文件中添加：</span></span><br><span class="line">sharding: </span><br><span class="line">   clusterRole:shardsvr</span><br></pre></td></tr></table></figure>

<p>配置文件示例：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">systemLog:</span></span><br><span class="line">   <span class="attr">destination:</span> <span class="string">file</span></span><br><span class="line">   <span class="comment">#path: &quot;/mongodb/log/mongod.log&quot;	#备份需要日志路径是绝对路径</span></span><br><span class="line">   <span class="attr">logAppend:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">storage:</span></span><br><span class="line">   <span class="comment">#dbPath: &quot;/mongodb/data&quot;	#路径是绝对路径</span></span><br><span class="line">   <span class="attr">journal:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">processManagement:</span></span><br><span class="line">   <span class="attr">fork:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">net:</span></span><br><span class="line">   <span class="attr">bindIp:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">   <span class="attr">port:</span> <span class="number">27017</span></span><br><span class="line"><span class="attr">setParameter:</span></span><br><span class="line">   <span class="attr">enableLocalhostAuthBypass:</span> <span class="literal">false</span> </span><br><span class="line"><span class="attr">security:</span></span><br><span class="line">  <span class="attr">keyFile:</span> <span class="string">&quot;/var/lib/mongo/mongodb-keyfile&quot;</span> <span class="comment">#指定分片集或副本集成员之间身份验证的key文件存储位置。</span></span><br><span class="line">  <span class="attr">clusterAuthMode:</span> <span class="string">&quot;keyFile&quot;</span> <span class="comment">#值keyFile,sendKeyFile,sendX509,x509</span></span><br><span class="line">  <span class="attr">authorization:</span> <span class="string">&quot;disabled&quot;</span> <span class="comment">#值：enabled、disabled；打开访问数据库和进行操作的用户角色认证。集群环境下开启了认证参数，就必须配置keyFile</span></span><br><span class="line"><span class="attr">sharding:</span> </span><br><span class="line">   <span class="string">clusterRole:shardsvr</span></span><br></pre></td></tr></table></figure>

<p>创建存放数据文件和日志文件的路径：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /mongodb/data</span><br><span class="line"><span class="built_in">mkdir</span> -p /mongodb/log</span><br></pre></td></tr></table></figure>



<h4 id="2、配置-Config-Server"><a href="#2、配置-Config-Server" class="headerlink" title="2、配置 Config Server"></a>2、配置 Config Server</h4><p>配置服务器（Config Server）是普通的 mongod 服务器，保存着集群的配置信息：集群中有哪些分片、分片的是哪些集合，以及数据块的分布。</p>
<p>配置集群其实也是一个MongoDB，可以是副本集也可以是单机，在启动的时候需要进行配置此集群群是 Config Server：具体配置方法如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#方式一：mongod --shardsvr</span></span><br><span class="line">mongod --shardsvr -f /mongodb/conf/RepSet1/mongoRepSet.conf</span><br><span class="line"><span class="comment">#方式二：在配置文件中添加：</span></span><br><span class="line">sharding: </span><br><span class="line">   clusterRole:configsvr </span><br></pre></td></tr></table></figure>

<p>配置文件示例：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">systemLog:</span></span><br><span class="line">   <span class="attr">destination:</span> <span class="string">file</span></span><br><span class="line">   <span class="comment">#path: &quot;/mongodb/log/mongod.log&quot;	#备份需要日志路径是绝对路径</span></span><br><span class="line">   <span class="attr">logAppend:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">storage:</span></span><br><span class="line">   <span class="comment">#dbPath: &quot;/mongodb/data&quot;	#路径是绝对路径</span></span><br><span class="line">   <span class="attr">journal:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">processManagement:</span></span><br><span class="line">   <span class="attr">fork:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">net:</span></span><br><span class="line">   <span class="attr">bindIp:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">   <span class="attr">port:</span> <span class="number">39001</span></span><br><span class="line"><span class="attr">setParameter:</span></span><br><span class="line">   <span class="attr">enableLocalhostAuthBypass:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">security:</span></span><br><span class="line">  <span class="attr">keyFile:</span> <span class="string">&quot;/var/lib/mongo/mongodb-keyfile&quot;</span> <span class="comment">#指定分片集或副本集成员之间身份验证的key文件存储位置。</span></span><br><span class="line">  <span class="attr">clusterAuthMode:</span> <span class="string">&quot;keyFile&quot;</span> <span class="comment">#值keyFile,sendKeyFile,sendX509,x509</span></span><br><span class="line">  <span class="attr">authorization:</span> <span class="string">&quot;disabled&quot;</span> <span class="comment">#值：enabled、disabled；打开访问数据库和进行操作的用户角色认证。集群环境下开启了认证参数，就必须配置keyFile</span></span><br><span class="line">  </span><br><span class="line"><span class="attr">sharding:</span> </span><br><span class="line">   <span class="attr">clusterRole:</span> <span class="string">configsvr</span> </span><br></pre></td></tr></table></figure>

<p>初始化集群：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cfg=&#123;_id:&#x27;config&#x27;,version:1,members:[&#123;_id:0,host:&#x27;10.5.150.140:28001&#x27;&#125;,&#123;_id:1,host:&#x27;10.5.150.140:28002&#x27;&#125;,&#123;_id:2,host:&#x27;10.5.150.140:28003&#x27;&#125;]&#125;;</span><br><span class="line">rs.initiate(cfg)</span><br></pre></td></tr></table></figure>

<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Mongdb搭建\image-20220601135930741.png" alt="image-20220601135930741"></p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Mongdb搭建\image-20220601140026380.png" alt="image-20220601140026380"></p>
<p>至此<code>configDB</code>配置完备</p>
<p>注：使用副本集选项实现了配置信息的冗余存储。配置服务器并不需要太多的空间和资源。配置服务器的 1KB 空间约等于 200MB 真实数据，它保存的只是数据的分布表。配置服务器的工作持久保存集群的公认状态。</p>
<p>目前位置 我们搭建了三个副本集，其中{38001、38002、38003}、{37001、37002、37003} 两个副本集为<code>shard</code>集群，{28001、28002、28003}为<code>config</code>集群</p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Mongdb搭建\image-20220601144624782.png" alt="image-20220601144624782"></p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>10.5.150.140:37001</td>
<td></td>
<td></td>
</tr>
<tr>
<td>10.5.150.140:37002</td>
<td></td>
<td></td>
</tr>
<tr>
<td>10.5.150.140:37003</td>
<td></td>
<td></td>
</tr>
<tr>
<td>10.5.150.140:38001</td>
<td></td>
<td></td>
</tr>
<tr>
<td>10.5.150.140:38002</td>
<td></td>
<td></td>
</tr>
<tr>
<td>10.5.150.140:38003</td>
<td></td>
<td></td>
</tr>
<tr>
<td>10.5.150.140:28001</td>
<td></td>
<td></td>
</tr>
<tr>
<td>10.5.150.140:28002</td>
<td></td>
<td></td>
</tr>
<tr>
<td>10.5.150.140:28003</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="3、配置Route-Server"><a href="#3、配置Route-Server" class="headerlink" title="3、配置Route Server"></a>3、配置<code>Route Server</code></h4><p>在默认情况下，mongos 运行在 27017 端口。注意，并不需要指定数据目录（mongos 自身并不保存数据，它会在启动时从配置服务器加载集群数据）。 mongs进程是非持久化的，确保正确设置了 logpath，以便将 mongos 日志保存到安全的地方。</p>
<p>可启动任意数量的 mongos 进程，通常的设置是每个应用程序服务器使用一个 mongos 进程（与应用服务器运行在同一台机器上）。每个 mongos 进程必须按照列表顺序，使用相同的配置服务器列表，如 –configdb 后面输入的是一个带有三个服务器列表的 config 的副本集的名称。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongos --configdb config/10.5.150.140:28001,10.5.150.140:28002,10.5.150.140:28003 -logpath /mongodb/log/mongos.log --logappend --fork --keyFile /var/libmongo/mongodb-keyfile</span><br></pre></td></tr></table></figure>

<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Mongdb搭建\image-20220602135250380.png" alt="image-20220602135250380"></p>
<p>至此Mongs进程启动成功。</p>
<p>将shard的分片集加入数据库中。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.runCommand (&#123; addshard : &quot;repSet1/10.5.150.140:37001,10.5.150.140:37002,10.5.150.140:37003&quot;, name : &quot;s1&quot;&#125;);</span><br><span class="line">db.runCommand (&#123; addshard : &quot;repSet2/10.5.150.140:38001,10.5.150.140:38002,10.5.150.140:38003&quot;, name : &quot;s2&quot;&#125;);</span><br></pre></td></tr></table></figure>

<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Mongdb搭建\image-20220602144224674.png" alt="image-20220602144224674"></p>
<p>查询分片集状态：sh.status()</p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Mongdb搭建\image-20220602144335839.png" alt="image-20220602144335839"></p>
<p>问题1、搭建过程出现的权限问题：</p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Mongdb搭建\image-20220511180745571.png" alt="image-20220511180745571"></p>
<p>问题2：configure配置了用户认证，在启动<code>mongs</code>进程的时候未配置<code>keyFile</code></p>
<p><img src="/RobertBlog/.io//JavaStudyLocal\RobertBlog\source_posts\Mongdb搭建\image-20220602135414738.png" alt="image-20220602135414738"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://robert-pf.github.io/RobertBlog/2020/03/26/Mongodb%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/" data-id="cl26a2mu9000630uvd19l3fce" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/RobertBlog/tags/MongoDB%E9%9B%86%E7%BE%A4/" rel="tag">MongoDB集群</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/RobertBlog/page/2/">2</a><a class="extend next" rel="next" href="/RobertBlog/page/2/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/RobertBlog/tags/Java-Spring/" rel="tag">Java Spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/RobertBlog/tags/Java-Web/" rel="tag">Java Web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/RobertBlog/tags/LVM/" rel="tag">LVM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/RobertBlog/tags/MongoDB/" rel="tag">MongoDB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/RobertBlog/tags/MongoDB%E9%9B%86%E7%BE%A4/" rel="tag">MongoDB集群</a></li><li class="tag-list-item"><a class="tag-list-link" href="/RobertBlog/tags/MyBatis/" rel="tag">MyBatis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/RobertBlog/tags/Redis/" rel="tag">Redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/RobertBlog/tags/Servlet/" rel="tag">Servlet</a></li><li class="tag-list-item"><a class="tag-list-link" href="/RobertBlog/tags/Web%E7%BD%91%E9%A1%B5/" rel="tag">Web网页</a></li><li class="tag-list-item"><a class="tag-list-link" href="/RobertBlog/tags/idea-java/" rel="tag">idea java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/RobertBlog/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/RobertBlog/tags/Java-Spring/" style="font-size: 20px;">Java Spring</a> <a href="/RobertBlog/tags/Java-Web/" style="font-size: 10px;">Java Web</a> <a href="/RobertBlog/tags/LVM/" style="font-size: 20px;">LVM</a> <a href="/RobertBlog/tags/MongoDB/" style="font-size: 20px;">MongoDB</a> <a href="/RobertBlog/tags/MongoDB%E9%9B%86%E7%BE%A4/" style="font-size: 10px;">MongoDB集群</a> <a href="/RobertBlog/tags/MyBatis/" style="font-size: 20px;">MyBatis</a> <a href="/RobertBlog/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/RobertBlog/tags/Servlet/" style="font-size: 10px;">Servlet</a> <a href="/RobertBlog/tags/Web%E7%BD%91%E9%A1%B5/" style="font-size: 10px;">Web网页</a> <a href="/RobertBlog/tags/idea-java/" style="font-size: 10px;">idea java</a> <a href="/RobertBlog/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 10px;">设计模式</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/RobertBlog/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/RobertBlog/archives/2022/05/">May 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/RobertBlog/archives/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/RobertBlog/archives/2022/03/">March 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/RobertBlog/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/RobertBlog/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/RobertBlog/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/RobertBlog/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/RobertBlog/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/RobertBlog/archives/2020/02/">February 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/RobertBlog/2022/07/29/%E8%87%AA%E6%88%91%E4%BB%8B%E7%BB%8D/">(no title)</a>
          </li>
        
          <li>
            <a href="/RobertBlog/2022/07/17/IO%E6%A8%A1%E5%9E%8B/">(no title)</a>
          </li>
        
          <li>
            <a href="/RobertBlog/2022/05/12/idea%E4%BD%BF%E7%94%A8%E4%B9%8B%E8%B0%9C/">idea</a>
          </li>
        
          <li>
            <a href="/RobertBlog/2022/04/12/%E7%AC%94%E8%AE%B0/">Java 面试题整理笔记</a>
          </li>
        
          <li>
            <a href="/RobertBlog/2022/03/31/Linux%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 Robert Pang<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/RobertBlog/" class="mobile-nav-link">Home</a>
  
    <a href="/RobertBlog/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/RobertBlog/fancybox/jquery.fancybox.css">

  
<script src="/RobertBlog/fancybox/jquery.fancybox.pack.js"></script>




<script src="/RobertBlog/js/script.js"></script>




  </div>
</body>
</html>